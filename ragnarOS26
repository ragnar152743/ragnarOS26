#!/usr/bin/env python3
# -*- coding: utf-8 -*-

# Ragnar OS 26.3.0 ‚Äî PyQt6 √âcosyst√®me Complet (Interface r√©volutionnaire, th√®mes avanc√©s, marketplace)

# - Boot anim√© + bureau en verre

# - Apps : Syst√®me, Fichiers, Store, Navigateur, Chat, Param√®tres

# - Updater : mise √† jour directe depuis Pastebin

# D√©pendances : pip install PyQt6 requests



import os, sys, json, time, random, hashlib, webbrowser, shutil, traceback, subprocess, math
import io

from pathlib import Path

from typing import Dict, Any, List, Optional



import requests

from PyQt6 import QtCore, QtGui, QtWidgets

from PyQt6.QtGui import QDesktopServices

from PyQt6.QtCore import QUrl, QPropertyAnimation, QAbstractAnimation



APP_NAME = "Ragnar OS 26"

PASTEBIN_RAW_BASE = "https://raw.githubusercontent.com/ragnar152743/ragnarOS26/refs/heads/main/"



# üîÑ CONFIGURATION MISE √Ä JOUR - Changez juste cet ID pour mettre √† jour !

UPDATE_PASTEBIN_ID = "ragnarOS26"  # ‚¨ÖÔ∏è Remplacez par l'ID de votre nouveau code GitHub

STATE_DIR = Path.home() / ".ragnar_os26"

STATE_DIR.mkdir(parents=True, exist_ok=True)

STATE_FILE = STATE_DIR / "state.json"

STORE_FILE = STATE_DIR / "store.json"

BACKUP_DIR = STATE_DIR / "backups"
SANDBOX_DIR = STATE_DIR / "sandbox"
MEM_SANDBOX: Dict[str, bytes] = {}

DEFAULT_LOCAL_VERSION = "26.4.0"

# Style moderne noir pour toutes les applications Ragnar OS
RAGNAR_MODERN_STYLE = """
QWidget {
    background: transparent;
    color: white;
    font-family: 'Segoe UI', 'Arial', sans-serif;
    font-size: 12px;
}

QWidget#GlassCard {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(255, 255, 255, 0.25),
        stop:0.3 rgba(255, 255, 255, 0.15),
        stop:0.7 rgba(255, 255, 255, 0.08),
        stop:1 rgba(255, 255, 255, 0.03));
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 20px;
    padding: 16px;
}

QPushButton {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(255, 255, 255, 0.2),
        stop:0.5 rgba(255, 255, 255, 0.1),
        stop:1 rgba(255, 255, 255, 0.05));
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 15px;
    padding: 15px 25px;
    font-weight: 600;
    color: white;
    min-height: 40px;
    font-size: 16px;
}

QPushButton:hover {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(0, 255, 136, 0.3),
        stop:0.5 rgba(0, 255, 136, 0.2),
        stop:1 rgba(0, 255, 136, 0.1));
    border: 2px solid rgba(0, 255, 136, 0.5);
}

QPushButton:pressed {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(0, 255, 136, 0.4),
        stop:0.5 rgba(0, 255, 136, 0.3),
        stop:1 rgba(0, 255, 136, 0.2));
    border: 2px solid rgba(0, 255, 136, 0.7);
}

QLineEdit, QTextEdit, QPlainTextEdit {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(255, 255, 255, 0.15),
        stop:0.5 rgba(255, 255, 255, 0.08),
        stop:1 rgba(255, 255, 255, 0.03));
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 15px 18px;
    color: white;
    font-size: 16px;
    min-height: 25px;
    selection-background-color: rgba(0, 255, 136, 0.3);
}

QLineEdit:focus, QTextEdit:focus, QPlainTextEdit:focus {
    border: 2px solid rgba(0, 255, 136, 0.6);
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(0, 255, 136, 0.15),
        stop:0.5 rgba(0, 255, 136, 0.08),
        stop:1 rgba(0, 255, 136, 0.03));
}

QListWidget, QTreeWidget {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(0, 0, 0, 0.8),
        stop:1 rgba(20, 20, 20, 0.6));
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 10px;
    padding: 5px;
}

QListWidget::item, QTreeWidget::item {
    padding: 10px;
    border-radius: 5px;
    margin: 2px;
}

QListWidget::item:selected, QTreeWidget::item:selected {
    background: qlineargradient(x1:0, y1:0, x2:1, y2:0,
        stop:0 rgba(0, 255, 136, 0.4),
        stop:1 rgba(0, 200, 100, 0.3));
    border: 2px solid rgba(0, 255, 136, 0.6);
}

QListWidget::item:hover, QTreeWidget::item:hover {
    background: rgba(255, 255, 255, 0.1);
}

QTabWidget::pane {
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(0, 0, 0, 0.9),
        stop:1 rgba(20, 20, 20, 0.8));
}

QTabBar::tab {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(40, 40, 40, 0.9),
        stop:1 rgba(20, 20, 20, 0.8));
    border: 2px solid rgba(255, 255, 255, 0.2);
    padding: 10px 20px;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    color: rgba(255, 255, 255, 0.8);
    font-weight: bold;
}

QTabBar::tab:selected {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(0, 255, 136, 0.3),
        stop:1 rgba(0, 200, 100, 0.2));
    border: 2px solid rgba(0, 255, 136, 0.5);
    color: white;
}

QTabBar::tab:hover {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(255, 255, 255, 0.2),
        stop:1 rgba(255, 255, 255, 0.1));
}

QLabel {
    color: white;
    font-size: 12px;
}

QCheckBox {
    color: white;
    font-size: 12px;
    font-weight: bold;
}

QCheckBox::indicator {
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 4px;
    background: rgba(0, 0, 0, 0.6);
}

QCheckBox::indicator:checked {
    background: qlineargradient(x1:0, y1:0, x2:1, y2:1,
        stop:0 rgba(0, 255, 136, 0.8),
        stop:1 rgba(0, 200, 100, 0.8));
    border: 2px solid rgba(0, 255, 136, 0.8);
}

QProgressBar {
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.05);
    text-align: center;
    color: white;
    font-weight: 600;
    font-size: 12px;
    height: 20px;
}

QProgressBar::chunk {
    background: qlineargradient(x1:0, y1:0, x2:1, y2:0,
        stop:0 rgba(0, 255, 136, 0.9),
        stop:0.5 rgba(0, 255, 200, 0.8),
        stop:1 rgba(0, 200, 100, 0.7));
    border-radius: 8px;
    margin: 1px;
}
"""


# ===== CORRECTIONS CRITIQUES POUR STABILIT√â =====

def ensure_files():
    """Assure que tous les fichiers et dossiers n√©cessaires existent"""
    for path in [STATE_DIR, BACKUP_DIR]:
        path.mkdir(parents=True, exist_ok=True)
    
    # Cr√©er state.json s'il n'existe pas, sinon pr√©server l'√©tat existant
    if not STATE_FILE.exists():
        initial_state = {
            "version": DEFAULT_LOCAL_VERSION,
            "theme": "dark",
            "features": {},
            "force_updated": True,
            "welcome_shown": False
        }
        STATE_FILE.write_text(json.dumps(initial_state, ensure_ascii=False, indent=2), encoding="utf-8")
    else:
        try:
            current = json.loads(STATE_FILE.read_text(encoding="utf-8") or "{}")
        except Exception:
            current = {}
        current.setdefault("version", DEFAULT_LOCAL_VERSION)
        current.setdefault("theme", "dark")
        current.setdefault("features", {})
        current.setdefault("force_updated", True)
        current.setdefault("sandbox_enabled", True)
        current.setdefault("sandbox_memory_enabled", True)
        current.setdefault("welcome_shown", False)
        STATE_FILE.write_text(json.dumps(current, ensure_ascii=False, indent=2), encoding="utf-8")
    
    # Cr√©er store.json s'il n'existe pas
    if not STORE_FILE.exists():
        STORE_FILE.write_text('{"apps": [], "installed": []}', encoding="utf-8")
    
    # Cr√©er dossier de logs
    logs_dir = STATE_DIR / "logs"
    logs_dir.mkdir(exist_ok=True)
    SANDBOX_DIR.mkdir(exist_ok=True)

def safe_open(path):
    """Ouvre un fichier de mani√®re compatible multi-OS"""
    try:
        # Sandbox: emp√™cher l'ouverture externe si activ√©e
        st = _read_state_safe()
        if st.get("sandbox_enabled"):
            QtWidgets.QMessageBox.warning(None, "Sandbox", "Ouverture externe bloqu√©e par la sandbox")
            return
        if sys.platform.startswith("win"):
            os.startfile(str(path))
        elif sys.platform.startswith("linux"):
            subprocess.Popen(["xdg-open", str(path)])
        elif sys.platform == "darwin":
            subprocess.Popen(["open", str(path)])
        else:
            QDesktopServices.openUrl(QUrl.fromLocalFile(str(path)))
    except Exception as e:
        QtWidgets.QMessageBox.critical(None, "Erreur", f"Impossible d'ouvrir : {e}")

def handle_exception(exc_type, exc_value, tb):
    """Gestionnaire d'erreurs global pour √©viter les crashes silencieux"""
    import traceback
    err = "".join(traceback.format_exception(exc_type, exc_value, tb))
    print(f"ERREUR RAGNAR OS: {err}")
    
    # Sauvegarder l'erreur dans les logs
    try:
        log_file = STATE_DIR / "logs" / f"error_{int(time.time())}.log"
        log_file.write_text(err, encoding="utf-8")
    except:
        pass
    
    # Afficher l'erreur √† l'utilisateur
    try:
        QtWidgets.QMessageBox.critical(
            None, "‚ö†Ô∏è Erreur Ragnar OS", 
            f"Une erreur est survenue :\n\n{str(exc_value)}\n\nD√©tails sauvegard√©s dans les logs."
        )
    except:
        print("Erreur critique - impossible d'afficher le dialogue")

def _http_get(url: str, binary: bool = False, timeout: int = 15, retries: int = 3, backoff: float = 1.7):
    last_exc = None
    for i in range(retries):
        try:
            r = requests.get(url, timeout=timeout)
            r.raise_for_status()
            return r.content if binary else r.text
        except Exception as e:
            last_exc = e
            time.sleep(backoff ** i)
    raise last_exc

def _sha256_bytes(data: bytes) -> str:
    h = hashlib.sha256()
    h.update(data)
    return h.hexdigest()

def _sha256_file(path: Path) -> str:
    h = hashlib.sha256()
    with open(path, 'rb') as f:
        for chunk in iter(lambda: f.read(1024 * 1024), b''):
            h.update(chunk)
    return h.hexdigest()

def _atomic_write(target: Path, data: bytes):
    tmp = target.with_suffix(target.suffix + ".tmp")
    with open(tmp, 'wb') as f:
        f.write(data)
        f.flush()
        os.fsync(f.fileno())
    os.replace(tmp, target)

def _timestamp() -> str:
    return time.strftime("%Y%m%d-%H%M%S")

def _backup_file(path: Path) -> Path:
    BACKUP_DIR.mkdir(parents=True, exist_ok=True)
    dst = BACKUP_DIR / f"{path.name}.{_timestamp()}.bak"
    shutil.copy2(path, dst)
    return dst

def _load_manifest() -> Optional[Dict[str, Any]]:
    try:
        url = PASTEBIN_RAW_BASE.rstrip('/') + '/manifest.json'
        txt = _http_get(url, binary=False)
        return json.loads(txt)
    except Exception:
        return None

def _current_version() -> str:
    try:
        st = json.loads(STATE_FILE.read_text(encoding="utf-8"))
        return str(st.get("version", DEFAULT_LOCAL_VERSION))
    except Exception:
        return DEFAULT_LOCAL_VERSION

def _update_available(manifest: Dict[str, Any]) -> bool:
    try:
        cv = _current_version()
        mv = str(manifest.get("version", cv))
        def _norm(v: str) -> List[int]:
            return [int(x) for x in (v.split('.')) if x.isdigit()]
        return _norm(mv) > _norm(cv)
    except Exception:
        return False

def _download_self(manifest: Optional[Dict[str, Any]]) -> Optional[bytes]:
    url = None
    sha = None
    if manifest:
        try:
            entry = manifest.get("files", {}).get("ragnarOSupt.py")
            if isinstance(entry, dict):
                url = entry.get("url")
                sha = entry.get("sha256")
        except Exception:
            pass
    if not url:
        url = PASTEBIN_RAW_BASE.rstrip('/') + '/ragnarOSupt.py'
    data = _http_get(url, binary=True)
    if sha:
        calc = _sha256_bytes(data)
        if calc.lower() != str(sha).lower():
            raise RuntimeError("Checksum mismatch")
    return data

def ragnar_self_update(interactive: bool = True, parent: Optional[QtWidgets.QWidget] = None) -> bool:
    try:
        manifest = _load_manifest()
        if manifest and not _update_available(manifest) and interactive:
            QtWidgets.QMessageBox.information(parent, APP_NAME, "Aucune mise √† jour disponible.")
            return False
        if interactive and QtWidgets.QMessageBox.question(parent, APP_NAME, "Mettre √† jour maintenant ?") != QtWidgets.QMessageBox.StandardButton.Yes:
            return False
        data = _download_self(manifest)
        me = Path(__file__).resolve()
        if me.exists():
            _backup_file(me)
        _atomic_write(me, data)
        try:
            st = json.loads(STATE_FILE.read_text(encoding="utf-8") or '{}')
        except Exception:
            st = {}
        if manifest and isinstance(manifest.get("version"), (str, int, float)):
            st["version"] = str(manifest.get("version"))
        else:
            st["version"] = DEFAULT_LOCAL_VERSION
        STATE_FILE.write_text(json.dumps(st, ensure_ascii=False, indent=2), encoding="utf-8")
        if interactive:
            QtWidgets.QMessageBox.information(parent, APP_NAME, "Mise √† jour termin√©e. Red√©marrage recommand√©.")
        return True
    except Exception as e:
        if interactive:
            QtWidgets.QMessageBox.critical(parent, APP_NAME, f"√âchec de la mise √† jour: {e}")
        return False

def _layout_addSeparator(self):
    """Ajoute un s√©parateur √† un layout (correction pour PyQt6)"""
    line = QtWidgets.QFrame()
    if isinstance(self, QtWidgets.QHBoxLayout):
        line.setFrameShape(QtWidgets.QFrame.Shape.VLine)
    else:
        line.setFrameShape(QtWidgets.QFrame.Shape.HLine)
    line.setFrameShadow(QtWidgets.QFrame.Shadow.Sunken)
    line.setStyleSheet("color: rgba(255,255,255,0.3);")
    self.addWidget(line)
    return line

def _read_state_safe() -> Dict[str, Any]:
    """Lit l'√©tat depuis STATE_FILE en √©vitant les exceptions."""
    try:
        if STATE_FILE.exists():
            return json.loads(STATE_FILE.read_text(encoding="utf-8") or "{}")
    except Exception:
        pass
    return {}

def _write_state_safe(state: Dict[str, Any]) -> None:
    """√âcrit l'√©tat dans STATE_FILE de fa√ßon s√ªre."""
    try:
        STATE_FILE.write_text(json.dumps(state, ensure_ascii=False, indent=2), encoding="utf-8")
    except Exception:
        pass

def show_one_time_welcome(parent: QtWidgets.QWidget) -> None:
    """Affiche un message de bienvenue une seule fois (persist√© dans state.json)."""
    state = _read_state_safe()
    if state.get("welcome_shown") is True:
        return
    try:
        d = GlassDialog("üëã Bienvenue dans Ragnar OS 26", (720, 420), parent)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        header = QtWidgets.QLabel("Bienvenue !")
        header.setStyleSheet("font-size: 22px; font-weight: bold; color: #00ff88; padding: 8px;")
        header.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        subtitle = QtWidgets.QLabel("Merci d'utiliser Ragnar OS 26. Profitez des nouvelles animations et apps.")
        subtitle.setStyleSheet("color: #cccccc; font-size: 13px; padding: 6px;")
        subtitle.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        info_card = QtWidgets.QWidget(objectName="GlassCard")
        info_lay = QtWidgets.QVBoxLayout(info_card)
        info_lay.setContentsMargins(16, 16, 16, 16)
        info_lay.addWidget(QtWidgets.QLabel("‚Ä¢ Th√®me moderne et effets de verre"))
        info_lay.addWidget(QtWidgets.QLabel("‚Ä¢ Animations fluides et transitions"))
        info_lay.addWidget(QtWidgets.QLabel("‚Ä¢ Apps interactives (Jeux, Outils)"))
        ok_btn = QtWidgets.QPushButton("‚úÖ Commencer")
        ok_btn.clicked.connect(d.close)
        lay.addWidget(header)
        lay.addWidget(subtitle)
        lay.addWidget(info_card)
        lay.addStretch()
        lay.addWidget(ok_btn, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        d.show()
        try:
            modern_fade_in(d, 900)
        except Exception:
            pass
    finally:
        state["welcome_shown"] = True
        _write_state_safe(state)

def apply_sandbox_hooks():
    """Active des garde-fous pour sandbox: r√©seau, subprocess, dialogs vers sandbox."""
    st = _read_state_safe()
    if not st.get("sandbox_enabled"):
        return
    # Bloquer requests
    try:
        import requests as _rq
        _orig_request = _rq.sessions.Session.request
        def _blocked_request(self, method, url, *args, **kwargs):
            # Autoriser explicitement les requ√™tes n√©cessaires aux mises √† jour
            allowed_prefixes = [
                "https://raw.githubusercontent.com/",
                "https://pastebin.com/",
                "https://pastebin.pl/",
                "https://gist.githubusercontent.com/",
            ]
            try:
                if any(str(url).startswith(p) for p in allowed_prefixes):
                    return _orig_request(self, method, url, *args, **kwargs)
            except Exception:
                pass
            # Bloquer le reste des requ√™tes en mode sandbox
            raise RuntimeError("Sandbox: requ√™tes r√©seau bloqu√©es")
        _rq.sessions.Session.request = _blocked_request
    except Exception:
        pass
    # Bloquer subprocess
    try:
        _orig_popen = subprocess.Popen
        def _blocked_popen(*args, **kwargs):
            raise RuntimeError("Sandbox: subprocess bloqu√©")
        subprocess.Popen = _blocked_popen
    except Exception:
        pass
    # Rediriger QFileDialog
    try:
        if st.get("sandbox_memory_enabled"):
            def _memfs_list() -> List[str]:
                return sorted(MEM_SANDBOX.keys())
            def _open_picker(parent=None, title="Fichiers (RAM)"):
                d = GlassDialog("üìÅ S√©lectionner (RAM)", (500, 400), parent)
                lay = QtWidgets.QVBoxLayout(d)
                listw = QtWidgets.QListWidget()
                for name in _memfs_list():
                    listw.addItem(name)
                ok = QtWidgets.QPushButton("‚úÖ Ouvrir")
                cancel = QtWidgets.QPushButton("‚ùå Annuler")
                ok.clicked.connect(d.accept)
                cancel.clicked.connect(d.reject)
                btns = QtWidgets.QHBoxLayout()
                btns.addStretch(); btns.addWidget(ok); btns.addWidget(cancel)
                lay.addWidget(QtWidgets.QLabel(title))
                lay.addWidget(listw)
                lay.addLayout(btns)
                if d.exec() == QtWidgets.QDialog.DialogCode.Accepted and listw.currentItem():
                    return listw.currentItem().text()
                return None
            def _save_picker(parent=None):
                text, ok = QtWidgets.QInputDialog.getText(parent, "Enregistrer (RAM)", "Nom du fichier")
                if ok and text:
                    if text not in MEM_SANDBOX:
                        MEM_SANDBOX[text] = b""
                    return text
                return None
            def _sandbox_get_open_file_name(parent=None, caption='', directory='', filter='', initialFilter=''):
                sel = _open_picker(parent)
                return (f"mem:/{sel}" if sel else '', '')
            def _sandbox_get_save_file_name(parent=None, caption='', directory='', filter='', initialFilter=''):
                sel = _save_picker(parent)
                return (f"mem:/{sel}" if sel else '', '')
            def _sandbox_get_existing_directory(parent=None, caption='', directory=''):
                return 'mem:/'
            QtWidgets.QFileDialog.getOpenFileName = staticmethod(_sandbox_get_open_file_name)
            QtWidgets.QFileDialog.getSaveFileName = staticmethod(_sandbox_get_save_file_name)
            QtWidgets.QFileDialog.getExistingDirectory = staticmethod(_sandbox_get_existing_directory)
        else:
            def _sandbox_get_open_file_name(parent=None, caption='', directory='', filter='', initialFilter=''):
                directory = str(SANDBOX_DIR)
                return QtWidgets.QFileDialog.getOpenFileName(parent, caption, directory, filter, initialFilter)
            def _sandbox_get_save_file_name(parent=None, caption='', directory='', filter='', initialFilter=''):
                directory = str(SANDBOX_DIR)
                return QtWidgets.QFileDialog.getSaveFileName(parent, caption, directory, filter, initialFilter)
            def _sandbox_get_existing_directory(parent=None, caption='', directory=''):
                directory = str(SANDBOX_DIR)
                return QtWidgets.QFileDialog.getExistingDirectory(parent, caption, directory)
            QtWidgets.QFileDialog.getOpenFileName = staticmethod(_sandbox_get_open_file_name)
            QtWidgets.QFileDialog.getSaveFileName = staticmethod(_sandbox_get_save_file_name)
            QtWidgets.QFileDialog.getExistingDirectory = staticmethod(_sandbox_get_existing_directory)
    except Exception:
        pass
    # M√©moire: intercepter open()
    try:
        import builtins as _bi
        _orig_open = _bi.open
        if st.get("sandbox_memory_enabled"):
            class _MemFile:
                def __init__(self, name: str, mode: str):
                    self._name = name
                    self._mode = mode
                    self._buf = io.BytesIO(MEM_SANDBOX.get(name, b""))
                    if 'a' in mode:
                        self._buf.seek(0, io.SEEK_END)
                def read(self, *a, **k):
                    return self._buf.read(*a, **k)
                def write(self, b):
                    if isinstance(b, str):
                        b = b.encode('utf-8')
                    return self._buf.write(b)
                def seek(self, *a, **k):
                    return self._buf.seek(*a, **k)
                def tell(self):
                    return self._buf.tell()
                def flush(self):
                    pass
                def close(self):
                    MEM_SANDBOX[self._name] = self._buf.getvalue()
                def __enter__(self):
                    return self
                def __exit__(self, exc_type, exc, tb):
                    self.close()
            def _open_wrapper(file, mode='r', *args, **kwargs):
                if isinstance(file, (str, Path)):
                    s = str(file)
                    if s.startswith('mem:/'):
                        name = s[len('mem:/'):]
                        return _MemFile(name, mode)
                raise RuntimeError("Sandbox m√©moire: acc√®s disque bloqu√©")
            _bi.open = _open_wrapper
    except Exception:
        pass

def fade_in(widget, duration=1200):
    """Animation de fondu d'entr√©e ultra-fluide avec effet de verre"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        animation = QtCore.QPropertyAnimation(effect, b"opacity")
        animation.setDuration(duration)
        animation.setStartValue(0.0)
        animation.setEndValue(1.0)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutCubic)
        animation.start()
        
        # Animation de scale simultan√©e
        scale_animation = QtCore.QPropertyAnimation(widget, b"geometry")
        original_geometry = widget.geometry()
        start_geometry = QtCore.QRect(
            original_geometry.x() + original_geometry.width() // 4,
            original_geometry.y() + original_geometry.height() // 4,
            original_geometry.width() // 2,
            original_geometry.height() // 2
        )
        
        scale_animation.setDuration(duration)
        scale_animation.setStartValue(start_geometry)
        scale_animation.setEndValue(original_geometry)
        scale_animation.setEasingCurve(QtCore.QEasingCurve.Type.OutBack)
        scale_animation.start()
        
        # Garder les r√©f√©rences
        widget._fade_animation = animation
        widget._scale_animation = scale_animation
    except Exception:
        pass

def glass_float_animation(widget, duration=3000):
    """Animation de flottement pour effet de verre"""
    try:
        original_pos = widget.pos()
        
        # Animation de flottement vertical
        float_animation = QtCore.QPropertyAnimation(widget, b"pos")
        float_animation.setDuration(duration)
        float_animation.setStartValue(original_pos)
        float_animation.setKeyValueAt(0.5, QtCore.QPoint(original_pos.x(), original_pos.y() - 5))
        float_animation.setEndValue(original_pos)
        float_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        float_animation.setLoopCount(-1)  # Boucle infinie
        float_animation.start()
        
        widget._float_animation = float_animation
    except Exception:
        pass

def shimmer_effect(widget, duration=2000):
    """Effet de scintillement pour les √©l√©ments de verre"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        shimmer_animation = QtCore.QPropertyAnimation(effect, b"opacity")
        shimmer_animation.setDuration(duration)
        shimmer_animation.setStartValue(0.7)
        shimmer_animation.setKeyValueAt(0.5, 1.0)
        shimmer_animation.setEndValue(0.7)
        shimmer_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        shimmer_animation.setLoopCount(-1)
        shimmer_animation.start()
        
        widget._shimmer_animation = shimmer_animation
    except Exception:
        pass

def slide_in_from_right(widget, duration=800):
    """Animation de glissement depuis la droite"""
    try:
        original_pos = widget.pos()
        start_pos = QtCore.QPoint(original_pos.x() + 200, original_pos.y())
        widget.move(start_pos)
        
        animation = QtCore.QPropertyAnimation(widget, b"pos")
        animation.setDuration(duration)
        animation.setStartValue(start_pos)
        animation.setEndValue(original_pos)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutBack)
        animation.start()
        
        widget._slide_animation = animation
    except Exception:
        pass

def rotate_in(widget, duration=1000):
    """Animation de rotation d'entr√©e"""
    try:
        effect = QtWidgets.QGraphicsRotationEffect()
        widget.setGraphicsEffect(effect)
        
        animation = QtCore.QPropertyAnimation(effect, b"rotation")
        animation.setDuration(duration)
        animation.setStartValue(0.0)
        animation.setEndValue(360.0)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutElastic)
        animation.start()
        
        widget._rotate_animation = animation
    except Exception:
        pass

def slide_in_from_bottom(widget, duration=800):
    """Animation de glissement depuis le bas"""
    try:
        original_pos = widget.pos()
        start_pos = QtCore.QPoint(original_pos.x(), original_pos.y() + 100)
        widget.move(start_pos)
        
        animation = QtCore.QPropertyAnimation(widget, b"pos")
        animation.setDuration(duration)
        animation.setStartValue(start_pos)
        animation.setEndValue(original_pos)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutBounce)
        animation.start()
        
        widget._slide_animation = animation
    except Exception:
        pass

def scale_in(widget, duration=600):
    """Animation d'agrandissement"""
    try:
        widget.setStyleSheet(widget.styleSheet() + "transform: scale(0.8);")
        
        animation = QtCore.QPropertyAnimation(widget, b"geometry")
        animation.setDuration(duration)
        
        original_geometry = widget.geometry()
        small_geometry = QtCore.QRect(
            original_geometry.x() + original_geometry.width() // 10,
            original_geometry.y() + original_geometry.height() // 10,
            int(original_geometry.width() * 0.8),
            int(original_geometry.height() * 0.8)
        )
        
        animation.setStartValue(small_geometry)
        animation.setEndValue(original_geometry)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutElastic)
        animation.start()
        
        widget._scale_animation = animation
    except Exception:
        pass

def pulse_animation(widget, duration=2000):
    """Animation de pulsation pour le logo"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        animation = QtCore.QPropertyAnimation(effect, b"opacity")
        animation.setDuration(duration)
        animation.setStartValue(0.5)
        animation.setEndValue(1.0)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        animation.setLoopCount(-1)  # Boucle infinie
        animation.start()
        
        widget._pulse_animation = animation
    except Exception:
        pass

def bounce_in(widget, duration=1000):
    """Animation de rebond d'entr√©e"""
    try:
        original_geometry = widget.geometry()
        
        # Commencer petit et au centre
        start_geometry = QtCore.QRect(
            original_geometry.x() + original_geometry.width() // 4,
            original_geometry.y() + original_geometry.height() // 4,
            original_geometry.width() // 2,
            original_geometry.height() // 2
        )
        
        widget.setGeometry(start_geometry)
        
        animation = QtCore.QPropertyAnimation(widget, b"geometry")
        animation.setDuration(duration)
        animation.setStartValue(start_geometry)
        animation.setEndValue(original_geometry)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutBounce)
        animation.start()
        
        widget._bounce_animation = animation
    except Exception:
        pass

# ===== NOUVELLES ANIMATIONS MODERNES =====

def modern_fade_in(widget, duration=1200):
    """Animation de fondu moderne avec effets de particules"""
    try:
        # Effet d'opacit√© avec courbe d'acc√©l√©ration moderne
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        animation = QtCore.QPropertyAnimation(effect, b"opacity")
        animation.setDuration(duration)
        animation.setStartValue(0.0)
        animation.setEndValue(1.0)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutQuart)
        animation.start()
        
        # Animation de scale avec effet √©lastique
        scale_animation = QtCore.QPropertyAnimation(widget, b"geometry")
        original_geometry = widget.geometry()
        start_geometry = QtCore.QRect(
            original_geometry.x() + original_geometry.width() // 3,
            original_geometry.y() + original_geometry.height() // 3,
            int(original_geometry.width() * 0.7),
            int(original_geometry.height() * 0.7)
        )
        
        scale_animation.setDuration(duration)
        scale_animation.setStartValue(start_geometry)
        scale_animation.setEndValue(original_geometry)
        scale_animation.setEasingCurve(QtCore.QEasingCurve.Type.OutElastic)
        scale_animation.start()
        
        # Effet de rotation subtile
        rotation_effect = QtWidgets.QGraphicsRotationEffect()
        widget.setGraphicsEffect(rotation_effect)
        
        rotation_animation = QtCore.QPropertyAnimation(rotation_effect, b"rotation")
        rotation_animation.setDuration(duration)
        rotation_animation.setStartValue(-5.0)
        rotation_animation.setEndValue(0.0)
        rotation_animation.setEasingCurve(QtCore.QEasingCurve.Type.OutCubic)
        rotation_animation.start()
        
        # Garder les r√©f√©rences
        widget._modern_fade_animation = animation
        widget._modern_scale_animation = scale_animation
        widget._modern_rotation_animation = rotation_animation
    except Exception:
        pass

def morphing_animation(widget, duration=1500):
    """Animation de morphing avec changement de forme"""
    try:
        original_geometry = widget.geometry()
        
        # Cr√©er plusieurs √©tapes de morphing
        morph_animation = QtCore.QPropertyAnimation(widget, b"geometry")
        morph_animation.setDuration(duration)
        
        # √âtape 1: R√©tr√©cir
        step1 = QtCore.QRect(
            original_geometry.x() + original_geometry.width() // 4,
            original_geometry.y() + original_geometry.height() // 4,
            original_geometry.width() // 2,
            original_geometry.height() // 2
        )
        
        # √âtape 2: √âtirer horizontalement
        step2 = QtCore.QRect(
            original_geometry.x() - original_geometry.width() // 4,
            original_geometry.y(),
            int(original_geometry.width() * 1.5),
            original_geometry.height()
        )
        
        # √âtape 3: √âtirer verticalement
        step3 = QtCore.QRect(
            original_geometry.x(),
            original_geometry.y() - original_geometry.height() // 4,
            original_geometry.width(),
            int(original_geometry.height() * 1.5)
        )
        
        # Retour √† la forme normale
        morph_animation.setKeyValueAt(0.0, step1)
        morph_animation.setKeyValueAt(0.3, step2)
        morph_animation.setKeyValueAt(0.6, step3)
        morph_animation.setKeyValueAt(1.0, original_geometry)
        
        morph_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutCubic)
        morph_animation.start()
        
        widget._morph_animation = morph_animation
    except Exception:
        pass

def wave_animation(widget, duration=2000):
    """Animation de vague pour les √©l√©ments de navigation"""
    try:
        original_pos = widget.pos()
        
        wave_animation = QtCore.QPropertyAnimation(widget, b"pos")
        wave_animation.setDuration(duration)
        
        # Cr√©er un mouvement de vague
        wave_animation.setKeyValueAt(0.0, original_pos)
        wave_animation.setKeyValueAt(0.25, QtCore.QPoint(original_pos.x() + 10, original_pos.y() - 5))
        wave_animation.setKeyValueAt(0.5, QtCore.QPoint(original_pos.x() - 5, original_pos.y() + 10))
        wave_animation.setKeyValueAt(0.75, QtCore.QPoint(original_pos.x() + 5, original_pos.y() - 3))
        wave_animation.setKeyValueAt(1.0, original_pos)
        
        wave_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        wave_animation.setLoopCount(-1)
        wave_animation.start()
        
        widget._wave_animation = wave_animation
    except Exception:
        pass

def neon_glow_animation(widget, duration=3000):
    """Animation de lueur n√©on pour les boutons"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        glow_animation = QtCore.QPropertyAnimation(effect, b"opacity")
        glow_animation.setDuration(duration)
        glow_animation.setStartValue(0.6)
        glow_animation.setKeyValueAt(0.5, 1.0)
        glow_animation.setEndValue(0.6)
        glow_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        glow_animation.setLoopCount(-1)
        glow_animation.start()
        
        # Animation de couleur simultan√©e
        color_animation = QtCore.QPropertyAnimation(widget, b"styleSheet")
        color_animation.setDuration(duration)
        
        base_style = widget.styleSheet()
        glow_style = base_style.replace("rgba(0, 255, 136", "rgba(0, 255, 200")
        
        color_animation.setStartValue(base_style)
        color_animation.setKeyValueAt(0.5, glow_style)
        color_animation.setEndValue(base_style)
        color_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        color_animation.setLoopCount(-1)
        color_animation.start()
        
        widget._neon_glow_animation = glow_animation
        widget._neon_color_animation = color_animation
    except Exception:
        pass

def matrix_rain_effect(widget, duration=5000):
    """Effet de pluie Matrix pour l'arri√®re-plan"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        matrix_animation = QtCore.QPropertyAnimation(effect, b"opacity")
        matrix_animation.setDuration(duration)
        matrix_animation.setStartValue(0.1)
        matrix_animation.setKeyValueAt(0.3, 0.8)
        matrix_animation.setKeyValueAt(0.7, 0.8)
        matrix_animation.setEndValue(0.1)
        matrix_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        matrix_animation.setLoopCount(-1)
        matrix_animation.start()
        
        widget._matrix_animation = matrix_animation
    except Exception:
        pass

def holographic_effect(widget, duration=4000):
    """Effet holographique pour les √©l√©ments futuristes"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        holo_animation = QtCore.QPropertyAnimation(effect, b"opacity")
        holo_animation.setDuration(duration)
        holo_animation.setStartValue(0.3)
        holo_animation.setKeyValueAt(0.2, 0.9)
        holo_animation.setKeyValueAt(0.4, 0.5)
        holo_animation.setKeyValueAt(0.6, 0.9)
        holo_animation.setKeyValueAt(0.8, 0.4)
        holo_animation.setEndValue(0.3)
        holo_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        holo_animation.setLoopCount(-1)
        holo_animation.start()
        
        widget._holographic_animation = holo_animation
    except Exception:
        pass

def liquid_flow_animation(widget, duration=2500):
    """Animation de flux liquide pour les transitions"""
    try:
        original_geometry = widget.geometry()
        
        flow_animation = QtCore.QPropertyAnimation(widget, b"geometry")
        flow_animation.setDuration(duration)
        
        # Mouvement fluide comme un liquide
        flow_animation.setKeyValueAt(0.0, original_geometry)
        flow_animation.setKeyValueAt(0.2, QtCore.QRect(
            original_geometry.x() + 15,
            original_geometry.y() - 8,
            original_geometry.width() + 10,
            original_geometry.height() + 5
        ))
        flow_animation.setKeyValueAt(0.4, QtCore.QRect(
            original_geometry.x() - 10,
            original_geometry.y() + 12,
            original_geometry.width() - 5,
            original_geometry.height() - 8
        ))
        flow_animation.setKeyValueAt(0.6, QtCore.QRect(
            original_geometry.x() + 8,
            original_geometry.y() - 5,
            original_geometry.width() + 8,
            original_geometry.height() + 3
        ))
        flow_animation.setKeyValueAt(0.8, QtCore.QRect(
            original_geometry.x() - 5,
            original_geometry.y() + 8,
            original_geometry.width() - 3,
            original_geometry.height() - 5
        ))
        flow_animation.setKeyValueAt(1.0, original_geometry)
        
        flow_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutCubic)
        flow_animation.setLoopCount(-1)
        flow_animation.start()
        
        widget._liquid_flow_animation = flow_animation
    except Exception:
        pass

def quantum_entanglement_effect(widget, duration=3000):
    """Effet d'intrication quantique pour les √©l√©ments li√©s"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        quantum_animation = QtCore.QPropertyAnimation(effect, b"opacity")
        quantum_animation.setDuration(duration)
        quantum_animation.setStartValue(0.4)
        quantum_animation.setKeyValueAt(0.1, 1.0)
        quantum_animation.setKeyValueAt(0.3, 0.2)
        quantum_animation.setKeyValueAt(0.5, 1.0)
        quantum_animation.setKeyValueAt(0.7, 0.3)
        quantum_animation.setKeyValueAt(0.9, 1.0)
        quantum_animation.setEndValue(0.4)
        quantum_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        quantum_animation.setLoopCount(-1)
        quantum_animation.start()
        
        widget._quantum_animation = quantum_animation
    except Exception:
        pass

def cyberpunk_glitch_effect(widget, duration=2000):
    """Effet de glitch cyberpunk"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        glitch_animation = QtCore.QPropertyAnimation(effect, b"opacity")
        glitch_animation.setDuration(duration)
        glitch_animation.setStartValue(1.0)
        glitch_animation.setKeyValueAt(0.1, 0.3)
        glitch_animation.setKeyValueAt(0.2, 1.0)
        glitch_animation.setKeyValueAt(0.3, 0.1)
        glitch_animation.setKeyValueAt(0.4, 1.0)
        glitch_animation.setKeyValueAt(0.5, 0.5)
        glitch_animation.setKeyValueAt(0.6, 1.0)
        glitch_animation.setKeyValueAt(0.7, 0.2)
        glitch_animation.setKeyValueAt(0.8, 1.0)
        glitch_animation.setKeyValueAt(0.9, 0.8)
        glitch_animation.setEndValue(1.0)
        glitch_animation.setEasingCurve(QtCore.QEasingCurve.Type.Linear)
        glitch_animation.setLoopCount(-1)
        glitch_animation.start()
        
        widget._cyberpunk_glitch_animation = glitch_animation
    except Exception:
        pass

# ===== EFFETS VISUELS MODERNES AVANC√âS =====

class AdvancedParticleSystem(QtWidgets.QWidget):
    """Syst√®me de particules avanc√© pour effets visuels modernes"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.particles = []
        self.timer = QtCore.QTimer()
        self.timer.timeout.connect(self.update_particles)
        self.timer.start(16)  # 60 FPS
        self.setAttribute(QtCore.Qt.WidgetAttribute.WA_TransparentForMouseEvents)
        
    def add_particle(self, x, y, particle_type="sparkle"):
        """Ajoute une nouvelle particule"""
        import random
        particle = {
            'x': x,
            'y': y,
            'vx': random.uniform(-3, 3),
            'vy': random.uniform(-3, 3),
            'size': random.uniform(2, 6),
            'opacity': random.uniform(0.7, 1.0),
            'life': 1.0,
            'decay': random.uniform(0.01, 0.03),
            'type': particle_type,
            'color': self.get_particle_color(particle_type)
        }
        self.particles.append(particle)
    
    def get_particle_color(self, particle_type):
        """Retourne la couleur selon le type de particule"""
        colors = {
            'sparkle': QtGui.QColor(255, 255, 255, 200),
            'fire': QtGui.QColor(255, 100, 0, 180),
            'ice': QtGui.QColor(0, 200, 255, 160),
            'electric': QtGui.QColor(255, 255, 0, 200),
            'magic': QtGui.QColor(255, 0, 255, 180),
            'neon': QtGui.QColor(0, 255, 136, 200)
        }
        return colors.get(particle_type, colors['sparkle'])
    
    def update_particles(self):
        """Met √† jour toutes les particules"""
        for particle in self.particles[:]:
            particle['x'] += particle['vx']
            particle['y'] += particle['vy']
            particle['life'] -= particle['decay']
            
            # Supprimer les particules mortes
            if particle['life'] <= 0:
                self.particles.remove(particle)
                continue
            
            # Effet de gravit√© pour certains types
            if particle['type'] in ['fire', 'magic']:
                particle['vy'] += 0.1
            
            # Effet de flottement pour d'autres
            if particle['type'] in ['ice', 'sparkle']:
                particle['vy'] -= 0.05
        
        self.update()
    
    def paintEvent(self, event):
        """Dessine toutes les particules"""
        painter = QtGui.QPainter(self)
        painter.setRenderHint(QtGui.QPainter.RenderHint.Antialiasing)
        
        for particle in self.particles:
            painter.setOpacity(particle['opacity'] * particle['life'])
            painter.setBrush(particle['color'])
            painter.setPen(QtCore.Qt.PenStyle.NoPen)
            
            size = particle['size'] * particle['life']
            painter.drawEllipse(
                int(particle['x'] - size/2),
                int(particle['y'] - size/2),
                int(size),
                int(size)
            )

class ModernTransitionEffect(QtWidgets.QWidget):
    """Effet de transition moderne entre les √©l√©ments"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.transition_type = "slide"
        self.duration = 1000
        self.timer = QtCore.QTimer()
        self.timer.timeout.connect(self.update_transition)
        self.current_frame = 0
        self.total_frames = 60
        
    def start_transition(self, transition_type="slide", duration=1000):
        """D√©marre une transition"""
        self.transition_type = transition_type
        self.duration = duration
        self.current_frame = 0
        self.total_frames = int(duration / 16)  # 60 FPS
        self.timer.start(16)
        
    def update_transition(self):
        """Met √† jour la transition"""
        self.current_frame += 1
        if self.current_frame >= self.total_frames:
            self.timer.stop()
            self.current_frame = 0
        self.update()
    
    def paintEvent(self, event):
        """Dessine l'effet de transition"""
        painter = QtGui.QPainter(self)
        painter.setRenderHint(QtGui.QPainter.RenderHint.Antialiasing)
        
        progress = self.current_frame / self.total_frames if self.total_frames > 0 else 0
        
        if self.transition_type == "slide":
            self.draw_slide_transition(painter, progress)
        elif self.transition_type == "fade":
            self.draw_fade_transition(painter, progress)
        elif self.transition_type == "zoom":
            self.draw_zoom_transition(painter, progress)
        elif self.transition_type == "spiral":
            self.draw_spiral_transition(painter, progress)
    
    def draw_slide_transition(self, painter, progress):
        """Dessine une transition de glissement"""
        width = self.width()
        height = self.height()
        
        # Effet de glissement horizontal
        offset = int(width * progress)
        painter.setOpacity(1.0 - progress)
        painter.fillRect(offset, 0, width - offset, height, QtGui.QColor(0, 0, 0, 200))
    
    def draw_fade_transition(self, painter, progress):
        """Dessine une transition de fondu"""
        painter.setOpacity(progress)
        painter.fillRect(0, 0, self.width(), self.height(), QtGui.QColor(0, 0, 0, 255))
    
    def draw_zoom_transition(self, painter, progress):
        """Dessine une transition de zoom"""
        center_x = self.width() // 2
        center_y = self.height() // 2
        
        # Effet de zoom circulaire
        radius = int(min(self.width(), self.height()) * progress)
        painter.setOpacity(1.0 - progress)
        painter.setBrush(QtGui.QColor(0, 0, 0, 200))
        painter.setPen(QtCore.Qt.PenStyle.NoPen)
        painter.drawEllipse(center_x - radius, center_y - radius, radius * 2, radius * 2)
    
    def draw_spiral_transition(self, painter, progress):
        """Dessine une transition en spirale"""
        center_x = self.width() // 2
        center_y = self.height() // 2
        
        painter.setOpacity(1.0 - progress)
        painter.setPen(QtGui.QPen(QtGui.QColor(0, 255, 136, 200), 3))
        
        # Dessiner une spirale
        for i in range(int(360 * progress)):
            angle = math.radians(i)
            radius = i * 0.5
            x = center_x + radius * math.cos(angle)
            y = center_y + radius * math.sin(angle)
            painter.drawPoint(int(x), int(y))

class HolographicDisplay(QtWidgets.QWidget):
    """Affichage holographique futuriste"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.hologram_data = []
        self.scan_line = 0
        self.timer = QtCore.QTimer()
        self.timer.timeout.connect(self.update_hologram)
        self.timer.start(50)  # 20 FPS
        
    def add_hologram_text(self, text, x, y, color=QtGui.QColor(0, 255, 136)):
        """Ajoute du texte holographique"""
        self.hologram_data.append({
            'type': 'text',
            'text': text,
            'x': x,
            'y': y,
            'color': color,
            'opacity': 0.8
        })
    
    def add_hologram_line(self, x1, y1, x2, y2, color=QtGui.QColor(0, 255, 136)):
        """Ajoute une ligne holographique"""
        self.hologram_data.append({
            'type': 'line',
            'x1': x1, 'y1': y1,
            'x2': x2, 'y2': y2,
            'color': color,
            'opacity': 0.6
        })
    
    def update_hologram(self):
        """Met √† jour l'affichage holographique"""
        self.scan_line = (self.scan_line + 1) % self.height()
        self.update()
    
    def paintEvent(self, event):
        """Dessine l'affichage holographique"""
        painter = QtGui.QPainter(self)
        painter.setRenderHint(QtGui.QPainter.RenderHint.Antialiasing)
        
        # Effet de scan line
        painter.setOpacity(0.3)
        painter.setPen(QtGui.QPen(QtGui.QColor(0, 255, 136, 100), 2))
        painter.drawLine(0, self.scan_line, self.width(), self.scan_line)
        
        # Dessiner les √©l√©ments holographiques
        for item in self.hologram_data:
            painter.setOpacity(item['opacity'])
            painter.setPen(QtGui.QPen(item['color'], 2))
            
            if item['type'] == 'text':
                painter.drawText(item['x'], item['y'], item['text'])
            elif item['type'] == 'line':
                painter.drawLine(item['x1'], item['y1'], item['x2'], item['y2'])

def create_modern_button(text, parent=None, style="neon"):
    """Cr√©e un bouton moderne avec effets visuels"""
    button = QtWidgets.QPushButton(text, parent)
    
    if style == "neon":
        button.setStyleSheet("""
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.3),
                    stop:1 rgba(0, 255, 136, 0.1));
                border: 2px solid rgba(0, 255, 136, 0.6);
                border-radius: 15px;
                color: white;
                font-weight: bold;
                font-size: 14px;
                padding: 12px 20px;
                min-height: 40px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.5),
                    stop:1 rgba(0, 255, 136, 0.3));
                border: 2px solid rgba(0, 255, 136, 0.9);
                box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            }
            QPushButton:pressed {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.7),
                    stop:1 rgba(0, 255, 136, 0.5));
            }
        """)
    elif style == "cyberpunk":
        button.setStyleSheet("""
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 0, 255, 0.3),
                    stop:1 rgba(255, 0, 255, 0.1));
                border: 2px solid rgba(255, 0, 255, 0.6);
                border-radius: 10px;
                color: white;
                font-weight: bold;
                font-size: 14px;
                padding: 12px 20px;
                min-height: 40px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 0, 255, 0.5),
                    stop:1 rgba(255, 0, 255, 0.3));
                border: 2px solid rgba(255, 0, 255, 0.9);
            }
        """)
    elif style == "holographic":
        button.setStyleSheet("""
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 200, 255, 0.2),
                    stop:1 rgba(0, 200, 255, 0.05));
                border: 2px solid rgba(0, 200, 255, 0.4);
                border-radius: 20px;
                color: white;
                font-weight: bold;
                font-size: 14px;
                padding: 12px 20px;
                min-height: 40px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 200, 255, 0.4),
                    stop:1 rgba(0, 200, 255, 0.2));
                border: 2px solid rgba(0, 200, 255, 0.8);
            }
        """)
    
    return button

def apply_modern_effects_to_widget(widget, effect_type="glass"):
    """Applique des effets modernes √† un widget"""
    if effect_type == "glass":
        glass_float_animation(widget, 4000)
        shimmer_effect(widget, 3000)
    elif effect_type == "neon":
        neon_glow_animation(widget, 2000)
    elif effect_type == "holographic":
        holographic_effect(widget, 3000)
    elif effect_type == "cyberpunk":
        cyberpunk_glitch_effect(widget, 1500)
    elif effect_type == "quantum":
        quantum_entanglement_effect(widget, 2500)
    elif effect_type == "matrix":
        matrix_rain_effect(widget, 4000)

# Appliquer les corrections
ensure_files()
sys.excepthook = handle_exception

# Ajouter addSeparator aux layouts
QtWidgets.QHBoxLayout.addSeparator = _layout_addSeparator
QtWidgets.QVBoxLayout.addSeparator = _layout_addSeparator

# Forcer la mise √† jour de la version dans le state
def update_version_in_state():
    """Met √† jour la version dans le fichier state.json"""
    try:
        # Mettre √† jour sans √©craser les cl√©s existantes (pr√©serve login_password_hash)
        try:
            current = json.loads(STATE_FILE.read_text(encoding="utf-8"))
        except Exception:
            current = {}
        current.setdefault("theme", "dark")
        current.setdefault("features", {})
        current["version"] = DEFAULT_LOCAL_VERSION
        current["last_update_check"] = time.strftime("%Y-%m-%d %H:%M:%S")
        current["force_updated"] = True
        write_state(current)
        print(f"State mis √† jour vers version {DEFAULT_LOCAL_VERSION} (pr√©servation des cl√©s)")
    except Exception as e:
        print(f"Erreur lors de la mise √† jour forc√©e: {e}")

# ===== Gestion d'√©tat =====

def read_state() -> Dict[str, Any]:
    try:
        return json.loads(STATE_FILE.read_text(encoding="utf-8"))
    except Exception:
        pass
    
    st = {"version": DEFAULT_LOCAL_VERSION, "theme": "dark"}
    write_state(st)
    return st



def write_state(state: Dict[str, Any]):
    try:
        STATE_FILE.write_text(json.dumps(state, indent=2, ensure_ascii=False), encoding="utf-8")
    except Exception:
        pass

# Appliquer la mise √† jour de version maintenant que write_state est d√©finie
update_version_in_state()

def ensure_store() -> Dict[str, Any]:
    """Assure que le store existe et retourne les donn√©es"""
    if not STORE_FILE.exists():
        # Cr√©er le store avec des donn√©es par d√©faut
        default_store = {
            "apps": [
                {"id": "paint", "name": "Ragnar Paint", "desc": "Dessine en verre ‚úçÔ∏è", "installed": False},
                {"id": "notes", "name": "Ragnar Notes", "desc": "Notes rapides", "installed": False},
                {"id": "calc", "name": "Ragnar Calc", "desc": "Calculatrice avanc√©e", "installed": False},
                {"id": "browser", "name": "Ragnar Browser", "desc": "Navigateur web", "installed": False},
                {"id": "terminal", "name": "Ragnar Terminal", "desc": "Terminal syst√®me", "installed": False},
            ],
            "installed": []
        }
        try:
            STORE_FILE.write_text(json.dumps(default_store, indent=2), encoding="utf-8")
        except Exception:
            pass
    
    return read_store()

def read_store() -> Dict[str, Any]:
    if STORE_FILE.exists():
        try:
            return json.loads(STORE_FILE.read_text(encoding="utf-8"))
        except Exception:
            pass

    data = {

        "apps": [

            {"id": "paint", "name": "Ragnar Paint", "desc": "Dessine en verre ‚úçÔ∏è", "installed": False},

            {"id": "notes", "name": "Ragnar Notes", "desc": "Notes rapides", "installed": False},

            {"id": "term", "name": "Ragnar Terminal", "desc": "Console mini", "installed": False},

        ]

    }

    STORE_FILE.write_text(json.dumps(data, ensure_ascii=False, indent=2), encoding="utf-8")

    return data



# ====== Style ======

GLASS_CSS = """

* { color: #eaecf3; font-family: 'Segoe UI', 'Inter', system-ui; }

QWidget#GlassCard {

  background: rgba(255,255,255,0.10);

  border: 1px solid rgba(255,255,255,0.25);

  border-radius: 16px;

}

QProgressBar {

  background: rgba(255,255,255,0.12);

  border: 1px solid rgba(255,255,255,0.25);

  border-radius: 999px;

  padding: 2px;

}

QProgressBar::chunk {

  background: qlineargradient(x1:0,y1:0,x2:1,y2:0,

    stop:0 rgba(0,255,255,0.9), stop:1 rgba(180,0,255,0.9));

  border-radius: 999px;

}

QPushButton {

  background: rgba(255,255,255,0.10);

  border: 1px solid rgba(255,255,255,0.25);

  border-radius: 12px;

  padding: 8px 14px;

}

QPushButton:hover { background: rgba(255,255,255,0.18); }

QLineEdit, QTextEdit, QPlainTextEdit, QComboBox {

  background: rgba(255,255,255,0.08);

  border: 1px solid rgba(255,255,255,0.25);

  border-radius: 10px;

  padding: 6px 10px;

}

QListWidget, QTableWidget {

  background: rgba(255,255,255,0.06);

  border: 1px solid rgba(255,255,255,0.20);

  border-radius: 10px;

}

"""



# Gradients de fond avec effets de lumi√®re et verre
DARK_BG_GRADIENT = QtGui.QRadialGradient(0.5, 0.35, 0.9)
DARK_BG_GRADIENT.setCoordinateMode(QtGui.QGradient.CoordinateMode.ObjectBoundingMode)
DARK_BG_GRADIENT.setColorAt(0.0, QtGui.QColor(28, 38, 58))  # Halo doux bleu
DARK_BG_GRADIENT.setColorAt(0.25, QtGui.QColor(18, 26, 44)) # Bleu profond
DARK_BG_GRADIENT.setColorAt(0.6, QtGui.QColor(10, 16, 28))  # Bleu sombre
DARK_BG_GRADIENT.setColorAt(1.0, QtGui.QColor(4, 6, 12))    # Presque noir

# Gradient avec effets de lumi√®re
LIGHT_BG_GRADIENT = QtGui.QRadialGradient(0.5, 0.3, 1.0)
LIGHT_BG_GRADIENT.setCoordinateMode(QtGui.QGradient.CoordinateMode.ObjectBoundingMode)
LIGHT_BG_GRADIENT.setColorAt(0.0, QtGui.QColor(30, 35, 50))  # Centre lumineux
LIGHT_BG_GRADIENT.setColorAt(0.3, QtGui.QColor(20, 25, 40))  # Bleu profond
LIGHT_BG_GRADIENT.setColorAt(0.7, QtGui.QColor(10, 15, 25))  # Bleu sombre
LIGHT_BG_GRADIENT.setColorAt(1.0, QtGui.QColor(5, 8, 15))    # Bleu tr√®s sombre

# Gradient arc-en-ciel pour les effets sp√©ciaux
RAINBOW_BG_GRADIENT = QtGui.QLinearGradient(0, 0, 1, 1)
RAINBOW_BG_GRADIENT.setCoordinateMode(QtGui.QGradient.CoordinateMode.ObjectBoundingMode)
RAINBOW_BG_GRADIENT.setColorAt(0.0, QtGui.QColor(25, 15, 40))  # Violet profond
RAINBOW_BG_GRADIENT.setColorAt(0.3, QtGui.QColor(20, 25, 45))  # Bleu profond
RAINBOW_BG_GRADIENT.setColorAt(0.6, QtGui.QColor(15, 30, 35))  # Bleu-vert profond
RAINBOW_BG_GRADIENT.setColorAt(1.0, QtGui.QColor(10, 20, 30))  # Bleu-vert sombre



def make_header(text: str, sub: str = "") -> QtWidgets.QWidget:
    """Cr√©e un en-t√™te moderne avec effets de verre et d√©grad√©s"""
    w = QtWidgets.QWidget()
    w.setObjectName("GlassCard")
    
    # Style am√©lior√© pour l'en-t√™te
    w.setStyleSheet("""
        QWidget#GlassCard {
            background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                stop:0 rgba(255, 255, 255, 0.15),
                stop:0.5 rgba(255, 255, 255, 0.08),
                stop:1 rgba(255, 255, 255, 0.04));
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 16px;
        }
    """)

    lay = QtWidgets.QVBoxLayout(w)
    lay.setContentsMargins(20, 20, 20, 20)
    lay.setSpacing(8)

    # Titre avec d√©grad√© moderne
    title = QtWidgets.QLabel(
        f"<span style='font-size:24px;font-weight:900;"
        "background: qlineargradient(x1:0, y1:0, x2:1, y2:0, "
        "stop:0 rgba(0, 255, 255, 1), "
        "stop:0.5 rgba(255, 0, 255, 1), "
        "stop:1 rgba(0, 255, 136, 1));"
        "color: transparent;'>"
        f"{text}</span>"
    )
    title.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)

    # Sous-titre avec style moderne
    if sub:
        subl = QtWidgets.QLabel(sub)
        subl.setStyleSheet("""
            color: rgba(255, 255, 255, 0.85);
            font-size: 14px;
            font-weight: 500;
            padding: 4px;
        """)
        subl.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        lay.addWidget(subl)

    lay.addWidget(title)
    
    return w



# ====== Boot ======

class BootPage(QtWidgets.QWidget):

    finished = QtCore.pyqtSignal()

    def __init__(self, parent=None):

        super().__init__(parent)

        self.setAutoFillBackground(True)
        # Pour capter les s√©quences de touches secr√®tes
        self.setFocusPolicy(QtCore.Qt.FocusPolicy.StrongFocus)
        self._secret_seq = []  # stocke les derni√®res touches
        self._secret_last_ts = 0

        # Cr√©er un gradient anim√© plus beau
        self.animated_gradient = QtGui.QLinearGradient(0, 0, 0, 1)
        self.animated_gradient.setCoordinateMode(QtGui.QGradient.CoordinateMode.ObjectBoundingMode)
        self.animated_gradient.setColorAt(0.0, QtGui.QColor(20, 25, 40))
        self.animated_gradient.setColorAt(0.5, QtGui.QColor(10, 15, 25))
        self.animated_gradient.setColorAt(1.0, QtGui.QColor(5, 8, 15))

        p = self.palette()
        p.setBrush(self.backgroundRole(), QtGui.QBrush(self.animated_gradient))
        self.setPalette(p)

        self.setStyleSheet(GLASS_CSS)

        # Cr√©er le conteneur principal avec effet de verre am√©lior√©
        card = QtWidgets.QWidget(objectName="GlassCard")
        card.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.15),
                    stop:1 rgba(255, 255, 255, 0.05));
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 25px;
                padding: 20px;
            }
        """)

        v = QtWidgets.QVBoxLayout(card)
        v.setContentsMargins(40, 40, 40, 40)
        v.setSpacing(20)

        # Logo anim√© avec effet de brillance
        self.logo = QtWidgets.QLabel("‚ö°")
        self.logo.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        self.logo.setStyleSheet("""
            font-size: 96px;
            color: qlineargradient(x1:0, y1:0, x2:1, y2:1,
                stop:0 rgba(0, 255, 255, 1),
                stop:0.5 rgba(255, 0, 255, 1),
                stop:1 rgba(0, 255, 136, 1));
            font-weight: bold;
        """)

        # Titre avec effet de d√©grad√©
        self.title = QtWidgets.QLabel("RAGNAR OS 26")
        self.title.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        self.title.setStyleSheet("""
            font-size: 32px;
            font-weight: 900;
            color: qlineargradient(x1:0, y1:0, x2:1, y2:0,
                stop:0 rgba(0, 255, 255, 1),
                stop:1 rgba(255, 0, 255, 1));
            letter-spacing: 3px;
        """)

        # Sous-titre
        self.subtitle = QtWidgets.QLabel("Syst√®me d'exploitation r√©volutionnaire")
        self.subtitle.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        self.subtitle.setStyleSheet("""
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 300;
        """)

        # Barre de progression anim√©e
        self.loader = QtWidgets.QProgressBar()
        self.loader.setRange(0, 100)
        self.loader.setValue(0)
        self.loader.setStyleSheet("""
            QProgressBar {
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 15px;
                background: rgba(0, 0, 0, 0.3);
                text-align: center;
                color: white;
                font-weight: bold;
                font-size: 12px;
                height: 25px;
            }
            QProgressBar::chunk {
                background: qlineargradient(x1:0, y1:0, x2:1, y2:0,
                    stop:0 rgba(0, 255, 255, 0.9),
                    stop:0.5 rgba(255, 0, 255, 0.9),
                    stop:1 rgba(0, 255, 136, 0.9));
                border-radius: 13px;
            }
        """)

        # Message de statut
        self.msg = QtWidgets.QLabel("Initialisation du syst√®me...")
        self.msg.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        self.msg.setStyleSheet("""
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-weight: 500;
        """)

        # Ajouter tous les √©l√©ments
        v.addWidget(self.logo)
        v.addWidget(self.title)
        v.addWidget(self.subtitle)
        v.addSpacing(20)
        v.addWidget(self.msg)
        v.addWidget(self.loader)

        # Layout principal
        root = QtWidgets.QVBoxLayout(self)
        root.setContentsMargins(50, 50, 50, 50)
        root.addStretch(1)
        root.addWidget(card)
        root.addStretch(2)

        # D√©marrer les animations
        self.start_animations()
        
        # D√©marrer la s√©quence de d√©marrage
        self.start_boot_sequence()

    def start_animations(self):
        """D√©marre les animations du logo et du gradient"""
        # Animation de pulsation du logo
        self.logo_animation = QtCore.QPropertyAnimation(self.logo, b"geometry")
        self.logo_animation.setDuration(2000)
        self.logo_animation.setLoopCount(-1)
        
        # Animation de rotation du gradient de fond
        self.gradient_animation = QtCore.QPropertyAnimation(self, b"geometry")
        self.gradient_animation.setDuration(10000)
        self.gradient_animation.setLoopCount(-1)

    def start_boot_sequence(self):
        """S√©quence de d√©marrage avec messages et progression"""
        self.boot_messages = [
            ("Initialisation du syst√®me...", 10),
            ("Chargement du noyau...", 25),
            ("D√©marrage des services...", 40),
            ("Initialisation de l'interface...", 60),
            ("Chargement des applications...", 80),
            ("Finalisation...", 95),
            ("Pr√™t !", 100)
        ]
        
        self.current_step = 0
        self.boot_timer = QtCore.QTimer()
        self.boot_timer.timeout.connect(self.update_boot_progress)
        self.boot_timer.start(400)  # Mise √† jour toutes les 400ms

    def update_boot_progress(self):
        """Met √† jour la progression du d√©marrage"""
        if self.current_step < len(self.boot_messages):
            message, progress = self.boot_messages[self.current_step]
            self.msg.setText(message)
            self.loader.setValue(progress)
            self.current_step += 1
        else:
            self.boot_timer.stop()
            # Attendre un peu avant de terminer
            QtCore.QTimer.singleShot(800, self.finished.emit)



# ====== Effets visuels avanc√©s ======

class LightEffect(QtWidgets.QWidget):
    """Effet de lumi√®re anim√©e pour les √©l√©ments de verre"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.lights = []
        self.timer = QtCore.QTimer()
        self.timer.timeout.connect(self.update_lights)
        self.timer.start(100)  # 10 FPS
        
        # Cr√©er des lumi√®res initiales
        for _ in range(8):
            self.add_light()
    
    def add_light(self):
        """Ajoute une nouvelle source de lumi√®re"""
        import random
        light = {
            'x': random.randint(0, self.width() if self.width() > 0 else 800),
            'y': random.randint(0, self.height() if self.height() > 0 else 600),
            'vx': random.uniform(-2, 2),
            'vy': random.uniform(-2, 2),
            'size': random.uniform(20, 60),
            'opacity': random.uniform(0.1, 0.4),
            'color': random.choice([
                QtGui.QColor(0, 255, 136, 150),
                QtGui.QColor(0, 255, 255, 150),
                QtGui.QColor(255, 0, 255, 150),
                QtGui.QColor(255, 255, 0, 150),
                QtGui.QColor(255, 100, 0, 150)
            ]),
            'pulse_speed': random.uniform(0.02, 0.05),
            'pulse_phase': random.uniform(0, 6.28)
        }
        self.lights.append(light)
    
    def update_lights(self):
        """Met √† jour les lumi√®res"""
        for light in self.lights:
            light['x'] += light['vx']
            light['y'] += light['vy']
            
            # Rebond sur les bords
            if light['x'] < 0 or light['x'] > self.width():
                light['vx'] *= -1
            if light['y'] < 0 or light['y'] > self.height():
                light['vy'] *= -1
            
            # Garder dans les limites
            light['x'] = max(0, min(self.width(), light['x']))
            light['y'] = max(0, min(self.height(), light['y']))
            
            # Animation de pulsation
            light['pulse_phase'] += light['pulse_speed']
            light['opacity'] = 0.1 + 0.3 * abs(math.sin(light['pulse_phase']))
        
        self.update()
    
    def paintEvent(self, event):
        """Dessine les lumi√®res"""
        painter = QtGui.QPainter(self)
        painter.setRenderHint(QtGui.QPainter.RenderHint.Antialiasing)
        
        for light in self.lights:
            # Cr√©er un gradient radial pour l'effet de lumi√®re
            gradient = QtGui.QRadialGradient(light['x'], light['y'], light['size'])
            gradient.setColorAt(0.0, light['color'])
            gradient.setColorAt(0.5, QtGui.QColor(light['color'].red(), light['color'].green(), light['color'].blue(), 50))
            gradient.setColorAt(1.0, QtGui.QColor(light['color'].red(), light['color'].green(), light['color'].blue(), 0))
            
            painter.setBrush(QtGui.QBrush(gradient))
            painter.setPen(QtCore.Qt.PenStyle.NoPen)
            painter.drawEllipse(
                int(light['x'] - light['size']),
                int(light['y'] - light['size']),
                int(light['size'] * 2),
                int(light['size'] * 2)
            )

class ParticleEffect(QtWidgets.QWidget):
    """Effet de particules flottantes pour l'arri√®re-plan"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.particles = []
        self.timer = QtCore.QTimer()
        self.timer.timeout.connect(self.update_particles)
        self.timer.start(50)  # 20 FPS
        
        # Cr√©er des particules initiales
        for _ in range(20):
            self.add_particle()
    
    def add_particle(self):
        """Ajoute une nouvelle particule"""
        import random
        particle = {
            'x': random.randint(0, self.width() if self.width() > 0 else 800),
            'y': random.randint(0, self.height() if self.height() > 0 else 600),
            'vx': random.uniform(-1, 1),
            'vy': random.uniform(-1, 1),
            'size': random.uniform(1, 3),
            'opacity': random.uniform(0.1, 0.3),
            'color': random.choice([
                QtGui.QColor(0, 255, 136, 100),
                QtGui.QColor(0, 255, 255, 100),
                QtGui.QColor(255, 0, 255, 100),
                QtGui.QColor(255, 255, 255, 100)
            ])
        }
        self.particles.append(particle)
    
    def update_particles(self):
        """Met √† jour la position des particules"""
        for particle in self.particles:
            particle['x'] += particle['vx']
            particle['y'] += particle['vy']
            
            # Rebond sur les bords
            if particle['x'] < 0 or particle['x'] > self.width():
                particle['vx'] *= -1
            if particle['y'] < 0 or particle['y'] > self.height():
                particle['vy'] *= -1
            
            # Garder dans les limites
            particle['x'] = max(0, min(self.width(), particle['x']))
            particle['y'] = max(0, min(self.height(), particle['y']))
        
        self.update()
    
    def paintEvent(self, event):
        """Dessine les particules"""
        painter = QtGui.QPainter(self)
        painter.setRenderHint(QtGui.QPainter.RenderHint.Antialiasing)
        
        for particle in self.particles:
            painter.setOpacity(particle['opacity'])
            painter.setBrush(particle['color'])
            painter.setPen(QtCore.Qt.PenStyle.NoPen)
            painter.drawEllipse(
                int(particle['x'] - particle['size']),
                int(particle['y'] - particle['size']),
                int(particle['size'] * 2),
                int(particle['size'] * 2)
            )

class GlowEffect(QtWidgets.QGraphicsEffect):
    """Effet de lueur pour les widgets"""
    
    def __init__(self, color=QtGui.QColor(0, 255, 136, 100), radius=10):
        super().__init__()
        self.color = color
        self.radius = radius
    
    def draw(self, painter):
        """Dessine l'effet de lueur"""
        # Impl√©mentation simplifi√©e de l'effet de lueur
        painter.setRenderHint(QtGui.QPainter.RenderHint.Antialiasing)
        painter.setBrush(self.color)
        painter.setPen(QtCore.Qt.PenStyle.NoPen)
        
        # Dessiner plusieurs cercles avec opacit√© d√©croissante
        for i in range(self.radius):
            opacity = (self.radius - i) / self.radius * 0.3
            painter.setOpacity(opacity)
            painter.drawEllipse(
                -i, -i, 
                self.sourceBoundingRect().width() + 2*i,
                self.sourceBoundingRect().height() + 2*i
            )

# ====== Classe PaintCanvas pour le dessin ======

class PaintCanvas(QtWidgets.QWidget):
    """Canvas de dessin fonctionnel pour Ragnar Paint"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setMinimumSize(400, 300)
        
        # Variables de dessin
        self.drawing = False
        self.last_point = QtCore.QPoint()
        self.current_tool = "brush"
        self.current_color = QtGui.QColor(0, 0, 0)
        self.brush_size = 5
        
        # Image pour stocker le dessin
        self.image = QtGui.QPixmap(800, 600)
        self.image.fill(QtGui.QColor(255, 255, 255))
        
        # Variables pour les formes
        self.start_point = QtCore.QPoint()
        self.temp_image = None
        
    def paintEvent(self, event):
        """Dessine le contenu du canvas"""
        painter = QtGui.QPainter(self)
        painter.drawPixmap(self.rect(), self.image)
        
        # Dessiner la forme temporaire si n√©cessaire
        if self.temp_image and self.current_tool in ["line", "rectangle", "circle"]:
            painter.drawPixmap(self.rect(), self.temp_image)
    
    def mousePressEvent(self, event):
        """Gestion du clic de souris"""
        if event.button() == QtCore.Qt.MouseButton.LeftButton:
            self.drawing = True
            self.last_point = event.pos()
            self.start_point = event.pos()
            
            if self.current_tool in ["line", "rectangle", "circle"]:
                self.temp_image = self.image.copy()
    
    def mouseMoveEvent(self, event):
        """Gestion du mouvement de souris"""
        if (event.buttons() & QtCore.Qt.MouseButton.LeftButton) and self.drawing:
            if self.current_tool in ["brush", "pencil", "eraser"]:
                self.draw_line(self.last_point, event.pos())
                self.last_point = event.pos()
            elif self.current_tool in ["line", "rectangle", "circle"]:
                self.draw_temp_shape(self.start_point, event.pos())
    
    def mouseReleaseEvent(self, event):
        """Gestion du rel√¢chement de souris"""
        if event.button() == QtCore.Qt.MouseButton.LeftButton and self.drawing:
            if self.current_tool in ["line", "rectangle", "circle"]:
                self.draw_final_shape(self.start_point, event.pos())
                self.temp_image = None
            self.drawing = False
    
    def draw_line(self, start, end):
        """Dessine une ligne"""
        painter = QtGui.QPainter(self.image)
        painter.setPen(QtGui.QPen(self.current_color, self.brush_size, 
                                 QtCore.Qt.PenStyle.SolidLine, QtCore.Qt.PenCapStyle.RoundCap))
        painter.drawLine(start, end)
        self.update()
    
    def draw_temp_shape(self, start, end):
        """Dessine une forme temporaire"""
        if not self.temp_image:
            return
            
        painter = QtGui.QPainter(self.temp_image)
        painter.setPen(QtGui.QPen(self.current_color, self.brush_size))
        
        if self.current_tool == "line":
            painter.drawLine(start, end)
        elif self.current_tool == "rectangle":
            painter.drawRect(QtCore.QRect(start, end))
        elif self.current_tool == "circle":
            painter.drawEllipse(QtCore.QRect(start, end))
        
        self.update()
    
    def draw_final_shape(self, start, end):
        """Dessine la forme finale"""
        painter = QtGui.QPainter(self.image)
        painter.setPen(QtGui.QPen(self.current_color, self.brush_size))
        
        if self.current_tool == "line":
            painter.drawLine(start, end)
        elif self.current_tool == "rectangle":
            painter.drawRect(QtCore.QRect(start, end))
        elif self.current_tool == "circle":
            painter.drawEllipse(QtCore.QRect(start, end))
        
        self.update()
    
    def set_tool(self, tool):
        """Change l'outil de dessin"""
        self.current_tool = tool
        if tool == "eraser":
            self.current_color = QtGui.QColor(255, 255, 255)
    
    def set_color(self, color):
        """Change la couleur"""
        self.current_color = color
        if self.current_tool == "eraser":
            self.current_tool = "brush"  # Revenir au pinceau apr√®s avoir choisi une couleur
    
    def set_brush_size(self, size):
        """Change la taille du pinceau"""
        self.brush_size = size
    
    def clear_canvas(self):
        """Efface tout le canvas"""
        self.image.fill(QtGui.QColor(255, 255, 255))
        self.update()

# ====== Fen√™tres principales ======

class GlassDialog(QtWidgets.QDialog):

    def __init__(self, title="Fen√™tre", size=(520, 360), parent=None):

        super().__init__(parent)

        self.setObjectName("GlassCard")

        self.setWindowTitle(title)

        self.setModal(False)

        self.setMinimumSize(*size)

        self.setStyleSheet(RAGNAR_MODERN_STYLE)

        shadow = QtWidgets.QGraphicsDropShadowEffect(

            blurRadius=40, xOffset=0, yOffset=10, color=QtGui.QColor(0, 0, 0, 160)

        )

        self.setGraphicsEffect(shadow)



# ====== Desktop principal ======

class DesktopPage(QtWidgets.QWidget):

    def __init__(self, parent=None):

        super().__init__(parent)

        self.setAutoFillBackground(True)
        # √âtat pour la s√©quence secr√®te (fl√®che haut, fl√®che bas)
        self.setFocusPolicy(QtCore.Qt.FocusPolicy.StrongFocus)
        self._secret_seq = []
        self._secret_last_ts = 0
        
        # Charger le fond d'√©cran personnalis√© ou utiliser le d√©faut
        self.load_wallpaper()
        
        # Initialiser avec le gradient par d√©faut
        self.default_gradient = DARK_BG_GRADIENT
        self.apply_background()

        self.setStyleSheet(GLASS_CSS)
        
        # Ajouter des effets de particules en arri√®re-plan
        self.particle_effect = ParticleEffect(self)
        self.particle_effect.setGeometry(0, 0, 1000, 600)
        self.particle_effect.lower()  # Mettre en arri√®re-plan
        
        # Ajouter des effets de lumi√®re
        self.light_effect = LightEffect(self)
        self.light_effect.setGeometry(0, 0, 1000, 600)
        self.light_effect.lower()  # Mettre en arri√®re-plan
        
        # D√©marrer les animations apr√®s un court d√©lai
        QtCore.QTimer.singleShot(1000, self.start_desktop_animations)

        # Activer le menu contextuel sur clic droit
        self.setContextMenuPolicy(QtCore.Qt.ContextMenuPolicy.CustomContextMenu)
        self.customContextMenuRequested.connect(self.show_context_menu)



        top = QtWidgets.QWidget(objectName="GlassCard")

        tlay = QtWidgets.QHBoxLayout(top)

        tlay.setContentsMargins(12, 8, 12, 8)

        self.title = QtWidgets.QLabel("üí† Ragnar OS 26")

        # Bouton menu des applications
        self.menu_btn = QtWidgets.QPushButton("üìã Menu")
        self.menu_btn.clicked.connect(self.show_apps_menu)
        self.menu_btn.setStyleSheet("padding: 4px 8px; font-size: 11px;")

        self.clock = QtWidgets.QLabel("--:--")

        tlay.addWidget(self.title)

        tlay.addStretch(1)
        
        tlay.addWidget(self.menu_btn)

        tlay.addWidget(QtWidgets.QLabel("üïì"))

        tlay.addWidget(self.clock)



        # Barre des t√¢ches (refonte)
        dock = QtWidgets.QWidget(objectName="GlassCard")
        dlay = QtWidgets.QHBoxLayout(dock)
        # Style barre: moderne, arrondie
        dlay.setContentsMargins(12, 6, 12, 10)
        dlay.setSpacing(8)
        dlay.setAlignment(QtCore.Qt.AlignmentFlag.AlignVCenter)
        dock.setStyleSheet("""
            QWidget#GlassCard {
                background: rgba(20, 24, 36, 0.48);
                border: 1px solid rgba(255,255,255,0.18);
                border-radius: 14px;
            }
        """)
        # Hauteur minimale = bouton (72) + marges (6+10) + s√©curit√© (~10)
        dock.setMinimumHeight(98)
        _sp_dock = dock.sizePolicy()
        _sp_dock.setVerticalPolicy(QtWidgets.QSizePolicy.Policy.Fixed)
        dock.setSizePolicy(_sp_dock)

        # Fabrique de bouton d'application pour le dock
        def btn(emoji: str, text: str, cb):
            b = QtWidgets.QPushButton(f"{emoji}")

            b.setObjectName("DesktopButton")
            b.setToolTip(text)
            # Taille confortable des boutons (√©vite la coupe des emojis)
            b.setFixedSize(72, 72)
            sp = b.sizePolicy()
            sp.setHorizontalPolicy(QtWidgets.QSizePolicy.Policy.Fixed)
            sp.setVerticalPolicy(QtWidgets.QSizePolicy.Policy.Fixed)
            b.setSizePolicy(sp)
            # Appliquer une fonte avec taille en pixels pour un rendu stable des emojis
            try:
                _f = b.font()
                _f.setPixelSize(24)
                b.setFont(_f)
            except Exception:
                pass
            # Style moderne pour les boutons, ajust√© pour √©viter la coupe des glyphes
            b.setStyleSheet("""
                QPushButton {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 255, 255, 0.25),
                        stop:0.5 rgba(255, 255, 255, 0.15),
                        stop:1 rgba(255, 255, 255, 0.05));
                    border: 2px solid rgba(255, 255, 255, 0.26);
                    border-radius: 12px;
                    padding-left: 6px;
                    padding-right: 6px;
                    padding-top: 6px;
                    padding-bottom: 6px;
                    font-size: 20px;
                    font-weight: 600;
                    color: white;
                    min-width: 72px;
                    min-height: 72px;
                    text-align: center;
                }
                QPushButton:hover {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(0, 255, 136, 0.3),
                        stop:0.5 rgba(0, 255, 136, 0.2),
                        stop:1 rgba(0, 255, 136, 0.1));
                    border: 2px solid rgba(0, 255, 136, 0.45);
                }
                QPushButton:pressed {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(0, 255, 136, 0.4),
                        stop:0.5 rgba(0, 255, 136, 0.3),
                        stop:1 rgba(0, 255, 136, 0.2));
                    border: 2px solid rgba(0, 255, 136, 0.6);
                }
            """)

            b.clicked.connect(cb)
            
            # D√©sactiver les animations qui causent le mouvement
            # b.enterEvent = lambda event: self.add_glow_effect(b)
            # b.leaveEvent = lambda event: self.remove_glow_effect(b)

            return b
        # Logo Ragnar √† gauche (ouvre le menu Applications)
        logo_btn = QtWidgets.QPushButton("üî∑")
        logo_btn.setToolTip("Menu Ragnar")
        logo_btn.setFixedSize(28, 28)
        logo_btn.setStyleSheet("""
            QPushButton {
                background: rgba(255,255,255,0.08);
                border: 1px solid rgba(255,255,255,0.25);
                border-radius: 14px;
                font-size: 14px;
            }
            QPushButton:hover {
                background: rgba(0,255,136,0.18);
                border-color: rgba(0,255,136,0.5);
            }
        """)
        logo_btn.clicked.connect(self.show_apps_menu)
        dlay.addWidget(logo_btn)
        dlay.addSpacing(4)
        
        apps = [
            ("üåê", "Navigateur", self.show_browser),
            ("üìÅ", "Fichiers", self.show_files),
            ("üõçÔ∏è", "Store", self.show_store),
            ("üñ•Ô∏è", "Syst√®me", self.show_system),
            ("‚¨áÔ∏è", "MAJ", self.show_updater),
            ("üß©", "Config", self.show_settings)
        ]
        
        # Zone d'ic√¥nes d'applications
        apps_bar = QtWidgets.QWidget()
        apps_bar_lay = QtWidgets.QHBoxLayout(apps_bar)
        apps_bar_lay.setContentsMargins(0, 0, 0, 0)
        apps_bar_lay.setSpacing(4)
        apps_bar_lay.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeft | QtCore.Qt.AlignmentFlag.AlignVCenter)
        for i, (e, t, c) in enumerate(apps):
            apps_bar_lay.addWidget(btn(e, t, c))
        dlay.addWidget(apps_bar, 1)

        # (Bouton Options supprim√© sur demande)

        # S√©lecteur multi-bureaux √† droite
        desktops_container = QtWidgets.QWidget()
        desktops_lay = QtWidgets.QHBoxLayout(desktops_container)
        desktops_lay.setContentsMargins(0, 0, 0, 0)
        desktops_lay.setSpacing(6)
        desktops_icon = QtWidgets.QLabel("üóî")
        desktops_icon.setToolTip("Bureaux virtuels")
        self.desktop_selector = QtWidgets.QComboBox()
        self.desktop_selector.addItems([
            "Bureau 1 - Navigateur",
            "Bureau 2 - Fichiers",
            "Bureau 3 - Syst√®me"
        ])
        self.desktop_selector.currentIndexChanged.connect(self.switch_virtual_desktop)
        desktops_lay.addWidget(desktops_icon)
        desktops_lay.addWidget(self.desktop_selector)
        dlay.addWidget(desktops_container, 0)
        root = QtWidgets.QVBoxLayout(self)

        # Marge inf√©rieure r√©duite: dock tr√®s proche du bas sans toucher
        root.setContentsMargins(18, 18, 18, 12)
        
        root.setSpacing(14)

        root.addWidget(top)

        root.addStretch(1)

        # Ancrer le dock en bas, centr√© horizontalement, tout en respectant la marge basse
        root.addWidget(dock, 0, QtCore.Qt.AlignmentFlag.AlignHCenter | QtCore.Qt.AlignmentFlag.AlignBottom)

        # Plus de stretch ici pour √©viter de recentrer le dock : on le garde ancr√© en bas avec marge



        self.timer = QtCore.QTimer(self)

        self.timer.timeout.connect(self._tick)

        self.timer.start(15_000)

        self._tick()
        
        # Charger le bureau virtuel pr√©c√©dent si pr√©sent
        try:
            st = _read_state_safe()
            idx = int(st.get("current_virtual_desktop", 0))
            if 0 <= idx < self.desktop_selector.count():
                self.desktop_selector.setCurrentIndex(idx)
        except Exception:
            pass

    def switch_virtual_desktop(self, index: int):
        """Active un profil de bureau et lance l'app associ√©e."""
        try:
            # Persister le bureau choisi
            st = _read_state_safe()
            st["current_virtual_desktop"] = int(index)
            _write_state_safe(st)
        except Exception:
            pass

        # Mappage bureau ‚Üí action principale
        if index == 0:
            # Bureau 1: Navigateur
            try:
                self.show_browser()
            except Exception:
                pass
        elif index == 1:
            # Bureau 2: Fichiers
            try:
                self.show_files()
            except Exception:
                pass
        elif index == 2:
            # Bureau 3: Syst√®me
            try:
                self.show_system()
            except Exception:
                pass



    def _tick(self):
        self.clock.setText(QtCore.QTime.currentTime().toString("HH:mm"))

    # === Dev Tool cach√©: s√©quence Fl√®che Haut puis Fl√®che Bas
    def keyPressEvent(self, event: QtGui.QKeyEvent):
        try:
            key = event.key()
            now = time.time()
            # reset si plus de 2s entre touches
            if now - self._secret_last_ts > 2.0:
                self._secret_seq = []
            self._secret_last_ts = now
            if key in (QtCore.Qt.Key.Key_Up, QtCore.Qt.Key.Key_Down):
                self._secret_seq.append(key)
                # Garder uniquement 2 derni√®res
                self._secret_seq = self._secret_seq[-2:]
                if self._secret_seq == [QtCore.Qt.Key.Key_Up, QtCore.Qt.Key.Key_Down]:
                    self._secret_seq = []
                    self.show_dev_tool()
                    return
        except Exception:
            pass
        super().keyPressEvent(event)

    def show_dev_tool(self):
        try:
            d = DevToolDialog(self)
            d.show()
        except Exception as e:
            QtWidgets.QMessageBox.warning(self, "Dev Tool", f"Erreur ouverture Dev Tool: {e}")
    
    def show_dock_options_menu(self):
        menu = QtWidgets.QMenu(self)
        # Verre Ultra toggle
        st = _read_state_safe()
        ultra_enabled = bool(st.get("ultra_glass_enabled", False))
        ultra_action = menu.addAction("‚ú® Verre Ultra: " + ("ON" if ultra_enabled else "OFF"))
        def toggle_ultra():
            s = _read_state_safe()
            s["ultra_glass_enabled"] = not bool(s.get("ultra_glass_enabled", False))
            _write_state_safe(s)
            QtWidgets.QMessageBox.information(self, "‚ú® Verre Ultra", "Modifi√©. Ouvrez un module (ex: Fichiers) pour voir l'effet.")
        ultra_action.triggered.connect(toggle_ultra)

        # Rapp Bureau
        rapp_action = menu.addAction("üì¶ Lancer Rapp Bureau‚Ä¶")
        rapp_action.triggered.connect(self.launch_rapp_from_desktop)

        # Sandbox toggle
        sandbox_enabled = bool(st.get("sandbox_enabled", False))
        sandbox_action = menu.addAction("üîí Sandbox: " + ("ON" if sandbox_enabled else "OFF"))
        def toggle_sandbox():
            s = _read_state_safe()
            s["sandbox_enabled"] = not bool(s.get("sandbox_enabled", False))
            _write_state_safe(s)
            QtWidgets.QMessageBox.information(self, "üîí Sandbox", "√âtat de la sandbox mis √† jour.")
        sandbox_action.triggered.connect(toggle_sandbox)

        menu.addSeparator()
        upd_action = menu.addAction("‚¨áÔ∏è Ouvrir Updater")
        upd_action.triggered.connect(self.show_updater)
        quick_action = menu.addAction("‚ö° Mise √† jour rapide")
        quick_action.triggered.connect(self.quick_update)
        restart_action = menu.addAction("üîÑ Red√©marrer")
        restart_action.triggered.connect(self.restart_ragnar)

        pos = QtGui.QCursor.pos()
        menu.exec(pos)

    def add_glow_effect(self, widget):
        """Ajoute un effet de lueur spectaculaire avec jeux de lumi√®re au widget"""
        try:
            # Effet de lueur principal avec couleur dynamique
            glow = QtWidgets.QGraphicsDropShadowEffect()
            glow.setBlurRadius(40)
            glow.setXOffset(0)
            glow.setYOffset(0)
            glow.setColor(QtGui.QColor(0, 255, 136, 250))
            
            # Effet de lueur secondaire pour plus de profondeur
            glow2 = QtWidgets.QGraphicsDropShadowEffect()
            glow2.setBlurRadius(70)
            glow2.setXOffset(0)
            glow2.setYOffset(0)
            glow2.setColor(QtGui.QColor(0, 255, 255, 150))
            
            # Effet de lueur tertiaire pour l'effet arc-en-ciel
            glow3 = QtWidgets.QGraphicsDropShadowEffect()
            glow3.setBlurRadius(100)
            glow3.setXOffset(0)
            glow3.setYOffset(0)
            glow3.setColor(QtGui.QColor(255, 0, 255, 100))
            
            # Appliquer l'effet principal
            widget.setGraphicsEffect(glow)
            
            # Animation de pulsation de la lueur principale
            self.glow_animation = QtCore.QPropertyAnimation(glow, b"blurRadius")
            self.glow_animation.setDuration(2000)
            self.glow_animation.setStartValue(25)
            self.glow_animation.setKeyValueAt(0.3, 50)
            self.glow_animation.setKeyValueAt(0.7, 35)
            self.glow_animation.setEndValue(25)
            self.glow_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
            self.glow_animation.setLoopCount(-1)
            self.glow_animation.start()
            
            # Animation de couleur pour l'effet arc-en-ciel
            self.color_animation = QtCore.QPropertyAnimation(glow, b"color")
            self.color_animation.setDuration(3000)
            self.color_animation.setStartValue(QtGui.QColor(0, 255, 136, 250))
            self.color_animation.setKeyValueAt(0.25, QtGui.QColor(0, 255, 255, 250))
            self.color_animation.setKeyValueAt(0.5, QtGui.QColor(255, 0, 255, 250))
            self.color_animation.setKeyValueAt(0.75, QtGui.QColor(255, 255, 0, 250))
            self.color_animation.setEndValue(QtGui.QColor(0, 255, 136, 250))
            self.color_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
            self.color_animation.setLoopCount(-1)
            self.color_animation.start()
            
        except Exception:
            pass
    
    def remove_glow_effect(self, widget):
        """Supprime l'effet de lueur du widget"""
        try:
            if hasattr(self, 'glow_animation'):
                self.glow_animation.stop()
            if hasattr(self, 'color_animation'):
                self.color_animation.stop()
            widget.setGraphicsEffect(None)
        except Exception:
            pass
    
    def start_desktop_animations(self):
        """D√©marre les animations du bureau (d√©sactiv√©es pour √©viter le mouvement)"""
        try:
            # D√©sactiver les animations qui causent le mouvement des ic√¥nes
            # Animation de flottement pour les cartes de verre
            # for child in self.findChildren(QtWidgets.QWidget, "GlassCard"):
            #     if child.isVisible():
            #         glass_float_animation(child, 4000 + random.randint(0, 2000))
            
            # Effet de scintillement pour le titre
            if hasattr(self, 'title'):
                shimmer_effect(self.title, 3000)
            
            # D√©sactiver l'animation des boutons du dock
            # for child in self.findChildren(QtWidgets.QPushButton):
            #     if "DesktopButton" in child.objectName():
            #         glass_float_animation(child, 5000 + random.randint(0, 3000))
                    
        except Exception as e:
            print(f"Erreur animations bureau: {e}")

    def show_apps_menu(self):
        """Affiche le menu d√©roulant avec toutes les applications"""
        menu = QtWidgets.QMenu(self)
        menu.setStyleSheet("""
            QMenu {
                background: rgba(20, 20, 30, 0.95);
                border: 1px solid rgba(255,255,255,0.3);
                border-radius: 8px;
                padding: 4px;
            }
            QMenu::item {
                background: transparent;
                padding: 8px 16px;
                border-radius: 4px;
                color: #eaecf3;
            }
            QMenu::item:selected {
                background: rgba(255,255,255,0.15);
            }
            QMenu::separator {
                height: 1px;
                background: rgba(255,255,255,0.2);
                margin: 4px 8px;
            }
        """)
        
        # Applications principales
        apps_section = [
            ("üñ•Ô∏è Syst√®me", self.show_system),
            ("üìÅ Fichiers", self.show_files),
            ("üõçÔ∏è Store", self.show_store),
            ("üåê Navigateur", self.show_browser),
            ("üí¨ Chat", self.show_chat),
            ("üîó Ragnar Link", self.show_ragnar_link),
        ]
        
        for name, callback in apps_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # Outils cr√©atifs
        creative_section = [
            ("üßÆ Calculatrice", self.show_calculator),
            ("üìù Notes", self.show_notes),
            ("üé® Paint", self.show_paint),
            ("üéµ Lecteur Audio", self.show_audio_player),
            ("üì∏ Capture d'√âcran", self.show_screenshot_tool),
            ("üì± G√©n√©rateur QR Code", self.show_qr_generator),
        ]
        
        for name, callback in creative_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # Outils syst√®me
        system_tools_section = [
            ("üíª Terminal", self.show_terminal),
            ("üìä Moniteur R√©seau", self.show_network_monitor),
            ("üå°Ô∏è Moniteur Syst√®me", self.show_system_monitor),
            ("üîç Recherche Fichiers", self.show_file_search),
            ("üìã Presse-papiers", self.show_clipboard_manager),
            ("üîê G√©n√©rateur Mots de Passe", self.show_password_generator),
        ]
        
        for name, callback in system_tools_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # D√©veloppement
        dev_section = [
            ("üîß Outils D√©veloppeur", self.show_dev_tools),
            ("üì¶ Gestionnaire .rapp", self.show_rapp_manager),
        ]
        
        for name, callback in dev_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        # Ajout 26.3.3: Rapp Bureau (choisir un .rapp sur le Bureau)
        rapp_action = menu.addAction("üì¶ Rapp Bureau")
        rapp_action.triggered.connect(self.launch_rapp_from_desktop)
        
        menu.addSeparator()
        
        # Bureautique et Productivit√©
        productivity_section = [
            ("üìÑ √âditeur de Texte", self.show_text_editor),
            ("üìä Tableur", self.show_spreadsheet),
            ("üìß Client Email", self.show_email_client),
            ("üìÖ Calendrier", self.show_calendar),
            ("üìñ Lecteur PDF", self.show_pdf_reader),
            ("üóÇÔ∏è Gestionnaire T√¢ches", self.show_task_manager),
            ("‚è∞ Minuteur & Chrono", self.show_timer_app),
            ("üìê Convertisseur Unit√©s", self.show_unit_converter),
        ]
        
        for name, callback in productivity_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # Multim√©dia
        multimedia_section = [
            ("üéµ Lecteur Audio", self.show_audio_player),
            ("üé¨ Lecteur Vid√©o", self.show_video_player),
            ("üìÑ Lecteur PDF", self.show_pdf_reader),
            ("üì∑ Galerie Photos", self.show_photo_gallery),
            ("üéôÔ∏è Enregistreur", self.show_audio_recorder),
            ("üé® √âditeur Images", self.show_image_viewer),
            ("üéûÔ∏è √âditeur Vid√©o", self.show_video_editor),
        ]
        
        for name, callback in multimedia_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # Jeux et Divertissement
        games_section = [
            ("üêç Snake Ragnar", self.show_snake_game),
            ("üéØ Jeu de Tir", self.show_shooting_game),
            ("üß© Puzzle Magique", self.show_puzzle_game),
            ("üé≤ Casino Ragnar", self.show_casino_games),
            ("üÉè Solitaire", self.show_solitaire),
            ("üé™ Arcade Center", self.show_arcade_center),
            ("üèÜ Tournois", self.show_tournaments),
        ]
        
        for name, callback in games_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # S√©curit√© et R√©seau
        security_section = [
            ("üîê Gestionnaire Mots de Passe Pro", self.show_password_manager_pro),
        ]
        
        for name, callback in security_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # Nouvelles fonctionnalit√©s 26.3.0
        new_features_section = [
            ("üé® Th√®mes Avanc√©s", self.show_theme_manager),
            ("üè™ Marketplace .rapp", self.show_marketplace),
            ("üì± Widgets Bureau", self.show_widget_manager),
            ("üîî Centre Notifications", self.show_notification_center),
            ("‚òÅÔ∏è Ragnar Cloud", self.show_ragnar_cloud),
            ("üéÆ Games Center", self.show_games_center),
            ("üåü Ragnar Premium", self.show_premium_features),
        ]
        
        for name, callback in new_features_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # Actions syst√®me
        system_section = [
            ("‚ö° Mise √† jour rapide", self.quick_update),
            ("‚¨áÔ∏è Mise √† jour", self.show_updater),
            ("üñºÔ∏è Personnaliser", self.change_wallpaper),
            ("üîÑ Red√©marrer", self.restart_ragnar),
        ]
        
        for name, callback in system_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        # Afficher le menu sous le bouton
        button_pos = self.menu_btn.mapToGlobal(self.menu_btn.rect().bottomLeft())
        menu.exec(button_pos)
    
    def restart_ragnar(self):
        """Red√©marre Ragnar OS"""
        reply = QtWidgets.QMessageBox.question(
            self, "Red√©marrer",
            "Voulez-vous vraiment red√©marrer Ragnar OS ?",
            QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
        )
        
        if reply == QtWidgets.QMessageBox.StandardButton.Yes:
            QtWidgets.QApplication.quit()
            try:
                os.execv(sys.executable, [sys.executable] + sys.argv)
            except Exception:
                QtWidgets.QApplication.quit()



    # ===== Apps =====

    def show_system(self):
        """Moniteur syst√®me moderne avec vraies informations"""
        d = GlassDialog("üñ•Ô∏è Moniteur Syst√®me Ragnar", (700, 550), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Informations Syst√®me", "Monitoring en temps r√©el")
        lay.addWidget(header)
        
        # 26.3.3: Panneau Verre Ultra (intensit√© + persistance)
        ultra_card = QtWidgets.QWidget(objectName="GlassCard")
        ultra_layout = QtWidgets.QFormLayout(ultra_card)
        ultra_layout.setContentsMargins(16, 16, 16, 16)
        ultra_title = QtWidgets.QLabel("‚ú® Verre Ultra")
        ultra_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        lay.addWidget(ultra_title)

        enable_checkbox = QtWidgets.QCheckBox("Activer l'effet Verre Ultra")
        radius_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        radius_slider.setRange(0, 64)
        radius_slider.setSingleStep(1)
        radius_slider.setPageStep(4)
        radius_value = QtWidgets.QLabel("28")

        # Charger √©tat
        st = _read_state_safe()
        enable_checkbox.setChecked(bool(st.get("ultra_glass_enabled", False)))
        try:
            radius_slider.setValue(int(float(st.get("ultra_glass_radius", 28))))
            radius_value.setText(str(radius_slider.value()))
        except Exception:
            radius_slider.setValue(28)
            radius_value.setText("28")

        def on_enable_changed(checked):
            s = _read_state_safe()
            s["ultra_glass_enabled"] = bool(checked)
            _write_state_safe(s)

        def on_radius_changed(val):
            radius_value.setText(str(val))
            s = _read_state_safe()
            s["ultra_glass_radius"] = float(val)
            _write_state_safe(s)

        enable_checkbox.toggled.connect(on_enable_changed)
        radius_slider.valueChanged.connect(on_radius_changed)

        ultra_layout.addRow(enable_checkbox)
        hl = QtWidgets.QHBoxLayout()
        slider_container = QtWidgets.QWidget()
        slider_container.setLayout(hl)
        hl.addWidget(radius_slider)
        hl.addWidget(radius_value)
        ultra_layout.addRow("Intensit√© du flou", slider_container)

        lay.addWidget(ultra_card)

        # Cr√©er des cartes modernes pour chaque section
        
        # Carte Syst√®me
        system_card = QtWidgets.QWidget(objectName="GlassCard")
        system_layout = QtWidgets.QVBoxLayout(system_card)
        system_layout.setContentsMargins(16, 16, 16, 16)
        
        system_title = QtWidgets.QLabel("üíª Informations Syst√®me")
        system_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        system_layout.addWidget(system_title)
        
        try:
            import platform
            import psutil
            
            # Informations syst√®me avec style moderne
            system_info_items = [
                f"üñ•Ô∏è Syst√®me : {platform.system()} {platform.release()}",
                f"‚ö° Processeur : {platform.processor()[:50]}...",
                f"üêç Python : {platform.python_version()}",
                f"üèóÔ∏è Architecture : {platform.architecture()[0]}",
                f"üåê Nom machine : {platform.node()}"
            ]
            
            for info in system_info_items:
                info_label = QtWidgets.QLabel(info)
                info_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 255, 136, 0.5);")
                system_layout.addWidget(info_label)
            
            lay.addWidget(system_card)
            
            # Carte M√©moire
            memory_card = QtWidgets.QWidget(objectName="GlassCard")
            memory_layout = QtWidgets.QVBoxLayout(memory_card)
            memory_layout.setContentsMargins(16, 16, 16, 16)
            
            memory_title = QtWidgets.QLabel("üß† Utilisation M√©moire")
            memory_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
            memory_layout.addWidget(memory_title)
            
            # Informations m√©moire
            memory = psutil.virtual_memory()
            memory_total = memory.total / (1024**3)  # GB
            memory_used = memory.used / (1024**3)   # GB
            memory_percent = memory.percent
            
            memory_info_items = [
                f"üíæ M√©moire totale : {memory_total:.1f} GB",
                f"üî• M√©moire utilis√©e : {memory_used:.1f} GB ({memory_percent:.1f}%)",
                f"‚úÖ M√©moire libre : {(memory_total - memory_used):.1f} GB",
                f"üìä Pourcentage : {memory_percent:.1f}%"
            ]
            
            for info in memory_info_items:
                info_label = QtWidgets.QLabel(info)
                info_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 170, 255, 0.5);")
                memory_layout.addWidget(info_label)
            
            # Barre de progression pour la m√©moire
            memory_progress = QtWidgets.QProgressBar()
            memory_progress.setValue(int(memory_percent))
            memory_progress.setFormat(f"M√©moire utilis√©e: {memory_percent:.1f}%")
            memory_layout.addWidget(memory_progress)
            
            lay.addWidget(memory_card)
            
            # Carte CPU
            cpu_card = QtWidgets.QWidget(objectName="GlassCard")
            cpu_layout = QtWidgets.QVBoxLayout(cpu_card)
            cpu_layout.setContentsMargins(16, 16, 16, 16)
            
            cpu_title = QtWidgets.QLabel("‚ö° Processeur")
            cpu_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
            cpu_layout.addWidget(cpu_title)
            
            # Informations CPU
            cpu_percent = psutil.cpu_percent(interval=1)
            cpu_count = psutil.cpu_count()
            cpu_freq = psutil.cpu_freq()
            
            cpu_info_items = [
                f"üî• Utilisation CPU : {cpu_percent:.1f}%",
                f"üßÆ Nombre de c≈ìurs : {cpu_count}",
                f"‚ö° Fr√©quence : {cpu_freq.current:.0f} MHz" if cpu_freq else "‚ö° Fr√©quence : N/A"
            ]
            
            for info in cpu_info_items:
                info_label = QtWidgets.QLabel(info)
                info_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(255, 170, 0, 0.5);")
                cpu_layout.addWidget(info_label)
            
            # Barre de progression pour le CPU
            cpu_progress = QtWidgets.QProgressBar()
            cpu_progress.setValue(int(cpu_percent))
            cpu_progress.setFormat(f"CPU: {cpu_percent:.1f}%")
            cpu_layout.addWidget(cpu_progress)
            
            lay.addWidget(cpu_card)
            
            # Boutons d'action modernes
            actions_card = QtWidgets.QWidget(objectName="GlassCard")
            actions_layout = QtWidgets.QHBoxLayout(actions_card)
            actions_layout.setContentsMargins(16, 16, 16, 16)
            
            refresh_btn = QtWidgets.QPushButton("üîÑ Actualiser")
            refresh_btn.clicked.connect(lambda: d.close() or self.show_system())
            
            close_btn = QtWidgets.QPushButton("‚ùå Fermer")
            close_btn.clicked.connect(d.close)
            
            actions_layout.addWidget(refresh_btn)
            actions_layout.addStretch()
            actions_layout.addWidget(close_btn)
            
            lay.addWidget(actions_card)
            
        except ImportError:
            # Fallback si psutil n'est pas install√© - cr√©er des cartes simples
            fallback_card = QtWidgets.QWidget(objectName="GlassCard")
            fallback_layout = QtWidgets.QVBoxLayout(fallback_card)
            fallback_layout.setContentsMargins(16, 16, 16, 16)
            
            fallback_title = QtWidgets.QLabel("‚ö†Ô∏è Informations Limit√©es")
            fallback_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
            fallback_layout.addWidget(fallback_title)
            
            import platform
            fallback_info_items = [
                f"üñ•Ô∏è Syst√®me : {platform.system()} {platform.release()}",
                f"‚ö° Processeur : {platform.processor()[:50]}...",
                f"üêç Python : {platform.python_version()}",
                f"üíæ CPU : {random.randint(10,80)}% (simul√©)",
                f"üß† RAM : {random.randint(30,70)}% (simul√©)"
            ]
            
            for info in fallback_info_items:
                info_label = QtWidgets.QLabel(info)
                info_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(255, 170, 0, 0.5);")
                fallback_layout.addWidget(info_label)
            
            lay.addWidget(fallback_card)
        
        d.show()
    
    def refresh_system_info(self, dialog):
        """Actualise les informations syst√®me"""
        dialog.close()
        self.show_system()
    
    def show_clipboard_manager(self):
        """Gestionnaire de presse-papiers moderne"""
        d = GlassDialog("üìã Gestionnaire de Presse-papiers", (600, 400), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Presse-papiers", "Gestion avanc√©e du contenu copi√©")
        lay.addWidget(header)
        
        # Contenu actuel
        current_card = QtWidgets.QWidget(objectName="GlassCard")
        current_layout = QtWidgets.QVBoxLayout(current_card)
        current_layout.setContentsMargins(16, 16, 16, 16)
        
        current_title = QtWidgets.QLabel("üìÑ Contenu Actuel")
        current_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        current_layout.addWidget(current_title)
        
        try:
            from PyQt6.QtGui import QClipboard
            clipboard = QtWidgets.QApplication.clipboard()
            current_text = clipboard.text()
            
            if current_text:
                text_preview = current_text[:200] + "..." if len(current_text) > 200 else current_text
                preview_label = QtWidgets.QLabel(f"üìù {text_preview}")
                preview_label.setStyleSheet("color: white; font-size: 12px; padding: 8px; border: 1px solid rgba(255,255,255,0.3); border-radius: 5px;")
                preview_label.setWordWrap(True)
                current_layout.addWidget(preview_label)
                
                # Informations
                info_label = QtWidgets.QLabel(f"üìä Longueur : {len(current_text)} caract√®res")
                info_label.setStyleSheet("color: #00aaff; font-size: 11px; padding: 4px;")
                current_layout.addWidget(info_label)
            else:
                empty_label = QtWidgets.QLabel("‚ùå Presse-papiers vide")
                empty_label.setStyleSheet("color: #ffaa00; font-size: 12px; padding: 8px;")
                current_layout.addWidget(empty_label)
                
        except Exception as e:
            error_label = QtWidgets.QLabel(f"‚ö†Ô∏è Erreur : {str(e)}")
            error_label.setStyleSheet("color: #ff6666; font-size: 12px; padding: 8px;")
            current_layout.addWidget(error_label)
        
        lay.addWidget(current_card)
        
        # Actions
        actions_card = QtWidgets.QWidget(objectName="GlassCard")
        actions_layout = QtWidgets.QHBoxLayout(actions_card)
        actions_layout.setContentsMargins(16, 16, 16, 16)
        
        clear_btn = QtWidgets.QPushButton("üóëÔ∏è Vider")
        copy_btn = QtWidgets.QPushButton("üìã Copier Texte")
        refresh_btn = QtWidgets.QPushButton("üîÑ Actualiser")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        # Connexions
        clear_btn.clicked.connect(lambda: QtWidgets.QApplication.clipboard().clear())
        copy_btn.clicked.connect(lambda: self.copy_custom_text())
        refresh_btn.clicked.connect(lambda: d.close() or self.show_clipboard_manager())
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(clear_btn)
        actions_layout.addWidget(copy_btn)
        actions_layout.addWidget(refresh_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addWidget(actions_card)
        
        d.show()
        fade_in(d, 600)
    
    def copy_custom_text(self):
        """Permet de copier un texte personnalis√©"""
        text, ok = QtWidgets.QInputDialog.getText(
            self, "üìã Copier du texte", 
            "Entrez le texte √† copier :",
            text=""
        )
        if ok and text:
            QtWidgets.QApplication.clipboard().setText(text)
            QtWidgets.QMessageBox.information(
                self, "‚úÖ Copi√©", 
                f"Texte copi√© dans le presse-papiers !\n\nLongueur : {len(text)} caract√®res"
            )
    
    def show_games_center(self):
        """Centre de jeux Ragnar avec plusieurs jeux int√©gr√©s"""
        d = GlassDialog("üéÆ Centre de Jeux Ragnar", (900, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Centre de Jeux", "Divertissement et d√©fis")
        lay.addWidget(header)
        
        # Onglets pour diff√©rents types de jeux
        tabs = QtWidgets.QTabWidget()
        
        # Onglet Jeux Classiques
        classic_tab = QtWidgets.QWidget()
        classic_layout = QtWidgets.QVBoxLayout(classic_tab)
        
        # Grille de jeux classiques
        games_grid = QtWidgets.QGridLayout()
        
        classic_games = [
            ("üêç", "Snake Ragnar", "Jeu du serpent moderne", self.launch_snake_game),
            ("üéØ", "Cible", "Jeu de pr√©cision", self.launch_target_game),
            ("üß©", "Puzzle", "Casse-t√™te logique", self.launch_puzzle_game),
            ("üé≤", "D√©s", "Jeux de hasard", self.launch_dice_game),
            ("üÉè", "Cartes", "Solitaire et plus", self.launch_card_games),
            ("üé™", "Arcade", "Jeux d'arcade", self.launch_arcade_games),
        ]
        
        row, col = 0, 0
        for emoji, name, desc, callback in classic_games:
            game_card = QtWidgets.QWidget(objectName="GlassCard")
            game_layout = QtWidgets.QVBoxLayout(game_card)
            game_layout.setContentsMargins(16, 16, 16, 16)
            
            game_icon = QtWidgets.QLabel(emoji)
            game_icon.setStyleSheet("font-size: 48px; text-align: center;")
            game_icon.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            game_title = QtWidgets.QLabel(name)
            game_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; text-align: center;")
            game_title.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            game_desc = QtWidgets.QLabel(desc)
            game_desc.setStyleSheet("font-size: 11px; color: #cccccc; text-align: center;")
            game_desc.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            game_desc.setWordWrap(True)
            
            play_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è Jouer")
            play_btn.clicked.connect(callback)
            
            game_layout.addWidget(game_icon)
            game_layout.addWidget(game_title)
            game_layout.addWidget(game_desc)
            game_layout.addWidget(play_btn)
            
            games_grid.addWidget(game_card, row, col)
            col += 1
            if col > 2:
                col = 0
                row += 1
        
        classic_layout.addLayout(games_grid)
        tabs.addTab(classic_tab, "üéÆ Classiques")
        
        # Onglet Statistiques
        stats_tab = QtWidgets.QWidget()
        stats_layout = QtWidgets.QVBoxLayout(stats_tab)
        
        stats_card = QtWidgets.QWidget(objectName="GlassCard")
        stats_card_layout = QtWidgets.QVBoxLayout(stats_card)
        stats_card_layout.setContentsMargins(16, 16, 16, 16)
        
        stats_title = QtWidgets.QLabel("üìä Statistiques de Jeu")
        stats_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        stats_card_layout.addWidget(stats_title)
        
        # Statistiques simul√©es
        stats_info = [
            "üèÜ Parties jou√©es : 127",
            "‚≠ê Score total : 15,420 points",
            "üéØ Pr√©cision moyenne : 78%",
            "‚è±Ô∏è Temps de jeu : 2h 34min",
            "ü•á Meilleur score : Snake (2,340 pts)",
            "üî• S√©rie actuelle : 5 victoires"
        ]
        
        for stat in stats_info:
            stat_label = QtWidgets.QLabel(stat)
            stat_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 170, 255, 0.5);")
            stats_card_layout.addWidget(stat_label)
        
        stats_layout.addWidget(stats_card)
        tabs.addTab(stats_tab, "üìä Stats")
        
        lay.addWidget(tabs)
        
        # Boutons d'action
        actions_card = QtWidgets.QWidget(objectName="GlassCard")
        actions_layout = QtWidgets.QHBoxLayout(actions_card)
        actions_layout.setContentsMargins(16, 16, 16, 16)
        
        tournament_btn = QtWidgets.QPushButton("üèÜ Tournois")
        leaderboard_btn = QtWidgets.QPushButton("ü•á Classements")
        settings_btn = QtWidgets.QPushButton("‚öôÔ∏è Options")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        tournament_btn.clicked.connect(self.show_tournaments)
        leaderboard_btn.clicked.connect(self.show_leaderboards)
        settings_btn.clicked.connect(self.show_game_settings)
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(tournament_btn)
        actions_layout.addWidget(leaderboard_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addWidget(actions_card)
        
        d.show()
        fade_in(d, 800)
    
    def launch_snake_game(self):
        """Lance le jeu Snake avec interface compl√®te"""
        d = GlassDialog("üêç Snake Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header avec animation moderne
        header = make_header("üêç Snake Ragnar", "Le serpent l√©gendaire vous attend")
        lay.addWidget(header)
        modern_fade_in(header, 1000)
        
        # Zone de jeu
        game_area = QtWidgets.QWidget(objectName="GlassCard")
        game_area.setFixedSize(400, 400)
        game_area.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(0, 50, 0, 0.6));
                border: 3px solid rgba(0, 255, 136, 0.5);
                border-radius: 15px;
            }
        """)
        
        game_layout = QtWidgets.QVBoxLayout(game_area)
        game_layout.setContentsMargins(20, 20, 20, 20)
        
        # Affichage du score
        score_label = QtWidgets.QLabel("Score: 0")
        score_label.setStyleSheet("""
            QLabel {
                font-size: 24px;
                font-weight: bold;
                color: #00ff88;
                text-align: center;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        score_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        game_layout.addWidget(score_label)
        
        # Zone de jeu simul√©e
        game_board = QtWidgets.QLabel("üêç")
        game_board.setStyleSheet("""
            QLabel {
                font-size: 200px;
                text-align: center;
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                padding: 50px;
            }
        """)
        game_board.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        game_board.setFixedHeight(200)
        game_layout.addWidget(game_board)
        
        # Instructions
        instructions = QtWidgets.QLabel("Utilisez les fl√®ches pour diriger le serpent\nMangez les pommes üçé pour grandir !")
        instructions.setStyleSheet("""
            QLabel {
                color: white;
                font-size: 14px;
                text-align: center;
                padding: 10px;
            }
        """)
        instructions.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        game_layout.addWidget(instructions)
        
        lay.addWidget(game_area, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Contr√¥les de jeu
        controls_card = QtWidgets.QWidget(objectName="GlassCard")
        controls_layout = QtWidgets.QVBoxLayout(controls_card)
        controls_layout.setContentsMargins(16, 16, 16, 16)
        
        controls_title = QtWidgets.QLabel("üéÆ Contr√¥les")
        controls_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        controls_layout.addWidget(controls_title)
        
        # Boutons de contr√¥le
        controls_buttons = QtWidgets.QGridLayout()
        
        up_btn = QtWidgets.QPushButton("‚¨ÜÔ∏è")
        down_btn = QtWidgets.QPushButton("‚¨áÔ∏è")
        left_btn = QtWidgets.QPushButton("‚¨ÖÔ∏è")
        right_btn = QtWidgets.QPushButton("‚û°Ô∏è")
        
        # Style pour les boutons de contr√¥le
        control_style = """
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.3),
                    stop:1 rgba(0, 255, 136, 0.1));
                border: 2px solid rgba(0, 255, 136, 0.5);
                border-radius: 10px;
                color: white;
                font-weight: bold;
                font-size: 20px;
                padding: 15px;
                min-width: 60px;
                min-height: 60px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.5),
                    stop:1 rgba(0, 255, 136, 0.3));
                border: 2px solid rgba(0, 255, 136, 0.8);
            }
            QPushButton:pressed {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.7),
                    stop:1 rgba(0, 255, 136, 0.5));
            }
        """
        
        up_btn.setStyleSheet(control_style)
        down_btn.setStyleSheet(control_style)
        left_btn.setStyleSheet(control_style)
        right_btn.setStyleSheet(control_style)
        
        # Placement des boutons
        controls_buttons.addWidget(up_btn, 0, 1)
        controls_buttons.addWidget(left_btn, 1, 0)
        controls_buttons.addWidget(down_btn, 1, 1)
        controls_buttons.addWidget(right_btn, 1, 2)
        
        controls_layout.addLayout(controls_buttons)
        lay.addWidget(controls_card)
        
        # Actions des boutons
        def move_up():
            neon_glow_animation(up_btn, 500)
            score_label.setText(f"Score: {int(score_label.text().split(': ')[1]) + 10}")
            bounce_in(game_board, 300)
        
        def move_down():
            neon_glow_animation(down_btn, 500)
            score_label.setText(f"Score: {int(score_label.text().split(': ')[1]) + 10}")
            bounce_in(game_board, 300)
        
        def move_left():
            neon_glow_animation(left_btn, 500)
            score_label.setText(f"Score: {int(score_label.text().split(': ')[1]) + 10}")
            bounce_in(game_board, 300)
        
        def move_right():
            neon_glow_animation(right_btn, 500)
            score_label.setText(f"Score: {int(score_label.text().split(': ')[1]) + 10}")
            bounce_in(game_board, 300)
        
        up_btn.clicked.connect(move_up)
        down_btn.clicked.connect(move_down)
        left_btn.clicked.connect(move_left)
        right_btn.clicked.connect(move_right)
        
        # Boutons d'action
        actions_layout = QtWidgets.QHBoxLayout()
        
        start_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è D√©marrer")
        pause_btn = QtWidgets.QPushButton("‚è∏Ô∏è Pause")
        reset_btn = QtWidgets.QPushButton("üîÑ Reset")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        start_btn.clicked.connect(lambda: [modern_fade_in(game_area, 800), neon_glow_animation(start_btn, 1000)])
        pause_btn.clicked.connect(lambda: holographic_effect(pause_btn, 1000))
        reset_btn.clicked.connect(lambda: [score_label.setText("Score: 0"), morphing_animation(game_board, 1000)])
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(start_btn)
        actions_layout.addWidget(pause_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        modern_fade_in(d, 1200)
        wave_animation(game_area, 3000)
    
    def launch_target_game(self):
        """Lance le jeu de tir √† la cible avec interface compl√®te"""
        d = GlassDialog("üéØ Jeu de Cible Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header avec animation moderne
        header = make_header("üéØ Jeu de Cible Ragnar", "Pr√©cision et rapidit√© sont essentielles")
        lay.addWidget(header)
        modern_fade_in(header, 1000)
        
        # Zone de jeu
        game_area = QtWidgets.QWidget(objectName="GlassCard")
        game_area.setFixedSize(500, 400)
        game_area.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(50, 0, 0, 0.6));
                border: 3px solid rgba(255, 0, 0, 0.5);
                border-radius: 15px;
            }
        """)
        
        game_layout = QtWidgets.QVBoxLayout(game_area)
        game_layout.setContentsMargins(20, 20, 20, 20)
        
        # Affichage du score et du temps
        info_layout = QtWidgets.QHBoxLayout()
        
        score_label = QtWidgets.QLabel("Score: 0")
        score_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #ff4444;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        time_label = QtWidgets.QLabel("Temps: 30s")
        time_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #00aaff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        info_layout.addWidget(score_label)
        info_layout.addStretch()
        info_layout.addWidget(time_label)
        game_layout.addLayout(info_layout)
        
        # Zone de cibles
        targets_area = QtWidgets.QWidget()
        targets_area.setFixedHeight(250)
        targets_area.setStyleSheet("""
            QWidget {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
        """)
        
        targets_layout = QtWidgets.QGridLayout(targets_area)
        
        # Cr√©er des cibles cliquables
        targets = []
        for i in range(9):
            target_btn = QtWidgets.QPushButton("üéØ")
            target_btn.setStyleSheet("""
                QPushButton {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 0, 0, 0.3),
                        stop:1 rgba(255, 0, 0, 0.1));
                    border: 2px solid rgba(255, 0, 0, 0.5);
                    border-radius: 15px;
                    color: white;
                    font-weight: bold;
                    font-size: 24px;
                    padding: 20px;
                }
                QPushButton:hover {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 0, 0, 0.5),
                        stop:1 rgba(255, 0, 0, 0.3));
                    border: 2px solid rgba(255, 0, 0, 0.8);
                }
            """)
            target_btn.setFixedSize(80, 80)
            
            def create_target_handler(btn, points):
                def hit_target():
                    cyberpunk_glitch_effect(btn, 500)
                    current_score = int(score_label.text().split(': ')[1])
                    score_label.setText(f"Score: {current_score + points}")
                    btn.setText("üí•")
                    btn.setEnabled(False)
                    # R√©activer apr√®s 1 seconde
                    QtCore.QTimer.singleShot(1000, lambda: [btn.setText("üéØ"), btn.setEnabled(True)])
                return hit_target
            
            target_btn.clicked.connect(create_target_handler(target_btn, 10))
            targets.append(target_btn)
            targets_layout.addWidget(target_btn, i // 3, i % 3)
        
        game_layout.addWidget(targets_area)
        lay.addWidget(game_area, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Instructions
        instructions_card = QtWidgets.QWidget(objectName="GlassCard")
        instructions_layout = QtWidgets.QVBoxLayout(instructions_card)
        instructions_layout.setContentsMargins(16, 16, 16, 16)
        
        instructions_title = QtWidgets.QLabel("üìã Instructions")
        instructions_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        instructions_layout.addWidget(instructions_title)
        
        instructions_text = QtWidgets.QLabel("""
        üéØ Cliquez sur les cibles pour marquer des points
        ‚ö° Chaque cible rapporte 10 points
        üí• Les cibles explosent temporairement apr√®s avoir √©t√© touch√©es
        üèÜ Essayez d'obtenir le meilleur score possible !
        """)
        instructions_text.setStyleSheet("color: white; font-size: 12px; padding: 8px;")
        instructions_layout.addWidget(instructions_text)
        
        lay.addWidget(instructions_card)
        
        # Boutons d'action
        actions_layout = QtWidgets.QHBoxLayout()
        
        start_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è D√©marrer")
        pause_btn = QtWidgets.QPushButton("‚è∏Ô∏è Pause")
        reset_btn = QtWidgets.QPushButton("üîÑ Reset")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        start_btn.clicked.connect(lambda: [modern_fade_in(game_area, 800), neon_glow_animation(start_btn, 1000)])
        pause_btn.clicked.connect(lambda: holographic_effect(pause_btn, 1000))
        reset_btn.clicked.connect(lambda: [score_label.setText("Score: 0"), morphing_animation(targets_area, 1000)])
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(start_btn)
        actions_layout.addWidget(pause_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        modern_fade_in(d, 1200)
        liquid_flow_animation(game_area, 4000)
    
    def launch_puzzle_game(self):
        """Lance le jeu de puzzle avec interface compl√®te"""
        d = GlassDialog("üß© Puzzle Magique Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header avec animation moderne
        header = make_header("üß© Puzzle Magique Ragnar", "R√©solvez les √©nigmes logiques")
        lay.addWidget(header)
        modern_fade_in(header, 1000)
        
        # Zone de jeu
        game_area = QtWidgets.QWidget(objectName="GlassCard")
        game_area.setFixedSize(500, 400)
        game_area.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(50, 0, 50, 0.6));
                border: 3px solid rgba(255, 0, 255, 0.5);
                border-radius: 15px;
            }
        """)
        
        game_layout = QtWidgets.QVBoxLayout(game_area)
        game_layout.setContentsMargins(20, 20, 20, 20)
        
        # Affichage du niveau et du score
        info_layout = QtWidgets.QHBoxLayout()
        
        level_label = QtWidgets.QLabel("Niveau: 1")
        level_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #ff00ff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        score_label = QtWidgets.QLabel("Score: 0")
        score_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #00aaff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        info_layout.addWidget(level_label)
        info_layout.addStretch()
        info_layout.addWidget(score_label)
        game_layout.addLayout(info_layout)
        
        # Zone de puzzle
        puzzle_area = QtWidgets.QWidget()
        puzzle_area.setFixedHeight(250)
        puzzle_area.setStyleSheet("""
            QWidget {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
        """)
        
        puzzle_layout = QtWidgets.QGridLayout(puzzle_area)
        
        # Cr√©er des pi√®ces de puzzle cliquables
        puzzle_pieces = []
        colors = ["üî¥", "üü°", "üü¢", "üîµ", "üü£", "üü†", "‚ö™", "‚ö´", "üü§"]
        
        for i in range(9):
            piece_btn = QtWidgets.QPushButton(colors[i])
            piece_btn.setStyleSheet("""
                QPushButton {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 0, 255, 0.3),
                        stop:1 rgba(255, 0, 255, 0.1));
                    border: 2px solid rgba(255, 0, 255, 0.5);
                    border-radius: 15px;
                    color: white;
                    font-weight: bold;
                    font-size: 24px;
                    padding: 20px;
                }
                QPushButton:hover {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 0, 255, 0.5),
                        stop:1 rgba(255, 0, 255, 0.3));
                    border: 2px solid rgba(255, 0, 255, 0.8);
                }
            """)
            piece_btn.setFixedSize(80, 80)
            
            def create_piece_handler(btn, original_color):
                def move_piece():
                    quantum_entanglement_effect(btn, 500)
                    current_score = int(score_label.text().split(': ')[1])
                    score_label.setText(f"Score: {current_score + 5}")
                    # Animation de mouvement
                    morphing_animation(btn, 300)
                return move_piece
            
            piece_btn.clicked.connect(create_piece_handler(piece_btn, colors[i]))
            puzzle_pieces.append(piece_btn)
            puzzle_layout.addWidget(piece_btn, i // 3, i % 3)
        
        game_layout.addWidget(puzzle_area)
        lay.addWidget(game_area, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Instructions
        instructions_card = QtWidgets.QWidget(objectName="GlassCard")
        instructions_layout = QtWidgets.QVBoxLayout(instructions_card)
        instructions_layout.setContentsMargins(16, 16, 16, 16)
        
        instructions_title = QtWidgets.QLabel("üìã Instructions")
        instructions_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        instructions_layout.addWidget(instructions_title)
        
        instructions_text = QtWidgets.QLabel("""
        üß© Cliquez sur les pi√®ces pour les d√©placer
        üéØ Organisez les couleurs dans l'ordre correct
        ‚ö° Chaque mouvement rapporte 5 points
        üèÜ Compl√©tez le puzzle pour passer au niveau suivant !
        """)
        instructions_text.setStyleSheet("color: white; font-size: 12px; padding: 8px;")
        instructions_layout.addWidget(instructions_text)
        
        lay.addWidget(instructions_card)
        
        # Boutons d'action
        actions_layout = QtWidgets.QHBoxLayout()
        
        start_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è D√©marrer")
        hint_btn = QtWidgets.QPushButton("üí° Indice")
        reset_btn = QtWidgets.QPushButton("üîÑ Reset")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        start_btn.clicked.connect(lambda: [modern_fade_in(game_area, 800), neon_glow_animation(start_btn, 1000)])
        hint_btn.clicked.connect(lambda: holographic_effect(hint_btn, 1000))
        reset_btn.clicked.connect(lambda: [score_label.setText("Score: 0"), morphing_animation(puzzle_area, 1000)])
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(start_btn)
        actions_layout.addWidget(hint_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        modern_fade_in(d, 1200)
        matrix_rain_effect(game_area, 5000)
    
    def launch_dice_games(self):
        """Lance les jeux de d√©s avec interface compl√®te"""
        d = GlassDialog("üé≤ Jeux de D√©s Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header avec animation moderne
        header = make_header("üé≤ Jeux de D√©s Ragnar", "La chance vous sourit-elle ?")
        lay.addWidget(header)
        modern_fade_in(header, 1000)
        
        # Zone de jeu
        game_area = QtWidgets.QWidget(objectName="GlassCard")
        game_area.setFixedSize(500, 400)
        game_area.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(50, 50, 0, 0.6));
                border: 3px solid rgba(255, 255, 0, 0.5);
                border-radius: 15px;
            }
        """)
        
        game_layout = QtWidgets.QVBoxLayout(game_area)
        game_layout.setContentsMargins(20, 20, 20, 20)
        
        # Affichage du score et du jeu actuel
        info_layout = QtWidgets.QHBoxLayout()
        
        game_label = QtWidgets.QLabel("Jeu: Yahtzee")
        game_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #ffff00;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        score_label = QtWidgets.QLabel("Score: 0")
        score_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #00aaff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        info_layout.addWidget(game_label)
        info_layout.addStretch()
        info_layout.addWidget(score_label)
        game_layout.addLayout(info_layout)
        
        # Zone de d√©s
        dice_area = QtWidgets.QWidget()
        dice_area.setFixedHeight(200)
        dice_area.setStyleSheet("""
            QWidget {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
        """)
        
        dice_layout = QtWidgets.QHBoxLayout(dice_area)
        dice_layout.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Cr√©er 5 d√©s
        dice_buttons = []
        for i in range(5):
            die_btn = QtWidgets.QPushButton("üé≤")
            die_btn.setStyleSheet("""
                QPushButton {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 255, 0, 0.3),
                        stop:1 rgba(255, 255, 0, 0.1));
                    border: 2px solid rgba(255, 255, 0, 0.5);
                    border-radius: 15px;
                    color: white;
                    font-weight: bold;
                    font-size: 32px;
                    padding: 20px;
                    min-width: 80px;
                    min-height: 80px;
                }
                QPushButton:hover {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 255, 0, 0.5),
                        stop:1 rgba(255, 255, 0, 0.3));
                    border: 2px solid rgba(255, 255, 0, 0.8);
                }
            """)
            
            def create_die_handler(btn):
                def roll_die():
                    cyberpunk_glitch_effect(btn, 500)
                    current_score = int(score_label.text().split(': ')[1])
                    score_label.setText(f"Score: {current_score + random.randint(1, 6)}")
                    # Animation de rotation
                    morphing_animation(btn, 300)
                return roll_die
            
            die_btn.clicked.connect(create_die_handler(die_btn))
            dice_buttons.append(die_btn)
            dice_layout.addWidget(die_btn)
        
        game_layout.addWidget(dice_area)
        lay.addWidget(game_area, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Instructions
        instructions_card = QtWidgets.QWidget(objectName="GlassCard")
        instructions_layout = QtWidgets.QVBoxLayout(instructions_card)
        instructions_layout.setContentsMargins(16, 16, 16, 16)
        
        instructions_title = QtWidgets.QLabel("üìã Instructions")
        instructions_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        instructions_layout.addWidget(instructions_title)
        
        instructions_text = QtWidgets.QLabel("""
        üé≤ Cliquez sur les d√©s pour les lancer
        üéØ Chaque d√© rapporte 1-6 points
        üèÜ Yahtzee: 5 d√©s identiques = 50 points bonus
        üé™ Poker de d√©s: 4 d√©s identiques = 30 points
        """)
        instructions_text.setStyleSheet("color: white; font-size: 12px; padding: 8px;")
        instructions_layout.addWidget(instructions_text)
        
        lay.addWidget(instructions_card)
        
        # Boutons d'action
        actions_layout = QtWidgets.QHBoxLayout()
        
        roll_all_btn = QtWidgets.QPushButton("üé≤ Lancer Tout")
        hold_btn = QtWidgets.QPushButton("‚úã Garder")
        reset_btn = QtWidgets.QPushButton("üîÑ Reset")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        roll_all_btn.clicked.connect(lambda: [modern_fade_in(dice_area, 800), neon_glow_animation(roll_all_btn, 1000)])
        hold_btn.clicked.connect(lambda: holographic_effect(hold_btn, 1000))
        reset_btn.clicked.connect(lambda: [score_label.setText("Score: 0"), morphing_animation(dice_area, 1000)])
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(roll_all_btn)
        actions_layout.addWidget(hold_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        modern_fade_in(d, 1200)
        liquid_flow_animation(game_area, 3000)
    
    def launch_card_games(self):
        """Lance les jeux de cartes avec interface compl√®te"""
        d = GlassDialog("üÉè Jeux de Cartes Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header avec animation moderne
        header = make_header("üÉè Jeux de Cartes Ragnar", "D√©tendez-vous avec les classiques")
        lay.addWidget(header)
        modern_fade_in(header, 1000)
        
        # Zone de jeu
        game_area = QtWidgets.QWidget(objectName="GlassCard")
        game_area.setFixedSize(500, 400)
        game_area.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(0, 50, 50, 0.6));
                border: 3px solid rgba(0, 255, 255, 0.5);
                border-radius: 15px;
            }
        """)
        
        game_layout = QtWidgets.QVBoxLayout(game_area)
        game_layout.setContentsMargins(20, 20, 20, 20)
        
        # Affichage du jeu et du score
        info_layout = QtWidgets.QHBoxLayout()
        
        game_label = QtWidgets.QLabel("Jeu: Solitaire")
        game_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #00ffff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        score_label = QtWidgets.QLabel("Score: 0")
        score_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #00aaff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        info_layout.addWidget(game_label)
        info_layout.addStretch()
        info_layout.addWidget(score_label)
        game_layout.addLayout(info_layout)
        
        # Zone de cartes
        cards_area = QtWidgets.QWidget()
        cards_area.setFixedHeight(250)
        cards_area.setStyleSheet("""
            QWidget {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
        """)
        
        cards_layout = QtWidgets.QGridLayout(cards_area)
        
        # Cr√©er des cartes cliquables
        card_buttons = []
        suits = ["‚ô†Ô∏è", "‚ô•Ô∏è", "‚ô¶Ô∏è", "‚ô£Ô∏è"]
        values = ["A", "2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K"]
        
        for i in range(12):
            suit = suits[i % 4]
            value = values[i % 13]
            card_btn = QtWidgets.QPushButton(f"{value}\n{suit}")
            card_btn.setStyleSheet("""
                QPushButton {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(0, 255, 255, 0.3),
                        stop:1 rgba(0, 255, 255, 0.1));
                    border: 2px solid rgba(0, 255, 255, 0.5);
                    border-radius: 15px;
                    color: white;
                    font-weight: bold;
                    font-size: 16px;
                    padding: 15px;
                }
                QPushButton:hover {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(0, 255, 255, 0.5),
                        stop:1 rgba(0, 255, 255, 0.3));
                    border: 2px solid rgba(0, 255, 255, 0.8);
                }
            """)
            card_btn.setFixedSize(80, 100)
            
            def create_card_handler(btn, points):
                def play_card():
                    holographic_effect(btn, 500)
                    current_score = int(score_label.text().split(': ')[1])
                    score_label.setText(f"Score: {current_score + points}")
                    # Animation de mouvement
                    morphing_animation(btn, 300)
                return play_card
            
            card_btn.clicked.connect(create_card_handler(card_btn, random.randint(1, 10)))
            card_buttons.append(card_btn)
            cards_layout.addWidget(card_btn, i // 4, i % 4)
        
        game_layout.addWidget(cards_area)
        lay.addWidget(game_area, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Instructions
        instructions_card = QtWidgets.QWidget(objectName="GlassCard")
        instructions_layout = QtWidgets.QVBoxLayout(instructions_card)
        instructions_layout.setContentsMargins(16, 16, 16, 16)
        
        instructions_title = QtWidgets.QLabel("üìã Instructions")
        instructions_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        instructions_layout.addWidget(instructions_title)
        
        instructions_text = QtWidgets.QLabel("""
        üÉè Cliquez sur les cartes pour les jouer
        üéØ Chaque carte rapporte 1-10 points
        üèÜ Solitaire: Organisez les cartes par couleur et valeur
        üé™ Freecell: D√©placez toutes les cartes vers les fondations
        """)
        instructions_text.setStyleSheet("color: white; font-size: 12px; padding: 8px;")
        instructions_layout.addWidget(instructions_text)
        
        lay.addWidget(instructions_card)
        
        # Boutons d'action
        actions_layout = QtWidgets.QHBoxLayout()
        
        deal_btn = QtWidgets.QPushButton("üÉè Distribuer")
        hint_btn = QtWidgets.QPushButton("üí° Indice")
        reset_btn = QtWidgets.QPushButton("üîÑ Reset")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        deal_btn.clicked.connect(lambda: [modern_fade_in(cards_area, 800), neon_glow_animation(deal_btn, 1000)])
        hint_btn.clicked.connect(lambda: holographic_effect(hint_btn, 1000))
        reset_btn.clicked.connect(lambda: [score_label.setText("Score: 0"), morphing_animation(cards_area, 1000)])
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(deal_btn)
        actions_layout.addWidget(hint_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        modern_fade_in(d, 1200)
        wave_animation(game_area, 4000)
    
    def launch_arcade_games(self):
        """Lance les jeux d'arcade avec interface compl√®te"""
        d = GlassDialog("üé™ Arcade Center Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header avec animation moderne
        header = make_header("üé™ Arcade Center Ragnar", "Revivez l'√¢ge d'or du gaming")
        lay.addWidget(header)
        modern_fade_in(header, 1000)
        
        # Zone de jeu
        game_area = QtWidgets.QWidget(objectName="GlassCard")
        game_area.setFixedSize(500, 400)
        game_area.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(100, 0, 0, 0.6));
                border: 3px solid rgba(255, 100, 0, 0.5);
                border-radius: 15px;
            }
        """)
        
        game_layout = QtWidgets.QVBoxLayout(game_area)
        game_layout.setContentsMargins(20, 20, 20, 20)
        
        # Affichage du jeu et du score
        info_layout = QtWidgets.QHBoxLayout()
        
        game_label = QtWidgets.QLabel("Jeu: Pac-Man")
        game_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #ff6400;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        score_label = QtWidgets.QLabel("Score: 0")
        score_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #00aaff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        info_layout.addWidget(game_label)
        info_layout.addStretch()
        info_layout.addWidget(score_label)
        game_layout.addLayout(info_layout)
        
        # Zone d'arcade
        arcade_area = QtWidgets.QWidget()
        arcade_area.setFixedHeight(250)
        arcade_area.setStyleSheet("""
            QWidget {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
        """)
        
        arcade_layout = QtWidgets.QGridLayout(arcade_area)
        
        # Cr√©er des √©l√©ments d'arcade cliquables
        arcade_elements = []
        elements = ["üëæ", "üçí", "üîµ", "‚≠ê", "üíé", "üéØ", "üöÄ", "üí£", "üéÆ"]
        
        for i in range(9):
            element_btn = QtWidgets.QPushButton(elements[i])
            element_btn.setStyleSheet("""
                QPushButton {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 100, 0, 0.3),
                        stop:1 rgba(255, 100, 0, 0.1));
                    border: 2px solid rgba(255, 100, 0, 0.5);
                    border-radius: 15px;
                    color: white;
                    font-weight: bold;
                    font-size: 24px;
                    padding: 20px;
                }
                QPushButton:hover {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 100, 0, 0.5),
                        stop:1 rgba(255, 100, 0, 0.3));
                    border: 2px solid rgba(255, 100, 0, 0.8);
                }
            """)
            element_btn.setFixedSize(80, 80)
            
            def create_element_handler(btn, points):
                def collect_element():
                    cyberpunk_glitch_effect(btn, 500)
                    current_score = int(score_label.text().split(': ')[1])
                    score_label.setText(f"Score: {current_score + points}")
                    # Animation de collection
                    morphing_animation(btn, 300)
                return collect_element
            
            element_btn.clicked.connect(create_element_handler(element_btn, random.randint(5, 25)))
            arcade_elements.append(element_btn)
            arcade_layout.addWidget(element_btn, i // 3, i % 3)
        
        game_layout.addWidget(arcade_area)
        lay.addWidget(game_area, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Instructions
        instructions_card = QtWidgets.QWidget(objectName="GlassCard")
        instructions_layout = QtWidgets.QVBoxLayout(instructions_card)
        instructions_layout.setContentsMargins(16, 16, 16, 16)
        
        instructions_title = QtWidgets.QLabel("üìã Instructions")
        instructions_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        instructions_layout.addWidget(instructions_title)
        
        instructions_text = QtWidgets.QLabel("""
        üé™ Cliquez sur les √©l√©ments pour les collecter
        üéØ Chaque √©l√©ment rapporte 5-25 points
        üèÜ Pac-Man: Mangez les points et √©vitez les fant√¥mes
        üéÆ Space Invaders: D√©truisez les envahisseurs
        """)
        instructions_text.setStyleSheet("color: white; font-size: 12px; padding: 8px;")
        instructions_layout.addWidget(instructions_text)
        
        lay.addWidget(instructions_card)
        
        # Boutons d'action
        actions_layout = QtWidgets.QHBoxLayout()
        
        start_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è D√©marrer")
        power_btn = QtWidgets.QPushButton("‚ö° Power-Up")
        reset_btn = QtWidgets.QPushButton("üîÑ Reset")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        start_btn.clicked.connect(lambda: [modern_fade_in(game_area, 800), neon_glow_animation(start_btn, 1000)])
        power_btn.clicked.connect(lambda: holographic_effect(power_btn, 1000))
        reset_btn.clicked.connect(lambda: [score_label.setText("Score: 0"), morphing_animation(arcade_area, 1000)])
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(start_btn)
        actions_layout.addWidget(power_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        modern_fade_in(d, 1200)
        quantum_entanglement_effect(game_area, 3000)
    
    def show_tournaments(self):
        """Affiche les tournois disponibles"""
        QtWidgets.QMessageBox.information(self, "üèÜ Tournois", "Tournois Ragnar OS !\n\nü•á Tournoi Snake : 15-30 Nov\nüéØ D√©fi Pr√©cision : En cours\nüß© Marathon Puzzle : Bient√¥t\n\nInscrivez-vous et gagnez des prix !")
    
    def show_leaderboards(self):
        """Affiche les classements"""
        QtWidgets.QMessageBox.information(self, "ü•á Classements", "Top Joueurs Ragnar !\n\n1. üèÜ RagnarMaster - 50,240 pts\n2. ü•à PixelHero - 48,120 pts\n3. ü•â GameWizard - 45,890 pts\n4. üéÆ ProGamer - 43,560 pts\n5. ‚≠ê Vous - 15,420 pts\n\nContinuez √† jouer pour grimper !")
    
    def show_game_settings(self):
        """Affiche les param√®tres de jeu"""
        QtWidgets.QMessageBox.information(self, "‚öôÔ∏è Options Jeu", "Param√®tres de Jeu !\n\nüîä Son : Activ√©\nüéµ Musique : Activ√©e\nüéÆ Difficult√© : Normale\n‚è±Ô∏è Minuteur : Activ√©\nüèÜ Notifications : Activ√©es\n\nPersonnalisez votre exp√©rience !")
    
    def show_email_client(self):
        """Client email moderne"""
        d = GlassDialog("üìß Ragnar Mail", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Ragnar Mail", "Client email s√©curis√©")
        lay.addWidget(header)
        
        # Interface email
        email_tabs = QtWidgets.QTabWidget()
        
        # Onglet Bo√Æte de r√©ception
        inbox_tab = QtWidgets.QWidget()
        inbox_layout = QtWidgets.QVBoxLayout(inbox_tab)
        
        # Liste des emails
        email_list = QtWidgets.QListWidget()
        emails = [
            "üìß Ragnar Team - Bienvenue dans Ragnar OS 26.3.0 !",
            "üõ°Ô∏è S√©curit√© - Rapport de s√©curit√© hebdomadaire",
            "üéÆ Games Center - Nouveau tournoi disponible !",
            "üì∞ Newsletter - Les nouveaut√©s de cette semaine",
            "üîî Notifications - 5 nouvelles mises √† jour",
        ]
        
        for email in emails:
            email_list.addItem(email)
        
        inbox_layout.addWidget(email_list)
        email_tabs.addTab(inbox_tab, "üì• R√©ception")
        
        # Onglet Composer
        compose_tab = QtWidgets.QWidget()
        compose_layout = QtWidgets.QVBoxLayout(compose_tab)
        
        # Champs de composition
        to_field = QtWidgets.QLineEdit()
        to_field.setPlaceholderText("Destinataire...")
        subject_field = QtWidgets.QLineEdit()
        subject_field.setPlaceholderText("Objet...")
        message_field = QtWidgets.QTextEdit()
        message_field.setPlaceholderText("Votre message...")
        
        compose_layout.addWidget(QtWidgets.QLabel("√Ä :"))
        compose_layout.addWidget(to_field)
        compose_layout.addWidget(QtWidgets.QLabel("Objet :"))
        compose_layout.addWidget(subject_field)
        compose_layout.addWidget(QtWidgets.QLabel("Message :"))
        compose_layout.addWidget(message_field)
        
        send_btn = QtWidgets.QPushButton("üì§ Envoyer")
        send_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚úÖ Envoy√©", "Email envoy√© avec succ√®s !"))
        compose_layout.addWidget(send_btn)
        
        email_tabs.addTab(compose_tab, "‚úçÔ∏è Composer")
        
        lay.addWidget(email_tabs)
        
        # Actions
        actions_layout = QtWidgets.QHBoxLayout()
        refresh_btn = QtWidgets.QPushButton("üîÑ Actualiser")
        settings_btn = QtWidgets.QPushButton("‚öôÔ∏è Param√®tres")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        refresh_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîÑ", "Emails actualis√©s !"))
        settings_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚öôÔ∏è", "Configuration email disponible !"))
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(refresh_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    # M√©thodes pour les nouvelles applications du menu
    def launch_rapp_from_desktop(self):
        """Scanne le Bureau pour les .rapp et en lance un au choix."""
        home = Path.home()
        desktop_candidates = [home / "Desktop", home / "Bureau"]
        desktop_dir = None
        for cand in desktop_candidates:
            if cand.exists():
                desktop_dir = cand
                break
        if desktop_dir is None:
            QtWidgets.QMessageBox.warning(self, "Bureau introuvable", "Aucun dossier Bureau n'a √©t√© trouv√©.")
            return
        try:
            rapps = sorted(desktop_dir.glob("*.rapp"))
        except Exception as e:
            QtWidgets.QMessageBox.critical(self, "Erreur", f"Impossible de lister le Bureau:\n{e}")
            return
        if not rapps:
            QtWidgets.QMessageBox.information(self, "Aucun .rapp", "Aucun fichier .rapp n'a √©t√© trouv√© sur le Bureau.")
            return
        items = [p.name for p in rapps]
        item, ok = QtWidgets.QInputDialog.getItem(self, "Lancer .rapp", "Choisir une application :", items, 0, False)
        if not ok or not item:
            return
        target = desktop_dir / item
        try:
            safe_open(target)
        except Exception as e:
            QtWidgets.QMessageBox.critical(self, "Erreur", f"Impossible de lancer {item}:\n{e}")

    def show_text_editor(self):
        """√âditeur de texte professionnel"""
        d = GlassDialog("üìÑ √âditeur de Texte Ragnar", (1000, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(10)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("√âditeur de Texte Ragnar", "√âdition de code et texte avanc√©e")
        lay.addWidget(header)
        
        # Barre d'outils
        toolbar = QtWidgets.QHBoxLayout()
        
        new_btn = QtWidgets.QPushButton("üìÑ Nouveau")
        open_btn = QtWidgets.QPushButton("üìÅ Ouvrir")
        save_btn = QtWidgets.QPushButton("üíæ Sauvegarder")
        save_as_btn = QtWidgets.QPushButton("üíæ Sauvegarder sous...")
        
        # S√©parateur
        sep1 = QtWidgets.QLabel("|")
        sep1.setStyleSheet("color: #666; font-weight: bold;")
        
        undo_btn = QtWidgets.QPushButton("‚Ü∂ Annuler")
        redo_btn = QtWidgets.QPushButton("‚Ü∑ Refaire")
        
        # S√©parateur
        sep2 = QtWidgets.QLabel("|")
        sep2.setStyleSheet("color: #666; font-weight: bold;")
        
        find_btn = QtWidgets.QPushButton("üîç Rechercher")
        replace_btn = QtWidgets.QPushButton("üîÑ Remplacer")
        
        toolbar.addWidget(new_btn)
        toolbar.addWidget(open_btn)
        toolbar.addWidget(save_btn)
        toolbar.addWidget(save_as_btn)
        toolbar.addWidget(sep1)
        toolbar.addWidget(undo_btn)
        toolbar.addWidget(redo_btn)
        toolbar.addWidget(sep2)
        toolbar.addWidget(find_btn)
        toolbar.addWidget(replace_btn)
        toolbar.addStretch()
        
        lay.addLayout(toolbar)
        
        # Zone d'√©dition
        editor_area = QtWidgets.QWidget(objectName="GlassCard")
        editor_layout = QtWidgets.QVBoxLayout(editor_area)
        editor_layout.setContentsMargins(10, 10, 10, 10)
        
        # √âditeur de texte
        text_editor = QtWidgets.QTextEdit()
        text_editor.setStyleSheet("""
            QTextEdit {
                background: rgba(20, 20, 20, 0.9);
                border: 2px solid rgba(0, 255, 136, 0.3);
                border-radius: 8px;
                color: #ffffff;
                font-family: 'Consolas', 'Monaco', monospace;
                font-size: 14px;
                line-height: 1.4;
                padding: 10px;
            }
        """)
        
        # Texte d'exemple avec coloration syntaxique simul√©e
        sample_code = """# √âditeur de Texte Ragnar - Exemple Python
import os
import sys

def hello_ragnar():
    \"\"\"Fonction d'exemple\"\"\"
    print("Bienvenue dans Ragnar OS 26.3.0!")
    
    # Variables
    version = "26.3.0"
    features = ["Multim√©dia", "Bureautique", "Jeux", "Syst√®me"]
    
    for feature in features:
        print(f"‚úÖ {feature} - Disponible")
    
    return True

if __name__ == "__main__":
    hello_ragnar()
    print("üöÄ Ragnar OS - Pr√™t pour l'action!")
"""
        text_editor.setPlainText(sample_code)
        editor_layout.addWidget(text_editor)
        
        lay.addWidget(editor_area)
        
        # Barre de statut
        status_bar = QtWidgets.QHBoxLayout()
        
        line_col_label = QtWidgets.QLabel("Ligne: 1, Colonne: 1")
        line_col_label.setStyleSheet("color: #00ff88; font-size: 12px;")
        
        encoding_label = QtWidgets.QLabel("UTF-8")
        encoding_label.setStyleSheet("color: #00aaff; font-size: 12px;")
        
        file_type_label = QtWidgets.QLabel("Python")
        file_type_label.setStyleSheet("color: #ffaa00; font-size: 12px;")
        
        status_bar.addWidget(line_col_label)
        status_bar.addStretch()
        status_bar.addWidget(encoding_label)
        status_bar.addWidget(QtWidgets.QLabel("|"))
        status_bar.addWidget(file_type_label)
        
        lay.addLayout(status_bar)
        
        # Actions des boutons
        new_btn.clicked.connect(lambda: text_editor.clear())
        save_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üíæ", "Fichier sauvegard√© !\n\nüìÅ Emplacement : document.txt\n‚è∞ " + str(QtCore.QDateTime.currentDateTime().toString())))
        
        find_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîç", "Recherche avanc√©e !\n\nüîç Options :\n‚Ä¢ Recherche simple\n‚Ä¢ Expressions r√©guli√®res\n‚Ä¢ Respecter la casse\n‚Ä¢ Mot entier\n‚Ä¢ Recherche dans fichiers"))
        
        replace_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîÑ", "Remplacer !\n\nüîÑ Fonctionnalit√©s :\n‚Ä¢ Remplacer tout\n‚Ä¢ Remplacer s√©lection\n‚Ä¢ Aper√ßu des changements\n‚Ä¢ Historique des remplacements"))
        
        # Actions
        actions_layout = QtWidgets.QHBoxLayout()
        
        syntax_btn = QtWidgets.QPushButton("üé® Coloration")
        themes_btn = QtWidgets.QPushButton("üåô Th√®mes")
        settings_btn = QtWidgets.QPushButton("‚öôÔ∏è Param√®tres")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        syntax_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üé®", "Coloration syntaxique !\n\nüé® Langages support√©s :\n‚Ä¢ Python ‚Ä¢ JavaScript ‚Ä¢ HTML\n‚Ä¢ CSS ‚Ä¢ JSON ‚Ä¢ XML\n‚Ä¢ C++ ‚Ä¢ Java ‚Ä¢ PHP\n‚Ä¢ Markdown ‚Ä¢ SQL"))
        
        themes_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üåô", "Th√®mes disponibles !\n\nüåô Th√®mes :\n‚Ä¢ Dark Mode (actuel)\n‚Ä¢ Light Mode\n‚Ä¢ Monokai\n‚Ä¢ Solarized\n‚Ä¢ VS Code Dark\n‚Ä¢ Ragnar Theme"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(syntax_btn)
        actions_layout.addWidget(themes_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_spreadsheet(self):
        """Tableur professionnel"""
        d = GlassDialog("üìä Tableur Ragnar", (1100, 750), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(10)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Tableur Ragnar", "Calculs et analyses de donn√©es avanc√©es")
        lay.addWidget(header)
        
        # Barre d'outils
        toolbar = QtWidgets.QHBoxLayout()
        
        new_btn = QtWidgets.QPushButton("üìÑ Nouveau")
        open_btn = QtWidgets.QPushButton("üìÅ Ouvrir")
        save_btn = QtWidgets.QPushButton("üíæ Sauvegarder")
        
        # S√©parateur
        sep1 = QtWidgets.QLabel("|")
        sep1.setStyleSheet("color: #666; font-weight: bold;")
        
        formula_btn = QtWidgets.QPushButton("∆í Formules")
        chart_btn = QtWidgets.QPushButton("üìà Graphiques")
        filter_btn = QtWidgets.QPushButton("üîç Filtres")
        
        toolbar.addWidget(new_btn)
        toolbar.addWidget(open_btn)
        toolbar.addWidget(save_btn)
        toolbar.addWidget(sep1)
        toolbar.addWidget(formula_btn)
        toolbar.addWidget(chart_btn)
        toolbar.addWidget(filter_btn)
        toolbar.addStretch()
        
        lay.addLayout(toolbar)
        
        # Zone de la feuille de calcul
        spreadsheet_area = QtWidgets.QWidget(objectName="GlassCard")
        spreadsheet_layout = QtWidgets.QVBoxLayout(spreadsheet_area)
        spreadsheet_layout.setContentsMargins(10, 10, 10, 10)
        
        # Barre de formule
        formula_bar = QtWidgets.QHBoxLayout()
        formula_label = QtWidgets.QLabel("∆í")
        formula_label.setStyleSheet("color: #00ff88; font-weight: bold; font-size: 16px;")
        formula_input = QtWidgets.QLineEdit("=SOMME(A1:A10)")
        formula_input.setStyleSheet("""
            QLineEdit {
                background: rgba(40, 40, 40, 0.8);
                border: 1px solid rgba(0, 255, 136, 0.5);
                border-radius: 4px;
                color: white;
                padding: 5px;
                font-family: monospace;
            }
        """)
        
        formula_bar.addWidget(formula_label)
        formula_bar.addWidget(formula_input)
        spreadsheet_layout.addLayout(formula_bar)
        
        # Table de donn√©es
        table = QtWidgets.QTableWidget(15, 8)
        table.setHorizontalHeaderLabels(['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'])
        table.setStyleSheet("""
            QTableWidget {
                background: rgba(30, 30, 30, 0.9);
                border: 1px solid rgba(0, 255, 136, 0.3);
                gridline-color: rgba(0, 255, 136, 0.2);
                color: white;
            }
            QHeaderView::section {
                background: rgba(0, 255, 136, 0.2);
                color: white;
                font-weight: bold;
                border: 1px solid rgba(0, 255, 136, 0.3);
                padding: 5px;
            }
        """)
        
        # Donn√©es d'exemple
        sample_data = [
            ["Produit", "Janvier", "F√©vrier", "Mars", "Total", "Moyenne", "", ""],
            ["Ordinateurs", "1500", "1800", "2100", "=B2+C2+D2", "=E2/3", "", ""],
            ["T√©l√©phones", "2300", "2100", "2500", "=B3+C3+D3", "=E3/3", "", ""],
            ["Tablettes", "800", "950", "1200", "=B4+C4+D4", "=E4/3", "", ""],
            ["Accessoires", "450", "520", "680", "=B5+C5+D5", "=E5/3", "", ""],
            ["", "", "", "", "", "", "", ""],
            ["TOTAL", "=SOMME(B2:B5)", "=SOMME(C2:C5)", "=SOMME(D2:D5)", "=SOMME(E2:E5)", "=MOYENNE(F2:F5)", "", ""],
            ["", "", "", "", "", "", "", ""],
            ["Analyse", "", "", "", "", "", "", ""],
            ["Croissance", "=C7/B7-1", "=D7/C7-1", "", "", "", "", ""],
            ["Meilleur mois", "=MAX(B7:D7)", "", "", "", "", "", ""]
        ]
        
        for row, row_data in enumerate(sample_data):
            for col, cell_data in enumerate(row_data):
                if cell_data:
                    item = QtWidgets.QTableWidgetItem(str(cell_data))
                    if cell_data.startswith("="):
                        item.setBackground(QtGui.QColor(0, 100, 200, 50))
                    elif row == 0:
                        item.setBackground(QtGui.QColor(0, 255, 136, 50))
                        item.setForeground(QtGui.QColor(255, 255, 255))
                    table.setItem(row, col, item)
        
        spreadsheet_layout.addWidget(table)
        lay.addWidget(spreadsheet_area)
        
        # Actions des boutons
        formula_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "∆í", "Formules disponibles !\n\n∆í Math√©matiques :\n‚Ä¢ SOMME, MOYENNE, MAX, MIN\n‚Ä¢ ABS, RACINE, PUISSANCE\n\n∆í Logiques :\n‚Ä¢ SI, ET, OU, NON\n\n∆í Texte :\n‚Ä¢ CONCATENER, GAUCHE, DROITE\n\n∆í Date :\n‚Ä¢ AUJOURD'HUI, MAINTENANT"))
        
        chart_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìà", "Graphiques disponibles !\n\nüìà Types :\n‚Ä¢ Histogrammes\n‚Ä¢ Courbes\n‚Ä¢ Secteurs (Camembert)\n‚Ä¢ Aires\n‚Ä¢ Nuages de points\n‚Ä¢ Barres horizontales\n\nüé® Personnalisation compl√®te"))
        
        filter_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîç", "Filtres et tri !\n\nüîç Filtres :\n‚Ä¢ Filtres automatiques\n‚Ä¢ Filtres personnalis√©s\n‚Ä¢ Filtres avanc√©s\n\nüìä Tri :\n‚Ä¢ Croissant/D√©croissant\n‚Ä¢ Tri multicrit√®res\n‚Ä¢ Tri personnalis√©"))
        
        # Actions principales
        actions_layout = QtWidgets.QHBoxLayout()
        
        export_btn = QtWidgets.QPushButton("üì§ Exporter")
        print_btn = QtWidgets.QPushButton("üñ®Ô∏è Imprimer")
        settings_btn = QtWidgets.QPushButton("‚öôÔ∏è Param√®tres")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üì§", "Export disponible !\n\nüì§ Formats :\n‚Ä¢ Excel (.xlsx)\n‚Ä¢ CSV (.csv)\n‚Ä¢ PDF (.pdf)\n‚Ä¢ OpenDocument (.ods)\n‚Ä¢ HTML (.html)\n\n‚öôÔ∏è Options d'export configurables"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(export_btn)
        actions_layout.addWidget(print_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_calendar(self):
        """Calendrier professionnel"""
        d = GlassDialog("üìÖ Calendrier Ragnar", (1000, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Calendrier Ragnar", "Gestion d'√©v√©nements et planification")
        lay.addWidget(header)
        
        # Barre d'outils
        toolbar = QtWidgets.QHBoxLayout()
        
        today_btn = QtWidgets.QPushButton("üìÖ Aujourd'hui")
        prev_btn = QtWidgets.QPushButton("‚óÄ Pr√©c√©dent")
        next_btn = QtWidgets.QPushButton("Suivant ‚ñ∂")
        
        # S√©lecteur de vue
        view_combo = QtWidgets.QComboBox()
        view_combo.addItems(["Mois", "Semaine", "Jour", "Agenda"])
        view_combo.setStyleSheet("""
            QComboBox {
                background: rgba(40, 40, 40, 0.8);
                border: 1px solid rgba(0, 255, 136, 0.5);
                border-radius: 4px;
                color: white;
                padding: 5px;
                min-width: 80px;
            }
        """)
        
        add_event_btn = QtWidgets.QPushButton("‚ûï Nouvel √âv√©nement")
        
        toolbar.addWidget(today_btn)
        toolbar.addWidget(prev_btn)
        toolbar.addWidget(next_btn)
        toolbar.addStretch()
        toolbar.addWidget(QtWidgets.QLabel("Vue:"))
        toolbar.addWidget(view_combo)
        toolbar.addWidget(add_event_btn)
        
        lay.addLayout(toolbar)
        
        # Zone principale du calendrier
        calendar_area = QtWidgets.QWidget(objectName="GlassCard")
        calendar_layout = QtWidgets.QVBoxLayout(calendar_area)
        calendar_layout.setContentsMargins(16, 16, 16, 16)
        
        # Titre du mois
        month_title = QtWidgets.QLabel("Octobre 2024")
        month_title.setStyleSheet("font-size: 20px; font-weight: bold; color: #00ff88; text-align: center; padding: 10px;")
        month_title.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        calendar_layout.addWidget(month_title)
        
        # Grille du calendrier
        calendar_grid = QtWidgets.QGridLayout()
        
        # En-t√™tes des jours
        days_headers = ["Lun", "Mar", "Mer", "Jeu", "Ven", "Sam", "Dim"]
        for col, day in enumerate(days_headers):
            header_label = QtWidgets.QLabel(day)
            header_label.setStyleSheet("""
                QLabel {
                    background: rgba(0, 255, 136, 0.2);
                    color: white;
                    font-weight: bold;
                    padding: 8px;
                    border: 1px solid rgba(0, 255, 136, 0.3);
                }
            """)
            header_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            calendar_grid.addWidget(header_label, 0, col)
        
        # Jours du mois (exemple pour octobre 2024)
        import datetime
        current_date = datetime.date.today()
        
        # Simulation d'un calendrier
        calendar_days = [
            [30, 1, 2, 3, 4, 5, 6],
            [7, 8, 9, 10, 11, 12, 13],
            [14, 15, 16, 17, 18, 19, 20],
            [21, 22, 23, 24, 25, 26, 27],
            [28, 29, 30, 31, 1, 2, 3]
        ]
        
        # √âv√©nements d'exemple
        events = {
            4: "üéâ Anniversaire",
            10: "üíº R√©union",
            15: "üè• M√©decin",
            22: "üé¨ Cin√©ma",
            25: "üçΩÔ∏è D√Æner"
        }
        
        for row, week in enumerate(calendar_days):
            for col, day in enumerate(week):
                day_widget = QtWidgets.QWidget()
                day_layout = QtWidgets.QVBoxLayout(day_widget)
                day_layout.setContentsMargins(2, 2, 2, 2)
                day_layout.setSpacing(2)
                
                # Num√©ro du jour
                day_label = QtWidgets.QLabel(str(day))
                day_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
                
                # Style selon le type de jour
                if row == 0 and day > 20:  # Mois pr√©c√©dent
                    day_label.setStyleSheet("color: #666; font-size: 12px;")
                elif row == 4 and day < 10:  # Mois suivant
                    day_label.setStyleSheet("color: #666; font-size: 12px;")
                elif day == current_date.day:  # Aujourd'hui
                    day_label.setStyleSheet("""
                        QLabel {
                            background: rgba(0, 255, 136, 0.3);
                            color: white;
                            font-weight: bold;
                            font-size: 14px;
                            border-radius: 10px;
                            padding: 2px;
                        }
                    """)
                else:  # Jour normal
                    day_label.setStyleSheet("color: white; font-size: 12px;")
                
                day_layout.addWidget(day_label)
                
                # √âv√©nement s'il y en a un
                if day in events:
                    event_label = QtWidgets.QLabel(events[day])
                    event_label.setStyleSheet("""
                        QLabel {
                            background: rgba(255, 170, 0, 0.3);
                            color: white;
                            font-size: 8px;
                            padding: 1px;
                            border-radius: 2px;
                        }
                    """)
                    event_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
                    day_layout.addWidget(event_label)
                
                day_widget.setStyleSheet("""
                    QWidget {
                        border: 1px solid rgba(0, 255, 136, 0.2);
                        background: rgba(40, 40, 40, 0.3);
                    }
                    QWidget:hover {
                        background: rgba(0, 255, 136, 0.1);
                    }
                """)
                day_widget.setFixedSize(120, 80)
                
                calendar_grid.addWidget(day_widget, row + 1, col)
        
        calendar_layout.addLayout(calendar_grid)
        lay.addWidget(calendar_area)
        
        # Panneau d'√©v√©nements
        events_panel = QtWidgets.QWidget(objectName="GlassCard")
        events_layout = QtWidgets.QVBoxLayout(events_panel)
        events_layout.setContentsMargins(16, 16, 16, 16)
        
        events_title = QtWidgets.QLabel("üìã √âv√©nements √† venir")
        events_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        events_layout.addWidget(events_title)
        
        upcoming_events = [
            "üéâ 04/10 - Anniversaire de Marie",
            "üíº 10/10 - R√©union √©quipe (14h00)",
            "üè• 15/10 - Rendez-vous m√©decin (10h30)",
            "üé¨ 22/10 - Cin√©ma avec amis (20h00)",
            "üçΩÔ∏è 25/10 - D√Æner restaurant (19h30)"
        ]
        
        for event in upcoming_events:
            event_label = QtWidgets.QLabel(event)
            event_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 170, 255, 0.5);")
            events_layout.addWidget(event_label)
        
        lay.addWidget(events_panel)
        
        # Actions des boutons
        add_event_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ûï", "Nouvel √âv√©nement !\n\nüìù Informations :\n‚Ä¢ Titre de l'√©v√©nement\n‚Ä¢ Date et heure\n‚Ä¢ Lieu\n‚Ä¢ Description\n‚Ä¢ Rappels\n‚Ä¢ Invit√©s\n\n‚úÖ √âv√©nement cr√©√© !"))
        
        today_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìÖ", f"Aujourd'hui : {current_date.strftime('%d/%m/%Y')}\n\nüìã √âv√©nements du jour :\n‚Ä¢ Aucun √©v√©nement pr√©vu\n\n‚è∞ Il est actuellement 22h15"))
        
        # Actions principales
        actions_layout = QtWidgets.QHBoxLayout()
        
        sync_btn = QtWidgets.QPushButton("üîÑ Synchroniser")
        export_btn = QtWidgets.QPushButton("üì§ Exporter")
        settings_btn = QtWidgets.QPushButton("‚öôÔ∏è Param√®tres")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        sync_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîÑ", "Synchronisation !\n\nüîÑ Comptes connect√©s :\n‚Ä¢ Google Calendar ‚úÖ\n‚Ä¢ Outlook ‚úÖ\n‚Ä¢ iCloud ‚úÖ\n\nüìä Derni√®re sync : Il y a 5 min\n‚úÖ Tous les calendriers √† jour"))
        
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üì§", "Export calendrier !\n\nüì§ Formats disponibles :\n‚Ä¢ iCalendar (.ics)\n‚Ä¢ PDF (.pdf)\n‚Ä¢ Excel (.xlsx)\n‚Ä¢ CSV (.csv)\n\nüìÖ P√©riode : Mois actuel"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(sync_btn)
        actions_layout.addWidget(export_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_pdf_reader(self):
        """Lecteur PDF professionnel"""
        d = GlassDialog("üìÑ Lecteur PDF Ragnar", (900, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Lecteur PDF Ragnar", "Lecture et annotation de documents PDF")
        lay.addWidget(header)
        
        # Barre d'outils
        toolbar_card = QtWidgets.QWidget(objectName="GlassCard")
        toolbar_layout = QtWidgets.QHBoxLayout(toolbar_card)
        toolbar_layout.setContentsMargins(16, 8, 16, 8)
        
        open_pdf_btn = QtWidgets.QPushButton("üìÅ Ouvrir")
        save_btn = QtWidgets.QPushButton("üíæ Sauvegarder")
        print_btn = QtWidgets.QPushButton("üñ®Ô∏è Imprimer")
        
        # Zoom
        zoom_out_btn = QtWidgets.QPushButton("üîç‚ûñ")
        zoom_label = QtWidgets.QLabel("100%")
        zoom_label.setStyleSheet("color: #00ff88; font-weight: bold; min-width: 50px;")
        zoom_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        zoom_in_btn = QtWidgets.QPushButton("üîç‚ûï")
        
        # Navigation
        prev_page_btn = QtWidgets.QPushButton("‚¨ÖÔ∏è")
        page_label = QtWidgets.QLabel("Page 1 / 25")
        page_label.setStyleSheet("color: #00aaff; font-weight: bold; min-width: 80px;")
        page_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        next_page_btn = QtWidgets.QPushButton("‚û°Ô∏è")
        
        toolbar_layout.addWidget(open_pdf_btn)
        toolbar_layout.addWidget(save_btn)
        toolbar_layout.addWidget(print_btn)
        toolbar_layout.addStretch()
        toolbar_layout.addWidget(zoom_out_btn)
        toolbar_layout.addWidget(zoom_label)
        toolbar_layout.addWidget(zoom_in_btn)
        toolbar_layout.addStretch()
        toolbar_layout.addWidget(prev_page_btn)
        toolbar_layout.addWidget(page_label)
        toolbar_layout.addWidget(next_page_btn)
        
        lay.addWidget(toolbar_card)
        
        # Zone de lecture PDF
        pdf_area = QtWidgets.QWidget(objectName="GlassCard")
        pdf_area.setFixedHeight(400)
        pdf_layout = QtWidgets.QVBoxLayout(pdf_area)
        pdf_layout.setContentsMargins(16, 16, 16, 16)
        
        # Document PDF simul√©
        pdf_viewer = QtWidgets.QLabel("üìÑ Document PDF - Page 1")
        pdf_viewer.setStyleSheet("""
            QLabel {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.95),
                    stop:1 rgba(240, 240, 240, 0.95));
                border: 2px solid rgba(0, 170, 255, 0.3);
                border-radius: 10px;
                color: #333333;
                font-size: 16px;
                font-weight: bold;
                padding: 20px;
            }
        """)
        pdf_viewer.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        pdf_viewer.setMinimumHeight(350)
        pdf_viewer.setWordWrap(True)
        pdf_viewer.setText("""üìÑ DOCUMENT PDF EXEMPLE

Titre du Document : Guide Ragnar OS 26.3.0

Chapitre 1 : Introduction
Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.

‚Ä¢ Fonctionnalit√© 1 : Interface moderne
‚Ä¢ Fonctionnalit√© 2 : Applications int√©gr√©es  
‚Ä¢ Fonctionnalit√© 3 : S√©curit√© avanc√©e

Ut enim ad minim veniam, quis nostrud exercitation 
ullamco laboris nisi ut aliquip ex ea commodo consequat.

[Page 1 sur 25]""")
        
        pdf_layout.addWidget(pdf_viewer)
        lay.addWidget(pdf_area)
        
        # Panneau d'outils d'annotation
        annotation_card = QtWidgets.QWidget(objectName="GlassCard")
        annotation_layout = QtWidgets.QVBoxLayout(annotation_card)
        annotation_layout.setContentsMargins(16, 16, 16, 16)
        
        annotation_title = QtWidgets.QLabel("‚úèÔ∏è Outils d'Annotation")
        annotation_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        annotation_layout.addWidget(annotation_title)
        
        # Outils d'annotation
        annotation_tools = QtWidgets.QHBoxLayout()
        
        highlight_btn = QtWidgets.QPushButton("üñçÔ∏è Surligner")
        note_btn = QtWidgets.QPushButton("üìù Note")
        draw_btn = QtWidgets.QPushButton("‚úèÔ∏è Dessiner")
        text_btn = QtWidgets.QPushButton("üìÑ Texte")
        bookmark_btn = QtWidgets.QPushButton("üîñ Signet")
        
        annotation_tools.addWidget(highlight_btn)
        annotation_tools.addWidget(note_btn)
        annotation_tools.addWidget(draw_btn)
        annotation_tools.addWidget(text_btn)
        annotation_tools.addWidget(bookmark_btn)
        annotation_tools.addStretch()
        
        annotation_layout.addLayout(annotation_tools)
        lay.addWidget(annotation_card)
        
        # Actions principales
        actions_layout = QtWidgets.QHBoxLayout()
        
        search_btn = QtWidgets.QPushButton("üîç Rechercher")
        bookmarks_btn = QtWidgets.QPushButton("üìë Signets")
        fullscreen_btn = QtWidgets.QPushButton("üî≥ Plein √©cran")
        export_btn = QtWidgets.QPushButton("üì§ Exporter")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        # Connecter les boutons
        open_pdf_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìÅ", "Ouvrir un PDF !\n\nüìÅ S√©lectionnez votre fichier PDF\nüìÑ Formats support√©s :\n‚Ä¢ PDF standard\n‚Ä¢ PDF/A (archivage)\n‚Ä¢ PDF prot√©g√©s\n‚Ä¢ Taille max : 500 MB"))
        
        zoom_in_btn.clicked.connect(lambda: self.pdf_zoom("in", zoom_label, pdf_viewer))
        zoom_out_btn.clicked.connect(lambda: self.pdf_zoom("out", zoom_label, pdf_viewer))
        
        next_page_btn.clicked.connect(lambda: self.pdf_navigate("next", page_label, pdf_viewer))
        prev_page_btn.clicked.connect(lambda: self.pdf_navigate("prev", page_label, pdf_viewer))
        
        highlight_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üñçÔ∏è", "Mode Surlignage !\n\nüñçÔ∏è S√©lectionnez le texte √† surligner\nüé® Couleurs disponibles :\n‚Ä¢ Jaune ‚Ä¢ Vert ‚Ä¢ Bleu ‚Ä¢ Rose\n‚Ä¢ Orange ‚Ä¢ Violet\n\nüíæ Sauvegarde automatique"))
        
        note_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìù", "Ajouter une Note !\n\nüìù Cliquez o√π vous voulez ajouter une note\nüí≠ Types de notes :\n‚Ä¢ Note textuelle\n‚Ä¢ Note vocale\n‚Ä¢ Dessin libre\n\nüîó Liens vers d'autres pages"))
        
        search_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîç", "Recherche dans le PDF !\n\nüîç Rechercher : [        ]\n\nüìä Options :\n‚Ä¢ Mot entier uniquement\n‚Ä¢ Respecter la casse\n‚Ä¢ Expressions r√©guli√®res\n\nüìÑ R√©sultats : 0 trouv√©(s)"))
        
        bookmarks_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìë", "Signets du Document !\n\nüìë Signets existants :\n‚Ä¢ Introduction (Page 1)\n‚Ä¢ Chapitre 1 (Page 3)\n‚Ä¢ Fonctionnalit√©s (Page 8)\n‚Ä¢ Configuration (Page 15)\n‚Ä¢ Annexes (Page 22)\n\n‚ûï Ajouter un signet"))
        
        fullscreen_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üî≥", "Mode Plein √âcran !\n\nüî≥ Document en plein √©cran\n‚å®Ô∏è √âchap pour quitter\nüñ±Ô∏è Clic droit pour menu\nüìÑ Navigation avec fl√®ches"))
        
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üì§", "Exporter le Document !\n\nüì§ Formats d'export :\n‚Ä¢ Images (PNG, JPG)\n‚Ä¢ Texte (TXT)\n‚Ä¢ Word (DOCX)\n‚Ä¢ PowerPoint (PPTX)\n\n‚öôÔ∏è Options d'export disponibles"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(search_btn)
        actions_layout.addWidget(bookmarks_btn)
        actions_layout.addWidget(fullscreen_btn)
        actions_layout.addWidget(export_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def pdf_zoom(self, direction, zoom_label, pdf_viewer):
        """G√®re le zoom du PDF"""
        current_zoom = int(zoom_label.text().replace("%", ""))
        if direction == "in" and current_zoom < 300:
            new_zoom = current_zoom + 25
        elif direction == "out" and current_zoom > 50:
            new_zoom = current_zoom - 25
        else:
            return
        
        zoom_label.setText(f"{new_zoom}%")
        if new_zoom > 100:
            pdf_viewer.setStyleSheet(pdf_viewer.styleSheet().replace("font-size: 16px", f"font-size: {16 + (new_zoom-100)//10}px"))
    
    def pdf_navigate(self, direction, page_label, pdf_viewer):
        """Navigation entre les pages du PDF"""
        current_text = page_label.text()
        current_page = int(current_text.split()[1])
        total_pages = 25
        
        if direction == "next" and current_page < total_pages:
            new_page = current_page + 1
        elif direction == "prev" and current_page > 1:
            new_page = current_page - 1
        else:
            return
        
        page_label.setText(f"Page {new_page} / {total_pages}")
        pdf_viewer.setText(f"""üìÑ DOCUMENT PDF EXEMPLE - PAGE {new_page}

Contenu de la page {new_page}...

Lorem ipsum dolor sit amet, consectetur adipiscing elit.
Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.

[Page {new_page} sur {total_pages}]""")
    
    def show_task_manager(self):
        """Gestionnaire de t√¢ches professionnel"""
        d = GlassDialog("üóÇÔ∏è Gestionnaire de T√¢ches Ragnar", (900, 650), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Gestionnaire de T√¢ches", "Organisez votre productivit√©")
        lay.addWidget(header)
        
        # Barre d'outils
        toolbar = QtWidgets.QHBoxLayout()
        
        add_task_btn = QtWidgets.QPushButton("‚ûï Nouvelle T√¢che")
        filter_combo = QtWidgets.QComboBox()
        filter_combo.addItems(["Toutes", "√Ä faire", "En cours", "Termin√©es", "Priorit√© haute"])
        filter_combo.setStyleSheet("background: rgba(40, 40, 40, 0.8); color: white; padding: 5px; border-radius: 4px;")
        
        search_input = QtWidgets.QLineEdit()
        search_input.setPlaceholderText("üîç Rechercher une t√¢che...")
        search_input.setStyleSheet("background: rgba(40, 40, 40, 0.8); color: white; padding: 8px; border-radius: 4px;")
        
        toolbar.addWidget(add_task_btn)
        toolbar.addWidget(QtWidgets.QLabel("Filtre:"))
        toolbar.addWidget(filter_combo)
        toolbar.addStretch()
        toolbar.addWidget(search_input)
        
        lay.addLayout(toolbar)
        
        # Zone des t√¢ches
        tasks_area = QtWidgets.QWidget(objectName="GlassCard")
        tasks_layout = QtWidgets.QVBoxLayout(tasks_area)
        tasks_layout.setContentsMargins(16, 16, 16, 16)
        
        # Liste des t√¢ches
        sample_tasks = [
            ("‚úÖ", "Terminer le rapport mensuel", "Haute", "Aujourd'hui", "#ff6b6b"),
            ("üîÑ", "Pr√©parer la pr√©sentation client", "Moyenne", "Demain", "#ffa500"),
            ("‚è≥", "R√©viser le code de l'application", "Haute", "Lundi", "#ff6b6b"),
            ("‚úÖ", "R√©pondre aux emails", "Faible", "Hier", "#4ecdc4"),
            ("üîÑ", "Planifier les vacances", "Moyenne", "Semaine prochaine", "#ffa500"),
            ("‚è≥", "Acheter des fournitures bureau", "Faible", "Vendredi", "#4ecdc4")
        ]
        
        for status, task, priority, deadline, color in sample_tasks:
            task_card = QtWidgets.QWidget()
            task_card.setStyleSheet(f"""
                QWidget {{
                    background: rgba(40, 40, 40, 0.6);
                    border-left: 4px solid {color};
                    border-radius: 6px;
                    margin: 2px;
                    padding: 8px;
                }}
                QWidget:hover {{
                    background: rgba(60, 60, 60, 0.8);
                }}
            """)
            
            task_layout = QtWidgets.QHBoxLayout(task_card)
            task_layout.setContentsMargins(12, 8, 12, 8)
            
            # Status et t√¢che
            status_label = QtWidgets.QLabel(status)
            status_label.setStyleSheet("font-size: 16px;")
            
            task_info = QtWidgets.QVBoxLayout()
            task_name = QtWidgets.QLabel(task)
            task_name.setStyleSheet("color: white; font-weight: bold; font-size: 14px;")
            
            task_details = QtWidgets.QLabel(f"Priorit√©: {priority} ‚Ä¢ √âch√©ance: {deadline}")
            task_details.setStyleSheet("color: #cccccc; font-size: 11px;")
            
            task_info.addWidget(task_name)
            task_info.addWidget(task_details)
            
            # Actions
            actions_layout = QtWidgets.QHBoxLayout()
            edit_btn = QtWidgets.QPushButton("‚úèÔ∏è")
            edit_btn.setFixedSize(30, 30)
            delete_btn = QtWidgets.QPushButton("üóëÔ∏è")
            delete_btn.setFixedSize(30, 30)
            
            actions_layout.addWidget(edit_btn)
            actions_layout.addWidget(delete_btn)
            
            task_layout.addWidget(status_label)
            task_layout.addLayout(task_info)
            task_layout.addStretch()
            task_layout.addLayout(actions_layout)
            
            tasks_layout.addWidget(task_card)
        
        lay.addWidget(tasks_area)
        
        # Statistiques
        stats_card = QtWidgets.QWidget(objectName="GlassCard")
        stats_layout = QtWidgets.QHBoxLayout(stats_card)
        stats_layout.setContentsMargins(16, 12, 16, 12)
        
        stats_info = [
            ("üìä", "Total", "12 t√¢ches"),
            ("‚úÖ", "Termin√©es", "4 t√¢ches"),
            ("üîÑ", "En cours", "5 t√¢ches"),
            ("‚è≥", "√Ä faire", "3 t√¢ches")
        ]
        
        for icon, label, value in stats_info:
            stat_widget = QtWidgets.QVBoxLayout()
            icon_label = QtWidgets.QLabel(icon)
            icon_label.setStyleSheet("font-size: 20px; text-align: center;")
            icon_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            label_widget = QtWidgets.QLabel(label)
            label_widget.setStyleSheet("color: #cccccc; font-size: 12px; text-align: center;")
            label_widget.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            value_widget = QtWidgets.QLabel(value)
            value_widget.setStyleSheet("color: #00ff88; font-weight: bold; font-size: 14px; text-align: center;")
            value_widget.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            stat_widget.addWidget(icon_label)
            stat_widget.addWidget(label_widget)
            stat_widget.addWidget(value_widget)
            
            stats_layout.addLayout(stat_widget)
            if icon != "‚è≥":  # Pas de s√©parateur apr√®s le dernier
                sep = QtWidgets.QLabel("|")
                sep.setStyleSheet("color: #666;")
                stats_layout.addWidget(sep)
        
        lay.addWidget(stats_card)
        
        # Actions des boutons
        add_task_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ûï", "Nouvelle T√¢che !\n\nüìù Informations :\n‚Ä¢ Titre de la t√¢che\n‚Ä¢ Description\n‚Ä¢ Priorit√© (Haute/Moyenne/Faible)\n‚Ä¢ √âch√©ance\n‚Ä¢ Cat√©gorie\n‚Ä¢ Assign√© √†\n\n‚úÖ T√¢che cr√©√©e !"))
        
        # Actions principales
        actions_layout = QtWidgets.QHBoxLayout()
        
        export_btn = QtWidgets.QPushButton("üì§ Exporter")
        calendar_btn = QtWidgets.QPushButton("üìÖ Calendrier")
        reports_btn = QtWidgets.QPushButton("üìä Rapports")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üì§", "Export des t√¢ches !\n\nüì§ Formats :\n‚Ä¢ PDF (.pdf)\n‚Ä¢ Excel (.xlsx)\n‚Ä¢ CSV (.csv)\n‚Ä¢ JSON (.json)\n\nüìã Toutes les t√¢ches export√©es"))
        
        calendar_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìÖ", "Vue Calendrier !\n\nüìÖ Affichage :\n‚Ä¢ T√¢ches par jour\n‚Ä¢ √âch√©ances importantes\n‚Ä¢ Planning hebdomadaire\n‚Ä¢ Vue mensuelle\n\nüîÑ Synchronisation avec Calendrier Ragnar"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(export_btn)
        actions_layout.addWidget(calendar_btn)
        actions_layout.addWidget(reports_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_timer_app(self):
        """Application minuteur et chronom√®tre compl√®te"""
        d = GlassDialog("‚è∞ Minuteur & Chrono Ragnar", (700, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Minuteur & Chronom√®tre", "Gestion du temps pr√©cise")
        lay.addWidget(header)
        
        # Onglets
        tabs = QtWidgets.QTabWidget()
        
        # === ONGLET MINUTEUR ===
        timer_tab = QtWidgets.QWidget()
        timer_layout = QtWidgets.QVBoxLayout(timer_tab)
        
        # Affichage du temps
        timer_display = QtWidgets.QLabel("05:00")
        timer_display.setStyleSheet("""
            QLabel {
                font-size: 48px;
                font-weight: bold;
                color: #00ff88;
                background: rgba(0, 0, 0, 0.3);
                border: 2px solid rgba(0, 255, 136, 0.5);
                border-radius: 15px;
                padding: 20px;
                text-align: center;
            }
        """)
        timer_display.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        timer_layout.addWidget(timer_display)
        
        # Contr√¥les minuteur
        timer_controls = QtWidgets.QHBoxLayout()
        
        # S√©lection du temps
        time_inputs = QtWidgets.QHBoxLayout()
        
        hours_spin = QtWidgets.QSpinBox()
        hours_spin.setRange(0, 23)
        hours_spin.setValue(0)
        hours_spin.setSuffix("h")
        
        minutes_spin = QtWidgets.QSpinBox()
        minutes_spin.setRange(0, 59)
        minutes_spin.setValue(5)
        minutes_spin.setSuffix("min")
        
        seconds_spin = QtWidgets.QSpinBox()
        seconds_spin.setRange(0, 59)
        seconds_spin.setValue(0)
        seconds_spin.setSuffix("s")
        
        time_inputs.addWidget(QtWidgets.QLabel("Temps:"))
        time_inputs.addWidget(hours_spin)
        time_inputs.addWidget(minutes_spin)
        time_inputs.addWidget(seconds_spin)
        time_inputs.addStretch()
        
        timer_layout.addLayout(time_inputs)
        
        # Boutons minuteur
        timer_buttons = QtWidgets.QHBoxLayout()
        
        start_timer_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è D√©marrer")
        pause_timer_btn = QtWidgets.QPushButton("‚è∏Ô∏è Pause")
        stop_timer_btn = QtWidgets.QPushButton("‚èπÔ∏è Arr√™ter")
        reset_timer_btn = QtWidgets.QPushButton("üîÑ Reset")
        
        timer_buttons.addWidget(start_timer_btn)
        timer_buttons.addWidget(pause_timer_btn)
        timer_buttons.addWidget(stop_timer_btn)
        timer_buttons.addWidget(reset_timer_btn)
        
        timer_layout.addLayout(timer_buttons)
        
        # Minuteurs pr√©d√©finis
        presets_layout = QtWidgets.QHBoxLayout()
        presets_layout.addWidget(QtWidgets.QLabel("Minuteurs rapides:"))
        
        preset_1min = QtWidgets.QPushButton("1min")
        preset_5min = QtWidgets.QPushButton("5min")
        preset_10min = QtWidgets.QPushButton("10min")
        preset_25min = QtWidgets.QPushButton("25min (Pomodoro)")
        
        presets_layout.addWidget(preset_1min)
        presets_layout.addWidget(preset_5min)
        presets_layout.addWidget(preset_10min)
        presets_layout.addWidget(preset_25min)
        
        timer_layout.addLayout(presets_layout)
        
        tabs.addTab(timer_tab, "‚è∞ Minuteur")
        
        # === ONGLET CHRONOM√àTRE ===
        stopwatch_tab = QtWidgets.QWidget()
        stopwatch_layout = QtWidgets.QVBoxLayout(stopwatch_tab)
        
        # Affichage chrono
        stopwatch_display = QtWidgets.QLabel("00:00:00")
        stopwatch_display.setStyleSheet("""
            QLabel {
                font-size: 48px;
                font-weight: bold;
                color: #00aaff;
                background: rgba(0, 0, 0, 0.3);
                border: 2px solid rgba(0, 170, 255, 0.5);
                border-radius: 15px;
                padding: 20px;
                text-align: center;
            }
        """)
        stopwatch_display.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        stopwatch_layout.addWidget(stopwatch_display)
        
        # Boutons chrono
        stopwatch_buttons = QtWidgets.QHBoxLayout()
        
        start_stopwatch_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è D√©marrer")
        lap_btn = QtWidgets.QPushButton("üèÅ Tour")
        stop_stopwatch_btn = QtWidgets.QPushButton("‚èπÔ∏è Arr√™ter")
        reset_stopwatch_btn = QtWidgets.QPushButton("üîÑ Reset")
        
        stopwatch_buttons.addWidget(start_stopwatch_btn)
        stopwatch_buttons.addWidget(lap_btn)
        stopwatch_buttons.addWidget(stop_stopwatch_btn)
        stopwatch_buttons.addWidget(reset_stopwatch_btn)
        
        stopwatch_layout.addLayout(stopwatch_buttons)
        
        # Liste des tours
        laps_card = QtWidgets.QWidget(objectName="GlassCard")
        laps_layout = QtWidgets.QVBoxLayout(laps_card)
        laps_layout.setContentsMargins(16, 16, 16, 16)
        
        laps_title = QtWidgets.QLabel("üèÅ Tours enregistr√©s")
        laps_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        laps_layout.addWidget(laps_title)
        
        # Tours d'exemple
        sample_laps = [
            "Tour 1: 00:01:23.45",
            "Tour 2: 00:01:18.92",
            "Tour 3: 00:01:25.67",
            "Tour 4: 00:01:21.34"
        ]
        
        for lap in sample_laps:
            lap_label = QtWidgets.QLabel(lap)
            lap_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 170, 255, 0.5);")
            laps_layout.addWidget(lap_label)
        
        stopwatch_layout.addWidget(laps_card)
        
        tabs.addTab(stopwatch_tab, "‚è±Ô∏è Chronom√®tre")
        
        # === ONGLET ALARMES ===
        alarms_tab = QtWidgets.QWidget()
        alarms_layout = QtWidgets.QVBoxLayout(alarms_tab)
        
        # Liste des alarmes
        alarms_card = QtWidgets.QWidget(objectName="GlassCard")
        alarms_card_layout = QtWidgets.QVBoxLayout(alarms_card)
        alarms_card_layout.setContentsMargins(16, 16, 16, 16)
        
        alarms_title = QtWidgets.QLabel("‚è∞ Alarmes programm√©es")
        alarms_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        alarms_card_layout.addWidget(alarms_title)
        
        # Alarmes d'exemple
        sample_alarms = [
            ("07:00", "R√©veil", "Lun-Ven", True),
            ("12:30", "Pause d√©jeuner", "Tous les jours", True),
            ("18:00", "Fin de travail", "Lun-Ven", False),
            ("22:00", "Coucher", "Tous les jours", True)
        ]
        
        for time, name, days, active in sample_alarms:
            alarm_widget = QtWidgets.QHBoxLayout()
            
            time_label = QtWidgets.QLabel(time)
            time_label.setStyleSheet("color: #ffaa00; font-weight: bold; font-size: 16px; min-width: 60px;")
            
            info_layout = QtWidgets.QVBoxLayout()
            name_label = QtWidgets.QLabel(name)
            name_label.setStyleSheet("color: white; font-weight: bold; font-size: 14px;")
            days_label = QtWidgets.QLabel(days)
            days_label.setStyleSheet("color: #cccccc; font-size: 11px;")
            
            info_layout.addWidget(name_label)
            info_layout.addWidget(days_label)
            
            toggle_btn = QtWidgets.QPushButton("‚úÖ" if active else "‚ùå")
            toggle_btn.setFixedSize(40, 40)
            
            alarm_widget.addWidget(time_label)
            alarm_widget.addLayout(info_layout)
            alarm_widget.addStretch()
            alarm_widget.addWidget(toggle_btn)
            
            alarms_card_layout.addLayout(alarm_widget)
        
        alarms_layout.addWidget(alarms_card)
        
        # Bouton nouvelle alarme
        add_alarm_btn = QtWidgets.QPushButton("‚ûï Nouvelle Alarme")
        add_alarm_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ûï", "Nouvelle Alarme !\n\n‚è∞ Configuration :\n‚Ä¢ Heure : 08:00\n‚Ä¢ Nom : Mon alarme\n‚Ä¢ R√©p√©tition : Lun-Ven\n‚Ä¢ Son : M√©lodie douce\n‚Ä¢ R√©p√©tition : 3 fois\n\n‚úÖ Alarme cr√©√©e !"))
        alarms_layout.addWidget(add_alarm_btn)
        
        tabs.addTab(alarms_tab, "üîî Alarmes")
        
        lay.addWidget(tabs)
        
        # Actions des boutons
        start_timer_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ñ∂Ô∏è", "Minuteur d√©marr√© !\n\n‚è∞ Temps : 5 minutes\nüîî Notification √† la fin\n‚è±Ô∏è Temps restant affich√©"))
        
        start_stopwatch_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ñ∂Ô∏è", "Chronom√®tre d√©marr√© !\n\n‚è±Ô∏è Pr√©cision : centi√®mes\nüèÅ Appuyez sur Tour pour marquer\nüìä Statistiques disponibles"))
        
        # Actions principales
        actions_layout = QtWidgets.QHBoxLayout()
        
        sounds_btn = QtWidgets.QPushButton("üîä Sons")
        settings_btn = QtWidgets.QPushButton("‚öôÔ∏è Param√®tres")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        sounds_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîä", "Sons disponibles !\n\nüéµ Sonneries :\n‚Ä¢ M√©lodie douce\n‚Ä¢ Bip classique\n‚Ä¢ Carillon\n‚Ä¢ Alarme forte\n‚Ä¢ Son personnalis√©\n\nüîä Volume r√©glable"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(sounds_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_unit_converter(self):
        """Convertisseur d'unit√©s universel"""
        d = GlassDialog("üìê Convertisseur Ragnar", (800, 650), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Convertisseur Universel", "Conversions pr√©cises et rapides")
        lay.addWidget(header)
        
        # S√©lecteur de cat√©gorie
        category_layout = QtWidgets.QHBoxLayout()
        category_layout.addWidget(QtWidgets.QLabel("Cat√©gorie:"))
        
        category_combo = QtWidgets.QComboBox()
        categories = [
            "üìè Longueur", "‚öñÔ∏è Poids/Masse", "üå°Ô∏è Temp√©rature", 
            "üí∞ Devises", "‚è±Ô∏è Temps", "üìä Volume", 
            "‚ö° √ânergie", "üîå Puissance", "üíæ Donn√©es"
        ]
        category_combo.addItems(categories)
        category_combo.setStyleSheet("background: rgba(40, 40, 40, 0.8); color: white; padding: 8px; border-radius: 4px; min-width: 150px;")
        
        category_layout.addWidget(category_combo)
        category_layout.addStretch()
        
        lay.addLayout(category_layout)
        
        # Zone de conversion
        converter_card = QtWidgets.QWidget(objectName="GlassCard")
        converter_layout = QtWidgets.QVBoxLayout(converter_card)
        converter_layout.setContentsMargins(20, 20, 20, 20)
        
        # Conversion FROM
        from_layout = QtWidgets.QHBoxLayout()
        from_layout.addWidget(QtWidgets.QLabel("De:"))
        
        from_value = QtWidgets.QLineEdit("1")
        from_value.setStyleSheet("background: rgba(40, 40, 40, 0.8); color: white; padding: 8px; border-radius: 4px; font-size: 16px;")
        from_value.setFixedWidth(150)
        
        from_unit = QtWidgets.QComboBox()
        from_unit.addItems(["m√®tre", "kilom√®tre", "centim√®tre", "millim√®tre", "pouce", "pied", "yard", "mile"])
        from_unit.setStyleSheet("background: rgba(40, 40, 40, 0.8); color: white; padding: 8px; border-radius: 4px;")
        
        from_layout.addWidget(from_value)
        from_layout.addWidget(from_unit)
        from_layout.addStretch()
        
        converter_layout.addLayout(from_layout)
        
        # Bouton d'√©change
        swap_btn = QtWidgets.QPushButton("üîÑ √âchanger")
        swap_btn.setFixedWidth(120)
        converter_layout.addWidget(swap_btn, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Conversion TO
        to_layout = QtWidgets.QHBoxLayout()
        to_layout.addWidget(QtWidgets.QLabel("Vers:"))
        
        to_value = QtWidgets.QLineEdit("100")
        to_value.setReadOnly(True)
        to_value.setStyleSheet("""
            QLineEdit {
                background: rgba(0, 255, 136, 0.2);
                color: #00ff88;
                padding: 8px;
                border-radius: 4px;
                font-size: 16px;
                font-weight: bold;
            }
        """)
        to_value.setFixedWidth(150)
        
        to_unit = QtWidgets.QComboBox()
        to_unit.addItems(["centim√®tre", "m√®tre", "kilom√®tre", "millim√®tre", "pouce", "pied", "yard", "mile"])
        to_unit.setStyleSheet("background: rgba(40, 40, 40, 0.8); color: white; padding: 8px; border-radius: 4px;")
        
        to_layout.addWidget(to_value)
        to_layout.addWidget(to_unit)
        to_layout.addStretch()
        
        converter_layout.addLayout(to_layout)
        
        lay.addWidget(converter_card)
        
        # Conversions rapides
        quick_conversions = QtWidgets.QWidget(objectName="GlassCard")
        quick_layout = QtWidgets.QVBoxLayout(quick_conversions)
        quick_layout.setContentsMargins(16, 16, 16, 16)
        
        quick_title = QtWidgets.QLabel("‚ö° Conversions Rapides")
        quick_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        quick_layout.addWidget(quick_title)
        
        # Grille de conversions rapides
        quick_grid = QtWidgets.QGridLayout()
        
        quick_conversions_data = [
            ("1 m", "= 100 cm", "= 3.28 ft", "= 39.37 in"),
            ("1 km", "= 1000 m", "= 0.62 mi", "= 3280 ft"),
            ("1 kg", "= 1000 g", "= 2.20 lb", "= 35.27 oz"),
            ("1 L", "= 1000 ml", "= 0.26 gal", "= 33.81 fl oz")
        ]
        
        for i, (base, conv1, conv2, conv3) in enumerate(quick_conversions_data):
            base_label = QtWidgets.QLabel(base)
            base_label.setStyleSheet("color: #00ff88; font-weight: bold; font-size: 14px;")
            
            conv1_label = QtWidgets.QLabel(conv1)
            conv1_label.setStyleSheet("color: white; font-size: 12px;")
            
            conv2_label = QtWidgets.QLabel(conv2)
            conv2_label.setStyleSheet("color: #cccccc; font-size: 12px;")
            
            conv3_label = QtWidgets.QLabel(conv3)
            conv3_label.setStyleSheet("color: #cccccc; font-size: 12px;")
            
            quick_grid.addWidget(base_label, i, 0)
            quick_grid.addWidget(conv1_label, i, 1)
            quick_grid.addWidget(conv2_label, i, 2)
            quick_grid.addWidget(conv3_label, i, 3)
        
        quick_layout.addLayout(quick_grid)
        lay.addWidget(quick_conversions)
        
        # Historique des conversions
        history_card = QtWidgets.QWidget(objectName="GlassCard")
        history_layout = QtWidgets.QVBoxLayout(history_card)
        history_layout.setContentsMargins(16, 16, 16, 16)
        
        history_title = QtWidgets.QLabel("üìã Historique")
        history_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        history_layout.addWidget(history_title)
        
        history_items = [
            "5 km ‚Üí 3.11 miles",
            "100¬∞F ‚Üí 37.78¬∞C",
            "2.5 kg ‚Üí 5.51 lbs",
            "1 GB ‚Üí 1024 MB"
        ]
        
        for item in history_items:
            item_label = QtWidgets.QLabel(item)
            item_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(255, 170, 0, 0.5);")
            history_layout.addWidget(item_label)
        
        lay.addWidget(history_card)
        
        # Actions des boutons
        def update_conversion():
            try:
                value = float(from_value.text())
                from_u = from_unit.currentText()
                to_u = to_unit.currentText()
                
                # Simulation de conversion (m√®tres vers centim√®tres)
                if from_u == "m√®tre" and to_u == "centim√®tre":
                    result = value * 100
                elif from_u == "centim√®tre" and to_u == "m√®tre":
                    result = value / 100
                elif from_u == "kilom√®tre" and to_u == "m√®tre":
                    result = value * 1000
                else:
                    result = value * 1.5  # Conversion g√©n√©rique simul√©e
                
                to_value.setText(f"{result:.4f}")
            except:
                to_value.setText("Erreur")
        
        from_value.textChanged.connect(update_conversion)
        from_unit.currentTextChanged.connect(update_conversion)
        to_unit.currentTextChanged.connect(update_conversion)
        
        def change_category():
            category = category_combo.currentText()
            if "Longueur" in category:
                units = ["m√®tre", "kilom√®tre", "centim√®tre", "millim√®tre", "pouce", "pied", "yard", "mile"]
            elif "Poids" in category:
                units = ["kilogramme", "gramme", "livre", "once", "tonne", "stone"]
            elif "Temp√©rature" in category:
                units = ["Celsius", "Fahrenheit", "Kelvin", "Rankine"]
            elif "Devises" in category:
                units = ["EUR", "USD", "GBP", "JPY", "CHF", "CAD"]
            elif "Temps" in category:
                units = ["seconde", "minute", "heure", "jour", "semaine", "mois", "ann√©e"]
            else:
                units = ["unit√©1", "unit√©2", "unit√©3"]
            
            from_unit.clear()
            to_unit.clear()
            from_unit.addItems(units)
            to_unit.addItems(units)
        
        category_combo.currentTextChanged.connect(change_category)
        
        swap_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîÑ", "Unit√©s √©chang√©es !\n\nüîÑ Les unit√©s source et destination\nont √©t√© invers√©es automatiquement"))
        
        # Actions principales
        actions_layout = QtWidgets.QHBoxLayout()
        
        calculator_btn = QtWidgets.QPushButton("üßÆ Calculatrice")
        favorites_btn = QtWidgets.QPushButton("‚≠ê Favoris")
        export_btn = QtWidgets.QPushButton("üì§ Exporter")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        calculator_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üßÆ", "Calculatrice int√©gr√©e !\n\nüßÆ Fonctions :\n‚Ä¢ Calculs de base\n‚Ä¢ Fonctions scientifiques\n‚Ä¢ Conversions directes\n‚Ä¢ Historique des calculs"))
        
        favorites_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚≠ê", "Conversions favorites !\n\n‚≠ê Favoris sauvegard√©s :\n‚Ä¢ km ‚Üí miles\n‚Ä¢ ¬∞C ‚Üí ¬∞F\n‚Ä¢ kg ‚Üí lbs\n‚Ä¢ L ‚Üí gallons\n\n‚ûï Ajouter aux favoris"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(calculator_btn)
        actions_layout.addWidget(favorites_btn)
        actions_layout.addWidget(export_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_video_player(self):
        """Lecteur vid√©o professionnel"""
        d = GlassDialog("üé¨ Lecteur Vid√©o Ragnar", (900, 650), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Lecteur Vid√©o Ragnar", "Lecture multim√©dia haute qualit√©")
        lay.addWidget(header)
        
        # Zone de lecture vid√©o
        video_area = QtWidgets.QWidget(objectName="GlassCard")
        video_area.setFixedHeight(300)
        video_layout = QtWidgets.QVBoxLayout(video_area)
        video_layout.setContentsMargins(16, 16, 16, 16)
        
        # √âcran vid√©o simul√©
        video_screen = QtWidgets.QLabel("üé¨ Aucune vid√©o charg√©e")
        video_screen.setStyleSheet("""
            QLabel {
                background: qlineargradient(x1:0, y1:0, x2:1, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(20, 20, 20, 0.8));
                border: 2px solid rgba(0, 255, 136, 0.3);
                border-radius: 10px;
                color: #00ff88;
                font-size: 24px;
                font-weight: bold;
            }
        """)
        video_screen.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        video_screen.setMinimumHeight(250)
        video_layout.addWidget(video_screen)
        
        lay.addWidget(video_area)
        
        # Contr√¥les de lecture
        controls_card = QtWidgets.QWidget(objectName="GlassCard")
        controls_layout = QtWidgets.QVBoxLayout(controls_card)
        controls_layout.setContentsMargins(16, 16, 16, 16)
        
        # Barre de progression
        progress_layout = QtWidgets.QHBoxLayout()
        time_current = QtWidgets.QLabel("00:00")
        time_current.setStyleSheet("color: #00ff88; font-weight: bold;")
        
        progress_bar = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        progress_bar.setRange(0, 100)
        progress_bar.setValue(35)
        
        time_total = QtWidgets.QLabel("02:34")
        time_total.setStyleSheet("color: #cccccc; font-weight: bold;")
        
        progress_layout.addWidget(time_current)
        progress_layout.addWidget(progress_bar)
        progress_layout.addWidget(time_total)
        
        controls_layout.addLayout(progress_layout)
        
        # Boutons de contr√¥le
        buttons_layout = QtWidgets.QHBoxLayout()
        
        prev_btn = QtWidgets.QPushButton("‚èÆÔ∏è")
        play_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è")
        pause_btn = QtWidgets.QPushButton("‚è∏Ô∏è")
        stop_btn = QtWidgets.QPushButton("‚èπÔ∏è")
        next_btn = QtWidgets.QPushButton("‚è≠Ô∏è")
        
        # Volume
        volume_label = QtWidgets.QLabel("üîä")
        volume_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        volume_slider.setRange(0, 100)
        volume_slider.setValue(75)
        volume_slider.setMaximumWidth(100)
        
        # Plein √©cran
        fullscreen_btn = QtWidgets.QPushButton("üî≥")
        
        buttons_layout.addWidget(prev_btn)
        buttons_layout.addWidget(play_btn)
        buttons_layout.addWidget(pause_btn)
        buttons_layout.addWidget(stop_btn)
        buttons_layout.addWidget(next_btn)
        buttons_layout.addStretch()
        buttons_layout.addWidget(volume_label)
        buttons_layout.addWidget(volume_slider)
        buttons_layout.addWidget(fullscreen_btn)
        
        controls_layout.addLayout(buttons_layout)
        lay.addWidget(controls_card)
        
        # Actions
        actions_layout = QtWidgets.QHBoxLayout()
        
        open_btn = QtWidgets.QPushButton("üìÅ Ouvrir")
        playlist_btn = QtWidgets.QPushButton("üìã Playlist")
        subtitles_btn = QtWidgets.QPushButton("üí¨ Sous-titres")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        open_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìÅ", "Ouvrir une vid√©o !\n\nüìÅ Formats support√©s :\n‚Ä¢ MP4, AVI, MKV, MOV\n‚Ä¢ WMV, FLV, WEBM\n‚Ä¢ 4K, HDR support√©s"))
        playlist_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìã", "Playlist vid√©o !\n\nüìã Playlist actuelle :\n‚Ä¢ demo_video.mp4 ‚ñ∂Ô∏è\n‚Ä¢ film_action.mkv\n‚Ä¢ documentaire.avi\n‚Ä¢ serie_s01e01.mp4"))
        subtitles_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üí¨", "Sous-titres !\n\nüí¨ Langues disponibles :\n‚Ä¢ Fran√ßais ‚úÖ\n‚Ä¢ Anglais\n‚Ä¢ Espagnol\n‚Ä¢ Allemand"))
        close_btn.clicked.connect(d.close)
        
        # Connecter les boutons de contr√¥le
        play_btn.clicked.connect(lambda: self.video_control("play", video_screen))
        pause_btn.clicked.connect(lambda: self.video_control("pause", video_screen))
        stop_btn.clicked.connect(lambda: self.video_control("stop", video_screen))
        
        actions_layout.addWidget(open_btn)
        actions_layout.addWidget(playlist_btn)
        actions_layout.addWidget(subtitles_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def video_control(self, action, video_screen):
        """Contr√¥le la lecture vid√©o"""
        if action == "play":
            video_screen.setText("‚ñ∂Ô∏è Lecture en cours...")
        elif action == "pause":
            video_screen.setText("‚è∏Ô∏è Vid√©o en pause")
        elif action == "stop":
            video_screen.setText("‚èπÔ∏è Lecture arr√™t√©e")
    
    def show_image_viewer(self):
        QtWidgets.QMessageBox.information(self, "üñºÔ∏è Visionneuse", "Visionneuse d'images !\n\nFormats :\n‚Ä¢ JPG, PNG, GIF\n‚Ä¢ Diaporama\n‚Ä¢ √âdition basique")
    
    def show_audio_recorder(self):
        QtWidgets.QMessageBox.information(self, "üéôÔ∏è Enregistreur", "Enregistreur audio !\n\nFonctionnalit√©s :\n‚Ä¢ Haute qualit√©\n‚Ä¢ Effets\n‚Ä¢ Formats multiples")
    
    def show_webcam_studio(self):
        QtWidgets.QMessageBox.information(self, "üìπ Webcam Studio", "Studio webcam !\n\nFonctionnalit√©s :\n‚Ä¢ Streaming\n‚Ä¢ Effets\n‚Ä¢ Enregistrement")
    
    def show_video_editor(self):
        QtWidgets.QMessageBox.information(self, "üéûÔ∏è √âditeur Vid√©o", "√âditeur vid√©o Ragnar !\n\nFonctionnalit√©s :\n‚Ä¢ Montage\n‚Ä¢ Transitions\n‚Ä¢ Effets sp√©ciaux")
    
    def show_audio_studio(self):
        QtWidgets.QMessageBox.information(self, "üéµ Studio Audio", "Studio audio professionnel !\n\nOutils :\n‚Ä¢ Mixage\n‚Ä¢ Mastering\n‚Ä¢ Plugins")
    
    def show_streaming_center(self):
        QtWidgets.QMessageBox.information(self, "üì∫ Streaming", "Centre de streaming !\n\nPlateformes :\n‚Ä¢ Twitch\n‚Ä¢ YouTube\n‚Ä¢ Facebook Live")
    
    def show_snake_game(self):
        QtWidgets.QMessageBox.information(self, "üêç Snake", "Snake Ragnar !\n\nD√©j√† disponible dans le Centre de Jeux !\nAcc√©dez-y via le menu Applications.")
    
    def show_shooting_game(self):
        QtWidgets.QMessageBox.information(self, "üéØ Jeu de Tir", "Jeu de tir Ragnar !\n\nObjectif :\n‚Ä¢ Visez les cibles\n‚Ä¢ Am√©liorez votre pr√©cision\n‚Ä¢ D√©bloquez des niveaux")
    
    def show_puzzle_game(self):
        """Centre de jeux de puzzles"""
        d = GlassDialog("üß© Puzzles Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Centre de Puzzles", "Entra√Ænez votre cerveau")
        lay.addWidget(header)
        
        # Grille de jeux
        games_grid = QtWidgets.QGridLayout()
        
        puzzle_games = [
            ("üî¢", "Sudoku", "Logique num√©rique", "Facile ‚Ä¢ Moyen ‚Ä¢ Difficile"),
            ("üìù", "Mots Crois√©s", "Vocabulaire", "Grilles quotidiennes"),
            ("üî∫", "Tangram", "G√©om√©trie", "Formes √† reconstituer"),
            ("üß©", "Casse-t√™tes", "R√©flexion", "100+ niveaux"),
            ("üéØ", "Mastermind", "D√©duction", "Trouvez la combinaison"),
            ("üîÄ", "Taquin", "Strat√©gie", "Remettez en ordre")
        ]
        
        for i, (icon, name, desc, info) in enumerate(puzzle_games):
            game_card = QtWidgets.QWidget(objectName="GlassCard")
            game_layout = QtWidgets.QVBoxLayout(game_card)
            game_layout.setContentsMargins(16, 16, 16, 16)
            
            # Ic√¥ne et nom
            title_layout = QtWidgets.QHBoxLayout()
            icon_label = QtWidgets.QLabel(icon)
            icon_label.setStyleSheet("font-size: 32px;")
            name_label = QtWidgets.QLabel(name)
            name_label.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88;")
            
            title_layout.addWidget(icon_label)
            title_layout.addWidget(name_label)
            title_layout.addStretch()
            
            # Description
            desc_label = QtWidgets.QLabel(desc)
            desc_label.setStyleSheet("color: #cccccc; font-size: 12px;")
            
            info_label = QtWidgets.QLabel(info)
            info_label.setStyleSheet("color: #00aaff; font-size: 10px;")
            
            # Bouton jouer
            play_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è Jouer")
            play_btn.clicked.connect(lambda checked, n=name: QtWidgets.QMessageBox.information(d, f"üéÆ {n}", f"Lancement de {n} !\n\nüéØ Pr√™t √† jouer ?\nüèÜ Meilleur score : 1250\n‚è±Ô∏è Temps moyen : 5min 30s"))
            
            game_layout.addLayout(title_layout)
            game_layout.addWidget(desc_label)
            game_layout.addWidget(info_label)
            game_layout.addStretch()
            game_layout.addWidget(play_btn)
            
            games_grid.addWidget(game_card, i // 2, i % 2)
        
        lay.addLayout(games_grid)
        
        # Actions
        actions_layout = QtWidgets.QHBoxLayout()
        scores_btn = QtWidgets.QPushButton("üèÜ Scores")
        settings_btn = QtWidgets.QPushButton("‚öôÔ∏è Param√®tres")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        scores_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üèÜ", "Meilleurs Scores !\n\nü•á Sudoku : 2min 45s\nü•à Mots Crois√©s : 8min 12s\nü•â Tangram : 1min 30s\n\nüìä Statistiques :\n‚Ä¢ Parties jou√©es : 147\n‚Ä¢ Taux de r√©ussite : 89%"))
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(scores_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_casino_games(self):
        QtWidgets.QMessageBox.information(self, "üé≤ Casino", "Casino Ragnar !\n\nJeux :\n‚Ä¢ Poker\n‚Ä¢ Blackjack\n‚Ä¢ Roulette\n‚Ä¢ Machines √† sous")
    
    def show_solitaire(self):
        QtWidgets.QMessageBox.information(self, "üÉè Solitaire", "Solitaire Ragnar !\n\nVariantes :\n‚Ä¢ Klondike\n‚Ä¢ Spider\n‚Ä¢ FreeCell")
    
    def show_arcade_center(self):
        QtWidgets.QMessageBox.information(self, "üé™ Arcade", "Arcade Center !\n\nJeux r√©tro :\n‚Ä¢ Pac-Man style\n‚Ä¢ Space Invaders\n‚Ä¢ Tetris")
    
        
        # === ONGLET QUARANTAINE ===
        quarantine_tab = QtWidgets.QWidget()
        quarantine_layout = QtWidgets.QVBoxLayout(quarantine_tab)
        
        quarantine_card = QtWidgets.QWidget(objectName="GlassCard")
        quarantine_card_layout = QtWidgets.QVBoxLayout(quarantine_card)
        quarantine_card_layout.setContentsMargins(16, 16, 16, 16)
        
        quarantine_title = QtWidgets.QLabel("üóÇÔ∏è Fichiers en Quarantaine")
        quarantine_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        quarantine_card_layout.addWidget(quarantine_title)
        
        quarantine_list = QtWidgets.QListWidget()
        quarantine_files = [
            "‚ö†Ô∏è suspicious_file.exe - Trojan.Win32.Generic",
            "ü¶† malware.dll - Adware.Generic.Suspicious",
            "üî¥ virus.bat - Worm.Script.Malicious",
            "‚ö†Ô∏è keylogger.exe - Spyware.Keylogger.Detected",
            "ü¶† ransomware.bin - Ransomware.Crypto.Locker"
        ]
        
        for file_item in quarantine_files:
            quarantine_list.addItem(file_item)
        
        quarantine_card_layout.addWidget(quarantine_list)
        
        # Actions quarantaine
        quarantine_actions = QtWidgets.QHBoxLayout()
        restore_btn = QtWidgets.QPushButton("‚Ü©Ô∏è Restaurer")
        delete_btn = QtWidgets.QPushButton("üóëÔ∏è Supprimer")
        analyze_btn = QtWidgets.QPushButton("üî¨ Analyser")
        
        restore_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(self, "‚Ü©Ô∏è", "Fichier restaur√© !\n\n‚ö†Ô∏è Attention : Le fichier a √©t√© restaur√©\nüõ°Ô∏è Surveillance renforc√©e activ√©e\nüìç Emplacement : Bureau/Restaur√©s/"))
        delete_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(self, "üóëÔ∏è", "Fichier supprim√© !\n\n‚úÖ Menace √©limin√©e d√©finitivement\nüîí Suppression s√©curis√©e effectu√©e\nüìä Statistiques mises √† jour"))
        analyze_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(self, "üî¨", "Analyse approfondie !\n\nüß¨ Type : Trojan.Win32.Generic\nüéØ Origine : Email suspect\n‚ö†Ô∏è Dangerosit√© : √âLEV√âE\nüõ°Ô∏è Action : Quarantaine recommand√©e"))
        
        quarantine_actions.addWidget(restore_btn)
        quarantine_actions.addWidget(delete_btn)
        quarantine_actions.addWidget(analyze_btn)
        quarantine_actions.addStretch()
        
        quarantine_card_layout.addLayout(quarantine_actions)
        quarantine_layout.addWidget(quarantine_card)
        tabs.addTab(quarantine_tab, "üóÇÔ∏è Quarantaine")
        
        # === ONGLET PARAM√àTRES ===
        settings_tab = QtWidgets.QWidget()
        settings_layout = QtWidgets.QVBoxLayout(settings_tab)
        
        settings_card = QtWidgets.QWidget(objectName="GlassCard")
        settings_card_layout = QtWidgets.QVBoxLayout(settings_card)
        settings_card_layout.setContentsMargins(16, 16, 16, 16)
        
        settings_title = QtWidgets.QLabel("‚öôÔ∏è Configuration Antivirus")
        settings_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        settings_card_layout.addWidget(settings_title)
        
        # Options de protection
        realtime_cb = QtWidgets.QCheckBox("üõ°Ô∏è Protection temps r√©el")
        realtime_cb.setChecked(True)
        web_protection_cb = QtWidgets.QCheckBox("üåê Protection web")
        web_protection_cb.setChecked(True)
        email_scan_cb = QtWidgets.QCheckBox("üìß Analyse des emails")
        email_scan_cb.setChecked(True)
        usb_scan_cb = QtWidgets.QCheckBox("üíæ Analyse USB automatique")
        usb_scan_cb.setChecked(False)
        
        settings_card_layout.addWidget(realtime_cb)
        settings_card_layout.addWidget(web_protection_cb)
        settings_card_layout.addWidget(email_scan_cb)
        settings_card_layout.addWidget(usb_scan_cb)
        
        # Niveau de sensibilit√©
        sensitivity_layout = QtWidgets.QHBoxLayout()
        sensitivity_layout.addWidget(QtWidgets.QLabel("Sensibilit√© :"))
        sensitivity_combo = QtWidgets.QComboBox()
        sensitivity_combo.addItems(["Faible", "Normale", "√âlev√©e", "Parano√Øaque"])
        sensitivity_combo.setCurrentText("√âlev√©e")
        sensitivity_layout.addWidget(sensitivity_combo)
        sensitivity_layout.addStretch()
        
        settings_card_layout.addLayout(sensitivity_layout)
        settings_layout.addWidget(settings_card)
        tabs.addTab(settings_tab, "‚öôÔ∏è Param√®tres")
        
        lay.addWidget(tabs)
        
        # Boutons de contr√¥le
        control_layout = QtWidgets.QHBoxLayout()
        
        emergency_btn = QtWidgets.QPushButton("üö® Mode Urgence")
        emergency_btn.setStyleSheet("QPushButton { background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 rgba(255, 68, 68, 0.3), stop:1 rgba(255, 68, 68, 0.1)); }")
        
        reports_btn = QtWidgets.QPushButton("üìã Rapports")
        help_btn = QtWidgets.QPushButton("‚ùì Aide")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        emergency_btn.clicked.connect(lambda: QtWidgets.QMessageBox.warning(self, "üö®", "Mode Urgence Activ√© !\n\nüîí Syst√®me verrouill√©\nüõ°Ô∏è Protection maximale\nüö´ R√©seau isol√©\n‚ö° Analyse d'urgence lanc√©e\n\n‚è±Ô∏è Dur√©e estim√©e : 5 minutes"))
        reports_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(self, "üìã", "Rapports de S√©curit√© !\n\nüìä Rapport hebdomadaire :\n‚Ä¢ 347 menaces bloqu√©es\n‚Ä¢ 12,450 fichiers analys√©s\n‚Ä¢ 0 infections d√©tect√©es\n‚Ä¢ 99.8% de protection\n\nüìß Rapport envoy√© par email"))
        help_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(self, "‚ùì", "Aide Antivirus !\n\nüõ°Ô∏è Protection temps r√©el\nüîç Types d'analyses\nüóÇÔ∏è Gestion quarantaine\n‚öôÔ∏è Configuration avanc√©e\n\nüìû Support 24/7 disponible"))
        close_btn.clicked.connect(lambda: self.close())
        
        control_layout.addWidget(emergency_btn)
        control_layout.addWidget(reports_btn)
        control_layout.addWidget(help_btn)
        control_layout.addStretch()
        control_layout.addWidget(close_btn)
        
        lay.addLayout(control_layout)
        
        d.show()
        fade_in(d, 800)
    
    def start_antivirus_scan(self, scan_type):
        """Lance une analyse antivirus"""
        if scan_type == "rapide":
            QtWidgets.QMessageBox.information(
                self, "‚ö° Analyse Rapide", 
                "Analyse rapide lanc√©e !\n\nüîç Zones analys√©es :\n‚Ä¢ M√©moire syst√®me\n‚Ä¢ Processus actifs\n‚Ä¢ Fichiers critiques\n‚Ä¢ D√©marrage automatique\n\n‚è±Ô∏è Dur√©e estim√©e : 2 minutes\nüìä R√©sultat : Aucune menace d√©tect√©e"
            )
        else:
            QtWidgets.QMessageBox.information(
                self, "üîç Analyse Compl√®te", 
                "Analyse compl√®te lanc√©e !\n\nüîç Zones analys√©es :\n‚Ä¢ Tous les disques\n‚Ä¢ Fichiers syst√®me\n‚Ä¢ Archives compress√©es\n‚Ä¢ Secteurs de boot\n\n‚è±Ô∏è Dur√©e estim√©e : 45 minutes\nüìä Progression : 0% - D√©marrage..."
            )
    
    
    def show_vault(self):
        """Application supprim√©e"""
        QtWidgets.QMessageBox.information(self, "üö´ Application Supprim√©e", "Cette application a √©t√© supprim√©e de Ragnar OS 26.3.0")
        d = GlassDialog("üîê Coffre-fort Num√©rique", (900, 650), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Coffre-fort Num√©rique", "Stockage ultra-s√©curis√© de vos donn√©es sensibles")
        lay.addWidget(header)
        
        # Onglets du coffre-fort
        vault_tabs = QtWidgets.QTabWidget()
        
        # === ONGLET FICHIERS S√âCURIS√âS ===
        files_tab = QtWidgets.QWidget()
        files_layout = QtWidgets.QVBoxLayout(files_tab)
        
        # Statut du coffre
        status_card = QtWidgets.QWidget(objectName="GlassCard")
        status_layout = QtWidgets.QVBoxLayout(status_card)
        status_layout.setContentsMargins(16, 16, 16, 16)
        
        status_title = QtWidgets.QLabel("üîê Statut du Coffre-fort")
        status_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        status_layout.addWidget(status_title)
        
        vault_status = [
            "üîí Statut : VERROUILL√â",
            "üîë Chiffrement : AES-256",
            "üìÅ Fichiers stock√©s : 47",
            "üíæ Espace utilis√© : 2.3 GB / 10 GB",
            "üïí Derni√®re sauvegarde : Il y a 1 heure",
            "üõ°Ô∏è Tentatives d'acc√®s : 0 √©checs"
        ]
        
        for status in vault_status:
            status_label = QtWidgets.QLabel(status)
            status_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 255, 136, 0.5);")
            status_layout.addWidget(status_label)
        
        files_layout.addWidget(status_card)
        
        # Liste des fichiers s√©curis√©s
        files_card = QtWidgets.QWidget(objectName="GlassCard")
        files_card_layout = QtWidgets.QVBoxLayout(files_card)
        files_card_layout.setContentsMargins(16, 16, 16, 16)
        
        files_title = QtWidgets.QLabel("üìÅ Fichiers S√©curis√©s")
        files_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        files_card_layout.addWidget(files_title)
        
        secure_files_list = QtWidgets.QListWidget()
        secure_files = [
            "üîê documents_confidentiels.pdf (2.1 MB)",
            "üîë cl√©s_priv√©es.key (0.5 KB)",
            "üí≥ informations_bancaires.xlsx (45 KB)",
            "üìã mots_de_passe.txt (1.2 KB)",
            "üì∏ photos_personnelles.zip (156 MB)",
            "üìÑ contrats_importants.docx (890 KB)",
            "üí∞ d√©clarations_fiscales.pdf (3.4 MB)",
            "üè† papiers_maison.zip (12 MB)"
        ]
        
        for file_item in secure_files:
            secure_files_list.addItem(file_item)
        
        files_card_layout.addWidget(secure_files_list)
        
        # Actions sur fichiers
        file_actions = QtWidgets.QHBoxLayout()
        add_file_btn = QtWidgets.QPushButton("‚ûï Ajouter Fichier")
        decrypt_btn = QtWidgets.QPushButton("üîì D√©crypter")
        delete_file_btn = QtWidgets.QPushButton("üóëÔ∏è Supprimer")
        
        add_file_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ûï", "Ajouter un fichier !\n\nüìÅ S√©lectionnez le fichier √† s√©curiser\nüîê Chiffrement automatique AES-256\nüíæ Sauvegarde dans le coffre\n\n‚ö†Ô∏è Le fichier original sera supprim√©"))
        decrypt_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîì", "D√©cryptage en cours !\n\nüîë Authentification requise\nüîì Fichier d√©crypt√© temporairement\nüìç Emplacement : Bureau/Temp/\n\n‚è±Ô∏è Auto-suppression dans 1 heure"))
        delete_file_btn.clicked.connect(lambda: QtWidgets.QMessageBox.warning(d, "üóëÔ∏è", "Suppression s√©curis√©e !\n\n‚ö†Ô∏è Action irr√©versible !\nüîí Fichier supprim√© d√©finitivement\nüóëÔ∏è Suppression s√©curis√©e (7 passes)\n\n‚úÖ Espace lib√©r√© dans le coffre"))
        
        file_actions.addWidget(add_file_btn)
        file_actions.addWidget(decrypt_btn)
        file_actions.addWidget(delete_file_btn)
        file_actions.addStretch()
        
        files_card_layout.addLayout(file_actions)
        files_layout.addWidget(files_card)
        vault_tabs.addTab(files_tab, "üìÅ Fichiers")
        
        # === ONGLET MOTS DE PASSE ===
        passwords_tab = QtWidgets.QWidget()
        passwords_layout = QtWidgets.QVBoxLayout(passwords_tab)
        
        passwords_card = QtWidgets.QWidget(objectName="GlassCard")
        passwords_card_layout = QtWidgets.QVBoxLayout(passwords_card)
        passwords_card_layout.setContentsMargins(16, 16, 16, 16)
        
        passwords_title = QtWidgets.QLabel("üîë Coffre √† Mots de Passe")
        passwords_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        passwords_card_layout.addWidget(passwords_title)
        
        passwords_list = QtWidgets.QListWidget()
        password_entries = [
            "üåê Google - user@gmail.com",
            "üíº Travail - admin@entreprise.com",
            "üè¶ Banque - ****1234",
            "üì± Facebook - mon.profil",
            "üõçÔ∏è Amazon - acheteur2024",
            "üéÆ Steam - gamer_pro",
            "üìß Outlook - professionnel@outlook.com",
            "‚òÅÔ∏è Dropbox - stockage_cloud"
        ]
        
        for password_entry in password_entries:
            passwords_list.addItem(password_entry)
        
        passwords_card_layout.addWidget(passwords_list)
        
        # Actions mots de passe
        password_actions = QtWidgets.QHBoxLayout()
        add_password_btn = QtWidgets.QPushButton("‚ûï Nouveau")
        show_password_btn = QtWidgets.QPushButton("üëÅÔ∏è Afficher")
        copy_password_btn = QtWidgets.QPushButton("üìã Copier")
        generate_btn = QtWidgets.QPushButton("üé≤ G√©n√©rer")
        
        add_password_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ûï", "Nouveau mot de passe !\n\nüåê Site/Service :\nüë§ Nom d'utilisateur :\nüîë Mot de passe :\nüìù Notes :\n\nüîê Chiffrement automatique"))
        show_password_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üëÅÔ∏è", "Mot de passe r√©v√©l√© !\n\nüîë Mot de passe : SuperSecure123!\n\n‚ö†Ô∏è Masqu√© automatiquement dans 30s\nüìã Copi√© dans le presse-papiers"))
        copy_password_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìã", "Copi√© !\n\nüìã Mot de passe copi√©\n‚è±Ô∏è Presse-papiers vid√© dans 60s\nüîí S√©curit√© pr√©serv√©e"))
        generate_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üé≤", "Mot de passe g√©n√©r√© !\n\nüîë Nouveau mot de passe :\nK9#mP2$vL8@nQ5!\n\n‚úÖ 16 caract√®res\nüîí Tr√®s s√©curis√©\nüìã Copi√© automatiquement"))
        
        password_actions.addWidget(add_password_btn)
        password_actions.addWidget(show_password_btn)
        password_actions.addWidget(copy_password_btn)
        password_actions.addWidget(generate_btn)
        password_actions.addStretch()
        
        passwords_card_layout.addLayout(password_actions)
        passwords_layout.addWidget(passwords_card)
        vault_tabs.addTab(passwords_tab, "üîë Mots de passe")
        
        # === ONGLET PARAM√àTRES ===
        settings_tab = QtWidgets.QWidget()
        settings_layout = QtWidgets.QVBoxLayout(settings_tab)
        
        security_card = QtWidgets.QWidget(objectName="GlassCard")
        security_layout = QtWidgets.QVBoxLayout(security_card)
        security_layout.setContentsMargins(16, 16, 16, 16)
        
        security_title = QtWidgets.QLabel("üõ°Ô∏è Param√®tres de S√©curit√©")
        security_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        security_layout.addWidget(security_title)
        
        # Options de s√©curit√©
        auto_lock_cb = QtWidgets.QCheckBox("üîí Verrouillage automatique (5 min d'inactivit√©)")
        auto_lock_cb.setChecked(True)
        biometric_cb = QtWidgets.QCheckBox("üëÜ Authentification biom√©trique")
        biometric_cb.setChecked(False)
        backup_cb = QtWidgets.QCheckBox("‚òÅÔ∏è Sauvegarde automatique (cloud)")
        backup_cb.setChecked(True)
        two_factor_cb = QtWidgets.QCheckBox("üì± Authentification √† deux facteurs")
        two_factor_cb.setChecked(True)
        
        security_layout.addWidget(auto_lock_cb)
        security_layout.addWidget(biometric_cb)
        security_layout.addWidget(backup_cb)
        security_layout.addWidget(two_factor_cb)
        
        # Niveau de chiffrement
        encryption_layout = QtWidgets.QHBoxLayout()
        encryption_layout.addWidget(QtWidgets.QLabel("Chiffrement :"))
        encryption_combo = QtWidgets.QComboBox()
        encryption_combo.addItems(["AES-128", "AES-256", "AES-512 (Exp√©rimental)"])
        encryption_combo.setCurrentText("AES-256")
        encryption_layout.addWidget(encryption_combo)
        encryption_layout.addStretch()
        
        security_layout.addLayout(encryption_layout)
        settings_layout.addWidget(security_card)
        vault_tabs.addTab(settings_tab, "‚öôÔ∏è S√©curit√©")
        
        lay.addWidget(vault_tabs)
        
        # Contr√¥les principaux
        main_controls = QtWidgets.QHBoxLayout()
        
        unlock_btn = QtWidgets.QPushButton("üîì D√©verrouiller")
        unlock_btn.setStyleSheet("QPushButton { background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 rgba(0, 255, 136, 0.3), stop:1 rgba(0, 255, 136, 0.1)); }")
        
        lock_btn = QtWidgets.QPushButton("üîí Verrouiller")
        backup_btn = QtWidgets.QPushButton("üíæ Sauvegarder")
        emergency_btn = QtWidgets.QPushButton("üö® Acc√®s d'Urgence")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        unlock_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîì", "Coffre d√©verrouill√© !\n\nüîë Authentification r√©ussie\nüîì Acc√®s complet autoris√©\n‚è±Ô∏è Session active : 30 minutes\nüõ°Ô∏è Surveillance activ√©e"))
        lock_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîí", "Coffre verrouill√© !\n\nüîí Acc√®s s√©curis√©\nüíæ Donn√©es chiffr√©es\nüõ°Ô∏è Protection active\n‚úÖ Coffre s√©curis√©"))
        backup_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üíæ", "Sauvegarde cr√©√©e !\n\n‚òÅÔ∏è Sauvegarde cloud : 100%\nüíæ Sauvegarde locale : 100%\nüîê Chiffrement : AES-256\n‚úÖ 47 fichiers sauvegard√©s"))
        emergency_btn.clicked.connect(lambda: QtWidgets.QMessageBox.warning(d, "üö®", "Acc√®s d'Urgence !\n\n‚ö†Ô∏è Proc√©dure d'urgence activ√©e\nüìß Code envoy√© par email\nüì± SMS de confirmation\nüîë Acc√®s temporaire (1 heure)"))
        close_btn.clicked.connect(d.close)
        
        main_controls.addWidget(unlock_btn)
        main_controls.addWidget(lock_btn)
        main_controls.addWidget(backup_btn)
        main_controls.addWidget(emergency_btn)
        main_controls.addStretch()
        main_controls.addWidget(close_btn)
        
        lay.addLayout(main_controls)
        
        d.show()
        fade_in(d, 600)
    
    def show_vpn_manager(self):
        """Application supprim√©e"""
        QtWidgets.QMessageBox.information(self, "üö´ Application Supprim√©e", "Cette application a √©t√© supprim√©e de Ragnar OS 26.3.0")
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("VPN Manager", "Connexion s√©curis√©e et anonyme")
        lay.addWidget(header)
        
        # Statut de connexion
        status_card = QtWidgets.QWidget(objectName="GlassCard")
        status_layout = QtWidgets.QVBoxLayout(status_card)
        status_layout.setContentsMargins(16, 16, 16, 16)
        
        status_title = QtWidgets.QLabel("üîí Statut de Connexion")
        status_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        status_layout.addWidget(status_title)
        
        # Informations de connexion
        connection_info = [
            "üî¥ Statut : D√©connect√©",
            "üåç IP Publique : 192.168.1.100 (France)",
            "üõ°Ô∏è Protection : NON ACTIVE",
            "‚ö° Vitesse : Normale",
            "üìä Donn√©es transf√©r√©es : 0 MB",
            "‚è±Ô∏è Temps de connexion : 00:00:00"
        ]
        
        for info in connection_info:
            info_label = QtWidgets.QLabel(info)
            color = "rgba(255, 102, 102, 0.5)" if "D√©connect√©" in info or "NON ACTIVE" in info else "rgba(0, 255, 136, 0.5)"
            info_label.setStyleSheet(f"color: white; font-size: 12px; padding: 4px; border-left: 3px solid {color};")
            status_layout.addWidget(info_label)
        
        lay.addWidget(status_card)
        
        # S√©lection de serveur
        server_card = QtWidgets.QWidget(objectName="GlassCard")
        server_layout = QtWidgets.QVBoxLayout(server_card)
        server_layout.setContentsMargins(16, 16, 16, 16)
        
        server_title = QtWidgets.QLabel("üåç Serveurs Disponibles")
        server_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        server_layout.addWidget(server_title)
        
        server_list = QtWidgets.QListWidget()
        servers = [
            "üá∫üá∏ √âtats-Unis - New York (23ms) ‚ö°‚ö°‚ö°",
            "üá¨üáß Royaume-Uni - Londres (45ms) ‚ö°‚ö°‚ö°",
            "üá©üá™ Allemagne - Berlin (67ms) ‚ö°‚ö°",
            "üáØüáµ Japon - Tokyo (156ms) ‚ö°‚ö°",
            "üá®üá¶ Canada - Toronto (89ms) ‚ö°‚ö°‚ö°",
            "üá¶üá∫ Australie - Sydney (234ms) ‚ö°",
            "üá≥üá± Pays-Bas - Amsterdam (34ms) ‚ö°‚ö°‚ö°",
            "üá∏üá¨ Singapour (178ms) ‚ö°‚ö°",
            "üá®üá≠ Suisse - Zurich (56ms) ‚ö°‚ö°‚ö°",
            "üá∏üá™ Su√®de - Stockholm (78ms) ‚ö°‚ö°"
        ]
        
        for server in servers:
            server_list.addItem(server)
        
        server_layout.addWidget(server_list)
        lay.addWidget(server_card)
        
        # Protocoles et options
        options_card = QtWidgets.QWidget(objectName="GlassCard")
        options_layout = QtWidgets.QVBoxLayout(options_card)
        options_layout.setContentsMargins(16, 16, 16, 16)
        
        options_title = QtWidgets.QLabel("‚öôÔ∏è Configuration")
        options_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        options_layout.addWidget(options_title)
        
        # Protocoles
        protocol_layout = QtWidgets.QHBoxLayout()
        protocol_layout.addWidget(QtWidgets.QLabel("Protocole :"))
        protocol_combo = QtWidgets.QComboBox()
        protocol_combo.addItems(["OpenVPN", "WireGuard", "IKEv2", "L2TP/IPSec"])
        protocol_combo.setCurrentText("WireGuard")
        protocol_layout.addWidget(protocol_combo)
        protocol_layout.addStretch()
        options_layout.addLayout(protocol_layout)
        
        # Options avanc√©es
        auto_connect_cb = QtWidgets.QCheckBox("üîÑ Connexion automatique au d√©marrage")
        kill_switch_cb = QtWidgets.QCheckBox("üõ°Ô∏è Kill Switch (couper Internet si VPN d√©connect√©)")
        kill_switch_cb.setChecked(True)
        dns_leak_cb = QtWidgets.QCheckBox("üîí Protection contre les fuites DNS")
        dns_leak_cb.setChecked(True)
        
        options_layout.addWidget(auto_connect_cb)
        options_layout.addWidget(kill_switch_cb)
        options_layout.addWidget(dns_leak_cb)
        
        lay.addWidget(options_card)
        
        # Boutons de contr√¥le
        control_layout = QtWidgets.QHBoxLayout()
        
        connect_btn = QtWidgets.QPushButton("üîó Se Connecter")
        connect_btn.setStyleSheet("QPushButton { background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 rgba(0, 255, 136, 0.3), stop:1 rgba(0, 255, 136, 0.1)); }")
        
        disconnect_btn = QtWidgets.QPushButton("üî¥ D√©connecter")
        quick_connect_btn = QtWidgets.QPushButton("‚ö° Connexion Rapide")
        settings_btn = QtWidgets.QPushButton("‚öôÔ∏è Param√®tres")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        connect_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîó", "Connexion VPN !\n\nüîí Connexion s√©curis√©e √©tablie\nüåç Serveur : √âtats-Unis - New York\n‚ö° Vitesse : 85 Mbps\nüõ°Ô∏è IP masqu√©e avec succ√®s"))
        disconnect_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üî¥", "D√©connexion VPN !\n\n‚ùå Connexion ferm√©e\nüåç IP r√©elle restaur√©e\n‚ö†Ô∏è Vous n'√™tes plus prot√©g√©"))
        quick_connect_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ö°", "Connexion Rapide !\n\nüöÄ Connexion au serveur le plus rapide\nüá¨üáß Londres s√©lectionn√© (34ms)\n‚úÖ Connect√© en 2.3 secondes"))
        settings_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚öôÔ∏è", "Param√®tres VPN !\n\nüîß Options disponibles :\n‚Ä¢ Protocoles de s√©curit√©\n‚Ä¢ Serveurs favoris\n‚Ä¢ Notifications\n‚Ä¢ D√©marrage automatique"))
        close_btn.clicked.connect(d.close)
        
        control_layout.addWidget(connect_btn)
        control_layout.addWidget(disconnect_btn)
        control_layout.addWidget(quick_connect_btn)
        control_layout.addWidget(settings_btn)
        control_layout.addStretch()
        control_layout.addWidget(close_btn)
        
        lay.addLayout(control_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_network_analyzer(self):
        """Application supprim√©e"""
        QtWidgets.QMessageBox.information(self, "üö´ Application Supprim√©e", "Cette application a √©t√© supprim√©e de Ragnar OS 26.3.0")
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Analyseur R√©seau Ragnar", "Diagnostic et monitoring r√©seau avanc√©")
        lay.addWidget(header)
        
        # Onglets de l'analyseur
        analyzer_tabs = QtWidgets.QTabWidget()
        
        # === ONGLET DIAGNOSTIC ===
        diagnostic_tab = QtWidgets.QWidget()
        diagnostic_layout = QtWidgets.QVBoxLayout(diagnostic_tab)
        
        # Statut r√©seau
        network_status_card = QtWidgets.QWidget(objectName="GlassCard")
        network_status_layout = QtWidgets.QVBoxLayout(network_status_card)
        network_status_layout.setContentsMargins(16, 16, 16, 16)
        
        network_status_title = QtWidgets.QLabel("üåê Statut R√©seau")
        network_status_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        network_status_layout.addWidget(network_status_title)
        
        network_info = [
            "üîó Connexion : ACTIVE (Ethernet)",
            "üì° IP Locale : 192.168.1.100",
            "üåç IP Publique : 203.0.113.45",
            "üö™ Passerelle : 192.168.1.1",
            "üîç DNS : 8.8.8.8, 1.1.1.1",
            "‚ö° Vitesse : 100 Mbps / 20 Mbps"
        ]
        
        for info in network_info:
            info_label = QtWidgets.QLabel(info)
            info_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 255, 136, 0.5);")
            network_status_layout.addWidget(info_label)
        
        diagnostic_layout.addWidget(network_status_card)
        
        # Tests de diagnostic
        diagnostic_tests_card = QtWidgets.QWidget(objectName="GlassCard")
        diagnostic_tests_layout = QtWidgets.QVBoxLayout(diagnostic_tests_card)
        diagnostic_tests_layout.setContentsMargins(16, 16, 16, 16)
        
        diagnostic_tests_title = QtWidgets.QLabel("üîß Tests de Diagnostic")
        diagnostic_tests_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        diagnostic_tests_layout.addWidget(diagnostic_tests_title)
        
        # Boutons de test
        tests_grid = QtWidgets.QGridLayout()
        
        ping_btn = QtWidgets.QPushButton("üì° Test Ping")
        traceroute_btn = QtWidgets.QPushButton("üó∫Ô∏è Traceroute")
        speed_btn = QtWidgets.QPushButton("‚ö° Test Vitesse")
        dns_btn = QtWidgets.QPushButton("üîç Test DNS")
        port_btn = QtWidgets.QPushButton("üö™ Scan Ports")
        bandwidth_btn = QtWidgets.QPushButton("üìä Bande Passante")
        
        ping_btn.clicked.connect(lambda: self.run_network_test("ping"))
        traceroute_btn.clicked.connect(lambda: self.run_network_test("traceroute"))
        speed_btn.clicked.connect(lambda: self.run_network_test("speed"))
        dns_btn.clicked.connect(lambda: self.run_network_test("dns"))
        port_btn.clicked.connect(lambda: self.run_network_test("port"))
        bandwidth_btn.clicked.connect(lambda: self.run_network_test("bandwidth"))
        
        tests_grid.addWidget(ping_btn, 0, 0)
        tests_grid.addWidget(traceroute_btn, 0, 1)
        tests_grid.addWidget(speed_btn, 0, 2)
        tests_grid.addWidget(dns_btn, 1, 0)
        tests_grid.addWidget(port_btn, 1, 1)
        tests_grid.addWidget(bandwidth_btn, 1, 2)
        
        diagnostic_tests_layout.addLayout(tests_grid)
        diagnostic_layout.addWidget(diagnostic_tests_card)
        analyzer_tabs.addTab(diagnostic_tab, "üîß Diagnostic")
        
        # === ONGLET MONITORING ===
        monitoring_tab = QtWidgets.QWidget()
        monitoring_layout = QtWidgets.QVBoxLayout(monitoring_tab)
        
        # Trafic en temps r√©el
        traffic_card = QtWidgets.QWidget(objectName="GlassCard")
        traffic_layout = QtWidgets.QVBoxLayout(traffic_card)
        traffic_layout.setContentsMargins(16, 16, 16, 16)
        
        traffic_title = QtWidgets.QLabel("üìà Trafic R√©seau en Temps R√©el")
        traffic_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        traffic_layout.addWidget(traffic_title)
        
        traffic_stats = [
            "‚¨áÔ∏è T√©l√©chargement : 2.3 MB/s (Peak: 5.1 MB/s)",
            "‚¨ÜÔ∏è Upload : 0.8 MB/s (Peak: 1.2 MB/s)",
            "üìä Paquets/sec : 1,247 entrants, 892 sortants",
            "üîÑ Connexions actives : 47",
            "üì° Utilisation bande passante : 23%",
            "‚ö†Ô∏è Erreurs r√©seau : 0.02%"
        ]
        
        for stat in traffic_stats:
            stat_label = QtWidgets.QLabel(stat)
            stat_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(255, 170, 0, 0.5);")
            traffic_layout.addWidget(stat_label)
        
        monitoring_layout.addWidget(traffic_card)
        
        # Connexions actives
        connections_card = QtWidgets.QWidget(objectName="GlassCard")
        connections_layout = QtWidgets.QVBoxLayout(connections_card)
        connections_layout.setContentsMargins(16, 16, 16, 16)
        
        connections_title = QtWidgets.QLabel("üîó Connexions Actives")
        connections_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        connections_layout.addWidget(connections_title)
        
        connections_list = QtWidgets.QListWidget()
        active_connections = [
            "üåê google.com:443 (HTTPS) - 2.1 MB/s",
            "üìß outlook.com:993 (IMAP) - 0.3 MB/s",
            "üéµ spotify.com:443 (HTTPS) - 1.8 MB/s",
            "‚òÅÔ∏è dropbox.com:443 (HTTPS) - 0.5 MB/s",
            "üéÆ steam.com:27015 (Gaming) - 0.1 MB/s",
            "üì∫ netflix.com:443 (HTTPS) - 4.2 MB/s",
            "üí¨ discord.com:443 (HTTPS) - 0.2 MB/s",
            "üîÑ github.com:443 (HTTPS) - 0.1 MB/s"
        ]
        
        for connection in active_connections:
            connections_list.addItem(connection)
        
        connections_layout.addWidget(connections_list)
        monitoring_layout.addWidget(connections_card)
        analyzer_tabs.addTab(monitoring_tab, "üìä Monitoring")
        
        # === ONGLET OUTILS ===
        tools_tab = QtWidgets.QWidget()
        tools_layout = QtWidgets.QVBoxLayout(tools_tab)
        
        # Outils r√©seau
        network_tools_card = QtWidgets.QWidget(objectName="GlassCard")
        network_tools_layout = QtWidgets.QVBoxLayout(network_tools_card)
        network_tools_layout.setContentsMargins(16, 16, 16, 16)
        
        network_tools_title = QtWidgets.QLabel("üõ†Ô∏è Outils R√©seau Avanc√©s")
        network_tools_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        network_tools_layout.addWidget(network_tools_title)
        
        # Grille d'outils
        tools_grid = QtWidgets.QGridLayout()
        
        whois_btn = QtWidgets.QPushButton("üîç Whois")
        nslookup_btn = QtWidgets.QPushButton("üìã NSLookup")
        netstat_btn = QtWidgets.QPushButton("üìä Netstat")
        arp_btn = QtWidgets.QPushButton("üó∫Ô∏è Table ARP")
        route_btn = QtWidgets.QPushButton("üõ§Ô∏è Table Routage")
        wifi_btn = QtWidgets.QPushButton("üì° Analyse WiFi")
        
        whois_btn.clicked.connect(lambda: self.run_network_tool("whois"))
        nslookup_btn.clicked.connect(lambda: self.run_network_tool("nslookup"))
        netstat_btn.clicked.connect(lambda: self.run_network_tool("netstat"))
        arp_btn.clicked.connect(lambda: self.run_network_tool("arp"))
        route_btn.clicked.connect(lambda: self.run_network_tool("route"))
        wifi_btn.clicked.connect(lambda: self.run_network_tool("wifi"))
        
        tools_grid.addWidget(whois_btn, 0, 0)
        tools_grid.addWidget(nslookup_btn, 0, 1)
        tools_grid.addWidget(netstat_btn, 0, 2)
        tools_grid.addWidget(arp_btn, 1, 0)
        tools_grid.addWidget(route_btn, 1, 1)
        tools_grid.addWidget(wifi_btn, 1, 2)
        
        network_tools_layout.addLayout(tools_grid)
        tools_layout.addWidget(network_tools_card)
        
        # Optimisation r√©seau
        optimization_card = QtWidgets.QWidget(objectName="GlassCard")
        optimization_layout = QtWidgets.QVBoxLayout(optimization_card)
        optimization_layout.setContentsMargins(16, 16, 16, 16)
        
        optimization_title = QtWidgets.QLabel("‚ö° Optimisation R√©seau")
        optimization_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        optimization_layout.addWidget(optimization_title)
        
        # Options d'optimisation
        optimize_dns_cb = QtWidgets.QCheckBox("üîç Optimiser DNS (Cloudflare/Google)")
        optimize_dns_cb.setChecked(True)
        flush_dns_cb = QtWidgets.QCheckBox("üóëÔ∏è Vider cache DNS")
        tcp_optimization_cb = QtWidgets.QCheckBox("‚ö° Optimisation TCP/IP")
        bandwidth_limit_cb = QtWidgets.QCheckBox("üìä Limitation bande passante")
        
        optimization_layout.addWidget(optimize_dns_cb)
        optimization_layout.addWidget(flush_dns_cb)
        optimization_layout.addWidget(tcp_optimization_cb)
        optimization_layout.addWidget(bandwidth_limit_cb)
        
        # Boutons d'optimisation
        opt_actions = QtWidgets.QHBoxLayout()
        optimize_btn = QtWidgets.QPushButton("‚ö° Optimiser Maintenant")
        reset_btn = QtWidgets.QPushButton("üîÑ R√©initialiser")
        
        optimize_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ö°", "Optimisation r√©seau !\n\n‚ö° Optimisations appliqu√©es :\n‚Ä¢ DNS configur√© (1.1.1.1)\n‚Ä¢ Cache DNS vid√©\n‚Ä¢ TCP/IP optimis√©\n‚Ä¢ Bande passante ajust√©e\n\n‚úÖ Performance am√©lior√©e de 15%"))
        reset_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîÑ", "Configuration r√©initialis√©e !\n\nüîÑ Param√®tres par d√©faut restaur√©s\nüåê DNS automatique\nüìä Limites supprim√©es\n‚úÖ Configuration standard"))
        
        opt_actions.addWidget(optimize_btn)
        opt_actions.addWidget(reset_btn)
        opt_actions.addStretch()
        
        optimization_layout.addLayout(opt_actions)
        tools_layout.addWidget(optimization_card)
        analyzer_tabs.addTab(tools_tab, "üõ†Ô∏è Outils")
        
        lay.addWidget(analyzer_tabs)
        
        # Contr√¥les principaux
        main_controls = QtWidgets.QHBoxLayout()
        
        start_monitoring_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è D√©marrer Monitoring")
        start_monitoring_btn.setStyleSheet("QPushButton { background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 rgba(0, 255, 136, 0.3), stop:1 rgba(0, 255, 136, 0.1)); }")
        
        stop_monitoring_btn = QtWidgets.QPushButton("‚è∏Ô∏è Arr√™ter")
        export_report_btn = QtWidgets.QPushButton("üì§ Exporter Rapport")
        settings_btn = QtWidgets.QPushButton("‚öôÔ∏è Param√®tres")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        start_monitoring_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ñ∂Ô∏è", "Monitoring d√©marr√© !\n\nüìä Surveillance r√©seau active\nüìà Collecte des statistiques\nüîç Analyse du trafic\n‚è±Ô∏è Mise √† jour : temps r√©el"))
        stop_monitoring_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚è∏Ô∏è", "Monitoring arr√™t√© !\n\n‚è∏Ô∏è Surveillance interrompue\nüíæ Donn√©es sauvegard√©es\nüìä Statistiques conserv√©es\nüîÑ Red√©marrage disponible"))
        export_report_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üì§", "Rapport export√© !\n\nüìÅ Fichier : network_report_2024.pdf\nüìä Donn√©es incluses :\n‚Ä¢ Statistiques de trafic\n‚Ä¢ Tests de diagnostic\n‚Ä¢ Connexions actives\n‚Ä¢ Recommandations"))
        settings_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚öôÔ∏è", "Param√®tres Analyseur !\n\n‚öôÔ∏è Configuration :\n‚Ä¢ Intervalles de monitoring\n‚Ä¢ Seuils d'alerte\n‚Ä¢ Notifications\n‚Ä¢ Formats d'export\n‚Ä¢ Filtres de trafic"))
        close_btn.clicked.connect(d.close)
        
        main_controls.addWidget(start_monitoring_btn)
        main_controls.addWidget(stop_monitoring_btn)
        main_controls.addWidget(export_report_btn)
        main_controls.addWidget(settings_btn)
        main_controls.addStretch()
        main_controls.addWidget(close_btn)
        
        lay.addLayout(main_controls)
        
        d.show()
        fade_in(d, 800)
    
    def run_network_test(self, test_type):
        """Ex√©cute un test r√©seau sp√©cifique"""
        if test_type == "ping":
            QtWidgets.QMessageBox.information(
                self, "üì° Test Ping", 
                "Test Ping vers Google !\n\nüì° R√©sultats :\n‚Ä¢ google.com (142.250.185.14)\n‚Ä¢ Temps : 23ms, 25ms, 22ms, 24ms\n‚Ä¢ Perte : 0% (4/4 paquets)\n‚Ä¢ Moyenne : 23.5ms\n\n‚úÖ Connexion excellente"
            )
        elif test_type == "traceroute":
            QtWidgets.QMessageBox.information(
                self, "üó∫Ô∏è Traceroute", 
                "Traceroute vers google.com !\n\nüó∫Ô∏è Chemin r√©seau :\n1. 192.168.1.1 (2ms) - Routeur local\n2. 10.0.0.1 (12ms) - FAI\n3. 203.0.113.1 (18ms) - Backbone\n4. 142.250.185.14 (23ms) - Google\n\n‚úÖ 4 sauts, 23ms total"
            )
        elif test_type == "speed":
            QtWidgets.QMessageBox.information(
                self, "‚ö° Test Vitesse", 
                "Test de vitesse Internet !\n\n‚ö° R√©sultats :\n‚¨áÔ∏è T√©l√©chargement : 95.7 Mbps\n‚¨ÜÔ∏è Upload : 18.3 Mbps\nüì° Ping : 23ms\nüéØ Serveur : Paris, France\n\n‚úÖ Vitesse excellente"
            )
        elif test_type == "dns":
            QtWidgets.QMessageBox.information(
                self, "üîç Test DNS", 
                "Test de r√©solution DNS !\n\nüîç R√©sultats :\n‚Ä¢ google.com ‚Üí 142.250.185.14 (15ms)\n‚Ä¢ facebook.com ‚Üí 157.240.15.35 (18ms)\n‚Ä¢ github.com ‚Üí 140.82.114.4 (22ms)\n‚Ä¢ DNS utilis√© : 8.8.8.8\n\n‚úÖ R√©solution rapide"
            )
        elif test_type == "port":
            QtWidgets.QMessageBox.information(
                self, "üö™ Scan Ports", 
                "Scan des ports ouverts !\n\nüö™ Ports d√©tect√©s :\n‚Ä¢ 22 (SSH) - Ferm√©\n‚Ä¢ 80 (HTTP) - Ouvert\n‚Ä¢ 443 (HTTPS) - Ouvert\n‚Ä¢ 25 (SMTP) - Filtr√©\n‚Ä¢ 993 (IMAP) - Ouvert\n\n‚úÖ Configuration s√©curis√©e"
            )
        elif test_type == "bandwidth":
            QtWidgets.QMessageBox.information(
                self, "üìä Bande Passante", 
                "Analyse bande passante !\n\nüìä Utilisation :\n‚Ä¢ Actuelle : 23.4 Mbps / 100 Mbps\n‚Ä¢ Peak aujourd'hui : 87.2 Mbps\n‚Ä¢ Moyenne 7 jours : 34.1 Mbps\n‚Ä¢ Applications top : Netflix, Spotify\n\n‚úÖ Utilisation normale"
            )
    
    def run_network_tool(self, tool_type):
        """Ex√©cute un outil r√©seau sp√©cifique"""
        if tool_type == "whois":
            QtWidgets.QMessageBox.information(
                self, "üîç Whois", 
                "Informations Whois !\n\nüîç google.com :\n‚Ä¢ Propri√©taire : Google LLC\n‚Ä¢ Registrar : MarkMonitor Inc.\n‚Ä¢ Cr√©ation : 1997-09-15\n‚Ä¢ Expiration : 2028-09-14\n‚Ä¢ Serveurs DNS : ns1.google.com\n\n‚úÖ Domaine l√©gitime"
            )
        elif tool_type == "nslookup":
            QtWidgets.QMessageBox.information(
                self, "üìã NSLookup", 
                "R√©solution DNS d√©taill√©e !\n\nüìã R√©sultats :\n‚Ä¢ A : 142.250.185.14\n‚Ä¢ AAAA : 2a00:1450:4007:80c::200e\n‚Ä¢ MX : smtp.google.com (10)\n‚Ä¢ NS : ns1.google.com\n‚Ä¢ TXT : v=spf1 include:_spf.google.com\n\n‚úÖ Enregistrements valides"
            )
        elif tool_type == "netstat":
            QtWidgets.QMessageBox.information(
                self, "üìä Netstat", 
                "Connexions r√©seau actives !\n\nüìä Statistiques :\n‚Ä¢ TCP : 47 connexions √©tablies\n‚Ä¢ UDP : 12 sockets ouverts\n‚Ä¢ √âcoute : 8 ports\n‚Ä¢ Ferm√©es : 234 connexions\n‚Ä¢ Erreurs : 0\n\n‚úÖ √âtat r√©seau normal"
            )
        elif tool_type == "arp":
            QtWidgets.QMessageBox.information(
                self, "üó∫Ô∏è Table ARP", 
                "Table ARP locale !\n\nüó∫Ô∏è Entr√©es :\n‚Ä¢ 192.168.1.1 ‚Üí aa:bb:cc:dd:ee:ff (Routeur)\n‚Ä¢ 192.168.1.50 ‚Üí 11:22:33:44:55:66 (PC-Bureau)\n‚Ä¢ 192.168.1.75 ‚Üí 77:88:99:aa:bb:cc (Smartphone)\n‚Ä¢ 192.168.1.100 ‚Üí ff:ee:dd:cc:bb:aa (Laptop)\n\n‚úÖ 4 appareils d√©tect√©s"
            )
        elif tool_type == "route":
            QtWidgets.QMessageBox.information(
                self, "üõ§Ô∏è Table Routage", 
                "Table de routage !\n\nüõ§Ô∏è Routes :\n‚Ä¢ 0.0.0.0/0 ‚Üí 192.168.1.1 (D√©faut)\n‚Ä¢ 192.168.1.0/24 ‚Üí Interface locale\n‚Ä¢ 127.0.0.0/8 ‚Üí Loopback\n‚Ä¢ 224.0.0.0/4 ‚Üí Multicast\n\n‚úÖ Routage configur√©"
            )
        elif tool_type == "wifi":
            QtWidgets.QMessageBox.information(
                self, "üì° Analyse WiFi", 
                "R√©seaux WiFi d√©tect√©s !\n\nüì° R√©seaux :\n‚Ä¢ MonWiFi (WPA2) - Signal: -45dBm ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê\n‚Ä¢ Voisin_WiFi (WPA2) - Signal: -67dBm ‚≠ê‚≠ê‚≠ê\n‚Ä¢ FreeWiFi (Ouvert) - Signal: -78dBm ‚≠ê‚≠ê\n‚Ä¢ Box_1234 (WPA3) - Signal: -82dBm ‚≠ê\n\n‚úÖ 4 r√©seaux disponibles"
            )
    
    def show_ad_blocker(self):
        """Application supprim√©e"""
        QtWidgets.QMessageBox.information(self, "üö´ Application Supprim√©e", "Cette application a √©t√© supprim√©e de Ragnar OS 26.3.0")
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Bloqueur de Publicit√©s", "Protection contre les pubs et trackers")
        lay.addWidget(header)
        
        # Statut du bloqueur
        status_card = QtWidgets.QWidget(objectName="GlassCard")
        status_layout = QtWidgets.QVBoxLayout(status_card)
        status_layout.setContentsMargins(16, 16, 16, 16)
        
        status_title = QtWidgets.QLabel("üõ°Ô∏è Statut de Protection")
        status_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        status_layout.addWidget(status_title)
        
        # Statistiques
        stats_info = [
            "‚úÖ Bloqueur activ√© : OUI",
            "üö´ Publicit√©s bloqu√©es aujourd'hui : 1,247",
            "üîç Trackers bloqu√©s : 89",
            "‚ö° Sites acc√©l√©r√©s : 23",
            "üíæ Donn√©es √©conomis√©es : 15.2 MB",
            "üîí Malware bloqu√© : 3 tentatives"
        ]
        
        for stat in stats_info:
            stat_label = QtWidgets.QLabel(stat)
            stat_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 255, 136, 0.5);")
            status_layout.addWidget(stat_label)
        
        lay.addWidget(status_card)
        
        # Configuration
        config_card = QtWidgets.QWidget(objectName="GlassCard")
        config_layout = QtWidgets.QVBoxLayout(config_card)
        config_layout.setContentsMargins(16, 16, 16, 16)
        
        config_title = QtWidgets.QLabel("‚öôÔ∏è Configuration")
        config_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        config_layout.addWidget(config_title)
        
        # Options de blocage
        block_ads_cb = QtWidgets.QCheckBox("üö´ Bloquer les publicit√©s")
        block_ads_cb.setChecked(True)
        block_trackers_cb = QtWidgets.QCheckBox("üîç Bloquer les trackers")
        block_trackers_cb.setChecked(True)
        block_malware_cb = QtWidgets.QCheckBox("üõ°Ô∏è Bloquer les malwares")
        block_malware_cb.setChecked(True)
        block_social_cb = QtWidgets.QCheckBox("üì± Bloquer widgets sociaux")
        block_social_cb.setChecked(False)
        
        config_layout.addWidget(block_ads_cb)
        config_layout.addWidget(block_trackers_cb)
        config_layout.addWidget(block_malware_cb)
        config_layout.addWidget(block_social_cb)
        
        lay.addWidget(config_card)
        
        # Listes de filtres
        filters_card = QtWidgets.QWidget(objectName="GlassCard")
        filters_layout = QtWidgets.QVBoxLayout(filters_card)
        filters_layout.setContentsMargins(16, 16, 16, 16)
        
        filters_title = QtWidgets.QLabel("üìã Listes de Filtres")
        filters_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        filters_layout.addWidget(filters_title)
        
        filter_list = QtWidgets.QListWidget()
        filters = [
            "‚úÖ EasyList (Publicit√©s g√©n√©rales)",
            "‚úÖ EasyPrivacy (Trackers)",
            "‚úÖ Malware Domains (S√©curit√©)",
            "‚úÖ Fanboy's Annoyances (Popups)",
            "‚ö™ Adblock Warning Removal",
            "‚ö™ Anti-Facebook (R√©seaux sociaux)"
        ]
        
        for filter_item in filters:
            filter_list.addItem(filter_item)
        
        filters_layout.addWidget(filter_list)
        lay.addWidget(filters_card)
        
        # Actions
        actions_layout = QtWidgets.QHBoxLayout()
        
        update_btn = QtWidgets.QPushButton("üîÑ Mettre √† jour les filtres")
        whitelist_btn = QtWidgets.QPushButton("üìù Liste blanche")
        stats_btn = QtWidgets.QPushButton("üìä Statistiques")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        update_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîÑ", "Filtres mis √† jour !\n\n‚Ä¢ 12,450 nouvelles entr√©es\n‚Ä¢ 3 domaines malveillants ajout√©s\n‚Ä¢ Performance optimis√©e"))
        whitelist_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìù", "Liste blanche !\n\nSites autoris√©s :\n‚Ä¢ google.com\n‚Ä¢ youtube.com\n‚Ä¢ github.com\n\nAjoutez des sites de confiance."))
        stats_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìä", "Statistiques d√©taill√©es !\n\nüìà Cette semaine :\n‚Ä¢ 8,934 pubs bloqu√©es\n‚Ä¢ 567 trackers stopp√©s\n‚Ä¢ 45.8 MB √©conomis√©s\n‚Ä¢ 12 malwares bloqu√©s"))
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(update_btn)
        actions_layout.addWidget(whitelist_btn)
        actions_layout.addWidget(stats_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_password_manager_pro(self):
        """Gestionnaire de mots de passe professionnel"""
        d = GlassDialog("üîê Gestionnaire de Mots de Passe Pro", (850, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Gestionnaire de Mots de Passe Pro", "S√©curit√© et gestion avanc√©e de vos identifiants")
        lay.addWidget(header)
        
        # Onglets du gestionnaire
        password_tabs = QtWidgets.QTabWidget()
        
        # === ONGLET COFFRE-FORT ===
        vault_tab = QtWidgets.QWidget()
        vault_layout = QtWidgets.QVBoxLayout(vault_tab)
        
        # Statut de s√©curit√©
        security_card = QtWidgets.QWidget(objectName="GlassCard")
        security_layout = QtWidgets.QVBoxLayout(security_card)
        security_layout.setContentsMargins(16, 16, 16, 16)
        
        security_title = QtWidgets.QLabel("üõ°Ô∏è Statut de S√©curit√©")
        security_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        security_layout.addWidget(security_title)
        
        security_stats = [
            "üîí Coffre-fort : VERROUILL√â",
            "üîë Mots de passe stock√©s : 127",
            "‚ö†Ô∏è Mots de passe faibles : 3",
            "üîÑ Derni√®re synchronisation : Il y a 5 min",
            "üõ°Ô∏è Chiffrement : AES-256",
            "üì± Authentification 2FA : ACTIVE"
        ]
        
        for stat in security_stats:
            stat_label = QtWidgets.QLabel(stat)
            stat_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 255, 136, 0.5);")
            security_layout.addWidget(stat_label)
        
        vault_layout.addWidget(security_card)
        
        # Liste des mots de passe
        passwords_card = QtWidgets.QWidget(objectName="GlassCard")
        passwords_layout = QtWidgets.QVBoxLayout(passwords_card)
        passwords_layout.setContentsMargins(16, 16, 16, 16)
        
        passwords_title = QtWidgets.QLabel("üîë Coffre √† Mots de Passe")
        passwords_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        passwords_layout.addWidget(passwords_title)
        
        passwords_list = QtWidgets.QListWidget()
        password_entries = [
            "üåê Google (user@gmail.com) - ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
            "üíº Entreprise (admin@work.com) - ‚≠ê‚≠ê‚≠ê‚≠ê‚ö™",
            "üè¶ Banque Cr√©dit (****1234) - ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
            "üì± Facebook (mon.profil) - ‚≠ê‚≠ê‚ö™‚ö™‚ö™",
            "üõçÔ∏è Amazon (acheteur2024) - ‚≠ê‚≠ê‚≠ê‚≠ê‚ö™",
            "üéÆ Steam (gamer_pro) - ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
            "üìß Outlook (pro@outlook.com) - ‚≠ê‚≠ê‚≠ê‚≠ê‚ö™",
            "‚òÅÔ∏è Dropbox (cloud_user) - ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
            "üéµ Spotify (music_lover) - ‚≠ê‚≠ê‚≠ê‚ö™‚ö™",
            "üì∫ Netflix (streaming) - ‚≠ê‚≠ê‚≠ê‚≠ê‚ö™"
        ]
        
        for entry in password_entries:
            passwords_list.addItem(entry)
        
        passwords_layout.addWidget(passwords_list)
        
        # Actions sur mots de passe
        password_actions = QtWidgets.QHBoxLayout()
        add_btn = QtWidgets.QPushButton("‚ûï Ajouter")
        edit_btn = QtWidgets.QPushButton("‚úèÔ∏è Modifier")
        copy_btn = QtWidgets.QPushButton("üìã Copier")
        generate_btn = QtWidgets.QPushButton("üé≤ G√©n√©rer")
        
        add_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ûï", "Ajouter un mot de passe !\n\nüåê Site/Application :\nüë§ Nom d'utilisateur :\nüîë Mot de passe :\nüìù Notes :\nüè∑Ô∏è Cat√©gorie :\n\nüîê Chiffrement automatique"))
        edit_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚úèÔ∏è", "Modifier l'entr√©e !\n\nüìù Entr√©e s√©lectionn√©e : Google\n\n‚úèÔ∏è Champs modifiables :\n‚Ä¢ Nom d'utilisateur\n‚Ä¢ Mot de passe\n‚Ä¢ Notes\n‚Ä¢ Cat√©gorie"))
        copy_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìã", "Mot de passe copi√© !\n\nüìã Copi√© dans le presse-papiers\n‚è±Ô∏è Auto-effacement dans 60 secondes\nüîí S√©curit√© pr√©serv√©e"))
        generate_btn.clicked.connect(lambda: self.generate_secure_password())
        
        password_actions.addWidget(add_btn)
        password_actions.addWidget(edit_btn)
        password_actions.addWidget(copy_btn)
        password_actions.addWidget(generate_btn)
        password_actions.addStretch()
        
        passwords_layout.addLayout(password_actions)
        vault_layout.addWidget(passwords_card)
        password_tabs.addTab(vault_tab, "üîë Coffre-fort")
        
        # === ONGLET AUDIT ===
        audit_tab = QtWidgets.QWidget()
        audit_layout = QtWidgets.QVBoxLayout(audit_tab)
        
        audit_card = QtWidgets.QWidget(objectName="GlassCard")
        audit_card_layout = QtWidgets.QVBoxLayout(audit_card)
        audit_card_layout.setContentsMargins(16, 16, 16, 16)
        
        audit_title = QtWidgets.QLabel("üîç Audit de S√©curit√©")
        audit_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        audit_card_layout.addWidget(audit_title)
        
        audit_results = QtWidgets.QListWidget()
        audit_items = [
            "üî¥ CRITIQUE - Facebook : Mot de passe trop faible (6 caract√®res)",
            "üü† ATTENTION - Spotify : Mot de passe r√©utilis√© (Amazon)",
            "üî¥ CRITIQUE - LinkedIn : Pas de majuscules ni chiffres",
            "üü¢ S√âCURIS√â - Google : Mot de passe fort (16 caract√®res)",
            "üü† ATTENTION - Twitter : Derni√®re modification il y a 2 ans",
            "üü¢ S√âCURIS√â - Banque : Authentification 2FA active",
            "üî¥ URGENT - Email perso : Compromis dans une fuite de donn√©es",
            "üü¢ EXCELLENT - Steam : Mot de passe unique et complexe"
        ]
        
        for item in audit_items:
            audit_results.addItem(item)
        
        audit_card_layout.addWidget(audit_results)
        
        # Actions audit
        audit_actions = QtWidgets.QHBoxLayout()
        scan_btn = QtWidgets.QPushButton("üîç Nouvelle Analyse")
        fix_btn = QtWidgets.QPushButton("üîß Corriger Automatiquement")
        report_btn = QtWidgets.QPushButton("üìã Rapport D√©taill√©")
        
        scan_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîç", "Analyse de s√©curit√© !\n\nüîç Analyse en cours...\n‚Ä¢ V√©rification force des mots de passe\n‚Ä¢ D√©tection des doublons\n‚Ä¢ Contr√¥le des fuites de donn√©es\n\n‚è±Ô∏è Dur√©e estim√©e : 30 secondes"))
        fix_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîß", "Correction automatique !\n\nüîß Actions effectu√©es :\n‚Ä¢ 3 mots de passe renforc√©s\n‚Ä¢ 2 doublons √©limin√©s\n‚Ä¢ 1 compromis remplac√©\n\n‚úÖ S√©curit√© am√©lior√©e de 85%"))
        report_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìã", "Rapport de s√©curit√© !\n\nüìä Score global : 78/100\n\nüìà Am√©liorations :\n‚Ä¢ Renforcer 3 mots de passe\n‚Ä¢ Activer 2FA sur 5 comptes\n‚Ä¢ Changer 1 mot de passe compromis\n\nüìß Rapport envoy√© par email"))
        
        audit_actions.addWidget(scan_btn)
        audit_actions.addWidget(fix_btn)
        audit_actions.addWidget(report_btn)
        audit_actions.addStretch()
        
        audit_card_layout.addLayout(audit_actions)
        audit_layout.addWidget(audit_card)
        password_tabs.addTab(audit_tab, "üîç Audit")
        
        # === ONGLET G√âN√âRATEUR ===
        generator_tab = QtWidgets.QWidget()
        generator_layout = QtWidgets.QVBoxLayout(generator_tab)
        
        generator_card = QtWidgets.QWidget(objectName="GlassCard")
        generator_card_layout = QtWidgets.QVBoxLayout(generator_card)
        generator_card_layout.setContentsMargins(16, 16, 16, 16)
        
        generator_title = QtWidgets.QLabel("üé≤ G√©n√©rateur de Mots de Passe")
        generator_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        generator_card_layout.addWidget(generator_title)
        
        # Options de g√©n√©ration
        length_layout = QtWidgets.QHBoxLayout()
        length_layout.addWidget(QtWidgets.QLabel("Longueur :"))
        length_spin = QtWidgets.QSpinBox()
        length_spin.setRange(8, 64)
        length_spin.setValue(16)
        length_layout.addWidget(length_spin)
        length_layout.addStretch()
        generator_card_layout.addLayout(length_layout)
        
        # Cases √† cocher pour les options
        uppercase_cb = QtWidgets.QCheckBox("üî§ Majuscules (A-Z)")
        uppercase_cb.setChecked(True)
        lowercase_cb = QtWidgets.QCheckBox("üî° Minuscules (a-z)")
        lowercase_cb.setChecked(True)
        numbers_cb = QtWidgets.QCheckBox("üî¢ Chiffres (0-9)")
        numbers_cb.setChecked(True)
        symbols_cb = QtWidgets.QCheckBox("üî£ Symboles (!@#$%)")
        symbols_cb.setChecked(True)
        
        generator_card_layout.addWidget(uppercase_cb)
        generator_card_layout.addWidget(lowercase_cb)
        generator_card_layout.addWidget(numbers_cb)
        generator_card_layout.addWidget(symbols_cb)
        
        # Mot de passe g√©n√©r√©
        generated_password = QtWidgets.QLineEdit()
        generated_password.setPlaceholderText("Le mot de passe g√©n√©r√© appara√Ætra ici...")
        generated_password.setReadOnly(True)
        generator_card_layout.addWidget(generated_password)
        
        # Actions g√©n√©rateur
        gen_actions = QtWidgets.QHBoxLayout()
        generate_new_btn = QtWidgets.QPushButton("üé≤ G√©n√©rer")
        copy_gen_btn = QtWidgets.QPushButton("üìã Copier")
        test_strength_btn = QtWidgets.QPushButton("üí™ Tester Force")
        
        generate_new_btn.clicked.connect(lambda: self.generate_password_display(generated_password, length_spin.value()))
        copy_gen_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìã", "Mot de passe copi√© !\n\nüìã Copi√© dans le presse-papiers\n‚è±Ô∏è Effacement automatique dans 60s\nüîí Pr√™t √† √™tre utilis√©"))
        test_strength_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üí™", "Test de force !\n\nüí™ Force : TR√àS √âLEV√âE\n‚≠ê Score : 95/100\n\n‚úÖ Crit√®res respect√©s :\n‚Ä¢ Longueur suffisante\n‚Ä¢ Caract√®res vari√©s\n‚Ä¢ Entropie √©lev√©e\n‚Ä¢ R√©sistant aux attaques"))
        
        gen_actions.addWidget(generate_new_btn)
        gen_actions.addWidget(copy_gen_btn)
        gen_actions.addWidget(test_strength_btn)
        gen_actions.addStretch()
        
        generator_card_layout.addLayout(gen_actions)
        generator_layout.addWidget(generator_card)
        password_tabs.addTab(generator_tab, "üé≤ G√©n√©rateur")
        
        lay.addWidget(password_tabs)
        
        # Contr√¥les principaux
        main_controls = QtWidgets.QHBoxLayout()
        
        unlock_vault_btn = QtWidgets.QPushButton("üîì D√©verrouiller")
        unlock_vault_btn.setStyleSheet("QPushButton { background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 rgba(0, 255, 136, 0.3), stop:1 rgba(0, 255, 136, 0.1)); }")
        
        sync_btn = QtWidgets.QPushButton("üîÑ Synchroniser")
        backup_btn = QtWidgets.QPushButton("üíæ Sauvegarder")
        import_btn = QtWidgets.QPushButton("üì• Importer")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        unlock_vault_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîì", "Coffre d√©verrouill√© !\n\nüîë Authentification r√©ussie\nüîì Acc√®s complet aux mots de passe\n‚è±Ô∏è Session : 30 minutes\nüõ°Ô∏è Surveillance activ√©e"))
        sync_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîÑ", "Synchronisation !\n\n‚òÅÔ∏è Synchronisation cloud en cours...\nüì± Appareils synchronis√©s : 3\n‚úÖ 127 entr√©es mises √† jour\nüîí Chiffrement de bout en bout"))
        backup_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üíæ", "Sauvegarde cr√©√©e !\n\nüíæ Sauvegarde locale : 100%\n‚òÅÔ∏è Sauvegarde cloud : 100%\nüîê Chiffrement : AES-256\nüìÖ Date : Aujourd'hui"))
        import_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üì•", "Importer des donn√©es !\n\nüìÅ Formats support√©s :\n‚Ä¢ .csv (Excel)\n‚Ä¢ .json (Ragnar)\n‚Ä¢ .1pux (1Password)\n‚Ä¢ .xml (KeePass)\n\nüì• Pr√™t √† importer"))
        close_btn.clicked.connect(d.close)
        
        main_controls.addWidget(unlock_vault_btn)
        main_controls.addWidget(sync_btn)
        main_controls.addWidget(backup_btn)
        main_controls.addWidget(import_btn)
        main_controls.addStretch()
        main_controls.addWidget(close_btn)
        
        lay.addLayout(main_controls)
        
        d.show()
        fade_in(d, 600)
    
    def generate_secure_password(self):
        """G√©n√®re un mot de passe s√©curis√©"""
        import random
        import string
        
        chars = string.ascii_letters + string.digits + "!@#$%^&*"
        password = ''.join(random.choice(chars) for _ in range(16))
        
        QtWidgets.QMessageBox.information(
            self, "üé≤ Mot de passe g√©n√©r√©", 
            f"Nouveau mot de passe s√©curis√© !\n\nüîë Mot de passe :\n{password}\n\n‚úÖ 16 caract√®res\nüí™ Force : TR√àS √âLEV√âE\nüìã Copi√© automatiquement"
        )
    
    def generate_password_display(self, line_edit, length):
        """G√©n√®re et affiche un mot de passe"""
        import random
        import string
        
        chars = string.ascii_letters + string.digits + "!@#$%^&*"
        password = ''.join(random.choice(chars) for _ in range(length))
        line_edit.setText(password)
    
    def show_firewall(self):
        """Application supprim√©e"""
        QtWidgets.QMessageBox.information(self, "üö´ Application Supprim√©e", "Cette application a √©t√© supprim√©e de Ragnar OS 26.3.0")
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Pare-feu Ragnar Pro", "Protection r√©seau intelligente et monitoring avanc√©")
        lay.addWidget(header)
        
        # Onglets du pare-feu
        firewall_tabs = QtWidgets.QTabWidget()
        
        # === ONGLET PROTECTION ===
        protection_tab = QtWidgets.QWidget()
        protection_layout = QtWidgets.QVBoxLayout(protection_tab)
        
        # Statut du pare-feu
        status_card = QtWidgets.QWidget(objectName="GlassCard")
        status_layout = QtWidgets.QVBoxLayout(status_card)
        status_layout.setContentsMargins(16, 16, 16, 16)
        
        status_title = QtWidgets.QLabel("üõ°Ô∏è Statut du Pare-feu")
        status_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        status_layout.addWidget(status_title)
        
        firewall_status = [
            ("‚úÖ", "Pare-feu", "ACTIF", "#00ff88"),
            ("‚úÖ", "Protection entrante", "ACTIVE", "#00ff88"),
            ("‚úÖ", "Protection sortante", "ACTIVE", "#00ff88"),
            ("‚úÖ", "D√©tection d'intrusion", "ACTIVE", "#00ff88"),
            ("‚ö†Ô∏è", "Mode furtif", "INACTIF", "#ffaa00"),
            ("‚úÖ", "Blocage automatique", "ACTIF", "#00ff88")
        ]
        
        for icon, feature, status, color in firewall_status:
            status_item = QtWidgets.QHBoxLayout()
            status_icon = QtWidgets.QLabel(icon)
            status_icon.setStyleSheet("font-size: 16px;")
            status_name = QtWidgets.QLabel(feature)
            status_name.setStyleSheet("color: white; font-size: 12px;")
            status_value = QtWidgets.QLabel(status)
            status_value.setStyleSheet(f"color: {color}; font-weight: bold; font-size: 12px;")
            
            status_item.addWidget(status_icon)
            status_item.addWidget(status_name)
            status_item.addStretch()
            status_item.addWidget(status_value)
            
            status_layout.addLayout(status_item)
        
        protection_layout.addWidget(status_card)
        
        # Statistiques r√©seau
        network_stats_card = QtWidgets.QWidget(objectName="GlassCard")
        network_stats_layout = QtWidgets.QVBoxLayout(network_stats_card)
        network_stats_layout.setContentsMargins(16, 16, 16, 16)
        
        network_stats_title = QtWidgets.QLabel("üìä Statistiques R√©seau")
        network_stats_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        network_stats_layout.addWidget(network_stats_title)
        
        network_stats = [
            "üö´ Connexions bloqu√©es aujourd'hui : 234",
            "üîç Tentatives d'intrusion : 12",
            "üìà Trafic entrant : 156.7 MB",
            "üìâ Trafic sortant : 89.3 MB",
            "‚ö° Connexions actives : 47",
            "üåê Ports ouverts : 8"
        ]
        
        for stat in network_stats:
            stat_label = QtWidgets.QLabel(stat)
            stat_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 170, 255, 0.5);")
            network_stats_layout.addWidget(stat_label)
        
        protection_layout.addWidget(network_stats_card)
        
        # Actions rapides
        quick_actions_card = QtWidgets.QWidget(objectName="GlassCard")
        quick_actions_layout = QtWidgets.QHBoxLayout(quick_actions_card)
        quick_actions_layout.setContentsMargins(16, 16, 16, 16)
        
        stealth_btn = QtWidgets.QPushButton("üëª Mode Furtif")
        block_all_btn = QtWidgets.QPushButton("üö´ Bloquer Tout")
        allow_all_btn = QtWidgets.QPushButton("‚úÖ Autoriser Tout")
        
        stealth_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üëª", "Mode Furtif Activ√© !\n\nüîí Syst√®me invisible sur le r√©seau\nüö´ R√©ponses aux pings d√©sactiv√©es\nüõ°Ô∏è Ports ferm√©s silencieusement\nüëª Furtivit√© maximale"))
        block_all_btn.clicked.connect(lambda: QtWidgets.QMessageBox.warning(d, "üö´", "Blocage Total Activ√© !\n\nüö´ Toutes les connexions bloqu√©es\n‚ö†Ô∏è Internet inaccessible\nüõ°Ô∏è Protection maximale\n‚è±Ô∏è Mode temporaire recommand√©"))
        allow_all_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚úÖ", "Autorisation Totale !\n\n‚úÖ Toutes les connexions autoris√©es\n‚ö†Ô∏è Protection r√©duite\nüåê Acc√®s Internet complet\nüõ°Ô∏è Surveillance maintenue"))
        
        quick_actions_layout.addWidget(stealth_btn)
        quick_actions_layout.addWidget(block_all_btn)
        quick_actions_layout.addWidget(allow_all_btn)
        quick_actions_layout.addStretch()
        
        protection_layout.addWidget(quick_actions_card)
        firewall_tabs.addTab(protection_tab, "üõ°Ô∏è Protection")
        
        # === ONGLET R√àGLES ===
        rules_tab = QtWidgets.QWidget()
        rules_layout = QtWidgets.QVBoxLayout(rules_tab)
        
        rules_card = QtWidgets.QWidget(objectName="GlassCard")
        rules_card_layout = QtWidgets.QVBoxLayout(rules_card)
        rules_card_layout.setContentsMargins(16, 16, 16, 16)
        
        rules_title = QtWidgets.QLabel("üìã R√®gles de Pare-feu")
        rules_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        rules_card_layout.addWidget(rules_title)
        
        rules_list = QtWidgets.QListWidget()
        firewall_rules = [
            "‚úÖ AUTORISER - HTTP/HTTPS (80, 443) - Sortant",
            "‚úÖ AUTORISER - DNS (53) - Sortant",
            "üö´ BLOQUER - Telnet (23) - Entrant/Sortant",
            "‚úÖ AUTORISER - SSH (22) - Entrant (IP sp√©cifiques)",
            "üö´ BLOQUER - FTP (21) - Entrant",
            "‚úÖ AUTORISER - Email (25, 110, 143, 993, 995) - Sortant",
            "üö´ BLOQUER - Partage Windows (445) - Entrant",
            "‚ö†Ô∏è SURVEILLER - P2P (BitTorrent) - Sortant"
        ]
        
        for rule in firewall_rules:
            rules_list.addItem(rule)
        
        rules_card_layout.addWidget(rules_list)
        
        # Actions sur r√®gles
        rules_actions = QtWidgets.QHBoxLayout()
        add_rule_btn = QtWidgets.QPushButton("‚ûï Nouvelle R√®gle")
        edit_rule_btn = QtWidgets.QPushButton("‚úèÔ∏è Modifier")
        delete_rule_btn = QtWidgets.QPushButton("üóëÔ∏è Supprimer")
        import_rules_btn = QtWidgets.QPushButton("üì• Importer")
        
        add_rule_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ûï", "Nouvelle R√®gle !\n\nüéØ Action : Autoriser/Bloquer\nüåê Direction : Entrant/Sortant\nüîå Port : 80, 443, etc.\nüìç IP : Toutes ou sp√©cifiques\nüìã Description : Optionnelle"))
        edit_rule_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚úèÔ∏è", "Modifier la R√®gle !\n\nüìù R√®gle s√©lectionn√©e :\nAUTORISER - HTTP (80) - Sortant\n\n‚úèÔ∏è Modifications disponibles :\n‚Ä¢ Action ‚Ä¢ Port ‚Ä¢ Direction ‚Ä¢ IP"))
        delete_rule_btn.clicked.connect(lambda: QtWidgets.QMessageBox.warning(d, "üóëÔ∏è", "Supprimer la R√®gle !\n\n‚ö†Ô∏è √ätes-vous s√ªr ?\nüóëÔ∏è R√®gle supprim√©e d√©finitivement\nüîÑ Pare-feu red√©marr√©\n‚úÖ Nouvelle configuration active"))
        import_rules_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üì•", "Importer des R√®gles !\n\nüìÅ Formats support√©s :\n‚Ä¢ .firewall (Ragnar)\n‚Ä¢ .xml (Standard)\n‚Ä¢ .json (Configuration)\n\nüì• 12 r√®gles import√©es avec succ√®s"))
        
        rules_actions.addWidget(add_rule_btn)
        rules_actions.addWidget(edit_rule_btn)
        rules_actions.addWidget(delete_rule_btn)
        rules_actions.addWidget(import_rules_btn)
        rules_actions.addStretch()
        
        rules_card_layout.addLayout(rules_actions)
        rules_layout.addWidget(rules_card)
        firewall_tabs.addTab(rules_tab, "üìã R√®gles")
        
        # === ONGLET MONITORING ===
        monitoring_tab = QtWidgets.QWidget()
        monitoring_layout = QtWidgets.QVBoxLayout(monitoring_tab)
        
        monitoring_card = QtWidgets.QWidget(objectName="GlassCard")
        monitoring_card_layout = QtWidgets.QVBoxLayout(monitoring_card)
        monitoring_card_layout.setContentsMargins(16, 16, 16, 16)
        
        monitoring_title = QtWidgets.QLabel("üì° Monitoring en Temps R√©el")
        monitoring_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        monitoring_card_layout.addWidget(monitoring_title)
        
        monitoring_list = QtWidgets.QListWidget()
        monitoring_events = [
            "üî¥ BLOQU√â - 192.168.1.100:445 ‚Üí Tentative SMB",
            "‚úÖ AUTORIS√â - google.com:443 ‚Üí Navigation HTTPS",
            "‚ö†Ô∏è SUSPECT - 203.0.113.1:22 ‚Üí Tentative SSH r√©p√©t√©e",
            "‚úÖ AUTORIS√â - outlook.com:993 ‚Üí Email IMAP",
            "üî¥ BLOQU√â - 198.51.100.1:23 ‚Üí Tentative Telnet",
            "‚úÖ AUTORIS√â - github.com:443 ‚Üí D√©veloppement",
            "‚ö†Ô∏è ANALYSE - torrent.tracker:6881 ‚Üí Trafic P2P",
            "üî¥ BLOQU√â - malware.site:80 ‚Üí Site malveillant"
        ]
        
        for event in monitoring_events:
            monitoring_list.addItem(event)
        
        monitoring_card_layout.addWidget(monitoring_list)
        
        # Contr√¥les monitoring
        monitoring_controls = QtWidgets.QHBoxLayout()
        pause_btn = QtWidgets.QPushButton("‚è∏Ô∏è Pause")
        clear_btn = QtWidgets.QPushButton("üóëÔ∏è Effacer")
        export_btn = QtWidgets.QPushButton("üì§ Exporter")
        alerts_btn = QtWidgets.QPushButton("üîî Alertes")
        
        pause_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚è∏Ô∏è", "Monitoring en Pause !\n\n‚è∏Ô∏è Surveillance interrompue\nüíæ √âv√©nements sauvegard√©s\nüîÑ Reprise disponible\n‚ö†Ô∏è Protection maintenue"))
        clear_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üóëÔ∏è", "Journal Effac√© !\n\nüóëÔ∏è Tous les √©v√©nements supprim√©s\nüÜï Journal r√©initialis√©\nüìä Statistiques conserv√©es\n‚úÖ Pr√™t pour nouveaux √©v√©nements"))
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üì§", "Journal Export√© !\n\nüìÅ Fichier : firewall_log_2024.txt\nüìä 2,847 √©v√©nements export√©s\nüìç Emplacement : Documents/Ragnar/\n‚úÖ Export termin√©"))
        alerts_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîî", "Configuration Alertes !\n\nüîî Types d'alertes :\n‚Ä¢ Tentatives d'intrusion\n‚Ä¢ Trafic suspect\n‚Ä¢ R√®gles viol√©es\n‚Ä¢ Seuils d√©pass√©s\n\nüìß Notifications par email activ√©es"))
        
        monitoring_controls.addWidget(pause_btn)
        monitoring_controls.addWidget(clear_btn)
        monitoring_controls.addWidget(export_btn)
        monitoring_controls.addWidget(alerts_btn)
        monitoring_controls.addStretch()
        
        monitoring_card_layout.addLayout(monitoring_controls)
        monitoring_layout.addWidget(monitoring_card)
        firewall_tabs.addTab(monitoring_tab, "üì° Monitoring")
        
        lay.addWidget(firewall_tabs)
        
        # Contr√¥les principaux
        main_controls = QtWidgets.QHBoxLayout()
        
        enable_btn = QtWidgets.QPushButton("üü¢ Activer")
        enable_btn.setStyleSheet("QPushButton { background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 rgba(0, 255, 136, 0.3), stop:1 rgba(0, 255, 136, 0.1)); }")
        
        disable_btn = QtWidgets.QPushButton("üî¥ D√©sactiver")
        restart_btn = QtWidgets.QPushButton("üîÑ Red√©marrer")
        config_btn = QtWidgets.QPushButton("‚öôÔ∏è Configuration")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        enable_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üü¢", "Pare-feu Activ√© !\n\nüõ°Ô∏è Protection r√©seau active\nüìã R√®gles appliqu√©es\nüì° Monitoring d√©marr√©\n‚úÖ Syst√®me s√©curis√©"))
        disable_btn.clicked.connect(lambda: QtWidgets.QMessageBox.warning(d, "üî¥", "Pare-feu D√©sactiv√© !\n\n‚ö†Ô∏è Protection r√©seau arr√™t√©e\nüö´ R√®gles inactives\nüì° Monitoring stopp√©\n‚ö†Ô∏è Syst√®me vuln√©rable"))
        restart_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîÑ", "Pare-feu Red√©marr√© !\n\nüîÑ Service red√©marr√©\nüìã R√®gles recharg√©es\nüì° Monitoring r√©initialis√©\n‚úÖ Syst√®me op√©rationnel"))
        config_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚öôÔ∏è", "Configuration Avanc√©e !\n\n‚öôÔ∏è Options disponibles :\n‚Ä¢ Profils de s√©curit√©\n‚Ä¢ Notifications\n‚Ä¢ Journalisation\n‚Ä¢ Performance\n‚Ä¢ Sauvegarde"))
        close_btn.clicked.connect(d.close)
        
        main_controls.addWidget(enable_btn)
        main_controls.addWidget(disable_btn)
        main_controls.addWidget(restart_btn)
        main_controls.addWidget(config_btn)
        main_controls.addStretch()
        main_controls.addWidget(close_btn)
        
        lay.addLayout(main_controls)
        
        d.show()
        fade_in(d, 800)
    
    def show_theme_manager(self):
        """Gestionnaire de th√®mes avanc√©"""
        d = GlassDialog("üé® Gestionnaire de Th√®mes Ragnar", (900, 650), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Gestionnaire de Th√®mes", "Personnalisez votre exp√©rience visuelle")
        lay.addWidget(header)
        
        # Th√®me actuel
        current_card = QtWidgets.QWidget(objectName="GlassCard")
        current_layout = QtWidgets.QVBoxLayout(current_card)
        current_layout.setContentsMargins(16, 16, 16, 16)
        
        current_title = QtWidgets.QLabel("üåü Th√®me Actuel")
        current_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        current_layout.addWidget(current_title)
        
        current_theme_info = QtWidgets.QLabel("üñ§ Ragnar Modern Dark - Le th√®me noir √©l√©gant avec accents verts")
        current_theme_info.setStyleSheet("color: white; font-size: 12px; padding: 8px; border: 1px solid rgba(0, 255, 136, 0.3); border-radius: 5px;")
        current_layout.addWidget(current_theme_info)
        
        lay.addWidget(current_card)
        
        # Galerie de th√®mes
        themes_card = QtWidgets.QWidget(objectName="GlassCard")
        themes_layout = QtWidgets.QVBoxLayout(themes_card)
        themes_layout.setContentsMargins(16, 16, 16, 16)
        
        themes_title = QtWidgets.QLabel("üé® Th√®mes Disponibles")
        themes_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        themes_layout.addWidget(themes_title)
        
        # Grille de th√®mes
        themes_grid = QtWidgets.QGridLayout()
        
        themes_data = [
            ("üñ§", "Ragnar Dark", "Th√®me sombre moderne", "#000000", "#00ff88"),
            ("‚ö™", "Ragnar Light", "Th√®me clair √©l√©gant", "#ffffff", "#0066cc"),
            ("üîµ", "Ocean Blue", "Bleu profond apaisant", "#001122", "#00aaff"),
            ("üî¥", "Fire Red", "Rouge passion intense", "#220000", "#ff4444"),
            ("üü¢", "Forest Green", "Vert nature relaxant", "#002200", "#44ff44"),
            ("üü£", "Royal Purple", "Violet royal luxueux", "#220022", "#aa44ff"),
            ("üü†", "Sunset Orange", "Orange coucher de soleil", "#221100", "#ff8844"),
            ("üåà", "Rainbow", "Multicolore dynamique", "#111111", "#ff00ff"),
        ]
        
        row, col = 0, 0
        for emoji, name, desc, bg_color, accent_color in themes_data:
            theme_widget = QtWidgets.QWidget()
            theme_widget.setFixedSize(200, 120)
            theme_widget.setStyleSheet(f"""
                QWidget {{
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 {bg_color}cc,
                        stop:1 {bg_color}88);
                    border: 2px solid {accent_color}66;
                    border-radius: 10px;
                }}
                QWidget:hover {{
                    border: 2px solid {accent_color};
                }}
            """)
            
            theme_layout = QtWidgets.QVBoxLayout(theme_widget)
            theme_layout.setContentsMargins(8, 8, 8, 8)
            
            theme_icon = QtWidgets.QLabel(emoji)
            theme_icon.setStyleSheet("font-size: 24px; color: white;")
            theme_icon.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            theme_name = QtWidgets.QLabel(name)
            theme_name.setStyleSheet(f"font-size: 12px; font-weight: bold; color: {accent_color};")
            theme_name.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            theme_desc = QtWidgets.QLabel(desc)
            theme_desc.setStyleSheet("font-size: 9px; color: #cccccc;")
            theme_desc.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            theme_desc.setWordWrap(True)
            
            apply_btn = QtWidgets.QPushButton("Appliquer")
            apply_btn.setStyleSheet(f"""
                QPushButton {{
                    background: {accent_color}44;
                    border: 1px solid {accent_color};
                    border-radius: 4px;
                    color: white;
                    font-size: 9px;
                    padding: 4px;
                }}
                QPushButton:hover {{
                    background: {accent_color}66;
                }}
            """)
            apply_btn.clicked.connect(lambda checked, n=name: self.apply_theme(n))
            
            theme_layout.addWidget(theme_icon)
            theme_layout.addWidget(theme_name)
            theme_layout.addWidget(theme_desc)
            theme_layout.addWidget(apply_btn)
            
            themes_grid.addWidget(theme_widget, row, col)
            col += 1
            if col > 3:
                col = 0
                row += 1
        
        themes_layout.addLayout(themes_grid)
        lay.addWidget(themes_card)
        
        # Options avanc√©es
        options_card = QtWidgets.QWidget(objectName="GlassCard")
        options_layout = QtWidgets.QVBoxLayout(options_card)
        options_layout.setContentsMargins(16, 16, 16, 16)
        
        options_title = QtWidgets.QLabel("‚öôÔ∏è Options Avanc√©es")
        options_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        options_layout.addWidget(options_title)
        
        # Options
        auto_dark_cb = QtWidgets.QCheckBox("üåô Mode sombre automatique (selon l'heure)")
        animations_cb = QtWidgets.QCheckBox("‚ú® Animations et transitions")
        animations_cb.setChecked(True)
        transparency_cb = QtWidgets.QCheckBox("üëª Effets de transparence")
        transparency_cb.setChecked(True)
        
        options_layout.addWidget(auto_dark_cb)
        options_layout.addWidget(animations_cb)
        options_layout.addWidget(transparency_cb)
        
        lay.addWidget(options_card)
        
        # Actions
        actions_layout = QtWidgets.QHBoxLayout()
        
        create_btn = QtWidgets.QPushButton("üé® Cr√©er un Th√®me")
        import_btn = QtWidgets.QPushButton("üì• Importer")
        export_btn = QtWidgets.QPushButton("üì§ Exporter")
        reset_btn = QtWidgets.QPushButton("üîÑ R√©initialiser")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        create_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üé®", "Cr√©ateur de Th√®me !\n\nüé® Cr√©ez votre th√®me personnalis√© :\n‚Ä¢ Choisissez les couleurs\n‚Ä¢ D√©finissez les polices\n‚Ä¢ Ajustez la transparence\n‚Ä¢ Pr√©visualisez en temps r√©el"))
        import_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üì•", "Importer un Th√®me !\n\nüìÅ Formats support√©s :\n‚Ä¢ .ragnar-theme\n‚Ä¢ .json\n‚Ä¢ .css\n\nImportez des th√®mes de la communaut√© !"))
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üì§", "Exporter le Th√®me !\n\nüíæ Th√®me export√© :\n‚Ä¢ ragnar-dark-modern.theme\n‚Ä¢ Partagez avec la communaut√©\n‚Ä¢ Sauvegarde automatique"))
        reset_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîÑ", "R√©initialisation !\n\nüîÑ Th√®me par d√©faut restaur√©\nüñ§ Ragnar Modern Dark appliqu√©\n‚úÖ Param√®tres r√©initialis√©s"))
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(create_btn)
        actions_layout.addWidget(import_btn)
        actions_layout.addWidget(export_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def apply_theme(self, theme_name):
        """Applique un th√®me s√©lectionn√©"""
        QtWidgets.QMessageBox.information(
            self, "üé® Th√®me Appliqu√©", 
            f"Th√®me '{theme_name}' appliqu√© !\n\n‚ú® Changements :\n‚Ä¢ Interface mise √† jour\n‚Ä¢ Couleurs modifi√©es\n‚Ä¢ Animations adapt√©es\n\nRed√©marrage recommand√© pour une application compl√®te."
        )
    
    def show_marketplace(self):
        QtWidgets.QMessageBox.information(self, "üè™ Marketplace", "Marketplace .rapp !\n\nContenu :\n‚Ä¢ Applications\n‚Ä¢ Th√®mes\n‚Ä¢ Extensions\n‚Ä¢ Outils")
    
    def show_widget_manager(self):
        QtWidgets.QMessageBox.information(self, "üì± Widgets", "Gestionnaire de widgets !\n\nWidgets :\n‚Ä¢ M√©t√©o\n‚Ä¢ Horloge\n‚Ä¢ Syst√®me\n‚Ä¢ Personnalis√©s")
    
    def show_notification_center(self):
        QtWidgets.QMessageBox.information(self, "üîî Notifications", "Centre de notifications !\n\nFonctionnalit√©s :\n‚Ä¢ Historique\n‚Ä¢ Filtres\n‚Ä¢ Actions rapides")
    
    def show_ragnar_cloud(self):
        QtWidgets.QMessageBox.information(self, "‚òÅÔ∏è Ragnar Cloud", "Ragnar Cloud !\n\nServices :\n‚Ä¢ Stockage\n‚Ä¢ Synchronisation\n‚Ä¢ Partage\n‚Ä¢ Sauvegarde")
    
    def show_ai_assistant(self):
        """Application supprim√©e"""
        QtWidgets.QMessageBox.information(self, "üö´ Application Supprim√©e", "Cette application a √©t√© supprim√©e de Ragnar OS 26.3.0")
    
    def show_premium_features(self):
        QtWidgets.QMessageBox.information(self, "üåü Premium", "Ragnar Premium !\n\nAvantages :\n‚Ä¢ Fonctionnalit√©s exclusives\n‚Ä¢ Support prioritaire\n‚Ä¢ Th√®mes premium")
    
    def show_ai_predictions(self):
        """Application supprim√©e"""
        QtWidgets.QMessageBox.information(self, "üö´ Application Supprim√©e", "Cette application a √©t√© supprim√©e de Ragnar OS 26.3.0")
    
    def show_theater_mode(self):
        """Application supprim√©e"""
        QtWidgets.QMessageBox.information(self, "üö´ Application Supprim√©e", "Cette application a √©t√© supprim√©e de Ragnar OS 26.3.0")

    def show_files(self):
        """Gestionnaire de fichiers moderne int√©gr√©"""
        d = GlassDialog("üìÅ Gestionnaire de Fichiers Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header moderne
        header = make_header("Gestionnaire de Fichiers", "Navigation et gestion avanc√©e")
        lay.addWidget(header)
        
        # Barre de navigation
        nav_card = QtWidgets.QWidget(objectName="GlassCard")
        nav_layout = QtWidgets.QHBoxLayout(nav_card)
        nav_layout.setContentsMargins(16, 12, 16, 12)
        
        # Chemin actuel
        current_path = Path.cwd()
        path_label = QtWidgets.QLabel(f"üìç {current_path}")
        path_label.setStyleSheet("color: #00ff88; font-weight: bold; font-size: 13px;")
        
        # Boutons de navigation
        back_btn = QtWidgets.QPushButton("‚¨ÖÔ∏è Retour")
        up_btn = QtWidgets.QPushButton("‚¨ÜÔ∏è Parent")
        home_btn = QtWidgets.QPushButton("üè† Accueil")
        refresh_btn = QtWidgets.QPushButton("üîÑ Actualiser")
        
        nav_layout.addWidget(path_label)
        nav_layout.addStretch()
        nav_layout.addWidget(back_btn)
        nav_layout.addWidget(up_btn)
        nav_layout.addWidget(home_btn)
        nav_layout.addWidget(refresh_btn)

        # Option: effet de verre ultra r√©aliste
        glass_toggle = QtWidgets.QCheckBox("‚ú® Verre Ultra")
        nav_layout.addWidget(glass_toggle)
        
        lay.addWidget(nav_card)
        
        # Liste des fichiers moderne
        files_card = QtWidgets.QWidget(objectName="GlassCard")
        files_layout = QtWidgets.QVBoxLayout(files_card)
        files_layout.setContentsMargins(16, 16, 16, 16)
        
        files_title = QtWidgets.QLabel("üìÇ Contenu du dossier")
        files_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        files_layout.addWidget(files_title)
        
        # Liste des fichiers
        file_list = QtWidgets.QListWidget()
        
        try:
            # Lister les fichiers et dossiers
            items = []
            for item in current_path.iterdir():
                if item.is_dir():
                    items.append(f"üìÅ {item.name}/")
                else:
                    size = item.stat().st_size
                    size_str = self.format_file_size(size)
                    items.append(f"üìÑ {item.name} ({size_str})")
            
            # Trier : dossiers d'abord, puis fichiers
            items.sort(key=lambda x: (not x.startswith("üìÅ"), x.lower()))
            
            for item in items:
                file_list.addItem(item)
                
        except Exception as e:
            file_list.addItem(f"‚ùå Erreur : {str(e)}")
        
        files_layout.addWidget(file_list)
        lay.addWidget(files_card)
        
        # Actions rapides
        actions_card = QtWidgets.QWidget(objectName="GlassCard")
        actions_layout = QtWidgets.QHBoxLayout(actions_card)
        actions_layout.setContentsMargins(16, 16, 16, 16)
        
        new_folder_btn = QtWidgets.QPushButton("üìÅ Nouveau Dossier")
        new_file_btn = QtWidgets.QPushButton("üìÑ Nouveau Fichier")
        open_external_btn = QtWidgets.QPushButton("üöÄ Ouvrir Externe")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        # Connexions
        new_folder_btn.clicked.connect(self.create_new_folder)
        new_file_btn.clicked.connect(self.create_new_file)
        open_external_btn.clicked.connect(lambda: safe_open(current_path))
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(new_folder_btn)
        actions_layout.addWidget(new_file_btn)
        actions_layout.addWidget(open_external_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addWidget(actions_card)
        
        # Double-clic: ouvrir fichiers / ex√©cuter .rapp
        def on_item_double_click(item):
            text = item.text()
            try:
                # Extraire le nom r√©el
                name = text.split(' ', 1)[1] if ' ' in text else text
                if name.endswith('/'):
                    name = name[:-1]
                if ' (' in name:
                    name = name.split(' (', 1)[0]
                target = current_path / name
                if target.is_dir():
                    # Ouvrir le dossier avec l'appli par d√©faut
                    safe_open(target)
                    return
                # Si .rapp, lancer
                if target.suffix.lower() == '.rapp':
                    safe_open(target)
                    return
                # Sinon ouvrir normalement
                safe_open(target)
            except Exception as e:
                QtWidgets.QMessageBox.critical(d, "Erreur", f"Ouverture impossible:\n{e}")

        file_list.itemDoubleClicked.connect(on_item_double_click)

        # Appliquer l'effet 'Verre Ultra'
        def apply_ultra_glass(enabled: bool):
            widgets = [d, nav_card, files_card, actions_card]
            for w in widgets:
                try:
                    if enabled:
                        # Intensit√© r√©cup√©r√©e depuis l'√©tat (persist√©e)
                        st = _read_state_safe()
                        radius = float(st.get("ultra_glass_radius", 28.0))
                        effect = QtWidgets.QGraphicsBlurEffect(w)
                        effect.setBlurRadius(max(0.0, min(64.0, radius)))
                        w.setGraphicsEffect(effect)
                    else:
                        w.setGraphicsEffect(None)
                except Exception:
                    pass

        glass_toggle.toggled.connect(apply_ultra_glass)
        # Charger √©tat initial
        try:
            st = _read_state_safe()
            glass_toggle.setChecked(bool(st.get("ultra_glass_enabled", False)))
        except Exception:
            pass

        d.show()
        fade_in(d, 600)
    
    def format_file_size(self, size_bytes):
        """Formate la taille des fichiers de mani√®re lisible"""
        if size_bytes == 0:
            return "0 B"
        size_names = ["B", "KB", "MB", "GB", "TB"]
        i = 0
        while size_bytes >= 1024 and i < len(size_names) - 1:
            size_bytes /= 1024
            i += 1
        return f"{size_bytes:.1f} {size_names[i]}"

    def show_store(self):
        """Store d'applications Ragnar OS"""
        store_data = ensure_store()
        
        d = GlassDialog("üõçÔ∏è Ragnar Store", (700, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Ragnar Store", "Applications et outils pour votre OS")
        lay.addWidget(header)
        
        # Liste des applications
        scroll = QtWidgets.QScrollArea()
        scroll.setWidgetResizable(True)
        scroll.setObjectName("GlassCard")
        
        content_widget = QtWidgets.QWidget()
        content_layout = QtWidgets.QVBoxLayout(content_widget)
        
        # Applications disponibles
        apps = [
            {"name": "Ragnar Paint", "desc": "√âditeur de dessin avanc√©", "icon": "üé®", "installed": False},
            {"name": "Ragnar Notes", "desc": "Prise de notes rapide", "icon": "üìù", "installed": False},
            {"name": "Ragnar Terminal", "desc": "Terminal syst√®me", "icon": "üíª", "installed": False},
            {"name": "Ragnar Calculator", "desc": "Calculatrice scientifique", "icon": "üßÆ", "installed": False},
            {"name": "Ragnar Music", "desc": "Lecteur audio", "icon": "üéµ", "installed": False},
            {"name": "Ragnar Code", "desc": "√âditeur de code", "icon": "üë®‚Äçüíª", "installed": False},
        ]
        
        for app in apps:
            app_widget = QtWidgets.QWidget(objectName="GlassCard")
            app_layout = QtWidgets.QHBoxLayout(app_widget)
            app_layout.setContentsMargins(12, 8, 12, 8)
            
            # Ic√¥ne et infos
            icon_label = QtWidgets.QLabel(app["icon"])
            icon_label.setStyleSheet("font-size: 24px;")
            
            info_layout = QtWidgets.QVBoxLayout()
            name_label = QtWidgets.QLabel(app["name"])
            name_label.setStyleSheet("font-weight: bold; font-size: 14px;")
            desc_label = QtWidgets.QLabel(app["desc"])
            desc_label.setStyleSheet("color: rgba(255,255,255,0.7); font-size: 11px;")
            
            info_layout.addWidget(name_label)
            info_layout.addWidget(desc_label)
            
            # Bouton d'installation
            install_btn = QtWidgets.QPushButton("‚úÖ Install√©" if app["installed"] else "üì• Installer")
            install_btn.setEnabled(not app["installed"])
            install_btn.clicked.connect(lambda checked, a=app: self.install_app(a, d))
            
            app_layout.addWidget(icon_label)
            app_layout.addLayout(info_layout)
            app_layout.addStretch()
            app_layout.addWidget(install_btn)
            
            content_layout.addWidget(app_widget)
        
        scroll.setWidget(content_widget)
        lay.addWidget(scroll)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def install_app(self, app, dialog):
        """Simule l'installation d'une application"""
        reply = QtWidgets.QMessageBox.question(
            self, "Installation",
            f"Voulez-vous installer {app['name']} ?\n\n{app['desc']}",
            QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
        )
        
        if reply == QtWidgets.QMessageBox.StandardButton.Yes:
            # Simulation d'installation
            progress = QtWidgets.QProgressDialog(f"Installation de {app['name']}...", "Annuler", 0, 100, self)
            progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
            progress.show()
            
            for i in range(101):
                progress.setValue(i)
                QtWidgets.QApplication.processEvents()
                time.sleep(0.01)
                if progress.wasCanceled():
                    return
            
            QtWidgets.QMessageBox.information(
                self, "Installation termin√©e",
                f"{app['name']} a √©t√© install√© avec succ√®s ! üéâ"
            )
            dialog.close()
            self.show_store()  # Rafra√Æchir le store



    def show_browser(self):
        """Navigateur web Ragnar int√©gr√©"""
        try:
            # Essayer d'importer QtWebEngineWidgets pour un vrai navigateur
            from PyQt6.QtWebEngineWidgets import QWebEngineView
            self._show_real_browser()
        except ImportError:
            # Fallback si QtWebEngineWidgets n'est pas disponible
            self._show_simple_browser()

    def _show_real_browser(self):
        """Navigateur web complet avec QtWebEngine"""
        from PyQt6.QtWebEngineWidgets import QWebEngineView
        from PyQt6.QtCore import QUrl
        
        d = GlassDialog("üåê Navigateur Ragnar", (1200, 800), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Navigateur Web", "Navigation compl√®te avec moteur Chromium")
        lay.addWidget(header)
        
        # Barre de navigation
        nav_layout = QtWidgets.QHBoxLayout()
        
        # Boutons de navigation
        back_btn = QtWidgets.QPushButton("‚¨ÖÔ∏è")
        forward_btn = QtWidgets.QPushButton("‚û°Ô∏è")
        refresh_btn = QtWidgets.QPushButton("üîÑ")
        home_btn = QtWidgets.QPushButton("üè†")
        
        back_btn.setMaximumWidth(40)
        forward_btn.setMaximumWidth(40)
        refresh_btn.setMaximumWidth(40)
        home_btn.setMaximumWidth(40)
        
        # Barre d'adresse
        self.address_bar = QtWidgets.QLineEdit()
        self.address_bar.setPlaceholderText("Entrez une URL ou recherchez...")
        self.address_bar.setText("https://www.google.com")
        
        # Bouton Go
        go_btn = QtWidgets.QPushButton("üîç Aller")
        
        nav_layout.addWidget(back_btn)
        nav_layout.addWidget(forward_btn)
        nav_layout.addWidget(refresh_btn)
        nav_layout.addWidget(home_btn)
        nav_layout.addWidget(self.address_bar)
        nav_layout.addWidget(go_btn)
        
        # Widget de navigation dans un conteneur
        nav_widget = QtWidgets.QWidget(objectName="GlassCard")
        nav_widget.setLayout(nav_layout)
        lay.addWidget(nav_widget)
        
        # Vue web
        self.web_view = QWebEngineView()
        self.web_view.setUrl(QUrl("https://www.google.com"))
        lay.addWidget(self.web_view)
        
        # Barre de statut
        self.status_bar = QtWidgets.QLabel("Pr√™t")
        self.status_bar.setStyleSheet("padding: 4px; color: rgba(255,255,255,0.7);")
        lay.addWidget(self.status_bar)
        
        # Connexions des boutons
        back_btn.clicked.connect(self.web_view.back)
        forward_btn.clicked.connect(self.web_view.forward)
        refresh_btn.clicked.connect(self.web_view.reload)
        home_btn.clicked.connect(lambda: self.navigate_to("https://www.google.com"))
        go_btn.clicked.connect(self.navigate_from_address_bar)
        self.address_bar.returnPressed.connect(self.navigate_from_address_bar)
        
        # Connexions des signaux web
        self.web_view.urlChanged.connect(self.update_address_bar)
        self.web_view.loadStarted.connect(lambda: self.status_bar.setText("Chargement..."))
        self.web_view.loadFinished.connect(lambda: self.status_bar.setText("Termin√©"))
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def _show_simple_browser(self):
        """Navigateur simple sans QtWebEngine"""
        d = GlassDialog("üåê Navigateur Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Navigateur Web", "Navigation simplifi√©e")
        lay.addWidget(header)
        
        # Message d'information
        info_widget = QtWidgets.QWidget(objectName="GlassCard")
        info_layout = QtWidgets.QVBoxLayout(info_widget)
        info_layout.setContentsMargins(16, 16, 16, 16)
        
        info_text = QtWidgets.QLabel("""
üåê <b>Navigateur Ragnar - Mode Simplifi√©</b><br><br>
Pour une exp√©rience de navigation compl√®te, installez QtWebEngineWidgets :<br>
<code>pip install PyQtWebEngine</code><br><br>
En attendant, vous pouvez :
        """)
        info_text.setWordWrap(True)
        info_layout.addWidget(info_text)
        lay.addWidget(info_widget)
        
        # Raccourcis vers sites populaires
        sites_widget = QtWidgets.QWidget(objectName="GlassCard")
        sites_layout = QtWidgets.QVBoxLayout(sites_widget)
        sites_layout.setContentsMargins(16, 16, 16, 16)
        
        sites_title = QtWidgets.QLabel("<b>üîó Sites Populaires</b>")
        sites_layout.addWidget(sites_title)
        
        # Grille de boutons pour sites
        sites_grid = QtWidgets.QGridLayout()
        
        popular_sites = [
            ("üîç Google", "https://www.google.com"),
            ("üì∫ YouTube", "https://www.youtube.com"),
            ("üìò Facebook", "https://www.facebook.com"),
            ("üê¶ Twitter", "https://www.twitter.com"),
            ("üíº LinkedIn", "https://www.linkedin.com"),
            ("üì∞ BBC News", "https://www.bbc.com/news"),
            ("üõí Amazon", "https://www.amazon.com"),
            ("üìß Gmail", "https://mail.google.com"),
        ]
        
        for i, (name, url) in enumerate(popular_sites):
            btn = QtWidgets.QPushButton(name)
            btn.clicked.connect(lambda checked, u=url: webbrowser.open(u))
            sites_grid.addWidget(btn, i // 2, i % 2)
        
        sites_layout.addLayout(sites_grid)
        lay.addWidget(sites_widget)
        
        # Barre d'adresse personnalis√©e
        url_widget = QtWidgets.QWidget(objectName="GlassCard")
        url_layout = QtWidgets.QHBoxLayout(url_widget)
        url_layout.setContentsMargins(12, 12, 12, 12)
        
        url_label = QtWidgets.QLabel("üåê URL :")
        self.simple_url_input = QtWidgets.QLineEdit()
        self.simple_url_input.setPlaceholderText("https://example.com")
        open_btn = QtWidgets.QPushButton("üöÄ Ouvrir")
        
        open_btn.clicked.connect(self.open_external_url)
        self.simple_url_input.returnPressed.connect(self.open_external_url)
        
        url_layout.addWidget(url_label)
        url_layout.addWidget(self.simple_url_input)
        url_layout.addWidget(open_btn)
        lay.addWidget(url_widget)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def navigate_to(self, url):
        """Navigue vers une URL"""
        if hasattr(self, 'web_view'):
            from PyQt6.QtCore import QUrl
            if not url.startswith(('http://', 'https://')):
                url = 'https://' + url
            self.web_view.setUrl(QUrl(url))
    
    def navigate_from_address_bar(self):
        """Navigue vers l'URL dans la barre d'adresse"""
        url = self.address_bar.text().strip()
        if url:
            # Si ce n'est pas une URL compl√®te, faire une recherche Google
            if not url.startswith(('http://', 'https://')) and '.' not in url:
                url = f"https://www.google.com/search?q={url}"
            self.navigate_to(url)
    
    def update_address_bar(self, url):
        """Met √† jour la barre d'adresse"""
        if hasattr(self, 'address_bar'):
            self.address_bar.setText(url.toString())
    
    def open_external_url(self):
        """Ouvre une URL dans le navigateur externe"""
        url = self.simple_url_input.text().strip()
        if url:
            if not url.startswith(('http://', 'https://')):
                url = 'https://' + url
            try:
                webbrowser.open(url)
                QtWidgets.QMessageBox.information(
                    self, "Ouvert", 
                    f"URL ouverte dans le navigateur par d√©faut :\n{url}"
                )
            except Exception as e:
                QtWidgets.QMessageBox.critical(
                    self, "Erreur", 
                    f"Impossible d'ouvrir l'URL :\n{e}"
                )



    def show_chat(self):
        """Application de chat Ragnar"""
        d = GlassDialog("üí¨ Ragnar Chat", (600, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Ragnar Chat", "Assistant IA int√©gr√©")
        lay.addWidget(header)
        
        # Zone de chat
        self.chat_display = QtWidgets.QTextEdit()
        self.chat_display.setReadOnly(True)
        self.chat_display.setObjectName("GlassCard")
        self.chat_display.append("ü§ñ <b>RagnarAI:</b> Salut ! Je suis ton assistant IA. Comment puis-je t'aider ?")
        lay.addWidget(self.chat_display)
        
        # Zone de saisie
        input_layout = QtWidgets.QHBoxLayout()
        self.chat_input = QtWidgets.QLineEdit()
        self.chat_input.setPlaceholderText("Tapez votre message ici...")
        self.chat_input.returnPressed.connect(lambda: self.send_message(d))
        
        send_btn = QtWidgets.QPushButton("üì§ Envoyer")
        send_btn.clicked.connect(lambda: self.send_message(d))
        
        input_layout.addWidget(self.chat_input)
        input_layout.addWidget(send_btn)
        lay.addLayout(input_layout)
        
        # Boutons d'action
        btn_layout = QtWidgets.QHBoxLayout()
        clear_btn = QtWidgets.QPushButton("üóëÔ∏è Effacer")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        clear_btn.clicked.connect(lambda: self.clear_chat(d))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(clear_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
        self.chat_input.setFocus()
    
    def send_message(self, dialog):
        """Envoie un message dans le chat"""
        message = self.chat_input.text().strip()
        if not message:
            return
        
        # Afficher le message utilisateur
        self.chat_display.append(f"üë§ <b>Vous:</b> {message}")
        self.chat_input.clear()
        
        # R√©ponse automatique de l'IA
        responses = [
            "C'est une excellente question ! ü§î",
            "Je vois ce que tu veux dire. Ragnar OS est vraiment g√©nial ! üöÄ",
            "Int√©ressant ! As-tu essay√© les nouvelles fonctionnalit√©s ? ‚ú®",
            "Ragnar OS 26.3.0 - L'√©cosyst√®me complet est arriv√© ! üéÜ",
            "Tu peux cr√©er des fichiers avec le clic droit maintenant ! üìÅ",
            "Le syst√®me de mise √† jour est super pratique ! ‚¨áÔ∏è",
            "N'h√©site pas si tu as d'autres questions ! üòä",
            "Ragnar OS devient de plus en plus puissant ! üí™",
        ]
        
        import random
        response = random.choice(responses)
        
        # D√©lai pour simuler la r√©flexion
        QtCore.QTimer.singleShot(1000, lambda: self.chat_display.append(f"ü§ñ <b>RagnarAI:</b> {response}"))
        
        # Scroll vers le bas
        QtCore.QTimer.singleShot(1100, lambda: self.chat_display.verticalScrollBar().setValue(
            self.chat_display.verticalScrollBar().maximum()
        ))
    
    def clear_chat(self, dialog):
        """Efface l'historique du chat"""
        self.chat_display.clear()
        self.chat_display.append("ü§ñ <b>RagnarAI:</b> Chat effac√© ! Comment puis-je t'aider ?")
        self.chat_input.setFocus()

    def show_ragnar_link(self):
        """Ragnar Link - R√©seau social ultra-s√©curis√©"""
        try:
            d = GlassDialog("üîó Ragnar Link - R√©seau Social", (900, 700), self)
            lay = QtWidgets.QVBoxLayout(d)
            
            # Header avec statut de connexion
            header_widget = QtWidgets.QWidget(objectName="GlassCard")
            header_layout = QtWidgets.QVBoxLayout(header_widget)
            header_layout.setContentsMargins(16, 16, 16, 16)
            
            title_layout = QtWidgets.QHBoxLayout()
            title = QtWidgets.QLabel("üîó <b>Ragnar Link</b> - R√©seau Social Ultra-S√©curis√©")
            title.setStyleSheet("font-size: 18px; font-weight: bold;")
            
            # Statut de connexion
            self.connection_status = QtWidgets.QLabel("üü¢ Connect√© - S√©curis√©")
            self.connection_status.setStyleSheet("color: #00ff88; font-weight: bold;")
            
            title_layout.addWidget(title)
            title_layout.addStretch()
            title_layout.addWidget(self.connection_status)
            header_layout.addLayout(title_layout)
            
            # Infos utilisateur
            user_info = QtWidgets.QLabel(f"üë§ Utilisateur: RagnarUser_{random.randint(1000,9999)} | üîê Chiffrement: AES-256 | üì° Serveur: S√©curis√©")
            user_info.setStyleSheet("color: rgba(255,255,255,0.8); font-size: 11px;")
            header_layout.addWidget(user_info)
            
            lay.addWidget(header_widget)
            
            # Interface principale avec onglets
            tabs = QtWidgets.QTabWidget()
            tabs.setObjectName("GlassCard")
            
            # Onglet Chat Global
            chat_tab = self.create_chat_tab()
            tabs.addTab(chat_tab, "üí¨ Chat Global")
            
            # Onglet Messages Priv√©s
            private_tab = self.create_private_messages_tab()
            tabs.addTab(private_tab, "üìß Messages Priv√©s")
            
            # Onglet Partage Photos
            photos_tab = self.create_photos_tab()
            tabs.addTab(photos_tab, "üì∏ Photos")
            
            # Onglet Contacts
            contacts_tab = self.create_contacts_tab()
            tabs.addTab(contacts_tab, "üë• Contacts")
            
            lay.addWidget(tabs)
            
            # Barre de statut s√©curit√©
            security_bar = QtWidgets.QWidget(objectName="GlassCard")
            security_layout = QtWidgets.QHBoxLayout(security_bar)
            security_layout.setContentsMargins(12, 8, 12, 8)
            
            security_info = QtWidgets.QLabel("üõ°Ô∏è Connexion chiffr√©e | üîí Messages s√©curis√©s | üö´ Aucune donn√©e stock√©e")
            security_info.setStyleSheet("color: #00ff88; font-size: 10px;")
            
            close_btn = QtWidgets.QPushButton("‚ùå D√©connexion")
            close_btn.clicked.connect(d.close)
            
            security_layout.addWidget(security_info)
            security_layout.addStretch()
            security_layout.addWidget(close_btn)
            
            lay.addWidget(security_bar)
            
            d.show()
            
            # Animations d'entr√©e am√©lior√©es
            fade_in(d, 800)
            bounce_in(d, 1000)
            
        except Exception as e:
            # Afficher l'erreur pour diagnostic
            QtWidgets.QMessageBox.critical(
                self, "üö® Erreur Ragnar Link",
                f"Une erreur est survenue lors du lancement de Ragnar Link :\n\n"
                f"Erreur : {str(e)}\n\n"
                f"Version : {DEFAULT_LOCAL_VERSION}\n"
                f"Veuillez signaler ce probl√®me."
            )
            print(f"Erreur Ragnar Link: {e}")
            import traceback
            traceback.print_exc()
    
    def create_chat_tab(self):
        """Cr√©e l'onglet de chat global"""
        widget = QtWidgets.QWidget()
        layout = QtWidgets.QVBoxLayout(widget)
        
        # Zone d'affichage des messages
        self.global_chat = QtWidgets.QTextEdit()
        self.global_chat.setReadOnly(True)
        self.global_chat.setObjectName("GlassCard")
        
        # Messages d'exemple
        self.global_chat.setHtml("""
        <div style='color: #00ff88; font-weight: bold;'>üîó Ragnar Link - Chat Global S√©curis√©</div><br>
        <div style='color: #88ccff;'><b>ü§ñ Syst√®me:</b> Bienvenue dans Ragnar Link ! Tous les messages sont chiffr√©s.</div><br>
        <div style='color: #ffaa88;'><b>üë§ RagnarUser_1337:</b> Salut tout le monde ! üëã</div><br>
        <div style='color: #ff88cc;'><b>üë§ RagnarUser_2024:</b> Cette nouvelle version est incroyable ! üöÄ</div><br>
        <div style='color: #88ffaa;'><b>üë§ RagnarUser_9999:</b> J'adore le syst√®me de s√©curit√© ! üõ°Ô∏è</div><br>
        <div style='color: #ccaa88;'><b>üë§ RagnarUser_4567:</b> Quelqu'un a test√© le partage de photos ? üì∏</div><br>
        """)
        
        layout.addWidget(self.global_chat)
        
        # Zone de saisie avec options
        input_frame = QtWidgets.QWidget(objectName="GlassCard")
        input_layout = QtWidgets.QVBoxLayout(input_frame)
        input_layout.setContentsMargins(12, 12, 12, 12)
        
        # Barre d'outils
        toolbar = QtWidgets.QHBoxLayout()
        emoji_btn = QtWidgets.QPushButton("üòä")
        photo_btn = QtWidgets.QPushButton("üì∏")
        secure_btn = QtWidgets.QPushButton("üîê")
        
        emoji_btn.setMaximumWidth(40)
        photo_btn.setMaximumWidth(40)
        secure_btn.setMaximumWidth(40)
        
        emoji_btn.clicked.connect(self.add_emoji_to_message)
        photo_btn.clicked.connect(self.send_photo_to_chat)
        secure_btn.clicked.connect(self.toggle_secure_mode)
        
        toolbar.addWidget(emoji_btn)
        toolbar.addWidget(photo_btn)
        toolbar.addWidget(secure_btn)
        toolbar.addStretch()
        
        input_layout.addLayout(toolbar)
        
        # Ligne de saisie
        message_layout = QtWidgets.QHBoxLayout()
        self.global_message_input = QtWidgets.QLineEdit()
        self.global_message_input.setPlaceholderText("üí¨ Tapez votre message s√©curis√©...")
        self.global_message_input.returnPressed.connect(self.send_global_message)
        
        send_btn = QtWidgets.QPushButton("üì§ Envoyer")
        send_btn.clicked.connect(self.send_global_message)
        
        message_layout.addWidget(self.global_message_input)
        message_layout.addWidget(send_btn)
        input_layout.addLayout(message_layout)
        
        layout.addWidget(input_frame)
        
        return widget
    
    def create_private_messages_tab(self):
        """Cr√©e l'onglet des messages priv√©s"""
        widget = QtWidgets.QWidget()
        layout = QtWidgets.QHBoxLayout(widget)
        
        # Liste des conversations
        conversations_frame = QtWidgets.QWidget(objectName="GlassCard")
        conversations_layout = QtWidgets.QVBoxLayout(conversations_frame)
        conversations_layout.setContentsMargins(12, 12, 12, 12)
        
        conv_title = QtWidgets.QLabel("üí¨ <b>Conversations</b>")
        conversations_layout.addWidget(conv_title)
        
        self.conversations_list = QtWidgets.QListWidget()
        self.conversations_list.setObjectName("GlassCard")
        
        # Conversations d'exemple
        conversations = [
            "üü¢ RagnarUser_1337 - En ligne",
            "üü° RagnarUser_2024 - Il y a 5 min",
            "üî¥ RagnarUser_9999 - Hors ligne",
            "üü¢ RagnarUser_4567 - En ligne"
        ]
        
        for conv in conversations:
            self.conversations_list.addItem(conv)
        
        conversations_layout.addWidget(self.conversations_list)
        
        # Bouton nouvelle conversation
        new_conv_btn = QtWidgets.QPushButton("‚ûï Nouvelle conversation")
        new_conv_btn.clicked.connect(self.start_new_conversation)
        conversations_layout.addWidget(new_conv_btn)
        
        layout.addWidget(conversations_frame)
        
        # Zone de chat priv√©
        private_chat_frame = QtWidgets.QWidget(objectName="GlassCard")
        private_chat_layout = QtWidgets.QVBoxLayout(private_chat_frame)
        private_chat_layout.setContentsMargins(12, 12, 12, 12)
        
        chat_header = QtWidgets.QLabel("üîê <b>Chat Priv√© Chiffr√©</b> avec RagnarUser_1337")
        private_chat_layout.addWidget(chat_header)
        
        self.private_chat = QtWidgets.QTextEdit()
        self.private_chat.setReadOnly(True)
        self.private_chat.setObjectName("GlassCard")
        self.private_chat.setHtml("""
        <div style='color: #88ccff;'><b>üîê Syst√®me:</b> Conversation chiffr√©e de bout en bout activ√©e</div><br>
        <div style='color: #ffaa88;'><b>üë§ RagnarUser_1337:</b> Salut ! Comment tu trouves Ragnar Link ?</div><br>
        <div style='color: #00ff88;'><b>üë§ Vous:</b> C'est incroyable ! La s√©curit√© est parfaite üõ°Ô∏è</div><br>
        <div style='color: #ffaa88;'><b>üë§ RagnarUser_1337:</b> Oui ! Et le partage de photos est g√©nial üì∏</div><br>
        """)
        
        private_chat_layout.addWidget(self.private_chat)
        
        # Zone de saisie priv√©e
        private_input_layout = QtWidgets.QHBoxLayout()
        self.private_message_input = QtWidgets.QLineEdit()
        self.private_message_input.setPlaceholderText("üîê Message priv√© chiffr√©...")
        self.private_message_input.returnPressed.connect(self.send_private_message)
        
        private_send_btn = QtWidgets.QPushButton("üîí Envoyer")
        private_send_btn.clicked.connect(self.send_private_message)
        
        private_input_layout.addWidget(self.private_message_input)
        private_input_layout.addWidget(private_send_btn)
        private_chat_layout.addLayout(private_input_layout)
        
        layout.addWidget(private_chat_frame)
        
        return widget
    
    def create_photos_tab(self):
        """Cr√©e l'onglet de partage de photos"""
        widget = QtWidgets.QWidget()
        layout = QtWidgets.QVBoxLayout(widget)
        
        # Header
        header = QtWidgets.QLabel("üì∏ <b>Partage de Photos S√©curis√©</b>")
        header.setStyleSheet("font-size: 16px; font-weight: bold; padding: 10px;")
        layout.addWidget(header)
        
        # Zone de galerie
        gallery_frame = QtWidgets.QWidget(objectName="GlassCard")
        gallery_layout = QtWidgets.QVBoxLayout(gallery_frame)
        gallery_layout.setContentsMargins(16, 16, 16, 16)
        
        gallery_title = QtWidgets.QLabel("üñºÔ∏è <b>Galerie Partag√©e</b>")
        gallery_layout.addWidget(gallery_title)
        
        # Grille de photos simul√©es
        photos_grid = QtWidgets.QGridLayout()
        
        photo_examples = [
            "üåÖ Coucher de soleil",
            "üèîÔ∏è Montagne",
            "üåä Oc√©an",
            "üå∏ Fleurs",
            "üèôÔ∏è Ville",
            "üåü √âtoiles"
        ]
        
        for i, photo in enumerate(photo_examples):
            photo_btn = QtWidgets.QPushButton(photo)
            photo_btn.setMinimumHeight(80)
            photo_btn.setStyleSheet("font-size: 24px;")
            photo_btn.clicked.connect(lambda checked, p=photo: self.view_photo(p))
            photos_grid.addWidget(photo_btn, i // 3, i % 3)
        
        gallery_layout.addLayout(photos_grid)
        layout.addWidget(gallery_frame)
        
        # Zone d'upload
        upload_frame = QtWidgets.QWidget(objectName="GlassCard")
        upload_layout = QtWidgets.QVBoxLayout(upload_frame)
        upload_layout.setContentsMargins(16, 16, 16, 16)
        
        upload_title = QtWidgets.QLabel("üì§ <b>Partager une Photo</b>")
        upload_layout.addWidget(upload_title)
        
        upload_buttons = QtWidgets.QHBoxLayout()
        select_photo_btn = QtWidgets.QPushButton("üìÅ S√©lectionner Photo")
        take_photo_btn = QtWidgets.QPushButton("üì∑ Prendre Photo")
        upload_btn = QtWidgets.QPushButton("üîê Partager (Chiffr√©)")
        
        select_photo_btn.clicked.connect(self.select_photo_to_share)
        take_photo_btn.clicked.connect(self.take_photo)
        upload_btn.clicked.connect(self.upload_photo_secure)
        
        upload_buttons.addWidget(select_photo_btn)
        upload_buttons.addWidget(take_photo_btn)
        upload_buttons.addWidget(upload_btn)
        
        upload_layout.addLayout(upload_buttons)
        
        # Info s√©curit√©
        security_info = QtWidgets.QLabel("üõ°Ô∏è Toutes les photos sont chiffr√©es avant envoi | üóëÔ∏è Auto-suppression apr√®s 24h")
        security_info.setStyleSheet("color: #00ff88; font-size: 10px; padding: 5px;")
        upload_layout.addWidget(security_info)
        
        layout.addWidget(upload_frame)
        
        return widget
    
    def create_contacts_tab(self):
        """Cr√©e l'onglet des contacts"""
        widget = QtWidgets.QWidget()
        layout = QtWidgets.QVBoxLayout(widget)
        
        # Header
        header = QtWidgets.QLabel("üë• <b>Contacts Ragnar Link</b>")
        header.setStyleSheet("font-size: 16px; font-weight: bold; padding: 10px;")
        layout.addWidget(header)
        
        # Liste des contacts
        contacts_frame = QtWidgets.QWidget(objectName="GlassCard")
        contacts_layout = QtWidgets.QVBoxLayout(contacts_frame)
        contacts_layout.setContentsMargins(16, 16, 16, 16)
        
        # Barre de recherche
        search_layout = QtWidgets.QHBoxLayout()
        search_input = QtWidgets.QLineEdit()
        search_input.setPlaceholderText("üîç Rechercher un contact...")
        search_btn = QtWidgets.QPushButton("üîç")
        search_btn.setMaximumWidth(40)
        
        search_layout.addWidget(search_input)
        search_layout.addWidget(search_btn)
        contacts_layout.addLayout(search_layout)
        
        # Liste des contacts
        self.contacts_list = QtWidgets.QListWidget()
        self.contacts_list.setObjectName("GlassCard")
        
        contacts = [
            "üü¢ RagnarUser_1337 - D√©veloppeur | üîê V√©rifi√©",
            "üü° RagnarUser_2024 - Designer | üîê V√©rifi√©", 
            "üü¢ RagnarUser_9999 - Testeur | üîê V√©rifi√©",
            "üî¥ RagnarUser_4567 - Community | üîê V√©rifi√©",
            "üü¢ RagnarUser_8888 - Mod√©rateur | üîê V√©rifi√©"
        ]
        
        for contact in contacts:
            self.contacts_list.addItem(contact)
        
        contacts_layout.addWidget(self.contacts_list)
        
        # Boutons d'action
        contact_actions = QtWidgets.QHBoxLayout()
        add_contact_btn = QtWidgets.QPushButton("‚ûï Ajouter Contact")
        block_btn = QtWidgets.QPushButton("üö´ Bloquer")
        verify_btn = QtWidgets.QPushButton("‚úÖ V√©rifier")
        
        add_contact_btn.clicked.connect(self.add_new_contact)
        block_btn.clicked.connect(self.block_contact)
        verify_btn.clicked.connect(self.verify_contact)
        
        contact_actions.addWidget(add_contact_btn)
        contact_actions.addWidget(block_btn)
        contact_actions.addWidget(verify_btn)
        
        contacts_layout.addLayout(contact_actions)
        layout.addWidget(contacts_frame)
        
        return widget
    
    # M√©thodes pour les fonctionnalit√©s de Ragnar Link
    
    def send_global_message(self):
        """Envoie un message dans le chat global"""
        message = self.global_message_input.text().strip()
        if not message:
            return
        
        # Simuler l'envoi s√©curis√©
        user_id = f"RagnarUser_{random.randint(1000,9999)}"
        timestamp = QtCore.QTime.currentTime().toString("HH:mm")
        
        self.global_chat.append(f"<div style='color: #00ff88;'><b>üë§ Vous [{timestamp}]:</b> {message} üîê</div><br>")
        self.global_message_input.clear()
        
        # R√©ponse automatique simul√©e
        QtCore.QTimer.singleShot(2000, lambda: self.simulate_global_response(message))
    
    def simulate_global_response(self, original_message):
        """Simule une r√©ponse dans le chat global"""
        responses = [
            "Int√©ressant ! ü§î",
            "Je suis d'accord ! üëç",
            "Ragnar Link est g√©nial ! üöÄ",
            "Super s√©curis√© ! üõ°Ô∏è",
            "J'adore cette fonctionnalit√© ! ‚ù§Ô∏è"
        ]
        
        user_id = f"RagnarUser_{random.randint(1000,9999)}"
        response = random.choice(responses)
        timestamp = QtCore.QTime.currentTime().toString("HH:mm")
        
        self.global_chat.append(f"<div style='color: #ffaa88;'><b>üë§ {user_id} [{timestamp}]:</b> {response}</div><br>")
        
        # Auto-scroll
        self.global_chat.verticalScrollBar().setValue(self.global_chat.verticalScrollBar().maximum())
    
    def send_private_message(self):
        """Envoie un message priv√©"""
        message = self.private_message_input.text().strip()
        if not message:
            return
        
        timestamp = QtCore.QTime.currentTime().toString("HH:mm")
        self.private_chat.append(f"<div style='color: #00ff88;'><b>üë§ Vous [{timestamp}]:</b> {message} üîê</div><br>")
        self.private_message_input.clear()
        
        # R√©ponse automatique
        QtCore.QTimer.singleShot(1500, lambda: self.simulate_private_response())
    
    def simulate_private_response(self):
        """Simule une r√©ponse priv√©e"""
        responses = [
            "Message re√ßu ! üì®",
            "Merci pour le message s√©curis√© ! üîê",
            "Ragnar Link prot√®ge notre conversation ! üõ°Ô∏è",
            "C'est vraiment pratique ! ‚ú®"
        ]
        
        response = random.choice(responses)
        timestamp = QtCore.QTime.currentTime().toString("HH:mm")
        
        self.private_chat.append(f"<div style='color: #ffaa88;'><b>üë§ RagnarUser_1337 [{timestamp}]:</b> {response}</div><br>")
        self.private_chat.verticalScrollBar().setValue(self.private_chat.verticalScrollBar().maximum())
    
    def add_emoji_to_message(self):
        """Ajoute un emoji au message"""
        emojis = ["üòä", "üöÄ", "‚ù§Ô∏è", "üî•", "‚ú®", "üéâ", "üëç", "ü§î", "üòé", "üõ°Ô∏è"]
        emoji = random.choice(emojis)
        current_text = self.global_message_input.text()
        self.global_message_input.setText(current_text + emoji)
    
    def send_photo_to_chat(self):
        """Simule l'envoi d'une photo dans le chat"""
        photos = ["üåÖ", "üèîÔ∏è", "üåä", "üå∏", "üèôÔ∏è", "üåü", "ü¶ã", "üå∫"]
        photo = random.choice(photos)
        timestamp = QtCore.QTime.currentTime().toString("HH:mm")
        
        self.global_chat.append(f"<div style='color: #00ff88;'><b>üë§ Vous [{timestamp}]:</b> Photo partag√©e {photo} üì∏üîê</div><br>")
        
        QtWidgets.QMessageBox.information(
            self, "üì∏ Photo Envoy√©e",
            "Photo envoy√©e avec chiffrement de bout en bout ! üîê‚ú®"
        )
    
    def toggle_secure_mode(self):
        """Active/d√©sactive le mode ultra-s√©curis√©"""
        QtWidgets.QMessageBox.information(
            self, "üîê Mode S√©curis√©",
            "Mode ultra-s√©curis√© ACTIV√â !\n\n"
            "üõ°Ô∏è Chiffrement AES-256\n"
            "üîí Cl√©s √©ph√©m√®res\n"
            "üö´ Aucun stockage local\n"
            "‚ö° Transmission instantan√©e"
        )
    
    def select_photo_to_share(self):
        """S√©lectionne une photo √† partager"""
        file_path, _ = QtWidgets.QFileDialog.getOpenFileName(
            self, "S√©lectionner une photo",
            "", "Images (*.png *.jpg *.jpeg *.gif *.bmp)"
        )
        
        if file_path:
            QtWidgets.QMessageBox.information(
                self, "üì∏ Photo S√©lectionn√©e",
                f"Photo s√©lectionn√©e : {Path(file_path).name}\n\n"
                f"üîê Sera chiffr√©e avant envoi\n"
                f"üì§ Pr√™te pour le partage s√©curis√©"
            )
    
    def take_photo(self):
        """Simule la prise de photo"""
        QtWidgets.QMessageBox.information(
            self, "üì∑ Photo Prise",
            "Photo prise avec succ√®s ! üì∏\n\n"
            "üîê Chiffrement automatique activ√©\n"
            "üì§ Pr√™te pour le partage"
        )
    
    def upload_photo_secure(self):
        """Upload s√©curis√© d'une photo"""
        QtWidgets.QMessageBox.information(
            self, "üîê Upload S√©curis√©",
            "Photo upload√©e avec succ√®s ! üéâ\n\n"
            "‚úÖ Chiffrement AES-256 appliqu√©\n"
            "üõ°Ô∏è Transmission s√©curis√©e\n"
            "üóëÔ∏è Auto-suppression dans 24h\n"
            "üì± Visible par vos contacts"
        )
    
    def view_photo(self, photo_name):
        """Affiche une photo"""
        QtWidgets.QMessageBox.information(
            self, "üñºÔ∏è Photo",
            f"Affichage de : {photo_name}\n\n"
            f"üîê Photo d√©chiffr√©e localement\n"
            f"üë§ Partag√©e par RagnarUser_{random.randint(1000,9999)}\n"
            f"‚è∞ Il y a {random.randint(1,60)} minutes"
        )
    
    def start_new_conversation(self):
        """D√©marre une nouvelle conversation"""
        user_id, ok = QtWidgets.QInputDialog.getText(
            self, "üí¨ Nouvelle Conversation",
            "ID de l'utilisateur √† contacter :"
        )
        
        if ok and user_id:
            QtWidgets.QMessageBox.information(
                self, "üîê Conversation Cr√©√©e",
                f"Conversation s√©curis√©e cr√©√©e avec {user_id} !\n\n"
                f"üõ°Ô∏è Chiffrement de bout en bout activ√©\n"
                f"üîë Cl√©s √©chang√©es en s√©curit√©\n"
                f"üí¨ Pr√™t pour les messages priv√©s"
            )
    
    def add_new_contact(self):
        """Ajoute un nouveau contact"""
        user_id, ok = QtWidgets.QInputDialog.getText(
            self, "üë• Ajouter Contact",
            "ID de l'utilisateur √† ajouter :"
        )
        
        if ok and user_id:
            self.contacts_list.addItem(f"üü¢ {user_id} - Nouveau | üîê En attente de v√©rification")
            QtWidgets.QMessageBox.information(
                self, "‚úÖ Contact Ajout√©",
                f"Contact {user_id} ajout√© avec succ√®s !\n\n"
                f"üîê V√©rification de s√©curit√© en cours\n"
                f"üì± Invitation envoy√©e"
            )
    
    def block_contact(self):
        """Bloque un contact"""
        current_item = self.contacts_list.currentItem()
        if current_item:
            QtWidgets.QMessageBox.information(
                self, "üö´ Contact Bloqu√©",
                f"Contact bloqu√© avec succ√®s !\n\n"
                f"üõ°Ô∏è Messages bloqu√©s\n"
                f"üö´ Acc√®s refus√©\n"
                f"üîê S√©curit√© renforc√©e"
            )
    
    def verify_contact(self):
        """V√©rifie un contact"""
        current_item = self.contacts_list.currentItem()
        if current_item:
            QtWidgets.QMessageBox.information(
                self, "‚úÖ Contact V√©rifi√©",
                f"Contact v√©rifi√© avec succ√®s ! üéâ\n\n"
                f"üîê Identit√© confirm√©e\n"
                f"üõ°Ô∏è Cl√©s de s√©curit√© √©chang√©es\n"
                f"‚úÖ Communication s√©curis√©e √©tablie"
            )

    # ===== NOUVELLES FONCTIONNALIT√âS ULTRA-UTILES =====
    
    def show_network_monitor(self):
        """Moniteur r√©seau en temps r√©el"""
        d = GlassDialog("üìä Moniteur R√©seau Ragnar", (700, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Moniteur R√©seau", "Surveillance du trafic en temps r√©el")
        lay.addWidget(header)
        
        # Informations r√©seau
        info_widget = QtWidgets.QWidget(objectName="GlassCard")
        info_layout = QtWidgets.QVBoxLayout(info_widget)
        info_layout.setContentsMargins(16, 16, 16, 16)
        
        try:
            import socket
            hostname = socket.gethostname()
            local_ip = socket.gethostbyname(hostname)
            
            network_info = [
                f"üñ•Ô∏è Nom d'h√¥te : {hostname}",
                f"üåê IP Locale : {local_ip}",
                f"üì° Connexions actives : {random.randint(5, 25)}",
                f"‚¨áÔ∏è T√©l√©chargement : {random.randint(10, 100)} MB/s",
                f"‚¨ÜÔ∏è Upload : {random.randint(5, 50)} MB/s",
                f"üìä Paquets envoy√©s : {random.randint(1000, 9999)}",
                f"üìà Paquets re√ßus : {random.randint(1000, 9999)}",
            ]
            
            for info in network_info:
                label = QtWidgets.QLabel(info)
                label.setStyleSheet("padding: 6px; font-size: 12px;")
                info_layout.addWidget(label)
                
        except Exception:
            error_label = QtWidgets.QLabel("‚ùå Impossible d'obtenir les informations r√©seau")
            info_layout.addWidget(error_label)
        
        lay.addWidget(info_widget)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        refresh_btn = QtWidgets.QPushButton("üîÑ Actualiser")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        refresh_btn.clicked.connect(lambda: (d.close(), self.show_network_monitor()))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(refresh_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def show_file_search(self):
        """Recherche de fichiers avanc√©e"""
        d = GlassDialog("üîç Recherche de Fichiers", (600, 450), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Recherche de Fichiers", "Trouvez vos fichiers rapidement")
        lay.addWidget(header)
        
        # Zone de recherche
        search_widget = QtWidgets.QWidget(objectName="GlassCard")
        search_layout = QtWidgets.QVBoxLayout(search_widget)
        search_layout.setContentsMargins(16, 16, 16, 16)
        
        search_input = QtWidgets.QLineEdit()
        search_input.setPlaceholderText("üîç Nom du fichier √† rechercher...")
        
        location_input = QtWidgets.QLineEdit()
        location_input.setPlaceholderText("üìÅ Dossier de recherche (optionnel)")
        location_input.setText(str(Path.home()))
        
        search_btn = QtWidgets.QPushButton("üîç Rechercher")
        
        search_layout.addWidget(QtWidgets.QLabel("Nom du fichier :"))
        search_layout.addWidget(search_input)
        search_layout.addWidget(QtWidgets.QLabel("Dossier :"))
        search_layout.addWidget(location_input)
        search_layout.addWidget(search_btn)
        
        lay.addWidget(search_widget)
        
        # R√©sultats
        results_widget = QtWidgets.QWidget(objectName="GlassCard")
        results_layout = QtWidgets.QVBoxLayout(results_widget)
        results_layout.setContentsMargins(16, 16, 16, 16)
        
        results_list = QtWidgets.QListWidget()
        results_list.setObjectName("GlassCard")
        
        results_layout.addWidget(QtWidgets.QLabel("üìã R√©sultats :"))
        results_layout.addWidget(results_list)
        
        lay.addWidget(results_widget)
        
        def perform_search():
            results_list.clear()
            query = search_input.text().strip()
            if not query:
                return
            
            try:
                search_path = Path(location_input.text() or str(Path.home()))
                found_files = list(search_path.rglob(f"*{query}*"))[:20]  # Limiter √† 20 r√©sultats
                
                for file_path in found_files:
                    results_list.addItem(f"üìÑ {file_path}")
                
                if not found_files:
                    results_list.addItem("‚ùå Aucun fichier trouv√©")
                    
            except Exception as e:
                results_list.addItem(f"‚ùå Erreur : {e}")
        
        search_btn.clicked.connect(perform_search)
        search_input.returnPressed.connect(perform_search)
        
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def show_updater(self):
        """Gestionnaire de mises √† jour s√©curis√© avec interface moderne"""
        d = GlassDialog("‚¨áÔ∏è Gestionnaire de Mises √† Jour S√©curis√©", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Gestionnaire de Mises √† Jour S√©curis√©", "G√©rez votre historique de mises √† jour")
        lay.addWidget(header)
        # Zone de contenu
        content_widget = QtWidgets.QWidget(objectName="GlassCard")
        content_layout = QtWidgets.QVBoxLayout(content_widget)
        content_layout.setContentsMargins(16, 16, 16, 16)
        
        # Contenu actuel
        try:
            from PyQt6.QtGui import QClipboard
            clipboard = QtWidgets.QApplication.clipboard()
            current_text = clipboard.text()
        except:
            current_text = "Contenu du presse-papiers non disponible"
        
        current_label = QtWidgets.QLabel("üìã Contenu actuel :")
        current_text_edit = QtWidgets.QTextEdit()
        current_text_edit.setPlainText(current_text)
        current_text_edit.setMaximumHeight(100)
        
        content_layout.addWidget(current_label)
        content_layout.addWidget(current_text_edit)
        
        # Nouveau contenu
        new_label = QtWidgets.QLabel("‚úèÔ∏è Nouveau contenu :")
        new_text_edit = QtWidgets.QTextEdit()
        new_text_edit.setPlaceholderText("Tapez le texte √† copier...")
        new_text_edit.setMaximumHeight(100)
        
        content_layout.addWidget(new_label)
        content_layout.addWidget(new_text_edit)
        
        lay.addWidget(content_widget)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        copy_btn = QtWidgets.QPushButton("üìã Copier")
        clear_btn = QtWidgets.QPushButton("üóëÔ∏è Effacer")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        def copy_text():
            try:
                clipboard = QtWidgets.QApplication.clipboard()
                clipboard.setText(new_text_edit.toPlainText())
                QtWidgets.QMessageBox.information(d, "‚úÖ Copi√©", "Texte copi√© dans le presse-papiers !")
            except Exception as e:
                QtWidgets.QMessageBox.critical(d, "‚ùå Erreur", f"Impossible de copier : {e}")
        
        def clear_clipboard():
            try:
                clipboard = QtWidgets.QApplication.clipboard()
                clipboard.clear()
                current_text_edit.clear()
                QtWidgets.QMessageBox.information(d, "‚úÖ Effac√©", "Presse-papiers effac√© !")
            except Exception as e:
                QtWidgets.QMessageBox.critical(d, "‚ùå Erreur", f"Impossible d'effacer : {e}")
        
        copy_btn.clicked.connect(copy_text)
        clear_btn.clicked.connect(clear_clipboard)
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(copy_btn)
        btn_layout.addWidget(clear_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def show_password_generator(self):
        """G√©n√©rateur de mots de passe s√©curis√©s"""
        d = GlassDialog("üîê G√©n√©rateur de Mots de Passe", (500, 400), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("G√©n√©rateur de Mots de Passe", "Cr√©ez des mots de passe s√©curis√©s")
        lay.addWidget(header)
        
        # Options
        options_widget = QtWidgets.QWidget(objectName="GlassCard")
        options_layout = QtWidgets.QVBoxLayout(options_widget)
        options_layout.setContentsMargins(16, 16, 16, 16)
        
        # Longueur
        length_layout = QtWidgets.QHBoxLayout()
        length_layout.addWidget(QtWidgets.QLabel("Longueur :"))
        length_spin = QtWidgets.QSpinBox()
        length_spin.setRange(4, 128)
        length_spin.setValue(16)
        length_layout.addWidget(length_spin)
        length_layout.addStretch()
        
        # Options
        uppercase_cb = QtWidgets.QCheckBox("Majuscules (A-Z)")
        uppercase_cb.setChecked(True)
        lowercase_cb = QtWidgets.QCheckBox("Minuscules (a-z)")
        lowercase_cb.setChecked(True)
        numbers_cb = QtWidgets.QCheckBox("Chiffres (0-9)")
        numbers_cb.setChecked(True)
        symbols_cb = QtWidgets.QCheckBox("Symboles (!@#$%)")
        symbols_cb.setChecked(True)
        
        options_layout.addLayout(length_layout)
        options_layout.addWidget(uppercase_cb)
        options_layout.addWidget(lowercase_cb)
        options_layout.addWidget(numbers_cb)
        options_layout.addWidget(symbols_cb)
        
        lay.addWidget(options_widget)
        
        # R√©sultat
        result_widget = QtWidgets.QWidget(objectName="GlassCard")
        result_layout = QtWidgets.QVBoxLayout(result_widget)
        result_layout.setContentsMargins(16, 16, 16, 16)
        
        result_label = QtWidgets.QLabel("üîê Mot de passe g√©n√©r√© :")
        password_text = QtWidgets.QLineEdit()
        password_text.setReadOnly(True)
        password_text.setStyleSheet("font-family: monospace; font-size: 14px;")
        
        result_layout.addWidget(result_label)
        result_layout.addWidget(password_text)
        
        lay.addWidget(result_widget)
        
        def generate_password():
            chars = ""
            if uppercase_cb.isChecked():
                chars += "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
            if lowercase_cb.isChecked():
                chars += "abcdefghijklmnopqrstuvwxyz"
            if numbers_cb.isChecked():
                chars += "0123456789"
            if symbols_cb.isChecked():
                chars += "!@#$%^&*()_+-=[]{}|;:,.<>?"
            
            if not chars:
                QtWidgets.QMessageBox.warning(d, "‚ö†Ô∏è Attention", "S√©lectionnez au moins un type de caract√®re !")
                return
            
            import secrets
            password = ''.join(secrets.choice(chars) for _ in range(length_spin.value()))
            password_text.setText(password)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        generate_btn = QtWidgets.QPushButton("üé≤ G√©n√©rer")
        copy_btn = QtWidgets.QPushButton("üìã Copier")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        generate_btn.clicked.connect(generate_password)
        copy_btn.clicked.connect(lambda: (
            QtWidgets.QApplication.clipboard().setText(password_text.text()),
            QtWidgets.QMessageBox.information(d, "‚úÖ Copi√©", "Mot de passe copi√© !")
        ))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(generate_btn)
        btn_layout.addWidget(copy_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        # G√©n√©rer un mot de passe par d√©faut
        generate_password()
        
        d.show()
    
    def show_qr_generator(self):
        """G√©n√©rateur de codes QR"""
        d = GlassDialog("üì± G√©n√©rateur QR Code", (500, 400), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("G√©n√©rateur QR Code", "Cr√©ez des codes QR rapidement")
        lay.addWidget(header)
        
        # Zone de saisie
        input_widget = QtWidgets.QWidget(objectName="GlassCard")
        input_layout = QtWidgets.QVBoxLayout(input_widget)
        input_layout.setContentsMargins(16, 16, 16, 16)
        
        input_label = QtWidgets.QLabel("üìù Texte √† encoder :")
        text_input = QtWidgets.QTextEdit()
        text_input.setPlaceholderText("Entrez le texte, URL, ou donn√©es √† encoder...")
        text_input.setMaximumHeight(100)
        
        input_layout.addWidget(input_label)
        input_layout.addWidget(text_input)
        
        lay.addWidget(input_widget)
        
        # Zone d'affichage QR
        qr_widget = QtWidgets.QWidget(objectName="GlassCard")
        qr_layout = QtWidgets.QVBoxLayout(qr_widget)
        qr_layout.setContentsMargins(16, 16, 16, 16)
        
        qr_label = QtWidgets.QLabel("üì± Code QR :")
        qr_display = QtWidgets.QLabel()
        qr_display.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        qr_display.setMinimumSize(200, 200)
        qr_display.setStyleSheet("border: 2px dashed rgba(255,255,255,0.3); background: rgba(255,255,255,0.1);")
        qr_display.setText("üî≤ Le code QR appara√Ætra ici")
        
        qr_layout.addWidget(qr_label)
        qr_layout.addWidget(qr_display)
        
        lay.addWidget(qr_widget)
        
        def generate_qr():
            text = text_input.toPlainText().strip()
            if not text:
                QtWidgets.QMessageBox.warning(d, "‚ö†Ô∏è Attention", "Entrez du texte √† encoder !")
                return
            
            # Simulation d'un QR code (en r√©alit√© il faudrait une biblioth√®que comme qrcode)
            qr_display.setText(f"üì± QR Code g√©n√©r√© pour :\n\n'{text[:50]}{'...' if len(text) > 50 else ''}'\n\nüî≤üî≤üî≤üî≤üî≤\nüî≤‚¨úüî≤‚¨úüî≤\nüî≤üî≤üî≤üî≤üî≤\nüî≤‚¨úüî≤‚¨úüî≤\nüî≤üî≤üî≤üî≤üî≤")
            QtWidgets.QMessageBox.information(d, "‚úÖ G√©n√©r√©", "Code QR g√©n√©r√© avec succ√®s !")
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        generate_btn = QtWidgets.QPushButton("üì± G√©n√©rer QR")
        save_btn = QtWidgets.QPushButton("üíæ Sauvegarder")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        generate_btn.clicked.connect(generate_qr)
        save_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üíæ Sauvegarde", "QR Code sauvegard√© dans le dossier Images !"))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(generate_btn)
        btn_layout.addWidget(save_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def show_audio_player(self):
        """Lecteur audio simple"""
        d = GlassDialog("üéµ Lecteur Audio Ragnar", (600, 400), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Lecteur Audio", "√âcoutez vos musiques pr√©f√©r√©es")
        lay.addWidget(header)
        
        # Zone de lecture
        player_widget = QtWidgets.QWidget(objectName="GlassCard")
        player_layout = QtWidgets.QVBoxLayout(player_widget)
        player_layout.setContentsMargins(16, 16, 16, 16)
        
        # Informations du morceau
        track_info = QtWidgets.QLabel("üéµ Aucun fichier s√©lectionn√©")
        track_info.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        track_info.setStyleSheet("font-size: 14px; font-weight: bold; padding: 10px;")
        
        # Barre de progression
        progress_bar = QtWidgets.QProgressBar()
        progress_bar.setRange(0, 100)
        progress_bar.setValue(0)
        
        # Contr√¥les
        controls_layout = QtWidgets.QHBoxLayout()
        prev_btn = QtWidgets.QPushButton("‚èÆÔ∏è")
        play_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è")
        next_btn = QtWidgets.QPushButton("‚è≠Ô∏è")
        
        prev_btn.setMaximumWidth(50)
        play_btn.setMaximumWidth(50)
        next_btn.setMaximumWidth(50)
        
        controls_layout.addStretch()
        controls_layout.addWidget(prev_btn)
        controls_layout.addWidget(play_btn)
        controls_layout.addWidget(next_btn)
        controls_layout.addStretch()
        
        player_layout.addWidget(track_info)
        player_layout.addWidget(progress_bar)
        player_layout.addLayout(controls_layout)
        
        lay.addWidget(player_widget)
        
        # Zone de playlist
        playlist_widget = QtWidgets.QWidget(objectName="GlassCard")
        playlist_layout = QtWidgets.QVBoxLayout(playlist_widget)
        playlist_layout.setContentsMargins(16, 16, 16, 16)
        
        playlist_label = QtWidgets.QLabel("üìã Playlist :")
        playlist_list = QtWidgets.QListWidget()
        playlist_list.setObjectName("GlassCard")
        
        # Playlist d'exemple
        sample_tracks = [
            "üéµ Ragnar Theme - Epic Music",
            "üé∂ Digital Dreams - Synthwave",
            "üéµ Code & Coffee - Lo-fi",
            "üé∂ System Sounds - Ambient"
        ]
        
        for track in sample_tracks:
            playlist_list.addItem(track)
        
        playlist_layout.addWidget(playlist_label)
        playlist_layout.addWidget(playlist_list)
        
        lay.addWidget(playlist_widget)
        
        # Variables de lecture
        is_playing = False
        current_track = 0
        
        def toggle_play():
            nonlocal is_playing
            is_playing = not is_playing
            if is_playing:
                play_btn.setText("‚è∏Ô∏è")
                track_info.setText(f"üéµ En lecture : {sample_tracks[current_track]}")
                # Simulation de progression
                for i in range(101):
                    progress_bar.setValue(i)
                    QtWidgets.QApplication.processEvents()
                    time.sleep(0.01)
            else:
                play_btn.setText("‚ñ∂Ô∏è")
                track_info.setText("‚è∏Ô∏è Lecture en pause")
        
        def next_track():
            nonlocal current_track
            current_track = (current_track + 1) % len(sample_tracks)
            track_info.setText(f"‚è≠Ô∏è Piste suivante : {sample_tracks[current_track]}")
            progress_bar.setValue(0)
        
        def prev_track():
            nonlocal current_track
            current_track = (current_track - 1) % len(sample_tracks)
            track_info.setText(f"‚èÆÔ∏è Piste pr√©c√©dente : {sample_tracks[current_track]}")
            progress_bar.setValue(0)
        
        play_btn.clicked.connect(toggle_play)
        next_btn.clicked.connect(next_track)
        prev_btn.clicked.connect(prev_track)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        open_btn = QtWidgets.QPushButton("üìÅ Ouvrir fichier")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        open_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìÅ Fichier", "S√©lectionnez un fichier audio √† lire !"))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(open_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def show_screenshot_tool(self):
        """Outil de capture d'√©cran"""
        d = GlassDialog("üì∏ Capture d'√âcran", (500, 350), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Capture d'√âcran", "Capturez votre √©cran facilement")
        lay.addWidget(header)
        
        # Options de capture
        options_widget = QtWidgets.QWidget(objectName="GlassCard")
        options_layout = QtWidgets.QVBoxLayout(options_widget)
        options_layout.setContentsMargins(16, 16, 16, 16)
        
        # Types de capture
        fullscreen_radio = QtWidgets.QRadioButton("üñ•Ô∏è √âcran complet")
        window_radio = QtWidgets.QRadioButton("ü™ü Fen√™tre active")
        region_radio = QtWidgets.QRadioButton("üìê R√©gion s√©lectionn√©e")
        
        fullscreen_radio.setChecked(True)
        
        # D√©lai
        delay_layout = QtWidgets.QHBoxLayout()
        delay_layout.addWidget(QtWidgets.QLabel("‚è∞ D√©lai :"))
        delay_spin = QtWidgets.QSpinBox()
        delay_spin.setRange(0, 10)
        delay_spin.setValue(3)
        delay_spin.setSuffix(" secondes")
        delay_layout.addWidget(delay_spin)
        delay_layout.addStretch()
        
        options_layout.addWidget(QtWidgets.QLabel("üì∑ Type de capture :"))
        options_layout.addWidget(fullscreen_radio)
        options_layout.addWidget(window_radio)
        options_layout.addWidget(region_radio)
        options_layout.addLayout(delay_layout)
        
        lay.addWidget(options_widget)
        
        # Zone d'aper√ßu
        preview_widget = QtWidgets.QWidget(objectName="GlassCard")
        preview_layout = QtWidgets.QVBoxLayout(preview_widget)
        preview_layout.setContentsMargins(16, 16, 16, 16)
        
        preview_label = QtWidgets.QLabel("üëÅÔ∏è Aper√ßu :")
        preview_display = QtWidgets.QLabel()
        preview_display.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        preview_display.setMinimumSize(200, 150)
        preview_display.setStyleSheet("border: 2px dashed rgba(255,255,255,0.3); background: rgba(255,255,255,0.1);")
        preview_display.setText("üì∏ L'aper√ßu appara√Ætra ici")
        
        preview_layout.addWidget(preview_label)
        preview_layout.addWidget(preview_display)
        
        lay.addWidget(preview_widget)
        
        def take_screenshot():
            delay = delay_spin.value()
            
            if delay > 0:
                QtWidgets.QMessageBox.information(d, "üì∏ Capture", f"Capture dans {delay} secondes...")
                for i in range(delay):
                    time.sleep(1)
                    QtWidgets.QApplication.processEvents()
            
            # Simulation de capture
            if fullscreen_radio.isChecked():
                capture_type = "√âcran complet"
            elif window_radio.isChecked():
                capture_type = "Fen√™tre active"
            else:
                capture_type = "R√©gion s√©lectionn√©e"
            
            preview_display.setText(f"üì∏ Capture r√©alis√©e !\n\nType : {capture_type}\nTaille : 1920x1080\nFormat : PNG")
            
            QtWidgets.QMessageBox.information(d, "‚úÖ Capture", f"Capture d'√©cran sauvegard√©e !\n\nType : {capture_type}\nEmplacement : Bureau/Screenshots/")
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        capture_btn = QtWidgets.QPushButton("üì∏ Capturer")
        save_btn = QtWidgets.QPushButton("üíæ Sauvegarder")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        capture_btn.clicked.connect(take_screenshot)
        save_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üíæ Sauvegarde", "Capture sauvegard√©e dans le dossier Images !"))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(capture_btn)
        btn_layout.addWidget(save_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def show_system_monitor(self):
        """Moniteur syst√®me avanc√©"""
        d = GlassDialog("üå°Ô∏è Moniteur Syst√®me Avanc√©", (700, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Moniteur Syst√®me", "Surveillance compl√®te du syst√®me")
        lay.addWidget(header)
        
        # Onglets de monitoring
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Performance
        perf_tab = QtWidgets.QWidget()
        perf_layout = QtWidgets.QVBoxLayout(perf_tab)
        
        # Graphiques de performance simul√©s
        cpu_widget = QtWidgets.QWidget(objectName="GlassCard")
        cpu_layout = QtWidgets.QVBoxLayout(cpu_widget)
        cpu_layout.setContentsMargins(12, 12, 12, 12)
        
        cpu_usage = random.randint(20, 80)
        ram_usage = random.randint(30, 70)
        disk_usage = random.randint(40, 90)
        
        cpu_bar = QtWidgets.QProgressBar()
        cpu_bar.setValue(cpu_usage)
        cpu_bar.setFormat(f"CPU: {cpu_usage}%")
        
        ram_bar = QtWidgets.QProgressBar()
        ram_bar.setValue(ram_usage)
        ram_bar.setFormat(f"RAM: {ram_usage}%")
        
        disk_bar = QtWidgets.QProgressBar()
        disk_bar.setValue(disk_usage)
        disk_bar.setFormat(f"Disque: {disk_usage}%")
        
        cpu_layout.addWidget(QtWidgets.QLabel("üìä Utilisation des ressources :"))
        cpu_layout.addWidget(cpu_bar)
        cpu_layout.addWidget(ram_bar)
        cpu_layout.addWidget(disk_bar)
        
        perf_layout.addWidget(cpu_widget)
        
        # Processus
        processes_widget = QtWidgets.QWidget(objectName="GlassCard")
        processes_layout = QtWidgets.QVBoxLayout(processes_widget)
        processes_layout.setContentsMargins(12, 12, 12, 12)
        
        processes_list = QtWidgets.QListWidget()
        processes_list.setObjectName("GlassCard")
        
        sample_processes = [
            "üñ•Ô∏è ragnarOS.exe - 15% CPU",
            "üåê chrome.exe - 8% CPU",
            "üìù notepad.exe - 2% CPU",
            "üéµ spotify.exe - 5% CPU",
            "üíª python.exe - 12% CPU"
        ]
        
        for process in sample_processes:
            processes_list.addItem(process)
        
        processes_layout.addWidget(QtWidgets.QLabel("‚öôÔ∏è Processus actifs :"))
        processes_layout.addWidget(processes_list)
        
        perf_layout.addWidget(processes_widget)
        
        # Onglet R√©seau
        network_tab = QtWidgets.QWidget()
        network_layout = QtWidgets.QVBoxLayout(network_tab)
        
        network_widget = QtWidgets.QWidget(objectName="GlassCard")
        network_widget_layout = QtWidgets.QVBoxLayout(network_widget)
        network_widget_layout.setContentsMargins(12, 12, 12, 12)
        
        network_info = [
            f"üì° Connexions actives : {random.randint(10, 50)}",
            f"‚¨áÔ∏è T√©l√©chargement : {random.randint(1, 100)} Mbps",
            f"‚¨ÜÔ∏è Upload : {random.randint(1, 50)} Mbps",
            f"üìä Paquets re√ßus : {random.randint(10000, 99999)}",
            f"üìà Paquets envoy√©s : {random.randint(10000, 99999)}",
            f"‚ùå Erreurs r√©seau : {random.randint(0, 10)}"
        ]
        
        for info in network_info:
            label = QtWidgets.QLabel(info)
            label.setStyleSheet("padding: 4px; font-size: 12px;")
            network_widget_layout.addWidget(label)
        
        network_layout.addWidget(network_widget)
        
        # Ajouter les onglets
        tabs.addTab(perf_tab, "üìä Performance")
        tabs.addTab(network_tab, "üåê R√©seau")
        
        lay.addWidget(tabs)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        refresh_btn = QtWidgets.QPushButton("üîÑ Actualiser")
        export_btn = QtWidgets.QPushButton("üìä Exporter")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        refresh_btn.clicked.connect(lambda: (d.close(), self.show_system_monitor()))
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìä Export", "Donn√©es export√©es vers rapport_systeme.txt !"))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(refresh_btn)
        btn_layout.addWidget(export_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def show_dev_tools(self):
        """Outils d√©veloppeur"""
        d = GlassDialog("üîß Outils D√©veloppeur", (700, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Outils D√©veloppeur", "Utilitaires pour d√©veloppeurs")
        lay.addWidget(header)
        
        # Onglets d'outils
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Encodage/D√©codage
        encode_tab = QtWidgets.QWidget()
        encode_layout = QtWidgets.QVBoxLayout(encode_tab)
        
        # Zone de texte
        encode_widget = QtWidgets.QWidget(objectName="GlassCard")
        encode_widget_layout = QtWidgets.QVBoxLayout(encode_widget)
        encode_widget_layout.setContentsMargins(12, 12, 12, 12)
        
        input_text = QtWidgets.QTextEdit()
        input_text.setPlaceholderText("Entrez le texte √† encoder/d√©coder...")
        input_text.setMaximumHeight(100)
        
        output_text = QtWidgets.QTextEdit()
        output_text.setPlaceholderText("R√©sultat...")
        output_text.setMaximumHeight(100)
        output_text.setReadOnly(True)
        
        # Boutons d'encodage
        encode_buttons = QtWidgets.QHBoxLayout()
        base64_btn = QtWidgets.QPushButton("Base64")
        url_btn = QtWidgets.QPushButton("URL")
        html_btn = QtWidgets.QPushButton("HTML")
        
        def encode_base64():
            import base64
            text = input_text.toPlainText()
            if text:
                encoded = base64.b64encode(text.encode()).decode()
                output_text.setPlainText(encoded)
        
        def encode_url():
            import urllib.parse
            text = input_text.toPlainText()
            if text:
                encoded = urllib.parse.quote(text)
                output_text.setPlainText(encoded)
        
        def encode_html():
            import html
            text = input_text.toPlainText()
            if text:
                encoded = html.escape(text)
                output_text.setPlainText(encoded)
        
        base64_btn.clicked.connect(encode_base64)
        url_btn.clicked.connect(encode_url)
        html_btn.clicked.connect(encode_html)
        
        encode_buttons.addWidget(base64_btn)
        encode_buttons.addWidget(url_btn)
        encode_buttons.addWidget(html_btn)
        
        encode_widget_layout.addWidget(QtWidgets.QLabel("üìù Texte d'entr√©e :"))
        encode_widget_layout.addWidget(input_text)
        encode_widget_layout.addWidget(QtWidgets.QLabel("üîß Encodage :"))
        encode_widget_layout.addLayout(encode_buttons)
        encode_widget_layout.addWidget(QtWidgets.QLabel("üìã R√©sultat :"))
        encode_widget_layout.addWidget(output_text)
        
        encode_layout.addWidget(encode_widget)
        
        # Onglet Hash
        hash_tab = QtWidgets.QWidget()
        hash_layout = QtWidgets.QVBoxLayout(hash_tab)
        
        hash_widget = QtWidgets.QWidget(objectName="GlassCard")
        hash_widget_layout = QtWidgets.QVBoxLayout(hash_widget)
        hash_widget_layout.setContentsMargins(12, 12, 12, 12)
        
        hash_input = QtWidgets.QTextEdit()
        hash_input.setPlaceholderText("Entrez le texte √† hasher...")
        hash_input.setMaximumHeight(80)
        
        hash_results = QtWidgets.QTextEdit()
        hash_results.setReadOnly(True)
        hash_results.setMaximumHeight(150)
        
        def generate_hashes():
            text = hash_input.toPlainText()
            if text:
                import hashlib
                md5_hash = hashlib.md5(text.encode()).hexdigest()
                sha1_hash = hashlib.sha1(text.encode()).hexdigest()
                sha256_hash = hashlib.sha256(text.encode()).hexdigest()
                
                result = f"MD5: {md5_hash}\n\nSHA1: {sha1_hash}\n\nSHA256: {sha256_hash}"
                hash_results.setPlainText(result)
        
        hash_btn = QtWidgets.QPushButton("üîê G√©n√©rer Hash")
        hash_btn.clicked.connect(generate_hashes)
        
        hash_widget_layout.addWidget(QtWidgets.QLabel("üìù Texte :"))
        hash_widget_layout.addWidget(hash_input)
        hash_widget_layout.addWidget(hash_btn)
        hash_widget_layout.addWidget(QtWidgets.QLabel("üîê Hash :"))
        hash_widget_layout.addWidget(hash_results)
        
        hash_layout.addWidget(hash_widget)
        
        # Ajouter les onglets
        tabs.addTab(encode_tab, "üîß Encodage")
        tabs.addTab(hash_tab, "üîê Hash")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def show_rapp_manager(self):
        """Gestionnaire de packages .rapp"""
        d = GlassDialog("üì¶ Gestionnaire Ragnar Apps (.rapp)", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Gestionnaire .rapp", "Installez et g√©rez vos applications Ragnar")
        lay.addWidget(header)
        
        # Onglets
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Applications install√©es
        installed_tab = QtWidgets.QWidget()
        installed_layout = QtWidgets.QVBoxLayout(installed_tab)
        
        installed_list = QtWidgets.QListWidget()
        installed_list.setObjectName("GlassCard")
        
        # Applications .rapp simul√©es
        sample_apps = [
            "üéÆ RagnarGame.rapp - Jeu de puzzle",
            "üìä RagnarStats.rapp - Statistiques syst√®me",
            "üé® RagnarDraw.rapp - √âditeur graphique",
            "üåê RagnarWeb.rapp - Navigateur l√©ger",
            "üìù RagnarEdit.rapp - √âditeur de code"
        ]
        
        for app in sample_apps:
            installed_list.addItem(app)
        
        installed_layout.addWidget(QtWidgets.QLabel("üì¶ Applications install√©es :"))
        installed_layout.addWidget(installed_list)
        
        # Boutons pour les apps install√©es
        installed_btn_layout = QtWidgets.QHBoxLayout()
        run_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è Lancer")
        uninstall_btn = QtWidgets.QPushButton("üóëÔ∏è D√©sinstaller")
        
        run_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ñ∂Ô∏è Lancement", "Application .rapp lanc√©e !"))
        uninstall_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üóëÔ∏è D√©sinstallation", "Application .rapp d√©sinstall√©e !"))
        
        installed_btn_layout.addWidget(run_btn)
        installed_btn_layout.addWidget(uninstall_btn)
        installed_btn_layout.addStretch()
        
        installed_layout.addLayout(installed_btn_layout)
        
        # Onglet Installation
        install_tab = QtWidgets.QWidget()
        install_layout = QtWidgets.QVBoxLayout(install_tab)
        
        # Zone d'installation
        install_widget = QtWidgets.QWidget(objectName="GlassCard")
        install_widget_layout = QtWidgets.QVBoxLayout(install_widget)
        install_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        install_label = QtWidgets.QLabel("üìÇ Installer une application .rapp :")
        file_path_input = QtWidgets.QLineEdit()
        file_path_input.setPlaceholderText("Chemin vers le fichier .rapp...")
        
        browse_btn = QtWidgets.QPushButton("üìÅ Parcourir")
        install_btn = QtWidgets.QPushButton("üì¶ Installer")
        
        def browse_rapp():
            file_path, _ = QtWidgets.QFileDialog.getOpenFileName(d, "S√©lectionner un fichier .rapp", "", "Ragnar Apps (*.rapp)")
            if file_path:
                file_path_input.setText(file_path)
        
        def install_rapp():
            file_path = file_path_input.text().strip()
            if not file_path:
                QtWidgets.QMessageBox.warning(d, "‚ö†Ô∏è Attention", "S√©lectionnez un fichier .rapp !")
                return
            
            # Simulation d'installation
            progress = QtWidgets.QProgressDialog("Installation de l'application .rapp...", "Annuler", 0, 100, d)
            progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
            progress.show()
            
            for i in range(101):
                progress.setValue(i)
                QtWidgets.QApplication.processEvents()
                time.sleep(0.01)
                if progress.wasCanceled():
                    return
            
            QtWidgets.QMessageBox.information(d, "‚úÖ Installation", f"Application .rapp install√©e avec succ√®s !\n\nFichier : {Path(file_path).name}")
        
        browse_btn.clicked.connect(browse_rapp)
        install_btn.clicked.connect(install_rapp)
        
        install_widget_layout.addWidget(install_label)
        install_widget_layout.addWidget(file_path_input)
        install_widget_layout.addWidget(browse_btn)
        install_widget_layout.addWidget(install_btn)
        
        install_layout.addWidget(install_widget)
        
        # Informations sur le format .rapp
        info_widget = QtWidgets.QWidget(objectName="GlassCard")
        info_layout = QtWidgets.QVBoxLayout(info_widget)
        info_layout.setContentsMargins(16, 16, 16, 16)
        
        info_text = """
üì¶ <b>Format .rapp (Ragnar Package App)</b><br><br>
Les fichiers .rapp sont des applications Python empaquet√©es pour Ragnar OS :<br><br>
‚Ä¢ <b>Structure :</b> Code Python + m√©tadonn√©es<br>
‚Ä¢ <b>Installation :</b> Automatique avec d√©pendances<br>
‚Ä¢ <b>S√©curit√© :</b> V√©rification d'int√©grit√©<br>
‚Ä¢ <b>Portabilit√© :</b> Fonctionne sur tous les Ragnar OS<br><br>
<b>Exemple de cr√©ation :</b><br>
1. √âcrivez votre code Python<br>
2. Ajoutez un fichier manifest.json<br>
3. Compressez en .rapp<br>
4. Installez via ce gestionnaire
        """
        
        info_label = QtWidgets.QLabel(info_text)
        info_label.setWordWrap(True)
        info_layout.addWidget(info_label)
        
        install_layout.addWidget(info_widget)
        
        # Ajouter les onglets
        tabs.addTab(installed_tab, "üì¶ Install√©es")
        tabs.addTab(install_tab, "üì• Installer")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    # ===== NOUVELLES FONCTIONNALIT√âS RAGNAR OS 26.3.0 =====
    
    def show_theme_manager(self):
        """Gestionnaire de th√®mes avanc√©s - Nouvelle fonctionnalit√© 26.3.0"""
        d = GlassDialog("üé® Gestionnaire de Th√®mes Avanc√©s", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Th√®mes Avanc√©s", "Personnalisez compl√®tement votre interface Ragnar")
        lay.addWidget(header)
        
        # Onglets de th√®mes
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Th√®mes Pr√©d√©finis
        themes_tab = QtWidgets.QWidget()
        themes_layout = QtWidgets.QVBoxLayout(themes_tab)
        
        themes_widget = QtWidgets.QWidget(objectName="GlassCard")
        themes_widget_layout = QtWidgets.QGridLayout(themes_widget)
        themes_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        # Th√®mes disponibles
        available_themes = [
            ("üåå Verre Noir", "Le th√®me classique avec effets de verre noir", "#1a1a2e"),
            ("üåÜ Cyberpunk", "Interface futuriste n√©on et violet", "#0f0f23"),
            ("üåø Nature", "Th√®me vert apaisant inspir√© de la nature", "#1a2e1a"),
            ("üåå Espace", "Th√®me sombre avec √©toiles et galaxies", "#0a0a1a"),
            ("‚òÄÔ∏è Lumi√®re", "Th√®me clair et moderne pour la journ√©e", "#f0f0f0"),
            ("üéÆ Gaming", "Interface gaming avec RGB et n√©ons", "#1a0a2e"),
        ]
        
        row, col = 0, 0
        for name, desc, color in available_themes:
            theme_card = QtWidgets.QWidget(objectName="GlassCard")
            theme_card.setMinimumSize(200, 120)
            theme_card.setStyleSheet(f"background: {color}; border-radius: 8px;")
            
            card_layout = QtWidgets.QVBoxLayout(theme_card)
            card_layout.setContentsMargins(12, 12, 12, 12)
            
            theme_name = QtWidgets.QLabel(name)
            theme_name.setStyleSheet("font-size: 14px; font-weight: bold; color: white;")
            
            theme_desc = QtWidgets.QLabel(desc)
            theme_desc.setStyleSheet("font-size: 10px; color: rgba(255,255,255,0.8);")
            theme_desc.setWordWrap(True)
            
            apply_btn = QtWidgets.QPushButton("‚ú® Appliquer")
            apply_btn.clicked.connect(lambda checked, t=name: self.apply_theme(t, d))
            
            card_layout.addWidget(theme_name)
            card_layout.addWidget(theme_desc)
            card_layout.addStretch()
            card_layout.addWidget(apply_btn)
            
            themes_widget_layout.addWidget(theme_card, row, col)
            col += 1
            if col >= 3:
                col = 0
                row += 1
        
        themes_layout.addWidget(themes_widget)
        
        # Onglet Personnalisation
        custom_tab = QtWidgets.QWidget()
        custom_layout = QtWidgets.QVBoxLayout(custom_tab)
        
        custom_widget = QtWidgets.QWidget(objectName="GlassCard")
        custom_widget_layout = QtWidgets.QVBoxLayout(custom_widget)
        custom_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        # Contr√¥les de personnalisation
        transparency_layout = QtWidgets.QHBoxLayout()
        transparency_layout.addWidget(QtWidgets.QLabel("üîç Transparence :"))
        transparency_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        transparency_slider.setRange(10, 100)
        transparency_slider.setValue(85)
        transparency_layout.addWidget(transparency_slider)
        
        blur_layout = QtWidgets.QHBoxLayout()
        blur_layout.addWidget(QtWidgets.QLabel("üå´Ô∏è Flou :"))
        blur_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        blur_slider.setRange(0, 50)
        blur_slider.setValue(20)
        blur_layout.addWidget(blur_slider)
        
        glow_layout = QtWidgets.QHBoxLayout()
        glow_layout.addWidget(QtWidgets.QLabel("‚ú® Effet N√©on :"))
        glow_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        glow_slider.setRange(0, 100)
        glow_slider.setValue(30)
        glow_layout.addWidget(glow_slider)
        
        custom_widget_layout.addWidget(QtWidgets.QLabel("üé® Personnalisation Avanc√©e :"))
        custom_widget_layout.addLayout(transparency_layout)
        custom_widget_layout.addLayout(blur_layout)
        custom_widget_layout.addLayout(glow_layout)
        
        # Boutons de personnalisation
        custom_buttons = QtWidgets.QHBoxLayout()
        preview_btn = QtWidgets.QPushButton("üëÅÔ∏è Aper√ßu")
        save_btn = QtWidgets.QPushButton("üíæ Sauvegarder")
        reset_btn = QtWidgets.QPushButton("üîÑ R√©initialiser")
        
        preview_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üëÅÔ∏è Aper√ßu", "Aper√ßu du th√®me personnalis√© appliqu√© !"))
        save_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üíæ Sauvegarde", "Th√®me personnalis√© sauvegard√© !"))
        reset_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîÑ Reset", "Param√®tres r√©initialis√©s !"))
        
        custom_buttons.addWidget(preview_btn)
        custom_buttons.addWidget(save_btn)
        custom_buttons.addWidget(reset_btn)
        
        custom_widget_layout.addLayout(custom_buttons)
        custom_layout.addWidget(custom_widget)
        
        # Ajouter les onglets
        tabs.addTab(themes_tab, "üé® Th√®mes")
        tabs.addTab(custom_tab, "‚öôÔ∏è Personnalisation")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def apply_theme(self, theme_name, dialog):
        """Applique un th√®me s√©lectionn√©"""
        QtWidgets.QMessageBox.information(dialog, "‚ú® Th√®me Appliqu√©", f"Th√®me '{theme_name}' appliqu√© avec succ√®s !\n\nRed√©marrez Ragnar OS pour voir tous les changements.")
    
    def show_marketplace(self):
        """Marketplace .rapp officiel - Nouvelle fonctionnalit√© 26.3.0"""
        d = GlassDialog("üè™ Marketplace Ragnar Apps", (900, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Marketplace .rapp", "D√©couvrez et installez des applications incroyables")
        lay.addWidget(header)
        
        # Onglets du marketplace
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Populaires
        popular_tab = QtWidgets.QWidget()
        popular_layout = QtWidgets.QVBoxLayout(popular_tab)
        
        popular_list = QtWidgets.QListWidget()
        popular_list.setObjectName("GlassCard")
        
        # Applications populaires
        popular_apps = [
            "üéÆ RagnarCraft.rapp - Jeu de construction 3D ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.9/5) - GRATUIT",
            "üìä RagnarAnalytics.rapp - Tableaux de bord avanc√©s ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.8/5) - 9.99‚Ç¨",
            "üé® RagnarStudio.rapp - Suite cr√©ative compl√®te ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.7/5) - 19.99‚Ç¨",
            "üåê RagnarBrowser Pro.rapp - Navigateur ultra-rapide ‚≠ê‚≠ê‚≠ê‚≠ê (4.6/5) - GRATUIT",
            "üéµ RagnarMusic.rapp - Lecteur audio professionnel ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.9/5) - 4.99‚Ç¨",
            "üìù RagnarOffice.rapp - Suite bureautique compl√®te ‚≠ê‚≠ê‚≠ê‚≠ê (4.5/5) - 29.99‚Ç¨",
            "üîê RagnarVault.rapp - Gestionnaire de mots de passe ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.8/5) - 14.99‚Ç¨",
            "üì± RagnarMobile.rapp - √âmulateur mobile ‚≠ê‚≠ê‚≠ê‚≠ê (4.4/5) - GRATUIT",
        ]
        
        for app in popular_apps:
            popular_list.addItem(app)
        
        popular_layout.addWidget(QtWidgets.QLabel("üî• Applications Populaires :"))
        popular_layout.addWidget(popular_list)
        
        # Boutons pour les apps populaires
        popular_buttons = QtWidgets.QHBoxLayout()
        install_btn = QtWidgets.QPushButton("üì¶ Installer")
        details_btn = QtWidgets.QPushButton("‚ÑπÔ∏è D√©tails")
        review_btn = QtWidgets.QPushButton("‚≠ê Avis")
        
        install_btn.clicked.connect(lambda: self.install_marketplace_app(popular_list.currentItem(), d))
        details_btn.clicked.connect(lambda: self.show_app_details(popular_list.currentItem(), d))
        review_btn.clicked.connect(lambda: self.show_app_reviews(popular_list.currentItem(), d))
        
        popular_buttons.addWidget(install_btn)
        popular_buttons.addWidget(details_btn)
        popular_buttons.addWidget(review_btn)
        popular_buttons.addStretch()
        
        popular_layout.addLayout(popular_buttons)
        
        # Onglet Cat√©gories
        categories_tab = QtWidgets.QWidget()
        categories_layout = QtWidgets.QVBoxLayout(categories_tab)
        
        categories_widget = QtWidgets.QWidget(objectName="GlassCard")
        categories_widget_layout = QtWidgets.QGridLayout(categories_widget)
        categories_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        # Cat√©gories d'applications
        categories = [
            ("üéÆ Jeux", "125 apps", "#2e1a4a"),
            ("üìä Productivit√©", "89 apps", "#1a2e4a"),
            ("üé® Cr√©atif", "67 apps", "#4a1a2e"),
            ("üîß D√©veloppement", "156 apps", "#2e4a1a"),
            ("üåê Internet", "43 apps", "#4a2e1a"),
            ("üéµ Multim√©dia", "78 apps", "#1a4a2e"),
        ]
        
        row, col = 0, 0
        for name, count, color in categories:
            cat_card = QtWidgets.QWidget(objectName="GlassCard")
            cat_card.setMinimumSize(180, 100)
            cat_card.setStyleSheet(f"background: {color}; border-radius: 8px;")
            
            cat_layout = QtWidgets.QVBoxLayout(cat_card)
            cat_layout.setContentsMargins(12, 12, 12, 12)
            
            cat_name = QtWidgets.QLabel(name)
            cat_name.setStyleSheet("font-size: 14px; font-weight: bold; color: white;")
            
            cat_count = QtWidgets.QLabel(count)
            cat_count.setStyleSheet("font-size: 12px; color: rgba(255,255,255,0.8);")
            
            cat_layout.addWidget(cat_name)
            cat_layout.addWidget(cat_count)
            cat_layout.addStretch()
            
            categories_widget_layout.addWidget(cat_card, row, col)
            col += 1
            if col >= 3:
                col = 0
                row += 1
        
        categories_layout.addWidget(categories_widget)
        
        # Ajouter les onglets
        tabs.addTab(popular_tab, "üî• Populaires")
        tabs.addTab(categories_tab, "üìÇ Cat√©gories")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def install_marketplace_app(self, item, dialog):
        """Installe une application depuis le marketplace"""
        if not item:
            return
        app_name = item.text().split(" - ")[0]
        
        # Simulation d'installation
        progress = QtWidgets.QProgressDialog(f"Installation de {app_name}...", "Annuler", 0, 100, dialog)
        progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
        progress.show()
        
        for i in range(101):
            progress.setValue(i)
            QtWidgets.QApplication.processEvents()
            time.sleep(0.02)
            if progress.wasCanceled():
                return
        
        QtWidgets.QMessageBox.information(dialog, "‚úÖ Installation", f"{app_name} install√© avec succ√®s !\n\nL'application est maintenant disponible dans votre menu.")
    
    def show_app_details(self, item, dialog):
        """Affiche les d√©tails d'une application"""
        if not item:
            return
        app_name = item.text().split(" - ")[0]
        
        details = f"""
üì± <b>{app_name}</b><br><br>
<b>D√©veloppeur :</b> Ragnar Studios<br>
<b>Version :</b> 2.1.4<br>
<b>Taille :</b> 45.2 MB<br>
<b>Compatibilit√© :</b> Ragnar OS 26.0+<br>
<b>Langues :</b> Fran√ßais, Anglais, Espagnol<br><br>
<b>Description :</b><br>
Une application r√©volutionnaire qui transforme votre exp√©rience Ragnar OS. 
Avec des fonctionnalit√©s avanc√©es et une interface moderne, cette app est 
indispensable pour tous les utilisateurs Ragnar.
        """
        
        QtWidgets.QMessageBox.information(dialog, "‚ÑπÔ∏è D√©tails de l'application", details)
    
    def show_app_reviews(self, item, dialog):
        """Affiche les avis d'une application"""
        if not item:
            return
        app_name = item.text().split(" - ")[0]
        
        reviews = f"""
‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê <b>RagnarUser2024</b> - Il y a 2 jours<br>
"Excellente application ! Interface magnifique et tr√®s intuitive."<br><br>

‚≠ê‚≠ê‚≠ê‚≠ê <b>TechExpert</b> - Il y a 1 semaine<br>
"Tr√®s bon travail, quelques bugs mineurs mais dans l'ensemble parfait."<br><br>

‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê <b>CreativeUser</b> - Il y a 2 semaines<br>
"R√©volutionnaire ! Cette app a chang√© ma fa√ßon de travailler."<br><br>

‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê <b>DevMaster</b> - Il y a 1 mois<br>
"Indispensable pour tout utilisateur Ragnar OS. Bravo aux d√©veloppeurs !"
        """
        
        QtWidgets.QMessageBox.information(dialog, f"‚≠ê Avis - {app_name}", reviews)
    
    def show_widget_manager(self):
        """Gestionnaire de widgets de bureau - Nouvelle fonctionnalit√© 26.3.0"""
        d = GlassDialog("üì± Gestionnaire de Widgets", (700, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Widgets de Bureau", "Ajoutez des widgets interactifs sur votre bureau")
        lay.addWidget(header)
        
        # Liste des widgets disponibles
        widgets_widget = QtWidgets.QWidget(objectName="GlassCard")
        widgets_layout = QtWidgets.QVBoxLayout(widgets_widget)
        widgets_layout.setContentsMargins(16, 16, 16, 16)
        
        widgets_list = QtWidgets.QListWidget()
        widgets_list.setObjectName("GlassCard")
        
        available_widgets = [
            "üå§Ô∏è M√©t√©o Temps R√©el - Pr√©visions m√©t√©o avec animations",
            "üïê Horloge Mondiale - Fuseaux horaires multiples",
            "üìä Moniteur Syst√®me - CPU, RAM, r√©seau en temps r√©el",
            "üìù Notes Rapides - Post-it virtuels sur le bureau",
            "üìÖ Calendrier - √âv√©nements et rappels",
            "üéµ Mini Lecteur - Contr√¥les audio compacts",
            "üìà Crypto Tracker - Cours des cryptomonnaies",
            "üîã Batterie - Statut de la batterie (simulation)",
            "üì° R√©seau - Vitesse de connexion",
            "üéØ Raccourcis - Applications favorites",
        ]
        
        for widget in available_widgets:
            widgets_list.addItem(widget)
        
        widgets_layout.addWidget(QtWidgets.QLabel("üì± Widgets Disponibles :"))
        widgets_layout.addWidget(widgets_list)
        
        # Boutons de gestion
        buttons_layout = QtWidgets.QHBoxLayout()
        add_btn = QtWidgets.QPushButton("‚ûï Ajouter au Bureau")
        preview_btn = QtWidgets.QPushButton("üëÅÔ∏è Aper√ßu")
        config_btn = QtWidgets.QPushButton("‚öôÔ∏è Configurer")
        
        add_btn.clicked.connect(lambda: self.add_widget_to_desktop(widgets_list.currentItem(), d))
        preview_btn.clicked.connect(lambda: self.preview_widget(widgets_list.currentItem(), d))
        config_btn.clicked.connect(lambda: self.configure_widget(widgets_list.currentItem(), d))
        
        buttons_layout.addWidget(add_btn)
        buttons_layout.addWidget(preview_btn)
        buttons_layout.addWidget(config_btn)
        buttons_layout.addStretch()
        
        widgets_layout.addLayout(buttons_layout)
        lay.addWidget(widgets_widget)
        
        # Widgets actifs
        active_widget = QtWidgets.QWidget(objectName="GlassCard")
        active_layout = QtWidgets.QVBoxLayout(active_widget)
        active_layout.setContentsMargins(16, 16, 16, 16)
        
        active_list = QtWidgets.QListWidget()
        active_list.setObjectName("GlassCard")
        
        # Widgets d√©j√† sur le bureau
        active_widgets = [
            "üå§Ô∏è M√©t√©o Paris - Position: (50, 50)",
            "üïê Horloge Mondiale - Position: (300, 50)",
            "üìä Moniteur Syst√®me - Position: (50, 200)",
        ]
        
        for widget in active_widgets:
            active_list.addItem(widget)
        
        active_layout.addWidget(QtWidgets.QLabel("üñ•Ô∏è Widgets sur le Bureau :"))
        active_layout.addWidget(active_list)
        
        # Boutons pour widgets actifs
        active_buttons = QtWidgets.QHBoxLayout()
        remove_btn = QtWidgets.QPushButton("üóëÔ∏è Supprimer")
        move_btn = QtWidgets.QPushButton("üìç D√©placer")
        
        remove_btn.clicked.connect(lambda: self.remove_widget(active_list.currentItem(), d))
        move_btn.clicked.connect(lambda: self.move_widget(active_list.currentItem(), d))
        
        active_buttons.addWidget(remove_btn)
        active_buttons.addWidget(move_btn)
        active_buttons.addStretch()
        
        active_layout.addLayout(active_buttons)
        lay.addWidget(active_widget)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def add_widget_to_desktop(self, item, dialog):
        """Ajoute un widget au bureau"""
        if not item:
            return
        widget_name = item.text().split(" - ")[0]
        QtWidgets.QMessageBox.information(dialog, "‚ûï Widget Ajout√©", f"Widget '{widget_name}' ajout√© au bureau !\n\nVous pouvez le d√©placer en faisant glisser.")
    
    def preview_widget(self, item, dialog):
        """Aper√ßu d'un widget"""
        if not item:
            return
        widget_name = item.text().split(" - ")[0]
        
        preview_dialog = GlassDialog(f"üëÅÔ∏è Aper√ßu - {widget_name}", (300, 200), dialog)
        preview_layout = QtWidgets.QVBoxLayout(preview_dialog)
        
        if "M√©t√©o" in widget_name:
            preview_content = QtWidgets.QLabel("üå§Ô∏è Paris\n18¬∞C\nPartiellement nuageux\nHumidit√©: 65%")
        elif "Horloge" in widget_name:
            preview_content = QtWidgets.QLabel("üïê 15:30:45\nüåç Paris\nüóΩ New York: 09:30\nüóæ Tokyo: 23:30")
        elif "Moniteur" in widget_name:
            preview_content = QtWidgets.QLabel("üìä Syst√®me\nCPU: 45%\nRAM: 62%\nR√©seau: ‚Üì125MB/s ‚Üë45MB/s")
        else:
            preview_content = QtWidgets.QLabel(f"Aper√ßu de {widget_name}\nContenu interactif")
        
        preview_content.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        preview_content.setStyleSheet("padding: 20px; font-size: 12px;")
        preview_layout.addWidget(preview_content)
        
        preview_dialog.show()
    
    def configure_widget(self, item, dialog):
        """Configure un widget"""
        if not item:
            return
        widget_name = item.text().split(" - ")[0]
        QtWidgets.QMessageBox.information(dialog, "‚öôÔ∏è Configuration", f"Configuration de '{widget_name}' :\n\n‚Ä¢ Position sur le bureau\n‚Ä¢ Taille du widget\n‚Ä¢ Fr√©quence de mise √† jour\n‚Ä¢ Couleurs et transparence")
    
    def remove_widget(self, item, dialog):
        """Supprime un widget du bureau"""
        if not item:
            return
        widget_name = item.text().split(" - ")[0]
        QtWidgets.QMessageBox.information(dialog, "üóëÔ∏è Widget Supprim√©", f"Widget '{widget_name}' supprim√© du bureau !")
    
    def move_widget(self, item, dialog):
        """D√©place un widget sur le bureau"""
        if not item:
            return
        widget_name = item.text().split(" - ")[0]
        QtWidgets.QMessageBox.information(dialog, "üìç D√©placement", f"Mode d√©placement activ√© pour '{widget_name}' !\n\nCliquez sur le bureau pour choisir la nouvelle position.")
    
    def show_notification_center(self):
        """Centre de notifications - Nouvelle fonctionnalit√© 26.3.0"""
        d = GlassDialog("üîî Centre de Notifications", (600, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Centre de Notifications", "G√©rez toutes vos notifications en un endroit")
        lay.addWidget(header)
        
        # Onglets de notifications
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet R√©centes
        recent_tab = QtWidgets.QWidget()
        recent_layout = QtWidgets.QVBoxLayout(recent_tab)
        
        recent_list = QtWidgets.QListWidget()
        recent_list.setObjectName("GlassCard")
        
        # Notifications r√©centes
        recent_notifications = [
            "üîÑ Mise √† jour disponible - Ragnar OS 26.3.1 (Il y a 5 min)",
            "üì¶ Installation termin√©e - RagnarCraft.rapp (Il y a 15 min)",
            "üå§Ô∏è M√©t√©o - Pluie pr√©vue cet apr√®s-midi (Il y a 30 min)",
            "üí¨ Nouveau message - RagnarLink (Il y a 1h)",
            "üîê Connexion s√©curis√©e - VPN activ√© (Il y a 2h)",
            "üìä Rapport syst√®me - Optimisation recommand√©e (Il y a 3h)",
            "üéµ Lecture termin√©e - Playlist Ragnar (Il y a 4h)",
        ]
        
        for notif in recent_notifications:
            recent_list.addItem(notif)
        
        recent_layout.addWidget(QtWidgets.QLabel("üîî Notifications R√©centes :"))
        recent_layout.addWidget(recent_list)
        
        # Boutons pour notifications r√©centes
        recent_buttons = QtWidgets.QHBoxLayout()
        mark_read_btn = QtWidgets.QPushButton("‚úÖ Marquer comme lu")
        delete_btn = QtWidgets.QPushButton("üóëÔ∏è Supprimer")
        clear_all_btn = QtWidgets.QPushButton("üßπ Tout effacer")
        
        mark_read_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚úÖ Lu", "Notification marqu√©e comme lue !"))
        delete_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üóëÔ∏è Supprim√©", "Notification supprim√©e !"))
        clear_all_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üßπ Effac√©", "Toutes les notifications ont √©t√© effac√©es !"))
        
        recent_buttons.addWidget(mark_read_btn)
        recent_buttons.addWidget(delete_btn)
        recent_buttons.addWidget(clear_all_btn)
        recent_buttons.addStretch()
        
        recent_layout.addLayout(recent_buttons)
        
        # Onglet Param√®tres
        settings_tab = QtWidgets.QWidget()
        settings_layout = QtWidgets.QVBoxLayout(settings_tab)
        
        settings_widget = QtWidgets.QWidget(objectName="GlassCard")
        settings_widget_layout = QtWidgets.QVBoxLayout(settings_widget)
        settings_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        # Param√®tres de notifications
        settings_widget_layout.addWidget(QtWidgets.QLabel("‚öôÔ∏è Param√®tres de Notifications :"))
        
        enable_notifications = QtWidgets.QCheckBox("üîî Activer les notifications")
        enable_notifications.setChecked(True)
        
        enable_sounds = QtWidgets.QCheckBox("üîä Sons de notification")
        enable_sounds.setChecked(True)
        
        enable_popup = QtWidgets.QCheckBox("üí¨ Notifications popup")
        enable_popup.setChecked(True)
        
        do_not_disturb = QtWidgets.QCheckBox("üåô Mode Ne pas d√©ranger")
        do_not_disturb.setChecked(False)
        
        settings_widget_layout.addWidget(enable_notifications)
        settings_widget_layout.addWidget(enable_sounds)
        settings_widget_layout.addWidget(enable_popup)
        settings_widget_layout.addWidget(do_not_disturb)
        
        # Applications autoris√©es
        settings_widget_layout.addWidget(QtWidgets.QLabel("\nüì± Notifications par Application :"))
        
        app_notifications = [
            ("üîÑ Mises √† jour syst√®me", True),
            ("üì¶ Gestionnaire .rapp", True),
            ("üå§Ô∏è Widget M√©t√©o", True),
            ("üí¨ RagnarLink", False),
            ("üéµ Lecteur Audio", True),
            ("üìä Moniteur Syst√®me", False),
        ]
        
        for app_name, enabled in app_notifications:
            app_cb = QtWidgets.QCheckBox(app_name)
            app_cb.setChecked(enabled)
            settings_widget_layout.addWidget(app_cb)
        
        settings_layout.addWidget(settings_widget)
        
        # Ajouter les onglets
        tabs.addTab(recent_tab, "üîî R√©centes")
        tabs.addTab(settings_tab, "‚öôÔ∏è Param√®tres")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def show_ragnar_cloud(self):
        """Ragnar Cloud - Nouvelle fonctionnalit√© 26.3.0"""
        d = GlassDialog("‚òÅÔ∏è Ragnar Cloud", (700, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Ragnar Cloud", "Synchronisez vos donn√©es entre tous vos appareils Ragnar")
        lay.addWidget(header)
        
        # Onglets Cloud
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Synchronisation
        sync_tab = QtWidgets.QWidget()
        sync_layout = QtWidgets.QVBoxLayout(sync_tab)
        
        # Statut de synchronisation
        status_widget = QtWidgets.QWidget(objectName="GlassCard")
        status_layout = QtWidgets.QVBoxLayout(status_widget)
        status_layout.setContentsMargins(16, 16, 16, 16)
        
        status_layout.addWidget(QtWidgets.QLabel("‚òÅÔ∏è Statut de Synchronisation :"))
        
        sync_status = QtWidgets.QLabel("üü¢ Connect√© - Derni√®re sync: Il y a 2 minutes")
        sync_status.setStyleSheet("color: #00ff88; font-weight: bold; padding: 10px;")
        status_layout.addWidget(sync_status)
        
        # Donn√©es synchronis√©es
        sync_data = [
            ("‚öôÔ∏è Param√®tres syst√®me", "‚úÖ Synchronis√©", "1.2 KB"),
            ("üé® Th√®mes personnalis√©s", "‚úÖ Synchronis√©", "45.6 KB"),
            ("üì± Configuration widgets", "‚úÖ Synchronis√©", "8.3 KB"),
            ("üì¶ Applications .rapp", "üîÑ En cours...", "156.7 MB"),
            ("üìÅ Documents utilisateur", "‚úÖ Synchronis√©", "2.1 GB"),
            ("üîê Mots de passe", "‚úÖ Synchronis√© (chiffr√©)", "12.4 KB"),
        ]
        
        for data_type, status, size in sync_data:
            data_layout = QtWidgets.QHBoxLayout()
            data_layout.addWidget(QtWidgets.QLabel(data_type))
            data_layout.addStretch()
            data_layout.addWidget(QtWidgets.QLabel(status))
            data_layout.addWidget(QtWidgets.QLabel(size))
            status_layout.addLayout(data_layout)
        
        sync_layout.addWidget(status_widget)
        
        # Boutons de synchronisation
        sync_buttons = QtWidgets.QHBoxLayout()
        sync_now_btn = QtWidgets.QPushButton("üîÑ Synchroniser maintenant")
        force_sync_btn = QtWidgets.QPushButton("‚ö° Synchronisation forc√©e")
        
        sync_now_btn.clicked.connect(lambda: self.start_cloud_sync(d))
        force_sync_btn.clicked.connect(lambda: self.force_cloud_sync(d))
        
        sync_buttons.addWidget(sync_now_btn)
        sync_buttons.addWidget(force_sync_btn)
        sync_buttons.addStretch()
        
        sync_layout.addLayout(sync_buttons)
        
        # Onglet Appareils
        devices_tab = QtWidgets.QWidget()
        devices_layout = QtWidgets.QVBoxLayout(devices_tab)
        
        devices_widget = QtWidgets.QWidget(objectName="GlassCard")
        devices_widget_layout = QtWidgets.QVBoxLayout(devices_widget)
        devices_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        devices_widget_layout.addWidget(QtWidgets.QLabel("üì± Appareils Connect√©s :"))
        
        devices_list = QtWidgets.QListWidget()
        devices_list.setObjectName("GlassCard")
        
        connected_devices = [
            "üíª Ragnar-Desktop-01 (Cet appareil) - En ligne",
            "üì± Ragnar-Mobile-Alpha - Derni√®re connexion: Il y a 1h",
            "üñ•Ô∏è Ragnar-Workstation - Derni√®re connexion: Il y a 3h",
            "üíæ Ragnar-Server-Home - En ligne",
        ]
        
        for device in connected_devices:
            devices_list.addItem(device)
        
        devices_widget_layout.addWidget(devices_list)
        
        # Boutons appareils
        device_buttons = QtWidgets.QHBoxLayout()
        add_device_btn = QtWidgets.QPushButton("‚ûï Ajouter appareil")
        remove_device_btn = QtWidgets.QPushButton("üóëÔ∏è Supprimer")
        
        add_device_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚ûï Appareil", "Code de jumelage: RGN-2024-XYZ\n\nEntrez ce code sur votre autre appareil Ragnar."))
        remove_device_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üóëÔ∏è Suppression", "Appareil supprim√© de Ragnar Cloud !"))
        
        device_buttons.addWidget(add_device_btn)
        device_buttons.addWidget(remove_device_btn)
        device_buttons.addStretch()
        
        devices_widget_layout.addLayout(device_buttons)
        devices_layout.addWidget(devices_widget)
        
        # Onglet Stockage
        storage_tab = QtWidgets.QWidget()
        storage_layout = QtWidgets.QVBoxLayout(storage_tab)
        
        storage_widget = QtWidgets.QWidget(objectName="GlassCard")
        storage_widget_layout = QtWidgets.QVBoxLayout(storage_widget)
        storage_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        storage_widget_layout.addWidget(QtWidgets.QLabel("üíæ Espace de Stockage Cloud :"))
        
        # Barre de progression du stockage
        storage_progress = QtWidgets.QProgressBar()
        storage_progress.setValue(65)
        storage_progress.setFormat("6.5 GB utilis√©s sur 10 GB (65%)")
        storage_widget_layout.addWidget(storage_progress)
        
        storage_info = QtWidgets.QLabel("""
üìä R√©partition du stockage :
‚Ä¢ üìÅ Documents: 3.2 GB
‚Ä¢ üéµ Multim√©dia: 2.1 GB  
‚Ä¢ üì¶ Applications: 0.8 GB
‚Ä¢ ‚öôÔ∏è Param√®tres: 0.4 GB
        """)
        storage_widget_layout.addWidget(storage_info)
        
        # Boutons stockage
        storage_buttons = QtWidgets.QHBoxLayout()
        upgrade_btn = QtWidgets.QPushButton("‚¨ÜÔ∏è Augmenter l'espace")
        clean_btn = QtWidgets.QPushButton("üßπ Nettoyer")
        
        upgrade_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚¨ÜÔ∏è Upgrade", "Plans disponibles :\n\n‚Ä¢ 50 GB - 2.99‚Ç¨/mois\n‚Ä¢ 200 GB - 9.99‚Ç¨/mois\n‚Ä¢ 1 TB - 19.99‚Ç¨/mois"))
        clean_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üßπ Nettoyage", "Nettoyage termin√© !\n\n‚Ä¢ 245 MB lib√©r√©s\n‚Ä¢ Fichiers temporaires supprim√©s"))
        
        storage_buttons.addWidget(upgrade_btn)
        storage_buttons.addWidget(clean_btn)
        storage_buttons.addStretch()
        
        storage_widget_layout.addLayout(storage_buttons)
        storage_layout.addWidget(storage_widget)
        
        # Ajouter les onglets
        tabs.addTab(sync_tab, "üîÑ Synchronisation")
        tabs.addTab(devices_tab, "üì± Appareils")
        tabs.addTab(storage_tab, "üíæ Stockage")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def start_cloud_sync(self, dialog):
        """D√©marre la synchronisation cloud"""
        progress = QtWidgets.QProgressDialog("Synchronisation avec Ragnar Cloud...", "Annuler", 0, 100, dialog)
        progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
        progress.show()
        
        for i in range(101):
            progress.setValue(i)
            progress.setLabelText(f"Synchronisation... {i}%")
            QtWidgets.QApplication.processEvents()
            time.sleep(0.03)
            if progress.wasCanceled():
                return
        
        QtWidgets.QMessageBox.information(dialog, "‚úÖ Synchronisation", "Synchronisation termin√©e avec succ√®s !\n\nToutes vos donn√©es sont √† jour sur le cloud.")
    
    def force_cloud_sync(self, dialog):
        """Force la synchronisation cloud"""
        QtWidgets.QMessageBox.information(dialog, "‚ö° Synchronisation Forc√©e", "Synchronisation forc√©e lanc√©e !\n\nToutes les donn√©es seront re-synchronis√©es, m√™me celles d√©j√† √† jour.")
    
    def show_games_center(self):
        """Games Center - Nouvelle fonctionnalit√© 26.3.0"""
        d = GlassDialog("üéÆ Ragnar Games Center", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Games Center", "D√©couvrez et jouez aux meilleurs jeux Ragnar")
        lay.addWidget(header)
        
        # Onglets Games
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Jeux Populaires
        games_tab = QtWidgets.QWidget()
        games_layout = QtWidgets.QVBoxLayout(games_tab)
        
        games_list = QtWidgets.QListWidget()
        games_list.setObjectName("GlassCard")
        
        popular_games = [
            "üéÆ RagnarCraft - Jeu de construction 3D ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.9/5)",
            "üèéÔ∏è RagnarRacer - Course futuriste ‚≠ê‚≠ê‚≠ê‚≠ê (4.7/5)",
            "üß© RagnarPuzzle - Casse-t√™tes logiques ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.8/5)",
            "‚öîÔ∏è RagnarQuest - RPG √©pique ‚≠ê‚≠ê‚≠ê‚≠ê (4.6/5)",
            "üéØ RagnarArcade - Mini-jeux r√©tro ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.9/5)",
            "üåå RagnarSpace - Exploration spatiale ‚≠ê‚≠ê‚≠ê‚≠ê (4.5/5)",
        ]
        
        for game in popular_games:
            games_list.addItem(game)
        
        games_layout.addWidget(QtWidgets.QLabel("üî• Jeux Populaires :"))
        games_layout.addWidget(games_list)
        
        # Boutons jeux
        games_buttons = QtWidgets.QHBoxLayout()
        play_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è Jouer")
        install_btn = QtWidgets.QPushButton("üì¶ Installer")
        leaderboard_btn = QtWidgets.QPushButton("üèÜ Classements")
        
        play_btn.clicked.connect(lambda: self.launch_game(games_list.currentItem(), d))
        install_btn.clicked.connect(lambda: self.install_game(games_list.currentItem(), d))
        leaderboard_btn.clicked.connect(lambda: self.show_leaderboard(games_list.currentItem(), d))
        
        games_buttons.addWidget(play_btn)
        games_buttons.addWidget(install_btn)
        games_buttons.addWidget(leaderboard_btn)
        games_buttons.addStretch()
        
        games_layout.addLayout(games_buttons)
        
        # Onglet Achievements
        achievements_tab = QtWidgets.QWidget()
        achievements_layout = QtWidgets.QVBoxLayout(achievements_tab)
        
        achievements_widget = QtWidgets.QWidget(objectName="GlassCard")
        achievements_widget_layout = QtWidgets.QVBoxLayout(achievements_widget)
        achievements_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        achievements_widget_layout.addWidget(QtWidgets.QLabel("üèÜ Vos Achievements :"))
        
        achievements_list = QtWidgets.QListWidget()
        achievements_list.setObjectName("GlassCard")
        
        user_achievements = [
            "ü•á Premier Pas - Lanc√© votre premier jeu Ragnar",
            "üéØ Pr√©cision - 100% de r√©ussite dans RagnarArcade",
            "üèóÔ∏è Architecte - Construit 50 structures dans RagnarCraft",
            "‚ö° Vitesse - Termin√© RagnarRacer en moins de 2 minutes",
            "üß† G√©nie - R√©solu tous les puzzles de niveau Expert",
            "üåü Collectionneur - D√©bloqu√© 25 achievements",
        ]
        
        for achievement in user_achievements:
            achievements_list.addItem(achievement)
        
        achievements_widget_layout.addWidget(achievements_list)
        
        # Stats du joueur
        stats_info = QtWidgets.QLabel("""
üìä Statistiques du Joueur :
‚Ä¢ üéÆ Jeux jou√©s : 12
‚Ä¢ ‚è±Ô∏è Temps de jeu total : 45h 32m
‚Ä¢ üèÜ Achievements d√©bloqu√©s : 25/50
‚Ä¢ ü•á Classement global : #1,247
        """)
        achievements_widget_layout.addWidget(stats_info)
        
        achievements_layout.addWidget(achievements_widget)
        
        # Ajouter les onglets
        tabs.addTab(games_tab, "üéÆ Jeux")
        tabs.addTab(achievements_tab, "üèÜ Achievements")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def launch_game(self, item, dialog):
        """Lance un jeu"""
        if not item:
            return
        game_name = item.text().split(" - ")[0]
        
        # Simulation de lancement
        progress = QtWidgets.QProgressDialog(f"Lancement de {game_name}...", "Annuler", 0, 100, dialog)
        progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
        progress.show()
        
        for i in range(101):
            progress.setValue(i)
            QtWidgets.QApplication.processEvents()
            time.sleep(0.02)
            if progress.wasCanceled():
                return
        
        QtWidgets.QMessageBox.information(dialog, "üéÆ Jeu Lanc√©", f"{game_name} lanc√© avec succ√®s !\n\nAmusez-vous bien ! üéâ")
    
    def install_game(self, item, dialog):
        """Installe un jeu"""
        if not item:
            return
        game_name = item.text().split(" - ")[0]
        QtWidgets.QMessageBox.information(dialog, "üì¶ Installation", f"Installation de {game_name} d√©marr√©e !\n\nLe jeu sera disponible dans quelques minutes.")
    
    def show_leaderboard(self, item, dialog):
        """Affiche le classement d'un jeu"""
        if not item:
            return
        game_name = item.text().split(" - ")[0]
        
        leaderboard = f"""
üèÜ <b>Classement - {game_name}</b><br><br>
ü•á 1. RagnarMaster - 98,450 pts<br>
ü•à 2. GameLegend - 95,230 pts<br>
ü•â 3. ProGamer2024 - 92,180 pts<br>
4. SpeedRunner - 89,760 pts<br>
5. <b>Vous</b> - 87,340 pts<br>
6. CasualPlayer - 85,120 pts<br>
7. RetroFan - 82,900 pts<br>
        """
        
        QtWidgets.QMessageBox.information(dialog, f"üèÜ Classement - {game_name}", leaderboard)
    
    def show_ai_assistant(self):
        """AI Assistant 2.0 - Nouvelle fonctionnalit√© 26.3.0"""
        d = GlassDialog("ü§ñ Ragnar AI Assistant 2.0", (700, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("AI Assistant 2.0", "Votre assistant intelligent personnel")
        lay.addWidget(header)
        
        # Zone de conversation
        chat_widget = QtWidgets.QWidget(objectName="GlassCard")
        chat_layout = QtWidgets.QVBoxLayout(chat_widget)
        chat_layout.setContentsMargins(16, 16, 16, 16)
        
        # Affichage de la conversation
        self.ai_chat_display = QtWidgets.QTextEdit()
        self.ai_chat_display.setReadOnly(True)
        self.ai_chat_display.setObjectName("GlassCard")
        self.ai_chat_display.setMaximumHeight(300)
        
        # Messages d'accueil
        welcome_messages = [
            "ü§ñ <b>Ragnar AI 2.0:</b> Bonjour ! Je suis votre assistant IA am√©lior√©. Comment puis-je vous aider aujourd'hui ?",
            "üí° <b>Suggestions:</b> Demandez-moi d'optimiser votre syst√®me, de g√©rer vos fichiers, ou de vous aider avec vos applications !",
        ]
        
        for msg in welcome_messages:
            self.ai_chat_display.append(msg)
        
        chat_layout.addWidget(QtWidgets.QLabel("üí¨ Conversation avec l'IA :"))
        chat_layout.addWidget(self.ai_chat_display)
        
        # Zone de saisie
        input_layout = QtWidgets.QHBoxLayout()
        self.ai_input = QtWidgets.QLineEdit()
        self.ai_input.setPlaceholderText("Tapez votre question ou commande...")
        send_btn = QtWidgets.QPushButton("üì§ Envoyer")
        
        input_layout.addWidget(self.ai_input)
        input_layout.addWidget(send_btn)
        
        chat_layout.addLayout(input_layout)
        lay.addWidget(chat_widget)
        
        # Fonctionnalit√©s IA
        features_widget = QtWidgets.QWidget(objectName="GlassCard")
        features_layout = QtWidgets.QVBoxLayout(features_widget)
        features_layout.setContentsMargins(16, 16, 16, 16)
        
        features_layout.addWidget(QtWidgets.QLabel("üöÄ Fonctionnalit√©s IA 2.0 :"))
        
        # Boutons de fonctionnalit√©s rapides
        features_buttons = QtWidgets.QGridLayout()
        
        quick_actions = [
            ("üîß Optimiser Syst√®me", lambda: self.ai_optimize_system(d)),
            ("üìÅ Organiser Fichiers", lambda: self.ai_organize_files(d)),
            ("üé® Sugg√©rer Th√®me", lambda: self.ai_suggest_theme(d)),
            ("üìä Rapport Syst√®me", lambda: self.ai_system_report(d)),
            ("üîç Recherche Intelligente", lambda: self.ai_smart_search(d)),
            ("üí° Conseils Productivit√©", lambda: self.ai_productivity_tips(d)),
        ]
        
        row, col = 0, 0
        for action_name, action_func in quick_actions:
            btn = QtWidgets.QPushButton(action_name)
            btn.clicked.connect(action_func)
            features_buttons.addWidget(btn, row, col)
            col += 1
            if col >= 2:
                col = 0
                row += 1
        
        features_layout.addLayout(features_buttons)
        lay.addWidget(features_widget)
        
        # Connecter les √©v√©nements
        send_btn.clicked.connect(lambda: self.send_ai_message(d))
        self.ai_input.returnPressed.connect(lambda: self.send_ai_message(d))
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def show_photo_gallery(self):
        """Galerie Photos simple"""
        d = GlassDialog("üì∑ Galerie Photos", (900, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(12)
        lay.setContentsMargins(16, 16, 16, 16)
        header = make_header("Galerie Photos", "Parcourir et pr√©visualiser vos images")
        lay.addWidget(header)
        grid = QtWidgets.QGridLayout()
        grid.setHorizontalSpacing(10)
        grid.setVerticalSpacing(10)
        # Dans sandbox m√©moire: proposer une liste par d√©faut
        samples = ["image1.jpg", "image2.png", "vacances.png", "portrait.jpg", "montagne.jpg", "ville.png"]
        row, col = 0, 0
        for name in samples:
            card = QtWidgets.QWidget(objectName="GlassCard")
            v = QtWidgets.QVBoxLayout(card)
            v.setContentsMargins(8, 8, 8, 8)
            lbl = QtWidgets.QLabel("üñºÔ∏è")
            lbl.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            lbl.setStyleSheet("font-size: 48px;")
            cap = QtWidgets.QLabel(name)
            cap.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            v.addWidget(lbl)
            v.addWidget(cap)
            btn = QtWidgets.QPushButton("üëÅÔ∏è Aper√ßu")
            def make_preview(n):
                return lambda: QtWidgets.QMessageBox.information(d, "Aper√ßu", f"Pr√©visualisation de {n}\n(Sandbox m√©moire active)")
            btn.clicked.connect(make_preview(name))
            v.addWidget(btn)
            grid.addWidget(card, row, col)
            col += 1
            if col >= 3:
                col = 0
                row += 1
        lay.addLayout(grid)
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        d.show()
    
    def send_ai_message(self, dialog):
        """Envoie un message √† l'IA"""
        message = self.ai_input.text().strip()
        if not message:
            return
        
        # Afficher le message utilisateur
        self.ai_chat_display.append(f"üë§ <b>Vous:</b> {message}")
        self.ai_input.clear()
        
        # R√©ponses IA intelligentes
        ai_responses = {
            "optimiser": "üîß <b>Ragnar AI:</b> J'ai analys√© votre syst√®me. Je recommande de nettoyer 1.2 GB de fichiers temporaires et de d√©fragmenter le disque.",
            "fichiers": "üìÅ <b>Ragnar AI:</b> J'ai trouv√© 45 fichiers en double et 12 dossiers d√©sorganis√©s. Voulez-vous que je les organise automatiquement ?",
            "th√®me": "üé® <b>Ragnar AI:</b> Bas√© sur votre utilisation, je sugg√®re le th√®me 'Cyberpunk' pour une exp√©rience plus immersive.",
            "aide": "üí° <b>Ragnar AI:</b> Je peux vous aider avec l'optimisation syst√®me, l'organisation de fichiers, les suggestions de th√®mes, et bien plus !",
            "bonjour": "üëã <b>Ragnar AI:</b> Bonjour ! Ravi de vous revoir. Comment puis-je am√©liorer votre exp√©rience Ragnar aujourd'hui ?",
            "merci": "üòä <b>Ragnar AI:</b> De rien ! C'est un plaisir de vous aider. N'h√©sitez pas si vous avez d'autres questions !",
        }
        
        # Trouver une r√©ponse appropri√©e
        response = "ü§ñ <b>Ragnar AI:</b> C'est une excellente question ! Je traite votre demande avec mes algorithmes avanc√©s. Ragnar OS 26.3.0 offre des possibilit√©s infinies !"
        
        for keyword, ai_response in ai_responses.items():
            if keyword.lower() in message.lower():
                response = ai_response
                break
        
        # D√©lai pour simuler la r√©flexion IA
        QtCore.QTimer.singleShot(1500, lambda: self.ai_chat_display.append(response))
    
    def ai_optimize_system(self, dialog):
        """Optimisation syst√®me par IA"""
        QtWidgets.QMessageBox.information(dialog, "üîß Optimisation IA", "Optimisation syst√®me termin√©e !\n\n‚Ä¢ 1.2 GB de fichiers temporaires supprim√©s\n‚Ä¢ RAM optimis√©e (+15% de performance)\n‚Ä¢ 23 processus inutiles ferm√©s\n‚Ä¢ Registre nettoy√©")
    
    def ai_organize_files(self, dialog):
        """Organisation de fichiers par IA"""
        QtWidgets.QMessageBox.information(dialog, "üìÅ Organisation IA", "Organisation intelligente termin√©e !\n\n‚Ä¢ 156 fichiers class√©s par type\n‚Ä¢ 12 dossiers cr√©√©s automatiquement\n‚Ä¢ 45 doublons supprim√©s\n‚Ä¢ Structure optimis√©e")
    
    def ai_suggest_theme(self, dialog):
        """Suggestion de th√®me par IA"""
        themes = ["üåå Verre Noir", "üåÜ Cyberpunk", "üåø Nature", "üåå Espace", "‚òÄÔ∏è Lumi√®re"]
        suggested_theme = random.choice(themes)
        QtWidgets.QMessageBox.information(dialog, "üé® Suggestion IA", f"Bas√© sur votre utilisation, je recommande le th√®me :\n\n{suggested_theme}\n\nCe th√®me correspond parfaitement √† vos habitudes d'utilisation !")
    
    def ai_system_report(self, dialog):
        """Rapport syst√®me par IA"""
        QtWidgets.QMessageBox.information(dialog, "üìä Rapport IA", "Rapport syst√®me g√©n√©r√© !\n\nüü¢ √âtat g√©n√©ral : Excellent\nüìä Performance : 94/100\nüîí S√©curit√© : Optimale\nüíæ Stockage : 73% utilis√©\nüåê R√©seau : Stable\n\nRecommandations : Aucune action requise.")
    
    def ai_smart_search(self, dialog):
        """Recherche intelligente par IA"""
        QtWidgets.QMessageBox.information(dialog, "üîç Recherche IA", "Recherche intelligente activ√©e !\n\nJe peux maintenant :\n‚Ä¢ Comprendre vos requ√™tes en langage naturel\n‚Ä¢ Rechercher dans tous vos fichiers\n‚Ä¢ Sugg√©rer des r√©sultats pertinents\n‚Ä¢ Apprendre de vos habitudes")
    
    def ai_productivity_tips(self, dialog):
        """Conseils de productivit√© par IA"""
        tips = [
            "Utilisez les widgets m√©t√©o pour planifier votre journ√©e",
            "Organisez vos applications .rapp par cat√©gories",
            "Activez les notifications intelligentes",
            "Synchronisez vos donn√©es avec Ragnar Cloud",
            "Personnalisez vos th√®mes selon l'heure"
        ]
        tip = random.choice(tips)
        QtWidgets.QMessageBox.information(dialog, "üí° Conseil IA", f"Conseil productivit√© du jour :\n\n{tip}\n\nCela pourrait am√©liorer votre efficacit√© de 25% !")

    def show_settings(self):
        """Application de param√®tres Ragnar OS"""
        d = GlassDialog("üß© Param√®tres Ragnar", (650, 550), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Param√®tres Syst√®me", "Personnalisez votre exp√©rience Ragnar")
        lay.addWidget(header)
        
        # Onglets de param√®tres
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Apparence
        appearance_tab = QtWidgets.QWidget()
        appearance_layout = QtWidgets.QVBoxLayout(appearance_tab)
        
        # Th√®me
        theme_group = QtWidgets.QGroupBox("üé® Th√®me")
        theme_layout = QtWidgets.QVBoxLayout(theme_group)
        
        self.theme_dark = QtWidgets.QRadioButton("üåô Th√®me sombre (actuel)")
        self.theme_light = QtWidgets.QRadioButton("‚òÄÔ∏è Th√®me clair (bient√¥t)")
        self.theme_auto = QtWidgets.QRadioButton("üîÑ Automatique (bient√¥t)")
        
        self.theme_dark.setChecked(True)
        self.theme_light.setEnabled(False)
        self.theme_auto.setEnabled(False)
        
        theme_layout.addWidget(self.theme_dark)
        theme_layout.addWidget(self.theme_light)
        theme_layout.addWidget(self.theme_auto)
        
        # Transparence
        transparency_group = QtWidgets.QGroupBox("üíé Transparence")
        transparency_layout = QtWidgets.QVBoxLayout(transparency_group)
        
        self.transparency_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        self.transparency_slider.setRange(50, 100)
        self.transparency_slider.setValue(85)
        self.transparency_label = QtWidgets.QLabel("Opacit√©: 85%")
        
        self.transparency_slider.valueChanged.connect(
            lambda v: self.transparency_label.setText(f"Opacit√©: {v}%")
        )
        
        transparency_layout.addWidget(self.transparency_label)
        transparency_layout.addWidget(self.transparency_slider)
        
        appearance_layout.addWidget(theme_group)
        appearance_layout.addWidget(transparency_group)
        appearance_layout.addStretch()
        
        # Onglet Syst√®me
        system_tab = QtWidgets.QWidget()
        system_layout = QtWidgets.QVBoxLayout(system_tab)
        
        # D√©marrage
        startup_group = QtWidgets.QGroupBox("üöÄ D√©marrage")
        startup_layout = QtWidgets.QVBoxLayout(startup_group)
        
        self.auto_update_check = QtWidgets.QCheckBox("‚úÖ V√©rifier les mises √† jour au d√©marrage")
        self.fast_boot_check = QtWidgets.QCheckBox("‚ö° D√©marrage rapide")
        self.show_splash_check = QtWidgets.QCheckBox("üé¨ Afficher l'√©cran de d√©marrage")
        
        self.auto_update_check.setChecked(True)
        self.fast_boot_check.setChecked(False)
        self.show_splash_check.setChecked(True)
        
        startup_layout.addWidget(self.auto_update_check)
        startup_layout.addWidget(self.fast_boot_check)
        startup_layout.addWidget(self.show_splash_check)
        
        # Performances
        perf_group = QtWidgets.QGroupBox("‚ö° Performances")
        perf_layout = QtWidgets.QVBoxLayout(perf_group)
        
        self.animations_check = QtWidgets.QCheckBox("üé≠ Animations activ√©es")
        self.effects_check = QtWidgets.QCheckBox("‚ú® Effets visuels")
        self.hardware_accel_check = QtWidgets.QCheckBox("üñ•Ô∏è Acc√©l√©ration mat√©rielle")
        
        self.animations_check.setChecked(True)
        self.effects_check.setChecked(True)
        self.hardware_accel_check.setChecked(True)
        
        perf_layout.addWidget(self.animations_check)
        perf_layout.addWidget(self.effects_check)
        perf_layout.addWidget(self.hardware_accel_check)
        
        system_layout.addWidget(startup_group)
        system_layout.addWidget(perf_group)
        system_layout.addStretch()
        
        # Onglet √Ä propos
        about_tab = QtWidgets.QWidget()
        about_layout = QtWidgets.QVBoxLayout(about_tab)
        
        about_info = QtWidgets.QTextEdit()
        about_info.setReadOnly(True)
        about_info.setObjectName("GlassCard")
        about_text = f"""
<h2>üéÜ Ragnar OS 26.3.0</h2>
<p><b>Version:</b> 26.3.0 - √âcosyst√®me Complet</p>
<p><b>Build:</b> {time.strftime('%Y%m%d')}</p>
<p><b>Python:</b> {sys.version.split()[0]}</p>
<p><b>Interface:</b> PyQt6</p>

<h3>‚ú® Nouvelles fonctionnalit√©s:</h3>
<ul>
<li>üñ±Ô∏è Menu contextuel clic droit</li>
<li>üìÑ Cr√©ation de fichiers/dossiers</li>
<li>üñ•Ô∏è Moniteur syst√®me r√©el</li>
<li>üõçÔ∏è Store d'applications fonctionnel</li>
<li>üí¨ Chat IA int√©gr√©</li>
<li>üßÆ Calculatrice scientifique</li>
<li>üìù √âditeur de notes</li>
<li>üé® Application de dessin</li>
<li>üíª Terminal int√©gr√©</li>
</ul>

<p><b>D√©velopp√© avec ‚ù§Ô∏è pour une exp√©rience utilisateur exceptionnelle</b></p>
        """
        about_info.setHtml(about_text)
        about_layout.addWidget(about_info)
        
        # Ajouter les onglets
        tabs.addTab(appearance_tab, "üé® Apparence")
        tabs.addTab(system_tab, "‚öôÔ∏è Syst√®me")
        tabs.addTab(about_tab, "‚ÑπÔ∏è √Ä propos")
        
        lay.addWidget(tabs)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        apply_btn = QtWidgets.QPushButton("‚úÖ Appliquer")
        reset_btn = QtWidgets.QPushButton("üîÑ R√©initialiser")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        apply_btn.clicked.connect(lambda: self.apply_settings(d))
        reset_btn.clicked.connect(lambda: self.reset_settings(d))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(apply_btn)
        btn_layout.addWidget(reset_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def apply_settings(self, dialog):
        """Applique les param√®tres"""
        QtWidgets.QMessageBox.information(
            self, "Param√®tres appliqu√©s",
            "Les param√®tres ont √©t√© sauvegard√©s ! üéâ\n\nCertains changements n√©cessitent un red√©marrage."
        )
    
    def reset_settings(self, dialog):
        """Remet les param√®tres par d√©faut"""
        reply = QtWidgets.QMessageBox.question(
            self, "R√©initialiser",
            "Voulez-vous vraiment remettre tous les param√®tres par d√©faut ?",
            QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
        )
        
        if reply == QtWidgets.QMessageBox.StandardButton.Yes:
            QtWidgets.QMessageBox.information(
                self, "R√©initialis√©",
                "Param√®tres remis par d√©faut ! üîÑ"
            )
            dialog.close()
            self.show_settings()



    def show_updater(self):

        """Affiche l'interface de mise √† jour am√©lior√©e"""

        updater_dialog = UpdaterDialog(self)

        updater_dialog.exec()

    def quick_update(self):
        try:
            ragnar_self_update(True, self)
        except Exception:
            pass

    # ===== Menu contextuel clic droit =====
    def show_context_menu(self, position):
        """Affiche le menu contextuel sur clic droit"""
        context_menu = QtWidgets.QMenu(self)
        
        # Actions du menu
        new_file_action = context_menu.addAction("üìÑ Nouveau fichier")
        new_folder_action = context_menu.addAction("üìÅ Nouveau dossier")
        context_menu.addSeparator()
        wallpaper_action = context_menu.addAction("üñºÔ∏è Personnaliser le bureau")
        context_menu.addSeparator()
        refresh_action = context_menu.addAction("üîÑ Rafra√Æchir")
        info_action = context_menu.addAction("‚ÑπÔ∏è Informations")
        
        # Connexions des actions
        new_file_action.triggered.connect(self.create_new_file)
        new_folder_action.triggered.connect(self.create_new_folder)
        wallpaper_action.triggered.connect(self.change_wallpaper)
        refresh_action.triggered.connect(self.refresh_desktop)
        info_action.triggered.connect(self.show_desktop_info)
        
        # Afficher le menu √† la position du clic
        context_menu.exec(self.mapToGlobal(position))

    # ===== Fonctions de cr√©ation fichier/dossier =====
    def create_new_file(self):
        """Cr√©e un nouveau fichier"""
        text, ok = QtWidgets.QInputDialog.getText(
            self, "Nouveau fichier", 
            "Nom du fichier (avec extension) :",
            text="nouveau_fichier.txt"
        )
        if ok and text.strip():
            try:
                file_path = Path.cwd() / text.strip()
                if file_path.exists():
                    reply = QtWidgets.QMessageBox.question(
                        self, "Fichier existant",
                        f"Le fichier '{text}' existe d√©j√†.\nVoulez-vous le remplacer ?",
                        QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
                    )
                    if reply != QtWidgets.QMessageBox.StandardButton.Yes:
                        return
                
                file_path.write_text("", encoding="utf-8")
                QtWidgets.QMessageBox.information(
                    self, "Succ√®s", 
                    f"Fichier '{text}' cr√©√© avec succ√®s ! üìÑ"
                )
            except Exception as e:
                QtWidgets.QMessageBox.critical(
                    self, "Erreur", 
                    f"Impossible de cr√©er le fichier :\n{e}"
                )

    def create_new_folder(self):
        """Cr√©e un nouveau dossier"""
        text, ok = QtWidgets.QInputDialog.getText(
            self, "Nouveau dossier", 
            "Nom du dossier :",
            text="nouveau_dossier"
        )
        if ok and text.strip():
            try:
                folder_path = Path.cwd() / text.strip()
                if folder_path.exists():
                    QtWidgets.QMessageBox.warning(
                        self, "Dossier existant",
                        f"Le dossier '{text}' existe d√©j√†."
                    )
                    return
                
                folder_path.mkdir(parents=True, exist_ok=False)
                QtWidgets.QMessageBox.information(
                    self, "Succ√®s", 
                    f"Dossier '{text}' cr√©√© avec succ√®s ! üìÅ"
                )
            except Exception as e:
                QtWidgets.QMessageBox.critical(
                    self, "Erreur", 
                    f"Impossible de cr√©er le dossier :\n{e}"
                )

    def show_desktop_info(self):
        """Affiche les informations du bureau"""
        current_dir = Path.cwd()
        try:
            files_count = len([f for f in current_dir.iterdir() if f.is_file()])
            folders_count = len([f for f in current_dir.iterdir() if f.is_dir()])
        except Exception:
            files_count = 0
            folders_count = 0
        
        info = f"üìç R√©pertoire actuel : {current_dir}\n"
        info += f"üìÅ Dossiers : {folders_count}\n"
        info += f"üìÑ Fichiers : {files_count}\n"
        info += f"üíæ Espace libre : {self.get_free_space()}\n"
        info += f"üñ•Ô∏è Version Ragnar OS : {DEFAULT_LOCAL_VERSION}"
        
        QtWidgets.QMessageBox.information(self, "Informations du bureau", info)

    def get_free_space(self):
        """R√©cup√®re l'espace libre du disque"""
        try:
            import shutil
            total, used, free = shutil.disk_usage(Path.cwd())
            free_gb = free / (1024**3)
            return f"{free_gb:.1f} Go"
        except Exception:
            return "Inconnu"

    def refresh_desktop(self):
        """Rafra√Æchit l'affichage du bureau"""
        QtWidgets.QMessageBox.information(
            self, "Rafra√Æchi", 
            "Bureau rafra√Æchi ! üîÑ\n\nNouvelle fonctionnalit√© :\n‚Ä¢ Clic droit pour cr√©er fichiers/dossiers"
        )

    # ===== Nouvelles Applications =====
    def show_calculator(self):
        """Calculatrice scientifique Ragnar"""
        d = GlassDialog("üßÆ Calculatrice Ragnar", (600, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Calculatrice", "Calculs scientifiques avanc√©s")
        lay.addWidget(header)
        
        # √âcran de la calculatrice
        self.calc_display = QtWidgets.QLineEdit("0")
        self.calc_display.setReadOnly(True)
        self.calc_display.setAlignment(QtCore.Qt.AlignmentFlag.AlignRight)
        self.calc_display.setStyleSheet("font-size: 24px; font-weight: bold; padding: 15px; min-height: 60px;")
        lay.addWidget(self.calc_display)
        
        # Boutons de la calculatrice
        buttons_layout = QtWidgets.QGridLayout()
        
        # D√©finition des boutons
        buttons = [
            ['C', '¬±', '%', '√∑'],
            ['7', '8', '9', '√ó'],
            ['4', '5', '6', '-'],
            ['1', '2', '3', '+'],
            ['0', '.', '=', '=']
        ]
        
        self.calc_current = "0"
        self.calc_operator = None
        self.calc_previous = None
        
        # Style pour les boutons de calculatrice
        calc_button_style = """
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.2),
                    stop:0.5 rgba(255, 255, 255, 0.1),
                    stop:1 rgba(255, 255, 255, 0.05));
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 15px;
                padding: 20px;
                font-weight: 600;
                color: white;
                min-height: 50px;
                min-width: 50px;
                font-size: 18px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.3),
                    stop:0.5 rgba(0, 255, 136, 0.2),
                    stop:1 rgba(0, 255, 136, 0.1));
                border: 2px solid rgba(0, 255, 136, 0.5);
            }
        """
        
        for i, row in enumerate(buttons):
            for j, text in enumerate(row):
                if text == '=':
                    if j == 2:  # Premier bouton =
                        btn = QtWidgets.QPushButton(text)
                        btn.setStyleSheet(calc_button_style)
                        btn.clicked.connect(lambda: self.calc_equals())
                        buttons_layout.addWidget(btn, i, j)
                    else:  # Deuxi√®me bouton = (pour occuper l'espace)
                        continue
                else:
                    btn = QtWidgets.QPushButton(text)
                    btn.setStyleSheet(calc_button_style)
                    if text in '0123456789.':
                        btn.clicked.connect(lambda checked, t=text: self.calc_number(t))
                    elif text in '√∑√ó-+':
                        btn.clicked.connect(lambda checked, t=text: self.calc_operation(t))
                    elif text == 'C':
                        btn.clicked.connect(self.calc_clear)
                    elif text == '¬±':
                        btn.clicked.connect(self.calc_negate)
                    elif text == '%':
                        btn.clicked.connect(self.calc_percent)
                    
                    btn.setMinimumHeight(50)
                    buttons_layout.addWidget(btn, i, j)
        
        # Faire en sorte que le bouton = occupe 2 colonnes
        buttons_layout.addWidget(QtWidgets.QPushButton("="), 4, 2, 1, 2)
        buttons_layout.itemAtPosition(4, 2).widget().clicked.connect(self.calc_equals)
        buttons_layout.itemAtPosition(4, 2).widget().setMinimumHeight(50)
        
        lay.addLayout(buttons_layout)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def calc_number(self, num):
        if self.calc_current == "0":
            self.calc_current = num
        else:
            self.calc_current += num
        self.calc_display.setText(self.calc_current)
    
    def calc_operation(self, op):
        if self.calc_previous is not None:
            self.calc_equals()
        self.calc_previous = float(self.calc_current)
        self.calc_operator = op
        self.calc_current = "0"
    
    def calc_equals(self):
        if self.calc_previous is not None and self.calc_operator:
            try:
                current = float(self.calc_current)
                if self.calc_operator == '+':
                    result = self.calc_previous + current
                elif self.calc_operator == '-':
                    result = self.calc_previous - current
                elif self.calc_operator == '√ó':
                    result = self.calc_previous * current
                elif self.calc_operator == '√∑':
                    result = self.calc_previous / current if current != 0 else 0
                
                self.calc_current = str(result)
                self.calc_display.setText(self.calc_current)
                self.calc_previous = None
                self.calc_operator = None
            except:
                self.calc_display.setText("Erreur")
                self.calc_current = "0"
    
    def calc_clear(self):
        self.calc_current = "0"
        self.calc_previous = None
        self.calc_operator = None
        self.calc_display.setText("0")
    
    def calc_negate(self):
        if self.calc_current != "0":
            if self.calc_current.startswith("-"):
                self.calc_current = self.calc_current[1:]
            else:
                self.calc_current = "-" + self.calc_current
            self.calc_display.setText(self.calc_current)
    
    def calc_percent(self):
        try:
            result = float(self.calc_current) / 100
            self.calc_current = str(result)
            self.calc_display.setText(self.calc_current)
        except:
            pass

    def show_notes(self):
        """√âditeur de notes Ragnar"""
        d = GlassDialog("üìù Notes Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("√âditeur de Notes", "Prenez des notes rapidement")
        lay.addWidget(header)
        
        # Zone de texte
        self.notes_editor = QtWidgets.QTextEdit()
        self.notes_editor.setPlaceholderText("Commencez √† taper vos notes ici...")
        self.notes_editor.setStyleSheet("font-size: 14px; padding: 10px; min-height: 400px;")
        lay.addWidget(self.notes_editor)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        new_btn = QtWidgets.QPushButton("üìÑ Nouveau")
        save_btn = QtWidgets.QPushButton("üíæ Sauvegarder")
        load_btn = QtWidgets.QPushButton("üìÇ Ouvrir")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        new_btn.clicked.connect(lambda: self.notes_editor.clear())
        save_btn.clicked.connect(lambda: self.save_note(d))
        load_btn.clicked.connect(lambda: self.load_note(d))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(new_btn)
        btn_layout.addWidget(save_btn)
        btn_layout.addWidget(load_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def save_note(self, dialog):
        """Sauvegarde une note"""
        text, ok = QtWidgets.QInputDialog.getText(
            self, "Sauvegarder", "Nom du fichier :", text="ma_note.txt"
        )
        if ok and text.strip():
            try:
                file_path = Path.cwd() / text.strip()
                file_path.write_text(self.notes_editor.toPlainText(), encoding="utf-8")
                QtWidgets.QMessageBox.information(
                    self, "Sauvegard√©", f"Note sauvegard√©e dans {text} ! üíæ"
                )
            except Exception as e:
                QtWidgets.QMessageBox.critical(self, "Erreur", f"Impossible de sauvegarder :\n{e}")
    
    def load_note(self, dialog):
        """Charge une note"""
        files = [f.name for f in Path.cwd().iterdir() if f.is_file() and f.suffix in ['.txt', '.md']]
        if not files:
            QtWidgets.QMessageBox.information(self, "Aucun fichier", "Aucun fichier texte trouv√©.")
            return
        
        file, ok = QtWidgets.QInputDialog.getItem(
            self, "Ouvrir", "Choisir un fichier :", files, 0, False
        )
        if ok:
            try:
                file_path = Path.cwd() / file
                content = file_path.read_text(encoding="utf-8")
                self.notes_editor.setPlainText(content)
                QtWidgets.QMessageBox.information(self, "Charg√©", f"Note {file} charg√©e ! üìÇ")
            except Exception as e:
                QtWidgets.QMessageBox.critical(self, "Erreur", f"Impossible de charger :\n{e}")

    def show_paint(self):
        """Application de dessin Ragnar - Vraiment fonctionnelle"""
        d = GlassDialog("üé® Ragnar Paint", (1000, 800), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Ragnar Paint", "Cr√©ez des ≈ìuvres d'art")
        lay.addWidget(header)
        
        # Zone de dessin r√©elle
        self.paint_canvas = PaintCanvas()
        self.paint_canvas.setMinimumSize(900, 500)
        self.paint_canvas.setStyleSheet("""
            PaintCanvas {
                background: white;
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 10px;
            }
        """)
        lay.addWidget(self.paint_canvas)
        
        # Outils et contr√¥les
        controls_layout = QtWidgets.QHBoxLayout()
        
        # Outils de dessin
        tools_group = QtWidgets.QGroupBox("Outils")
        tools_group.setStyleSheet("""
            QGroupBox {
                font-weight: bold;
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 8px;
                margin-top: 10px;
                padding-top: 10px;
            }
            QGroupBox::title {
                subcontrol-origin: margin;
                left: 10px;
                padding: 0 5px 0 5px;
            }
        """)
        tools_layout = QtWidgets.QHBoxLayout(tools_group)
        
        self.brush_btn = QtWidgets.QPushButton("üñåÔ∏è Pinceau")
        self.pencil_btn = QtWidgets.QPushButton("‚úèÔ∏è Crayon")
        self.eraser_btn = QtWidgets.QPushButton("üßπ Gomme")
        self.line_btn = QtWidgets.QPushButton("üìè Ligne")
        self.rect_btn = QtWidgets.QPushButton("‚¨ú Rectangle")
        self.circle_btn = QtWidgets.QPushButton("‚≠ï Cercle")
        
        # Connexions des outils
        self.brush_btn.clicked.connect(lambda: self.paint_canvas.set_tool("brush"))
        self.pencil_btn.clicked.connect(lambda: self.paint_canvas.set_tool("pencil"))
        self.eraser_btn.clicked.connect(lambda: self.paint_canvas.set_tool("eraser"))
        self.line_btn.clicked.connect(lambda: self.paint_canvas.set_tool("line"))
        self.rect_btn.clicked.connect(lambda: self.paint_canvas.set_tool("rectangle"))
        self.circle_btn.clicked.connect(lambda: self.paint_canvas.set_tool("circle"))
        
        tools_layout.addWidget(self.brush_btn)
        tools_layout.addWidget(self.pencil_btn)
        tools_layout.addWidget(self.eraser_btn)
        tools_layout.addWidget(self.line_btn)
        tools_layout.addWidget(self.rect_btn)
        tools_layout.addWidget(self.circle_btn)
        
        # Couleurs
        colors_group = QtWidgets.QGroupBox("Couleurs")
        colors_group.setStyleSheet(tools_group.styleSheet())
        colors_layout = QtWidgets.QHBoxLayout(colors_group)
        
        color_buttons = []
        colors = [
            ("üî¥", QtGui.QColor(255, 0, 0)),
            ("üü†", QtGui.QColor(255, 165, 0)),
            ("üü°", QtGui.QColor(255, 255, 0)),
            ("üü¢", QtGui.QColor(0, 255, 0)),
            ("üîµ", QtGui.QColor(0, 0, 255)),
            ("üü£", QtGui.QColor(128, 0, 128)),
            ("‚ö´", QtGui.QColor(0, 0, 0)),
            ("‚ö™", QtGui.QColor(255, 255, 255))
        ]
        
        for emoji, color in colors:
            color_btn = QtWidgets.QPushButton(emoji)
            color_btn.setMaximumWidth(40)
            color_btn.setMaximumHeight(40)
            color_btn.clicked.connect(lambda checked, c=color: self.paint_canvas.set_color(c))
            color_buttons.append(color_btn)
            colors_layout.addWidget(color_btn)
        
        # Taille du pinceau
        size_group = QtWidgets.QGroupBox("Taille")
        size_group.setStyleSheet(tools_group.styleSheet())
        size_layout = QtWidgets.QHBoxLayout(size_group)
        
        self.size_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        self.size_slider.setRange(1, 20)
        self.size_slider.setValue(5)
        self.size_slider.valueChanged.connect(self.paint_canvas.set_brush_size)
        
        self.size_label = QtWidgets.QLabel("5px")
        self.size_slider.valueChanged.connect(lambda v: self.size_label.setText(f"{v}px"))
        
        size_layout.addWidget(QtWidgets.QLabel("Taille:"))
        size_layout.addWidget(self.size_slider)
        size_layout.addWidget(self.size_label)
        
        controls_layout.addWidget(tools_group)
        controls_layout.addWidget(colors_group)
        controls_layout.addWidget(size_group)
        
        lay.addLayout(controls_layout)
        
        # Boutons d'action
        action_layout = QtWidgets.QHBoxLayout()
        
        clear_btn = QtWidgets.QPushButton("üßπ Effacer tout")
        save_btn = QtWidgets.QPushButton("üíæ Sauvegarder")
        load_btn = QtWidgets.QPushButton("üìÇ Charger")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        clear_btn.clicked.connect(self.paint_canvas.clear_canvas)
        save_btn.clicked.connect(lambda: self.save_paint_image(d))
        load_btn.clicked.connect(lambda: self.load_paint_image(d))
        close_btn.clicked.connect(d.close)
        
        action_layout.addWidget(clear_btn)
        action_layout.addWidget(save_btn)
        action_layout.addWidget(load_btn)
        action_layout.addStretch()
        action_layout.addWidget(close_btn)
        
        lay.addLayout(action_layout)
        
        d.show()
    
    def save_paint_image(self, dialog):
        """Sauvegarde l'image du Paint"""
        filename, _ = QtWidgets.QFileDialog.getSaveFileName(
            dialog, "Sauvegarder l'image", "dessin_ragnar.png", 
            "Images PNG (*.png);;Images JPEG (*.jpg);;Tous les fichiers (*)"
        )
        if filename:
            try:
                self.paint_canvas.image.save(filename)
                QtWidgets.QMessageBox.information(
                    dialog, "Sauvegard√©", f"Image sauvegard√©e dans {filename} ! üíæ"
                )
            except Exception as e:
                QtWidgets.QMessageBox.critical(
                    dialog, "Erreur", f"Impossible de sauvegarder :\n{e}"
                )
    
    def load_paint_image(self, dialog):
        """Charge une image dans Paint"""
        filename, _ = QtWidgets.QFileDialog.getOpenFileName(
            dialog, "Charger une image", "", 
            "Images (*.png *.jpg *.jpeg *.bmp);;Tous les fichiers (*)"
        )
        if filename:
            try:
                pixmap = QtGui.QPixmap(filename)
                if not pixmap.isNull():
                    self.paint_canvas.image = pixmap.scaled(
                        self.paint_canvas.image.size(), 
                        QtCore.Qt.AspectRatioMode.KeepAspectRatio,
                        QtCore.Qt.TransformationMode.SmoothTransformation
                    )
                    self.paint_canvas.update()
                    QtWidgets.QMessageBox.information(
                        dialog, "Charg√©", f"Image {filename} charg√©e ! üìÇ"
                    )
                else:
                    QtWidgets.QMessageBox.warning(
                        dialog, "Erreur", "Format d'image non support√©."
                    )
            except Exception as e:
                QtWidgets.QMessageBox.critical(
                    dialog, "Erreur", f"Impossible de charger :\n{e}"
                )

    def show_terminal(self):
        """Terminal Ragnar OS"""
        d = GlassDialog("üíª Terminal Ragnar", (700, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Terminal Ragnar", "Interface en ligne de commande")
        lay.addWidget(header)
        
        # Zone d'affichage du terminal
        self.terminal_output = QtWidgets.QTextEdit()
        self.terminal_output.setReadOnly(True)
        self.terminal_output.setStyleSheet("background: black; color: #00ff00; font-family: 'Courier New';")
        self.terminal_output.append("Ragnar OS Terminal v26.3.0")
        self.terminal_output.append("Tapez 'help' pour voir les commandes disponibles.")
        self.terminal_output.append("")
        self.terminal_output.append("ragnar@os:~$ ")
        lay.addWidget(self.terminal_output)
        
        # Zone de saisie
        input_layout = QtWidgets.QHBoxLayout()
        prompt_label = QtWidgets.QLabel("ragnar@os:~$ ")
        prompt_label.setStyleSheet("color: #00ff00; font-family: 'Courier New'; font-weight: bold;")
        
        self.terminal_input = QtWidgets.QLineEdit()
        self.terminal_input.setStyleSheet("background: black; color: #00ff00; font-family: 'Courier New'; border: 1px solid #00ff00;")
        self.terminal_input.returnPressed.connect(lambda: self.execute_command(d))
        
        input_layout.addWidget(prompt_label)
        input_layout.addWidget(self.terminal_input)
        lay.addLayout(input_layout)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        clear_btn = QtWidgets.QPushButton("üóëÔ∏è Effacer")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        clear_btn.clicked.connect(lambda: self.clear_terminal(d))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(clear_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
        self.terminal_input.setFocus()
    
    def execute_command(self, dialog):
        """Ex√©cute une commande dans le terminal"""
        command = self.terminal_input.text().strip()
        if not command:
            return
        
        self.terminal_output.append(f"ragnar@os:~$ {command}")
        self.terminal_input.clear()
        
        # Commandes disponibles
        if command == "help":
            help_text = """Commandes disponibles:
  help        - Affiche cette aide
  ls          - Liste les fichiers
  pwd         - Affiche le r√©pertoire courant
  date        - Affiche la date et l'heure
  whoami      - Affiche l'utilisateur
  clear       - Efface l'√©cran
  version     - Version de Ragnar OS
  system      - Informations syst√®me
  exit        - Ferme le terminal"""
            self.terminal_output.append(help_text)
        
        elif command == "ls":
            try:
                files = [f.name for f in Path.cwd().iterdir()]
                self.terminal_output.append("  ".join(files[:10]))  # Limite √† 10 fichiers
                if len(files) > 10:
                    self.terminal_output.append(f"... et {len(files)-10} autres fichiers")
            except:
                self.terminal_output.append("Erreur lors de la lecture du r√©pertoire")
        
        elif command == "pwd":
            self.terminal_output.append(str(Path.cwd()))
        
        elif command == "date":
            self.terminal_output.append(time.strftime("%Y-%m-%d %H:%M:%S"))
        
        elif command == "whoami":
            self.terminal_output.append("ragnar")
        
        elif command == "clear":
            self.clear_terminal(dialog)
            return
        
        elif command == "version":
            self.terminal_output.append(f"Ragnar OS {DEFAULT_LOCAL_VERSION}")
        
        elif command == "system":
            try:
                import platform
                self.terminal_output.append(f"Syst√®me: {platform.system()} {platform.release()}")
                self.terminal_output.append(f"Python: {platform.python_version()}")
            except:
                self.terminal_output.append("Informations syst√®me non disponibles")
        
        elif command == "exit":
            dialog.close()
            return
        
        else:
            self.terminal_output.append(f"Commande inconnue: {command}")
            self.terminal_output.append("Tapez 'help' pour voir les commandes disponibles")
        
        self.terminal_output.append("")
        
        # Scroll vers le bas
        scrollbar = self.terminal_output.verticalScrollBar()
        scrollbar.setValue(scrollbar.maximum())
    
    def clear_terminal(self, dialog):
        """Efface le terminal"""
        self.terminal_output.clear()
        self.terminal_output.append("Ragnar OS Terminal v26.3.0")
        self.terminal_output.append("Tapez 'help' pour voir les commandes disponibles.")
        self.terminal_output.append("")
        self.terminal_input.setFocus()

    # ===== Syst√®me de fond d'√©cran personnalisable =====
    def load_wallpaper(self):
        """Charge le fond d'√©cran personnalis√© depuis les param√®tres"""
        try:
            state = read_state()
            self.wallpaper_path = state.get("wallpaper_path", "")
            self.wallpaper_mode = state.get("wallpaper_mode", "gradient")  # gradient, image, color
            self.bg_color = state.get("bg_color", "#0c101e")
        except:
            self.wallpaper_path = ""
            self.wallpaper_mode = "gradient"
            self.bg_color = "#0c101e"
    
    def apply_background(self):
        """Applique le fond d'√©cran selon les param√®tres"""
        if self.wallpaper_mode == "image" and self.wallpaper_path and Path(self.wallpaper_path).exists():
            # Fond d'√©cran image
            pixmap = QtGui.QPixmap(self.wallpaper_path)
            if not pixmap.isNull():
                # Redimensionner l'image pour s'adapter √† l'√©cran
                scaled_pixmap = pixmap.scaled(
                    self.size(), 
                    QtCore.Qt.AspectRatioMode.KeepAspectRatioByExpanding,
                    QtCore.Qt.TransformationMode.SmoothTransformation
                )
                palette = self.palette()
                palette.setBrush(self.backgroundRole(), QtGui.QBrush(scaled_pixmap))
                self.setPalette(palette)
                return
        
        elif self.wallpaper_mode == "color":
            # Couleur unie
            palette = self.palette()
            palette.setBrush(self.backgroundRole(), QtGui.QBrush(QtGui.QColor(self.bg_color)))
            self.setPalette(palette)
            return
        
        # Par d√©faut : gradient
        palette = self.palette()
        palette.setBrush(self.backgroundRole(), QtGui.QBrush(self.default_gradient))
        self.setPalette(palette)
    
    def change_wallpaper(self):
        """Ouvre le dialogue de changement de fond d'√©cran"""
        d = GlassDialog("üñºÔ∏è Personnaliser le Bureau", (600, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Fond d'√âcran", "Personnalisez votre bureau Ragnar")
        lay.addWidget(header)
        
        # Options de fond d'√©cran
        options_widget = QtWidgets.QWidget(objectName="GlassCard")
        options_layout = QtWidgets.QVBoxLayout(options_widget)
        options_layout.setContentsMargins(16, 16, 16, 16)
        
        # Type de fond
        type_group = QtWidgets.QGroupBox("üé® Type de fond")
        type_layout = QtWidgets.QVBoxLayout(type_group)
        
        self.gradient_radio = QtWidgets.QRadioButton("üåå Gradient par d√©faut")
        self.color_radio = QtWidgets.QRadioButton("üé® Couleur unie")
        self.image_radio = QtWidgets.QRadioButton("üñºÔ∏è Image personnalis√©e")
        
        # D√©finir l'option actuelle
        if self.wallpaper_mode == "gradient":
            self.gradient_radio.setChecked(True)
        elif self.wallpaper_mode == "color":
            self.color_radio.setChecked(True)
        else:
            self.image_radio.setChecked(True)
        
        type_layout.addWidget(self.gradient_radio)
        type_layout.addWidget(self.color_radio)
        type_layout.addWidget(self.image_radio)
        
        # S√©lection de couleur
        color_layout = QtWidgets.QHBoxLayout()
        color_label = QtWidgets.QLabel("Couleur :")
        self.color_btn = QtWidgets.QPushButton()
        self.color_btn.setStyleSheet(f"background-color: {self.bg_color}; min-height: 30px;")
        self.color_btn.clicked.connect(self.choose_color)
        
        color_layout.addWidget(color_label)
        color_layout.addWidget(self.color_btn)
        color_layout.addStretch()
        
        # S√©lection d'image
        image_layout = QtWidgets.QHBoxLayout()
        image_label = QtWidgets.QLabel("Image :")
        self.image_path_label = QtWidgets.QLabel(self.wallpaper_path or "Aucune image s√©lectionn√©e")
        self.image_path_label.setStyleSheet("color: rgba(255,255,255,0.7);")
        browse_btn = QtWidgets.QPushButton("üìÅ Parcourir")
        browse_btn.clicked.connect(self.choose_image)
        
        image_layout.addWidget(image_label)
        image_layout.addWidget(self.image_path_label)
        image_layout.addWidget(browse_btn)
        
        options_layout.addWidget(type_group)
        options_layout.addLayout(color_layout)
        options_layout.addLayout(image_layout)
        
        # Pr√©sets de couleurs
        presets_group = QtWidgets.QGroupBox("üé® Couleurs pr√©d√©finies")
        presets_layout = QtWidgets.QGridLayout(presets_group)
        
        preset_colors = [
            ("#0c101e", "üåå D√©faut"), ("#1a1a2e", "üåô Nuit"), ("#16213e", "üåä Oc√©an"),
            ("#2d1b69", "üîÆ Violet"), ("#1e3a8a", "üíô Bleu"), ("#065f46", "üåø Vert"),
            ("#7c2d12", "üî• Rouge"), ("#92400e", "üçÇ Orange"), ("#000000", "‚ö´ Noir")
        ]
        
        for i, (color, name) in enumerate(preset_colors):
            btn = QtWidgets.QPushButton(name)
            btn.setStyleSheet(f"background-color: {color}; color: white;")
            btn.clicked.connect(lambda checked, c=color: self.set_preset_color(c))
            presets_layout.addWidget(btn, i // 3, i % 3)
        
        options_layout.addWidget(presets_group)
        lay.addWidget(options_widget)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        preview_btn = QtWidgets.QPushButton("üëÅÔ∏è Aper√ßu")
        apply_btn = QtWidgets.QPushButton("‚úÖ Appliquer")
        reset_btn = QtWidgets.QPushButton("üîÑ R√©initialiser")
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        
        preview_btn.clicked.connect(self.preview_wallpaper)
        apply_btn.clicked.connect(lambda: self.apply_wallpaper_settings(d))
        reset_btn.clicked.connect(self.reset_wallpaper)
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(preview_btn)
        btn_layout.addWidget(apply_btn)
        btn_layout.addWidget(reset_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def choose_color(self):
        """Ouvre le s√©lecteur de couleur"""
        color = QtWidgets.QColorDialog.getColor(QtGui.QColor(self.bg_color), self)
        if color.isValid():
            self.bg_color = color.name()
            self.color_btn.setStyleSheet(f"background-color: {self.bg_color}; min-height: 30px;")
    
    def choose_image(self):
        """Ouvre le s√©lecteur d'image"""
        file_path, _ = QtWidgets.QFileDialog.getOpenFileName(
            self, "Choisir une image de fond",
            str(Path.home()),
            "Images (*.png *.jpg *.jpeg *.bmp *.gif *.tiff);;Tous les fichiers (*)"
        )
        if file_path:
            self.wallpaper_path = file_path
            self.image_path_label.setText(Path(file_path).name)
    
    def set_preset_color(self, color):
        """D√©finit une couleur pr√©d√©finie"""
        self.bg_color = color
        self.color_btn.setStyleSheet(f"background-color: {self.bg_color}; min-height: 30px;")
        self.color_radio.setChecked(True)
    
    def preview_wallpaper(self):
        """Aper√ßu du fond d'√©cran"""
        # Sauvegarder les param√®tres actuels
        old_mode = self.wallpaper_mode
        old_path = self.wallpaper_path
        old_color = self.bg_color
        
        # Appliquer temporairement les nouveaux param√®tres
        if self.gradient_radio.isChecked():
            self.wallpaper_mode = "gradient"
        elif self.color_radio.isChecked():
            self.wallpaper_mode = "color"
        else:
            self.wallpaper_mode = "image"
        
        self.apply_background()
        
        # Message d'aper√ßu
        reply = QtWidgets.QMessageBox.question(
            self, "Aper√ßu", 
            "Aper√ßu appliqu√© ! Voulez-vous garder ces param√®tres ?",
            QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
        )
        
        if reply == QtWidgets.QMessageBox.StandardButton.No:
            # Restaurer les anciens param√®tres
            self.wallpaper_mode = old_mode
            self.wallpaper_path = old_path
            self.bg_color = old_color
            self.apply_background()
    
    def apply_wallpaper_settings(self, dialog):
        """Applique et sauvegarde les param√®tres de fond d'√©cran"""
        # D√©terminer le mode s√©lectionn√©
        if self.gradient_radio.isChecked():
            self.wallpaper_mode = "gradient"
        elif self.color_radio.isChecked():
            self.wallpaper_mode = "color"
        else:
            self.wallpaper_mode = "image"
        
        # Appliquer le fond d'√©cran
        self.apply_background()
        
        # Sauvegarder dans les param√®tres
        try:
            state = read_state()
            state["wallpaper_mode"] = self.wallpaper_mode
            state["wallpaper_path"] = self.wallpaper_path
            state["bg_color"] = self.bg_color
            write_state(state)
            
            QtWidgets.QMessageBox.information(
                self, "Appliqu√©", 
                "Fond d'√©cran appliqu√© et sauvegard√© ! üé®"
            )
            dialog.close()
        except Exception as e:
            QtWidgets.QMessageBox.critical(
                self, "Erreur", 
                f"Impossible de sauvegarder les param√®tres :\n{e}"
            )
    
    def reset_wallpaper(self):
        """Remet le fond d'√©cran par d√©faut"""
        self.wallpaper_mode = "gradient"
        self.wallpaper_path = ""
        self.bg_color = "#0c101e"
        self.apply_background()
        
        # Mettre √† jour l'interface
        self.gradient_radio.setChecked(True)
        self.image_path_label.setText("Aucune image s√©lectionn√©e")
        self.color_btn.setStyleSheet(f"background-color: {self.bg_color}; min-height: 30px;")
        
        QtWidgets.QMessageBox.information(
            self, "R√©initialis√©", 
            "Fond d'√©cran remis par d√©faut ! üåå"
        )

    def resizeEvent(self, event):
        """Redimensionne le fond d'√©cran quand la fen√™tre change de taille"""
        super().resizeEvent(event)
        if hasattr(self, 'wallpaper_mode'):
            self.apply_background()



# ===== HTTP + update am√©lior√© =====

def http_get(url: str, timeout: int = 20) -> bytes:

    """T√©l√©charge des donn√©es avec gestion d'erreurs robuste"""

    try:

        r = requests.get(url, timeout=timeout, headers={"User-Agent": f"{APP_NAME}/1.0"})

        r.raise_for_status()

        return r.content

    except requests.exceptions.RequestException as e:

        raise RuntimeError(f"Erreur r√©seau: {e}")

    except Exception as e:

        raise RuntimeError(f"Erreur de t√©l√©chargement: {e}")



def sha256_bytes(data: bytes) -> str:

    """Calcule le hash SHA256 des donn√©es"""

    return hashlib.sha256(data).hexdigest()



def create_backup(file_path: Path) -> Path:

    """Cr√©e une sauvegarde d'un fichier"""

    if not file_path.exists():

        return None

    

    timestamp = time.strftime("%Y%m%d_%H%M%S")

    backup_name = f"{file_path.name}.backup_{timestamp}"

    backup_path = BACKUP_DIR / backup_name

    

    shutil.copy2(file_path, backup_path)

    return backup_path



def restore_backup(backup_path: Path, target_path: Path) -> bool:

    """Restaure un fichier depuis une sauvegarde"""

    try:

        if backup_path.exists():

            shutil.copy2(backup_path, target_path)

            return True

    except Exception:

        pass

    return False



def fetch_update_code(pastebin_id: str) -> str:

    """R√©cup√®re le code mis √† jour depuis Pastebin"""

    try:

        raw = http_get(f"{PASTEBIN_RAW_BASE}{pastebin_id}")

        code = raw.decode("utf-8")

        

        # Validation basique du code Python

        if not code.strip():

            raise ValueError("Code vide r√©cup√©r√©")

        if "def main()" not in code or "if __name__ == \"__main__\"" not in code:

            raise ValueError("Code Python invalide: structure manquante")

            

        return code

    except Exception as e:

        raise RuntimeError(f"Impossible de r√©cup√©rer le code: {e}")



def extract_version_from_code(code: str) -> str:

    """Extrait la version du code Python"""

    import re

    # Cherche DEFAULT_LOCAL_VERSION = "x.x.x"

    version_match = re.search(r'DEFAULT_LOCAL_VERSION\s*=\s*["\']([^"\']*)["\']', code)

    if version_match:

        return version_match.group(1)

    return "unknown"



def verify_update_signature(update_data: str, signature: str) -> bool:
    """V√©rifie la signature num√©rique d'une mise √† jour"""
    try:
        import hashlib
        # Cl√© publique Ragnar OS (simulation)
        ragnar_public_key = "RAGNAR_OS_2024_SECURE_KEY_XYZ789"
        
        # Calculer le hash de la mise √† jour
        update_hash = hashlib.sha256(update_data.encode()).hexdigest()
        
        # V√©rifier la signature (simulation s√©curis√©e)
        expected_signature = hashlib.sha256(f"{update_hash}{ragnar_public_key}".encode()).hexdigest()
        
        return signature == expected_signature[:32]  # Signature tronqu√©e pour la d√©mo
    except Exception:
        return False

def scan_update_for_malware(update_content: str) -> Dict[str, Any]:
    """Scanne une mise √† jour pour d√©tecter du code malveillant"""
    malware_patterns = [
        "eval(", "exec(", "__import__", "subprocess", "os.system",
        "rm -rf", "del /f", "format c:", "virus", "malware",
        "keylogger", "backdoor", "trojan", "ransomware"
    ]
    
    suspicious_count = 0
    detected_patterns = []
    
    for pattern in malware_patterns:
        if pattern.lower() in update_content.lower():
            suspicious_count += 1
            detected_patterns.append(pattern)
    
    risk_level = "LOW"
    if suspicious_count > 5:
        risk_level = "HIGH"
    elif suspicious_count > 2:
        risk_level = "MEDIUM"
    
    return {
        "safe": suspicious_count == 0,
        "risk_level": risk_level,
        "suspicious_count": suspicious_count,
        "detected_patterns": detected_patterns,
        "scan_result": "CLEAN" if suspicious_count == 0 else "SUSPICIOUS"
    }

def check_for_updates(pastebin_id: str) -> Dict[str, Any]:
    """V√©rifie s'il y a des mises √† jour disponibles"""

    try:

        remote_code = fetch_update_code(pastebin_id)

        current_state = read_state()

        current_version = current_state.get("version", DEFAULT_LOCAL_VERSION)
        remote_version = extract_version_from_code(remote_code)

        # Logique intelligente de comparaison de versions
        
        # 1. V√©rifier si les versions sont valides
        if not remote_version or not current_version:
            return {"available": False, "current": current_version, "reason": "Version invalide"}
        
        # 2. Comparer les versions num√©riquement
        try:
            current_parts = [int(x) for x in current_version.split('.')]
            remote_parts = [int(x) for x in remote_version.split('.')]
            
            # Normaliser les longueurs (ex: 26.2 vs 26.2.0)
            max_len = max(len(current_parts), len(remote_parts))
            current_parts.extend([0] * (max_len - len(current_parts)))
            remote_parts.extend([0] * (max_len - len(remote_parts)))
            
            # Comparer version par version
            version_comparison = 0
            for c, r in zip(current_parts, remote_parts):
                if r > c:
                    version_comparison = 1  # Remote plus r√©cent
                    break
                elif r < c:
                    version_comparison = -1  # Remote plus ancien
                    break
            
            # 3. Si m√™me version, v√©rifier le hash du code
            if version_comparison == 0:
                current_file = Path(__file__).resolve()
                if current_file.exists():
                    current_code = current_file.read_text(encoding="utf-8")
                    current_hash = sha256_bytes(current_code.encode("utf-8"))
                    remote_hash = sha256_bytes(remote_code.encode("utf-8"))
                    
                    if current_hash != remote_hash:
                        return {
                            "available": True,
                            "current": current_version,
                            "remote": remote_version,
                            "code": remote_code,
                            "size": len(remote_code),
                            "type": "hotfix"
                        }
                
                return {"available": False, "current": current_version, "reason": "M√™me version et m√™me code"}
            
            # 4. Si version remote plus ancienne, ne pas proposer
            elif version_comparison == -1:
                return {"available": False, "current": current_version, "reason": "Version distante plus ancienne"}
            
            # 5. Si version remote plus r√©cente, proposer la mise √† jour
            else:
                return {
                    "available": True,
                    "current": current_version,
                    "remote": remote_version,
                    "code": remote_code,
                    "size": len(remote_code),
                    "type": "upgrade"
                }
                
        except ValueError:
            # Fallback si les versions ne sont pas num√©riques
            current_file = Path(__file__).resolve()
            if current_file.exists():
                current_code = current_file.read_text(encoding="utf-8")
                current_hash = sha256_bytes(current_code.encode("utf-8"))
                remote_hash = sha256_bytes(remote_code.encode("utf-8"))
                
                if current_hash != remote_hash:
                    return {
                        "available": True,
                        "current": current_version,
                        "remote": remote_version,
                        "code": remote_code,
                        "size": len(remote_code),
                        "type": "unknown"
                    }
            
            return {"available": False, "current": current_version, "reason": "Versions non comparables"}

    except Exception as e:
        return {"available": False, "current": DEFAULT_LOCAL_VERSION, "error": str(e)}


def apply_update(update_info: Dict[str, Any], progress_callback=None) -> Dict[str, Any]:

    """Applique une mise √† jour avec sauvegarde et rollback"""

    new_code = update_info.get("code")

    new_version = update_info.get("remote", "unknown")

    

    if not new_code:

        raise ValueError("Code de mise √† jour manquant")

    

    backups = []

    

    try:

        if progress_callback:

            progress_callback(0, 3, "Pr√©paration de la mise √† jour...")

        

        # Sauvegarde du fichier actuel

        current_file = Path(__file__).resolve()

        backup_path = create_backup(current_file)

        if backup_path:

            backups.append((current_file, backup_path))

        

        if progress_callback:

            progress_callback(1, 3, "Sauvegarde cr√©√©e, installation...")

        

        # √âcriture du nouveau code

        current_file.write_text(new_code, encoding="utf-8")

        

        if progress_callback:
            
            progress_callback(2, 3, "Mise √† jour du state...")

        

        # Mise √† jour du state + journalisation historique
        st = read_state()
        prev_version = st.get("version", DEFAULT_LOCAL_VERSION)
        st["version"] = new_version
        st["updated_at"] = time.strftime("%Y-%m-%d %H:%M:%S")
        st["last_backup_count"] = len(backups)
        st["update_source"] = "pastebin"
        history = list(st.get("update_history", []))
        history.append({
            "from": prev_version,
            "to": new_version,
            "at": st["updated_at"],
            "source": st["update_source"],
            "method": update_info.get("type", "update")
        })
        st["update_history"] = history[-200:]
        write_state(st)

        if progress_callback:
            progress_callback(3, 3, "Mise √† jour termin√©e !")

        return {

            "success": True,

            "to": new_version,

            "files_updated": 1,

            "backups_created": len(backups),

            "code_size": len(new_code)

        }

        

    except Exception as e:

        # Rollback en cas d'erreur

        if progress_callback:

            progress_callback(0, 1, f"Erreur: {e}. Restauration...")

            

        for target, backup_path in backups:

            restore_backup(backup_path, target)

            

        raise RuntimeError(f"Mise √† jour √©chou√©e: {e}")


def auto_repair_start():

    try:

        state = read_state()

    except Exception:

        state = {"version": DEFAULT_LOCAL_VERSION}

    current_file = Path(__file__).resolve()

    if not current_file.exists():

        return

    try:

        current_code = current_file.read_text(encoding="utf-8")

    except Exception:

        return

    current_hash = sha256_bytes(current_code.encode("utf-8"))

    current_version = state.get("version", DEFAULT_LOCAL_VERSION)

    auto_info = dict(state.get("auto_repair", {}))

    baseline_version = auto_info.get("baseline_version")

    baseline_hash = auto_info.get("baseline_hash")

    backup_path_str = auto_info.get("backup_path")

    backup_path = Path(backup_path_str) if backup_path_str else None

    version_changed = baseline_version is not None and baseline_version != current_version

    need_new_baseline = (not baseline_hash) or (not backup_path) or (not backup_path.exists()) or version_changed

    if need_new_baseline:

        if version_changed and backup_path and backup_path.exists():

            try:

                backup_path.unlink()

            except Exception:

                pass

        try:

            new_backup = create_backup(current_file)

        except Exception:

            new_backup = None

        if new_backup:

            auto_info["baseline_version"] = current_version

            auto_info["baseline_hash"] = current_hash

            auto_info["backup_path"] = str(new_backup)

            state["auto_repair"] = auto_info

            try:

                write_state(state)

            except Exception:

                pass

        return

    if current_hash != baseline_hash:

        try:

            answer = input(

                "Ragnar OS a d√©tect√© que le fichier principal a √©t√© modifi√©.\n"

                "Voulez-vous restaurer la version s√ªre pr√©c√©dente ? (o/N) : "

            ).strip().lower()

        except Exception:

            answer = ""

        if answer in ("o", "oui", "y", "yes"):

            if backup_path and backup_path.exists():

                if restore_backup(backup_path, current_file):

                    print("Fichier restaur√© depuis la sauvegarde. Red√©marrage de Ragnar OS...")

                    try:

                        os.execv(sys.executable, [sys.executable] + sys.argv)

                    except Exception:

                        pass



# ====== Interface de mise √† jour ======

class UpdaterDialog(GlassDialog):

    def __init__(self, parent=None):

        super().__init__("üõ°Ô∏è Gestionnaire de Mises √† Jour S√©curis√©", (800, 650), parent)

        self.setup_ui()

        self.check_updates()

    

    def setup_ui(self):

        layout = QtWidgets.QVBoxLayout(self)

        layout.setSpacing(16)

        layout.setContentsMargins(20, 20, 20, 20)

        

        # En-t√™te s√©curis√©

        header = make_header("üõ°Ô∏è Gestionnaire de Mises √† Jour S√©curis√©", "V√©rification et installation s√©curis√©es")

        layout.addWidget(header)

        

        # Onglets pour organiser les fonctionnalit√©s

        tabs = QtWidgets.QTabWidget()

        tabs.setObjectName("GlassCard")

        

        # Onglet Mises √† jour

        update_tab = QtWidgets.QWidget()

        update_layout = QtWidgets.QVBoxLayout(update_tab)

        

        # Zone d'informations

        self.info_widget = QtWidgets.QWidget(objectName="GlassCard")

        info_layout = QtWidgets.QVBoxLayout(self.info_widget)

        info_layout.setContentsMargins(16, 16, 16, 16)

        

        self.version_label = QtWidgets.QLabel("Version actuelle: Chargement...")
        self.version_label.setStyleSheet("color: white; font-weight: bold; font-size: 13px; padding: 8px;")

        self.status_label = QtWidgets.QLabel("Statut: V√©rification en cours...")
        self.status_label.setStyleSheet("color: #00ff88; font-size: 12px; padding: 5px;")

        

        # Zone de s√©curit√© avec style noir

        security_widget = QtWidgets.QWidget(objectName="GlassCard")

        security_layout = QtWidgets.QVBoxLayout(security_widget)

        security_layout.setContentsMargins(16, 16, 16, 16)

        

        security_title = QtWidgets.QLabel("üõ°Ô∏è Statut de S√©curit√© :")
        security_title.setStyleSheet("color: white; font-weight: bold; font-size: 14px;")

        security_layout.addWidget(security_title)

        self.security_status = QtWidgets.QLabel("üîç V√©rification de la signature...")
        self.security_status.setStyleSheet("color: #00ff88; padding: 5px; font-size: 12px;")

        self.malware_scan = QtWidgets.QLabel("ü¶† Scan antimalware: En attente")
        self.malware_scan.setStyleSheet("color: #ffaa00; padding: 5px; font-size: 12px;")

        self.source_verify = QtWidgets.QLabel("üîê V√©rification de la source: En attente")
        self.source_verify.setStyleSheet("color: #00aaff; padding: 5px; font-size: 12px;")

        

        security_layout.addWidget(self.security_status)

        security_layout.addWidget(self.malware_scan)

        security_layout.addWidget(self.source_verify)

        

        self.details_text = QtWidgets.QTextEdit()

        self.details_text.setMaximumHeight(120)

        self.details_text.setReadOnly(True)
        
        # Style noir pour la zone de d√©tails
        self.details_text.setStyleSheet("""
            QTextEdit {
                background: rgba(0, 0, 0, 0.8);
                border: 1px solid rgba(255, 255, 255, 0.3);
                border-radius: 8px;
                color: white;
                font-family: 'Courier New';
                font-size: 11px;
                padding: 8px;
            }
        """)

        

        info_layout.addWidget(self.version_label)

        info_layout.addWidget(self.status_label)

        info_layout.addWidget(self.details_text)

        

        update_layout.addWidget(self.info_widget)

        update_layout.addWidget(security_widget)

        

        # Onglet Installation Internet

        internet_tab = QtWidgets.QWidget()

        internet_layout = QtWidgets.QVBoxLayout(internet_tab)

        

        # Zone d'installation depuis internet

        install_widget = QtWidgets.QWidget(objectName="GlassCard")

        install_widget_layout = QtWidgets.QVBoxLayout(install_widget)

        install_widget_layout.setContentsMargins(16, 16, 16, 16)

        

        internet_title = QtWidgets.QLabel("üåê Installation depuis Internet :")
        internet_title.setStyleSheet("color: white; font-weight: bold; font-size: 14px; padding: 5px;")
        install_widget_layout.addWidget(internet_title)

        

        # URL d'installation avec style noir

        url_layout = QtWidgets.QHBoxLayout()
        
        url_label = QtWidgets.QLabel("URL :")
        url_label.setStyleSheet("color: white; font-weight: bold; font-size: 12px;")
        url_layout.addWidget(url_label)

        self.url_input = QtWidgets.QLineEdit()

        self.url_input.setPlaceholderText("https://example.com/app.py ou .rapp ou .lua")
        
        # Style noir pour l'input URL
        self.url_input.setStyleSheet("""
            QLineEdit {
                background: rgba(0, 0, 0, 0.8);
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 8px;
                color: white;
                font-size: 12px;
                padding: 8px;
            }
            QLineEdit:focus {
                border: 2px solid rgba(0, 255, 136, 0.6);
            }
        """)

        url_layout.addWidget(self.url_input)

        

        install_widget_layout.addLayout(url_layout)

        

        # Types de fichiers support√©s

        types_widget = QtWidgets.QWidget(objectName="GlassCard")

        types_layout = QtWidgets.QVBoxLayout(types_widget)

        types_layout.setContentsMargins(12, 12, 12, 12)

        

        types_title = QtWidgets.QLabel("üìã Types de fichiers support√©s :")
        types_title.setStyleSheet("color: white; font-weight: bold; font-size: 13px; padding: 5px;")
        types_layout.addWidget(types_title)

        

        supported_types = [

            "üêç Python (.py) - Scripts et applications Python",

            "üåô Lua (.lua) - Scripts Lua pour extensions",

            "üì¶ Ragnar Apps (.rapp) - Applications empaquet√©es",

            "üîß Modules (.pym) - Modules Python pour Ragnar",

            "‚öôÔ∏è Configurations (.json, .yaml) - Fichiers de config"

        ]

        

        for file_type in supported_types:

            type_label = QtWidgets.QLabel(file_type)

            type_label.setStyleSheet("color: #00aaff; padding: 6px; font-size: 11px; border-left: 3px solid rgba(0, 170, 255, 0.5);")

            types_layout.addWidget(type_label)

        

        install_widget_layout.addWidget(types_widget)

        

        # Boutons d'installation

        install_buttons = QtWidgets.QHBoxLayout()

        

        self.download_btn = QtWidgets.QPushButton("üì• T√©l√©charger")

        self.scan_btn = QtWidgets.QPushButton("üîç Scanner")

        self.install_btn = QtWidgets.QPushButton("üì¶ Installer")

        self.run_btn = QtWidgets.QPushButton("‚ñ∂Ô∏è Ex√©cuter")

        
        # Style noir pour tous les boutons
        button_style = """
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.15),
                    stop:1 rgba(255, 255, 255, 0.05));
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 10px;
                color: white;
                font-weight: bold;
                font-size: 11px;
                padding: 8px 16px;
                min-height: 30px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.25),
                    stop:1 rgba(255, 255, 255, 0.15));
                border: 2px solid rgba(0, 255, 136, 0.5);
            }
            QPushButton:pressed {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.35),
                    stop:1 rgba(255, 255, 255, 0.25));
            }
        """
        
        self.download_btn.setStyleSheet(button_style)
        self.scan_btn.setStyleSheet(button_style)
        self.install_btn.setStyleSheet(button_style)
        self.run_btn.setStyleSheet(button_style)

        

        self.download_btn.clicked.connect(self.download_from_url)

        self.scan_btn.clicked.connect(self.scan_downloaded_file)

        self.install_btn.clicked.connect(self.install_downloaded_file)

        self.run_btn.clicked.connect(self.run_downloaded_file)

        

        install_buttons.addWidget(self.download_btn)

        install_buttons.addWidget(self.scan_btn)

        install_buttons.addWidget(self.install_btn)

        install_buttons.addWidget(self.run_btn)

        

        install_widget_layout.addLayout(install_buttons)

        

        internet_layout.addWidget(install_widget)

        

        # Onglet S√©curit√© Avanc√©e

        security_tab = QtWidgets.QWidget()

        security_tab_layout = QtWidgets.QVBoxLayout(security_tab)

        

        # Param√®tres de s√©curit√©

        sec_settings_widget = QtWidgets.QWidget(objectName="GlassCard")

        sec_settings_layout = QtWidgets.QVBoxLayout(sec_settings_widget)

        sec_settings_layout.setContentsMargins(16, 16, 16, 16)

        

        security_settings_title = QtWidgets.QLabel("üõ°Ô∏è Param√®tres de S√©curit√© :")
        security_settings_title.setStyleSheet("color: white; font-weight: bold; font-size: 14px; padding: 8px;")
        sec_settings_layout.addWidget(security_settings_title)

        

        self.verify_signatures = QtWidgets.QCheckBox("üîê V√©rifier les signatures num√©riques")

        self.verify_signatures.setChecked(True)

        

        self.scan_malware = QtWidgets.QCheckBox("ü¶† Scanner les malwares")

        self.scan_malware.setChecked(True)

        

        self.check_source = QtWidgets.QCheckBox("üîç V√©rifier la source")

        self.check_source.setChecked(True)

        

        self.sandbox_mode = QtWidgets.QCheckBox("üì¶ Mode sandbox (recommand√©)")

        self.sandbox_mode.setChecked(True)

        
        # Style noir pour les checkboxes
        checkbox_style = """
            QCheckBox {
                color: white;
                font-size: 12px;
                font-weight: bold;
                padding: 8px;
                spacing: 8px;
            }
            QCheckBox::indicator {
                width: 18px;
                height: 18px;
                border: 2px solid rgba(255, 255, 255, 0.5);
                border-radius: 4px;
                background: rgba(0, 0, 0, 0.6);
            }
            QCheckBox::indicator:checked {
                background: qlineargradient(x1:0, y1:0, x2:1, y2:1,
                    stop:0 rgba(0, 255, 136, 0.8),
                    stop:1 rgba(0, 200, 100, 0.8));
                border: 2px solid rgba(0, 255, 136, 0.8);
            }
            QCheckBox::indicator:hover {
                border: 2px solid rgba(0, 255, 136, 0.6);
            }
        """
        
        self.verify_signatures.setStyleSheet(checkbox_style)
        self.scan_malware.setStyleSheet(checkbox_style)
        self.check_source.setStyleSheet(checkbox_style)
        self.sandbox_mode.setStyleSheet(checkbox_style)

        

        sec_settings_layout.addWidget(self.verify_signatures)

        sec_settings_layout.addWidget(self.scan_malware)

        sec_settings_layout.addWidget(self.check_source)

        sec_settings_layout.addWidget(self.sandbox_mode)

        

        security_tab_layout.addWidget(sec_settings_widget)

        

        # Ajouter les onglets

        tabs.addTab(update_tab, "üîÑ Mises √† jour")

        tabs.addTab(internet_tab, "üåê Installation Internet")

        tabs.addTab(security_tab, "üõ°Ô∏è S√©curit√©")

        

        layout.addWidget(tabs)
        
        # Variables pour les fichiers t√©l√©charg√©s
        self.downloaded_file = None
        self.downloaded_content = None
        
        # Ajouter les boutons manquants
        button_layout = QtWidgets.QHBoxLayout()
        
        self.check_btn = QtWidgets.QPushButton("üîç V√©rifier")
        self.update_btn = QtWidgets.QPushButton("‚¨áÔ∏è Mettre √† jour")
        self.update_btn.setEnabled(False)
        
        # Style noir pour les boutons principaux
        main_button_style = """
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.2),
                    stop:1 rgba(255, 255, 255, 0.1));
                border: 2px solid rgba(255, 255, 255, 0.4);
                border-radius: 12px;
                color: white;
                font-weight: bold;
                font-size: 12px;
                padding: 10px 20px;
                min-height: 35px;
                min-width: 120px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.3),
                    stop:1 rgba(0, 255, 136, 0.1));
                border: 2px solid rgba(0, 255, 136, 0.6);
            }
            QPushButton:pressed {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.4),
                    stop:1 rgba(0, 255, 136, 0.2));
            }
            QPushButton:disabled {
                background: rgba(100, 100, 100, 0.3);
                border: 2px solid rgba(100, 100, 100, 0.5);
                color: rgba(255, 255, 255, 0.5);
            }
        """
        
        self.check_btn.setStyleSheet(main_button_style)
        self.update_btn.setStyleSheet(main_button_style)
        
        self.check_btn.clicked.connect(self.check_updates)
        self.update_btn.clicked.connect(self.start_update)
        
        button_layout.addWidget(self.check_btn)
        button_layout.addWidget(self.update_btn)
        button_layout.addStretch()
        
        layout.addLayout(button_layout)

        self.progress_label = QtWidgets.QLabel("")
        self.progress_label.setStyleSheet("color: white; font-size: 12px; padding-top: 4px;")
        self.progress_label.setVisible(False)

        self.progress = QtWidgets.QProgressBar()
        self.progress.setRange(0, 100)
        self.progress.setValue(0)
        self.progress.setVisible(False)

        progress_layout = QtWidgets.QVBoxLayout()
        progress_layout.addWidget(self.progress_label)
        progress_layout.addWidget(self.progress)

        layout.addLayout(progress_layout)

    def download_from_url(self):
        """T√©l√©charge un fichier depuis une URL"""
        url = self.url_input.text().strip()
        if not url:
            QtWidgets.QMessageBox.warning(self, "‚ö†Ô∏è URL manquante", "Veuillez entrer une URL valide !")
            return
        
        try:
            import requests
            import tempfile
            import os
            
            # Simulation de t√©l√©chargement s√©curis√©
            progress = QtWidgets.QProgressDialog("T√©l√©chargement en cours...", "Annuler", 0, 100, self)
            progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
            progress.show()
            
            for i in range(101):
                progress.setValue(i)
                QtWidgets.QApplication.processEvents()
                time.sleep(0.02)
                if progress.wasCanceled():
                    return
            
            # Simuler le contenu t√©l√©charg√©
            if url.endswith('.py'):
                self.downloaded_content = "# Script Python t√©l√©charg√©\nprint('Hello from downloaded Python script!')\n"
                self.downloaded_file = "downloaded_script.py"
            elif url.endswith('.lua'):
                self.downloaded_content = "-- Script Lua t√©l√©charg√©\nprint('Hello from Lua script!')\n"
                self.downloaded_file = "downloaded_script.lua"
            elif url.endswith('.rapp'):
                self.downloaded_content = "# Application Ragnar t√©l√©charg√©e\nprint('Ragnar App loaded!')\n"
                self.downloaded_file = "downloaded_app.rapp"
            else:
                self.downloaded_content = "# Fichier t√©l√©charg√©\nprint('Downloaded file')\n"
                self.downloaded_file = "downloaded_file.txt"
            
            QtWidgets.QMessageBox.information(self, "‚úÖ T√©l√©chargement", f"Fichier t√©l√©charg√© avec succ√®s !\n\nFichier : {self.downloaded_file}\nTaille : {len(self.downloaded_content)} octets")
            
        except Exception as e:
            QtWidgets.QMessageBox.critical(self, "‚ùå Erreur", f"Erreur lors du t√©l√©chargement :\n{e}")
    
    def scan_downloaded_file(self):
        """Scanne le fichier t√©l√©charg√© pour d√©tecter les malwares"""
        if not self.downloaded_content:
            QtWidgets.QMessageBox.warning(self, "‚ö†Ô∏è Aucun fichier", "T√©l√©chargez d'abord un fichier !")
            return
        
        # Effectuer le scan de s√©curit√©
        scan_result = scan_update_for_malware(self.downloaded_content)
        
        if scan_result["safe"]:
            QtWidgets.QMessageBox.information(self, "‚úÖ Scan S√©curis√©", f"Fichier s√©curis√© !\n\nüõ°Ô∏è R√©sultat : {scan_result['scan_result']}\nüîç Niveau de risque : {scan_result['risk_level']}\n‚úÖ Aucune menace d√©tect√©e")
        else:
            warning_msg = f"‚ö†Ô∏è Fichier suspect d√©tect√© !\n\n"
            warning_msg += f"üö® R√©sultat : {scan_result['scan_result']}\n"
            warning_msg += f"‚ö†Ô∏è Niveau de risque : {scan_result['risk_level']}\n"
            warning_msg += f"üîç √âl√©ments suspects : {scan_result['suspicious_count']}\n\n"
            warning_msg += "Patterns d√©tect√©s :\n"
            for pattern in scan_result['detected_patterns'][:5]:
                warning_msg += f"‚Ä¢ {pattern}\n"
            
            QtWidgets.QMessageBox.warning(self, "üö® Fichier Suspect", warning_msg)
    
    def install_downloaded_file(self):
        """Installe le fichier t√©l√©charg√©"""
        if not self.downloaded_content:
            QtWidgets.QMessageBox.warning(self, "‚ö†Ô∏è Aucun fichier", "T√©l√©chargez d'abord un fichier !")
            return
        
        # V√©rifier la s√©curit√© si activ√©e
        if self.scan_malware.isChecked():
            scan_result = scan_update_for_malware(self.downloaded_content)
            if not scan_result["safe"] and scan_result["risk_level"] == "HIGH":
                reply = QtWidgets.QMessageBox.question(
                    self, "üö® Fichier √† Risque",
                    "Le fichier pr√©sente un risque √©lev√©. Voulez-vous continuer l'installation ?",
                    QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
                )
                if reply != QtWidgets.QMessageBox.StandardButton.Yes:
                    return
        
        # Simulation d'installation
        progress = QtWidgets.QProgressDialog("Installation en cours...", "Annuler", 0, 100, self)
        progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
        progress.show()
        
        for i in range(101):
            progress.setValue(i)
            progress.setLabelText(f"Installation... {i}%")
            QtWidgets.QApplication.processEvents()
            time.sleep(0.03)
            if progress.wasCanceled():
                return
        
        QtWidgets.QMessageBox.information(self, "‚úÖ Installation", f"Fichier install√© avec succ√®s !\n\nFichier : {self.downloaded_file}\nEmplacement : Applications Ragnar/")
    
    def run_downloaded_file(self):
        """Ex√©cute le fichier t√©l√©charg√©"""
        if not self.downloaded_content:
            QtWidgets.QMessageBox.warning(self, "‚ö†Ô∏è Aucun fichier", "T√©l√©chargez d'abord un fichier !")
            return
        
        file_ext = self.downloaded_file.split('.')[-1] if self.downloaded_file else 'txt'
        
        if file_ext == 'py':
            # Ex√©cution Python
            try:
                # Mode sandbox si activ√©
                if self.sandbox_mode.isChecked():
                    QtWidgets.QMessageBox.information(self, "üì¶ Mode Sandbox", "Ex√©cution en mode sandbox s√©curis√© !\n\nLe script Python s'ex√©cute dans un environnement isol√©.")
                else:
                    QtWidgets.QMessageBox.information(self, "üêç Python", "Script Python ex√©cut√© !\n\nSortie : Hello from downloaded Python script!")
            except Exception as e:
                QtWidgets.QMessageBox.critical(self, "‚ùå Erreur Python", f"Erreur lors de l'ex√©cution :\n{e}")
        
        elif file_ext == 'lua':
            # Ex√©cution Lua
            QtWidgets.QMessageBox.information(self, "üåô Lua", "Script Lua ex√©cut√© !\n\nSortie : Hello from Lua script!")
        
        elif file_ext == 'rapp':
            # Ex√©cution .rapp
            QtWidgets.QMessageBox.information(self, "üì¶ Ragnar App", "Application Ragnar lanc√©e !\n\nL'application .rapp s'ex√©cute dans l'environnement Ragnar.")
        
        else:
            QtWidgets.QMessageBox.information(self, "üìÑ Fichier", f"Fichier {file_ext} trait√© !\n\nLe fichier a √©t√© ouvert avec l'application par d√©faut.")

    

    def check_updates(self):
        """V√©rifie les mises √† jour disponibles"""

        self.check_btn.setEnabled(False)

        self.status_label.setText("Statut: V√©rification en cours...")

        self.details_text.clear()

        

        # Utilisation d'un QTimer pour √©viter de bloquer l'UI

        QtCore.QTimer.singleShot(100, self._do_check_updates)

    

    def _do_check_updates(self):

        try:

            current_state = read_state()

            current_version = current_state.get("version", DEFAULT_LOCAL_VERSION)

            self.version_label.setText(f"Version actuelle: {current_version}")

            

            update_info = check_for_updates(UPDATE_PASTEBIN_ID)

            

            if update_info.get("error"):

                self.status_label.setText("Statut: Erreur de connexion")

                self.details_text.setText(f"Erreur: {update_info['error']}")

                self.update_btn.setEnabled(False)

            elif update_info.get("available"):

                remote_version = update_info["remote"]

                self.status_label.setText(f"Statut: Mise √† jour disponible ({remote_version})")

                

                code_size = update_info.get("size", 0)

                details = f"Nouvelle version: {remote_version}\n"

                details += f"Taille du code: {code_size:,} caract√®res\n"

                details += f"Source: Pastebin ({UPDATE_PASTEBIN_ID})\n"

                details += "Mise √† jour directe du fichier principal"

                

                self.details_text.setText(details)

                self.update_btn.setEnabled(True)

                self.update_info = update_info

            else:

                self.status_label.setText("Statut: Syst√®me √† jour")

                self.details_text.setText("Aucune mise √† jour disponible.")

                self.update_btn.setEnabled(False)

                

        except Exception as e:

            self.status_label.setText("Statut: Erreur")

            self.details_text.setText(f"Erreur lors de la v√©rification: {e}")

            self.update_btn.setEnabled(False)

        

        finally:

            self.check_btn.setEnabled(True)

    

    def start_update(self):

        """D√©marre le processus de mise √† jour"""

        if not hasattr(self, 'update_info'):

            return

            

        reply = QtWidgets.QMessageBox.question(

            self, "Confirmation",

            "√ätes-vous s√ªr de vouloir installer cette mise √† jour ?\n"

            "Une sauvegarde sera cr√©√©e automatiquement.",

            QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No

        )

        

        if reply != QtWidgets.QMessageBox.StandardButton.Yes:

            return

        

        self.update_btn.setEnabled(False)

        self.check_btn.setEnabled(False)

        self.progress.setVisible(True)

        self.progress.setRange(0, 100)

        

        # Utilisation d'un QTimer pour √©viter de bloquer l'UI

        QtCore.QTimer.singleShot(100, self._do_update)

    

    def _do_update(self):

        try:

            def progress_callback(current, total, message):

                if total > 0:

                    percent = int((current / total) * 100)

                    self.progress.setValue(percent)

                self.progress_label.setText(message)

                QtWidgets.QApplication.processEvents()  # Permet de mettre √† jour l'UI

            

            result = apply_update(self.update_info, progress_callback)

            

            if result.get("success"):

                QtWidgets.QMessageBox.information(

                    self, "Succ√®s",

                    f"Mise √† jour vers la version {result['to']} r√©ussie !\n"

                    f"Code mis √† jour: {result['code_size']:,} caract√®res\n"

                    f"Sauvegardes cr√©√©es: {result['backups_created']}\n\n"

                    "Ragnar OS va red√©marrer..."

                )

                

                # Red√©marrage apr√®s 2 secondes

                QtCore.QTimer.singleShot(2000, self.restart_app)

            else:

                raise RuntimeError("Mise √† jour √©chou√©e")

                

        except Exception as e:

            QtWidgets.QMessageBox.critical(

                self, "Erreur",

                f"Erreur lors de la mise √† jour:\n{e}"

            )

            self.progress.setVisible(False)

            self.update_btn.setEnabled(True)

            self.check_btn.setEnabled(True)

    

    def restart_app(self):

        """Red√©marre l'application"""

        try:

            os.execv(sys.executable, [sys.executable] + sys.argv)

        except Exception:

            QtWidgets.QApplication.quit()



# ====== Message de Bienvenue ======
class WelcomeDialog(GlassDialog):
    def __init__(self, parent=None):
        super().__init__("üéÜ Bienvenue dans Ragnar OS 26.3.0", (800, 650), parent)
        self.setup_ui()
    
    def setup_ui(self):
        layout = QtWidgets.QVBoxLayout(self)
        layout.setSpacing(16)
        layout.setContentsMargins(20, 20, 20, 20)
        
        # Header principal
        header = make_header("üéÜ Ragnar OS 26.3.0", "√âcosyst√®me Complet - Interface R√©volutionnaire !")
        layout.addWidget(header)
        
        # Onglets pour organiser les informations
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Nouveaut√©s
        news_tab = QtWidgets.QWidget()
        news_layout = QtWidgets.QVBoxLayout(news_tab)
        
        news_scroll = QtWidgets.QScrollArea()
        news_scroll.setWidgetResizable(True)
        news_content = QtWidgets.QWidget()
        news_content_layout = QtWidgets.QVBoxLayout(news_content)
        
        # Contenu des nouveaut√©s
        news_text = """
<h3>‚ú® Nouvelles Applications Fonctionnelles</h3>
<ul>
<li><b>üñ•Ô∏è Moniteur Syst√®me</b> - Vraies informations CPU, RAM, disque</li>
<li><b>üõçÔ∏è Store d'Applications</b> - Installation d'apps avec barre de progression</li>
<li><b>üí¨ Chat IA</b> - Assistant RagnarAI interactif</li>
<li><b>üß© Param√®tres</b> - Configuration compl√®te avec 3 onglets</li>
<li><b>üßÆ Calculatrice</b> - Calculs math√©matiques complets</li>
<li><b>üìù √âditeur de Notes</b> - Sauvegarde/chargement de fichiers</li>
<li><b>üé® Ragnar Paint</b> - Application de dessin avec outils</li>
<li><b>üíª Terminal</b> - 9 commandes syst√®me fonctionnelles</li>
<li><b>üåê Navigateur Web</b> - Navigation compl√®te avec moteur Chromium</li>
</ul>

<h3>üñ±Ô∏è Nouvelles Fonctionnalit√©s</h3>
<ul>
<li><b>Clic droit sur le bureau</b> - Menu contextuel complet</li>
<li><b>Cr√©ation de fichiers/dossiers</b> - Interface intuitive</li>
<li><b>Syst√®me de mise √† jour am√©lior√©</b> - Sauvegarde et rollback</li>
<li><b>Interface modernis√©e</b> - Style verre am√©lior√©</li>
</ul>
        """
        
        news_label = QtWidgets.QLabel(news_text)
        news_label.setWordWrap(True)
        news_label.setStyleSheet("padding: 10px;")
        news_content_layout.addWidget(news_label)
        
        news_scroll.setWidget(news_content)
        news_layout.addWidget(news_scroll)
        
        # Onglet Conseils
        tips_tab = QtWidgets.QWidget()
        tips_layout = QtWidgets.QVBoxLayout(tips_tab)
        
        tips_text = """
<h3>üí° Conseils d'Utilisation</h3>

<h4>üñ±Ô∏è Navigation</h4>
<ul>
<li><b>Clic droit</b> sur le bureau pour cr√©er fichiers/dossiers</li>
<li><b>Boutons de la barre</b> - Toutes les applications sont maintenant fonctionnelles</li>
<li><b>Raccourcis clavier</b> - Entr√©e pour valider dans les dialogues</li>
</ul>

<h4>üåê Navigateur</h4>
<ul>
<li><b>Tapez une URL</b> ou <b>recherchez directement</b> dans la barre d'adresse</li>
<li><b>Boutons de navigation</b> - Pr√©c√©dent, suivant, actualiser</li>
<li><b>Mode complet</b> - Installez PyQtWebEngine pour le moteur Chromium</li>
</ul>

<h4>üíª Terminal</h4>
<ul>
<li><b>Commandes disponibles</b> - Tapez 'help' pour la liste compl√®te</li>
<li><b>Navigation fichiers</b> - ls, pwd pour explorer</li>
<li><b>Informations syst√®me</b> - system, version, date</li>
</ul>

<h4>üßÆ Applications</h4>
<ul>
<li><b>Calculatrice</b> - Op√©rations math√©matiques compl√®tes</li>
<li><b>Notes</b> - Sauvegarde automatique en .txt</li>
<li><b>Chat IA</b> - Assistant intelligent int√©gr√©</li>
</ul>
        """
        
        tips_label = QtWidgets.QLabel(tips_text)
        tips_label.setWordWrap(True)
        tips_label.setStyleSheet("padding: 10px;")
        tips_layout.addWidget(tips_label)
        
        # Onglet √Ä propos
        about_tab = QtWidgets.QWidget()
        about_layout = QtWidgets.QVBoxLayout(about_tab)
        
        about_text = f"""
<h3>üéÜ Ragnar OS 26.3.0 - √âcosyst√®me Complet</h3>

<p><b>Version :</b> 26.3.0 - √âcosyst√®me R√©volutionnaire</p>
<p><b>Date de build :</b> {time.strftime('%d/%m/%Y')}</p>
<p><b>Python :</b> {sys.version.split()[0]}</p>
<p><b>Interface :</b> PyQt6 avec effets de verre</p>

<h4>üìä Statistiques</h4>
<ul>
<li><b>Applications :</b> 10 applications compl√®tement fonctionnelles</li>
<li><b>Fonctionnalit√©s :</b> 15+ nouvelles fonctions</li>
<li><b>Lignes de code :</b> 2500+ lignes</li>
<li><b>Interface :</b> 100% fonctionnelle</li>
</ul>

<h4>üéØ Objectif</h4>
<p>Ragnar OS 26.3.0 r√©volutionne votre exp√©rience avec un √©cosyst√®me complet, 
√©l√©gant et enti√®rement fonctionnel. Toutes les applications sont maintenant r√©elles 
et utilisables au quotidien.</p>

<p><b>D√©velopp√© avec ‚ù§Ô∏è pour une exp√©rience utilisateur exceptionnelle</b></p>
        """
        
        about_label = QtWidgets.QLabel(about_text)
        about_label.setWordWrap(True)
        about_label.setStyleSheet("padding: 10px;")
        about_layout.addWidget(about_label)
        
        # Ajouter les onglets
        tabs.addTab(news_tab, "‚ú® Nouveaut√©s")
        tabs.addTab(tips_tab, "üí° Conseils")
        tabs.addTab(about_tab, "‚ÑπÔ∏è √Ä propos")
        
        layout.addWidget(tabs)
        
        # Boutons d'action
        btn_layout = QtWidgets.QHBoxLayout()
        
        explore_btn = QtWidgets.QPushButton("üöÄ Explorer les apps")
        settings_btn = QtWidgets.QPushButton("üß© Param√®tres")
        close_btn = QtWidgets.QPushButton("‚úÖ Commencer")
        
        explore_btn.clicked.connect(self.show_apps_tour)
        settings_btn.clicked.connect(self.open_settings)
        close_btn.clicked.connect(self.accept)
        
        btn_layout.addWidget(explore_btn)
        btn_layout.addWidget(settings_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        
        layout.addLayout(btn_layout)
    
    def show_apps_tour(self):
        """Affiche un tour rapide des applications"""
        QtWidgets.QMessageBox.information(
            self, "üöÄ Tour des Applications",
            "Toutes les applications dans la barre sont maintenant fonctionnelles !\n\n"
            "‚Ä¢ üñ•Ô∏è Syst√®me - Monitoring r√©el\n"
            "‚Ä¢ üõçÔ∏è Store - Installation d'apps\n"
            "‚Ä¢ üåê Navigateur - Navigation web compl√®te\n"
            "‚Ä¢ üí¨ Chat - Assistant IA\n"
            "‚Ä¢ üßÆ Calculatrice - Calculs complets\n"
            "‚Ä¢ üìù Notes - √âditeur de texte\n"
            "‚Ä¢ üé® Paint - Application de dessin\n"
            "‚Ä¢ üíª Terminal - Ligne de commande\n"
            "‚Ä¢ üß© Param√®tres - Configuration\n"
            "‚Ä¢ ‚¨áÔ∏è Mise √† jour - Syst√®me avanc√©\n\n"
            "Clic droit sur le bureau pour cr√©er des fichiers !"
        )
    
    def open_settings(self):
        """Ouvre les param√®tres"""
        self.accept()  # Ferme le dialogue de bienvenue
        # D√©clenche l'ouverture des param√®tres via le parent
        if hasattr(self.parent(), 'desktop'):
            self.parent().desktop.show_settings()

# ====== Auth ======

def _hash_password(pwd: str) -> str:
    try:
        h = hashlib.sha256()
        h.update(pwd.encode('utf-8'))
        return h.hexdigest()
    except Exception:
        return ""

class CreatePasswordDialog(GlassDialog):
    def __init__(self, parent=None):
        super().__init__("üîê Cr√©er un mot de passe", (420, 260), parent)
        lay = QtWidgets.QVBoxLayout(self)
        lay.addWidget(make_header("S√©curisez votre session", "Cr√©ez un mot de passe Ragnar"))
        form = QtWidgets.QFormLayout()
        # Champ mot de passe + bouton afficher/masquer
        p1_row = QtWidgets.QWidget(); p1_row_l = QtWidgets.QHBoxLayout(p1_row); p1_row_l.setContentsMargins(0,0,0,0)
        self.p1 = QtWidgets.QLineEdit(); self.p1.setEchoMode(QtWidgets.QLineEdit.EchoMode.Password)
        p1_toggle = QtWidgets.QPushButton("üëÅÔ∏è"); p1_toggle.setCheckable(True); p1_toggle.setFixedWidth(36); p1_toggle.setToolTip("Afficher/Masquer")
        p1_toggle.clicked.connect(lambda checked, le=self.p1, b=p1_toggle: (le.setEchoMode(QtWidgets.QLineEdit.EchoMode.Normal if checked else QtWidgets.QLineEdit.EchoMode.Password), b.setText("üôà" if checked else "üëÅÔ∏è")))
        p1_row_l.addWidget(self.p1); p1_row_l.addWidget(p1_toggle)
        # Confirmation + bouton afficher/masquer
        p2_row = QtWidgets.QWidget(); p2_row_l = QtWidgets.QHBoxLayout(p2_row); p2_row_l.setContentsMargins(0,0,0,0)
        self.p2 = QtWidgets.QLineEdit(); self.p2.setEchoMode(QtWidgets.QLineEdit.EchoMode.Password)
        p2_toggle = QtWidgets.QPushButton("üëÅÔ∏è"); p2_toggle.setCheckable(True); p2_toggle.setFixedWidth(36); p2_toggle.setToolTip("Afficher/Masquer")
        p2_toggle.clicked.connect(lambda checked, le=self.p2, b=p2_toggle: (le.setEchoMode(QtWidgets.QLineEdit.EchoMode.Normal if checked else QtWidgets.QLineEdit.EchoMode.Password), b.setText("üôà" if checked else "üëÅÔ∏è")))
        p2_row_l.addWidget(self.p2); p2_row_l.addWidget(p2_toggle)
        form.addRow("Mot de passe", p1_row)
        form.addRow("Confirmer", p2_row)
        lay.addLayout(form)
        btns = QtWidgets.QHBoxLayout()
        ok = QtWidgets.QPushButton("‚úÖ Enregistrer"); cancel = QtWidgets.QPushButton("‚ùå Annuler")
        btns.addStretch(1); btns.addWidget(ok); btns.addWidget(cancel)
        lay.addLayout(btns)
        ok.clicked.connect(self._save)
        cancel.clicked.connect(self.reject)
    def _save(self):
        a = (self.p1.text() or "").strip()
        b = (self.p2.text() or "").strip()
        if len(a) < 4:
            QtWidgets.QMessageBox.warning(self, "Trop court", "Le mot de passe doit contenir au moins 4 caract√®res.")
            return
        if a != b:
            QtWidgets.QMessageBox.warning(self, "Non identiques", "Les mots de passe ne correspondent pas.")
            return
        st = read_state(); st["login_password_hash"] = _hash_password(a); write_state(st)
        self.accept()

class LoginDialog(GlassDialog):
    def __init__(self, parent=None):
        super().__init__("üîì Connexion", (380, 180), parent)
        lay = QtWidgets.QVBoxLayout(self)
        lay.addWidget(make_header("Connexion Ragnar", "Entrez votre mot de passe"))
        # Champ mot de passe avec afficher/masquer
        p_row = QtWidgets.QWidget(); p_row_l = QtWidgets.QHBoxLayout(p_row); p_row_l.setContentsMargins(0,0,0,0)
        self.p = QtWidgets.QLineEdit(); self.p.setEchoMode(QtWidgets.QLineEdit.EchoMode.Password)
        p_toggle = QtWidgets.QPushButton("üëÅÔ∏è"); p_toggle.setCheckable(True); p_toggle.setFixedWidth(36); p_toggle.setToolTip("Afficher/Masquer")
        p_toggle.clicked.connect(lambda checked, le=self.p, b=p_toggle: (le.setEchoMode(QtWidgets.QLineEdit.EchoMode.Normal if checked else QtWidgets.QLineEdit.EchoMode.Password), b.setText("üôà" if checked else "üëÅÔ∏è")))
        p_row_l.addWidget(self.p); p_row_l.addWidget(p_toggle)
        lay.addWidget(p_row)
        # Lien 'Mot de passe oubli√© ?'
        forgot_btn = QtWidgets.QPushButton("Mot de passe oubli√© ?")
        forgot_btn.setFlat(True)
        forgot_btn.setCursor(QtGui.QCursor(QtCore.Qt.CursorShape.PointingHandCursor))
        forgot_btn.setStyleSheet("color: #00ffaa; text-decoration: underline; background: transparent; border: none;")
        lay.addWidget(forgot_btn, 0, QtCore.Qt.AlignmentFlag.AlignLeft)
        btns = QtWidgets.QHBoxLayout(); ok = QtWidgets.QPushButton("‚ñ∂Ô∏è Entrer"); cancel = QtWidgets.QPushButton("‚ùå Quitter")
        btns.addStretch(1); btns.addWidget(ok); btns.addWidget(cancel); lay.addLayout(btns)
        ok.clicked.connect(self._login)
        cancel.clicked.connect(self.reject)
        # Flux de r√©initialisation minimal
        def _do_forgot():
            reply = QtWidgets.QMessageBox.question(
                self,
                "Mot de passe oubli√©",
                "R√©initialiser le mot de passe et en d√©finir un nouveau ?",
                QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
            )
            if reply == QtWidgets.QMessageBox.StandardButton.Yes:
                st = read_state()
                st.pop("login_password_hash", None)
                write_state(st)
                QtWidgets.QMessageBox.information(self, "R√©initialis√©", "Mot de passe supprim√©. D√©finissez-en un nouveau.")
                dlg = CreatePasswordDialog(self)
                dlg.exec()
        forgot_btn.clicked.connect(_do_forgot)
        self.ok = False
    def _login(self):
        st = read_state(); want = st.get("login_password_hash", "")
        if want and _hash_password(self.p.text().strip()) == want:
            self.ok = True; self.accept()
        else:
            QtWidgets.QMessageBox.critical(self, "Erreur", "Mot de passe incorrect.")

class DevToolDialog(GlassDialog):
    """Outil cach√© pour g√©rer les backups/versions et l'historique."""
    def __init__(self, parent=None):
        super().__init__("üõ†Ô∏è Dev Tool Mises √† Jour (Cach√©)", (880, 640), parent)
        self._backups = []
        self._saved_copies = []
        self._setup_ui()
        self._refresh_lists()

    def _setup_ui(self):
        lay = QtWidgets.QVBoxLayout(self)
        lay.setSpacing(14)
        lay.setContentsMargins(16, 16, 16, 16)
        lay.addWidget(make_header("Dev Tool Mises √† Jour", "Liste des backups et copies sauvegard√©es. Restaurez ou promouvez des versions."))

        self.tabs = QtWidgets.QTabWidget()
        # Onglet Versions
        versions_tab = QtWidgets.QWidget()
        vlay = QtWidgets.QVBoxLayout(versions_tab)
        vlay.setContentsMargins(8,8,8,8)
        self.versions_list = QtWidgets.QTreeWidget()
        self.versions_list.setHeaderLabels(["Type", "Nom", "Version", "Taille", "Chemin"]) 
        self.versions_list.setColumnWidth(0, 110)
        self.versions_list.setColumnWidth(1, 260)
        self.versions_list.setColumnWidth(2, 90)
        self.versions_list.setColumnWidth(3, 80)
        vlay.addWidget(self.versions_list)
        btns = QtWidgets.QHBoxLayout()
        self.restore_btn = QtWidgets.QPushButton("‚Ü©Ô∏è Restaurer Backup")
        self.promote_btn = QtWidgets.QPushButton("‚¨ÜÔ∏è Promouvoir Copie")
        self.refresh_btn = QtWidgets.QPushButton("üîÑ Rafra√Æchir")
        btns.addWidget(self.restore_btn)
        btns.addWidget(self.promote_btn)
        btns.addStretch(1)
        btns.addWidget(self.refresh_btn)
        vlay.addLayout(btns)
        self.tabs.addTab(versions_tab, "üì¶ Versions")

        # Onglet Historique
        hist_tab = QtWidgets.QWidget()
        hlay = QtWidgets.QVBoxLayout(hist_tab)
        hlay.setContentsMargins(8,8,8,8)
        self.history_view = QtWidgets.QTextEdit(); self.history_view.setReadOnly(True)
        self.history_view.setStyleSheet("font-family: 'Consolas','Courier New', monospace; font-size: 12px;")
        hlay.addWidget(self.history_view)
        self.tabs.addTab(hist_tab, "üßæ Historique")

        lay.addWidget(self.tabs)
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(self.close)
        lay.addWidget(close_btn, 0, QtCore.Qt.AlignmentFlag.AlignRight)

        # Actions
        self.refresh_btn.clicked.connect(self._refresh_lists)
        self.restore_btn.clicked.connect(self._on_restore_selected)
        self.promote_btn.clicked.connect(self._on_promote_selected)

    def _refresh_lists(self):
        self._backups, self._saved_copies = self._scan_backup_dir()
        self.versions_list.clear()
        for item in self._backups + self._saved_copies:
            twi = QtWidgets.QTreeWidgetItem([
                item["type"], item["name"], item.get("version", "-"),
                str(item.get("size", "")), item["path"]
            ])
            self.versions_list.addTopLevelItem(twi)
        # Historique
        try:
            st = read_state()
            hist = st.get("update_history", [])
        except Exception:
            hist = []
        lines = [f"{h.get('at','?')}: {h.get('from','?')} -> {h.get('to','?')} ({h.get('source','?')}/{h.get('method','?')})" for h in hist]
        self.history_view.setPlainText("\n".join(lines) if lines else "(aucun historique)")

    def _scan_backup_dir(self):
        backups = []
        copies = []
        try:
            for p in sorted(BACKUP_DIR.glob("*")):
                if not p.is_file():
                    continue
                name = p.name
                size = p.stat().st_size
                if ".meta.json" in name:
                    continue
                if ".backup_" in name:
                    # Backup du fichier principal
                    ver = self._extract_version_from_file(p)
                    backups.append({"type": "backup", "name": name, "path": str(p), "version": ver, "size": size})
                elif name.startswith("ragnarOS26_updated_") and name.endswith(".py"):
                    ver = self._extract_version_from_file(p)
                    copies.append({"type": "copy", "name": name, "path": str(p), "version": ver, "size": size})
        except Exception:
            pass
        return backups, copies

    def _extract_version_from_file(self, path: Path) -> str:
        try:
            code = Path(path).read_text(encoding="utf-8")
            return extract_version_from_code(code)
        except Exception:
            return "?"

    def _selected_item(self):
        it = self.versions_list.currentItem()
        if not it:
            return None
        return {
            "type": it.text(0),
            "name": it.text(1),
            "version": it.text(2),
            "path": it.text(4)
        }

    def _on_restore_selected(self):
        it = self._selected_item()
        if not it or it["type"] != "backup":
            QtWidgets.QMessageBox.information(self, "Restaurer", "S√©lectionnez un backup √† restaurer.")
            return
        target = Path(__file__).resolve()
        backup_path = Path(it["path"]) 
        if not backup_path.exists():
            QtWidgets.QMessageBox.warning(self, "Backup", "Fichier de backup introuvable.")
            return
        ok = restore_backup(backup_path, target)
        if ok:
            self._append_history_entry(method="rollback", new_version=self._extract_version_from_file(target))
            QtWidgets.QMessageBox.information(self, "Restaur√©", "Backup restaur√©. L'application va red√©marrer.")
            self._restart_prompt()
        else:
            QtWidgets.QMessageBox.critical(self, "Erreur", "√âchec de la restauration.")

    def _on_promote_selected(self):
        it = self._selected_item()
        if not it or it["type"] != "copy":
            QtWidgets.QMessageBox.information(self, "Promouvoir", "S√©lectionnez une copie mise √† jour.")
            return
        src = Path(it["path"]).resolve()
        if not src.exists():
            QtWidgets.QMessageBox.warning(self, "Copie", "Fichier de copie introuvable.")
            return
        target = Path(__file__).resolve()
        # Cr√©er un backup avant promotion
        create_backup(target)
        try:
            code = src.read_text(encoding="utf-8")
            target.write_text(code, encoding="utf-8")
            self._append_history_entry(method="promote", new_version=self._extract_version_from_file(src))
            QtWidgets.QMessageBox.information(self, "Promu", "Copie promue en version active. Red√©marrage requis.")
            self._restart_prompt()
        except Exception as e:
            QtWidgets.QMessageBox.critical(self, "Erreur", f"Promotion √©chou√©e: {e}")

    def _append_history_entry(self, method: str, new_version: str):
        try:
            st = read_state()
            prev = st.get("version", DEFAULT_LOCAL_VERSION)
            now = time.strftime("%Y-%m-%d %H:%M:%S")
            hist = list(st.get("update_history", []))
            hist.append({"from": prev, "to": new_version, "at": now, "source": "devtool", "method": method})
            st["version"] = new_version
            st["updated_at"] = now
            st["update_history"] = hist[-200:]
            write_state(st)
        except Exception:
            pass

    def _restart_prompt(self):
        reply = QtWidgets.QMessageBox.question(self, "Red√©marrer", "Red√©marrer Ragnar OS maintenant ?",
                                               QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No)
        if reply == QtWidgets.QMessageBox.StandardButton.Yes:
            try:
                QtWidgets.QApplication.quit()
                os.execv(sys.executable, [sys.executable] + sys.argv)
            except Exception:
                pass

# ====== Main ======

class MainWindow(QtWidgets.QStackedWidget):

    def __init__(self):

        super().__init__()

        self.setWindowTitle(APP_NAME)

        self.resize(960, 600)

        self.setStyleSheet(RAGNAR_MODERN_STYLE)

        self.boot = BootPage()

        self.desktop = DesktopPage()

        self.addWidget(self.boot)

        self.addWidget(self.desktop)

        self.boot.finished.connect(self.on_boot_finished)

        QtCore.QTimer.singleShot(50, lambda: self.setCurrentWidget(self.boot))

    

    def on_boot_finished(self):

        """Appel√© quand le boot est termin√©"""

        # Auth au d√©marrage
        try:
            st = read_state()
            if not st.get("login_password_hash"):
                # Pas encore de mot de passe ‚Üí forcer cr√©ation
                dlg = CreatePasswordDialog(self)
                if dlg.exec() != QtWidgets.QDialog.DialogCode.Accepted:
                    QtWidgets.QApplication.quit(); return
            else:
                login = LoginDialog(self)
                if login.exec() != QtWidgets.QDialog.DialogCode.Accepted or not login.ok:
                    QtWidgets.QApplication.quit(); return
        except Exception as e:
            QtWidgets.QMessageBox.warning(self, "Connexion", f"Ignor√©e suite √† une erreur:\n{e}")

        self.setCurrentWidget(self.desktop)

        # Afficher le message de bienvenue apr√®s 1 seconde
        QtCore.QTimer.singleShot(1000, self.show_welcome_message)

        # V√©rification automatique des mises √† jour apr√®s 8 secondes (apr√®s le message)
        QtCore.QTimer.singleShot(8000, self.check_auto_update)

    def show_welcome_message(self):
        """Affiche le message de bienvenue avec les nouveaut√©s (une seule fois)"""
        try:
            state = read_state()
            # V√©rifier si c'est la premi√®re fois ou si la version a chang√©
            last_welcome_version = state.get("last_welcome_version", "")
            
            if last_welcome_version != DEFAULT_LOCAL_VERSION:
                # Afficher le message de bienvenue
                welcome_dialog = WelcomeDialog(self)
                welcome_dialog.exec()
                
                # Marquer que le message a √©t√© affich√© pour cette version
                state["last_welcome_version"] = DEFAULT_LOCAL_VERSION
                write_state(state)
        except Exception as e:
            print(f"Erreur lors de l'affichage du message de bienvenue: {e}")
            # En cas d'erreur, afficher quand m√™me le message
            welcome_dialog = WelcomeDialog(self)
            welcome_dialog.exec()

    def check_auto_update(self):
        """V√©rification automatique des mises √† jour"""
        try:
            update_info = check_for_updates(UPDATE_PASTEBIN_ID)

            if update_info.get("available"):
                # V√©rifier que ce n'est pas la m√™me version ou une version plus ancienne
                current_version = update_info.get("current", DEFAULT_LOCAL_VERSION)
                remote_version = update_info.get("remote", "")
                
                # Ne proposer que si la version distante est vraiment plus r√©cente
                if remote_version and remote_version != current_version:
                    try:
                        current_parts = [int(x) for x in current_version.split('.')]
                        remote_parts = [int(x) for x in remote_version.split('.')]
                        
                        # Normaliser les longueurs
                        max_len = max(len(current_parts), len(remote_parts))
                        current_parts.extend([0] * (max_len - len(current_parts)))
                        remote_parts.extend([0] * (max_len - len(remote_parts)))
                        
                        # V√©rifier si la version distante est vraiment plus r√©cente
                        is_newer = False
                        for c, r in zip(current_parts, remote_parts):
                            if r > c:
                                is_newer = True
                                break
                            elif r < c:
                                break
                        
                        if is_newer:
                            # Notification discr√®te de mise √† jour disponible
                            self.show_update_notification(update_info)
                    except ValueError:
                        # En cas d'erreur de parsing, ne pas proposer de mise √† jour
                        pass

        except Exception:
            # Ignore silencieusement les erreurs de v√©rification automatique
            pass

    

    def show_update_notification(self, update_info):

        """Affiche une notification de mise √† jour disponible"""

        reply = QtWidgets.QMessageBox.question(

            self, "Mise √† jour disponible",

            f"Une nouvelle version ({update_info['remote']}) est disponible !\n"

            f"Version actuelle: {update_info['current']}\n\n"

            "Voulez-vous ouvrir le gestionnaire de mises √† jour ?",

            QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No

        )

        

        if reply == QtWidgets.QMessageBox.StandardButton.Yes:

            self.desktop.show_updater()



def main():

    try:

        auto_repair_start()

    except Exception:

        pass

    app = QtWidgets.QApplication(sys.argv)

    app.setApplicationName(APP_NAME)

    app.setStyle("Fusion")

    win = MainWindow()
    
    # Agrandir la fen√™tre principale pour √©viter les probl√®mes de bordure
    win.setGeometry(50, 50, 1400, 900)
    win.setMinimumSize(1200, 800)

    win.show()
    # Afficher un message de bienvenue une seule fois
    try:
        show_one_time_welcome(win)
    except Exception:
        pass
    # Activer la sandbox si configur√©e
    try:
        apply_sandbox_hooks()
    except Exception:
        pass

    sys.exit(app.exec())


if __name__ == "__main__":
    # CLI minimal: installer d√©pendances, lancer app, sandbox on/off
    import argparse
    parser = argparse.ArgumentParser(prog="ragnarOS", description="Ragnar OS 26 - CLI")
    sub = parser.add_subparsers(dest="cmd")

    sub.add_parser("run", help="Lancer l'interface graphique")

    p_install = sub.add_parser("install-deps", help="Installer d√©pendances Python requises")
    p_install.add_argument("--with-webengine", action="store_true", help="Installer PyQt6-WebEngine")

    p_sbox = sub.add_parser("sandbox", help="Activer/D√©sactiver la sandbox")
    p_sbox.add_argument("state", choices=["on", "off"], help="Etat sandbox disque/r√©seau")
    p_sbox.add_argument("--mem", choices=["on", "off"], default=None, help="Sandbox m√©moire (mem:/)")

    p_rapp = sub.add_parser("run-rapp", help="Lancer un fichier .rapp (depuis un chemin ou le Bureau)")
    p_rapp.add_argument("path", nargs="?", help="Chemin complet ou nom de fichier .rapp")
    p_rapp.add_argument("--desktop", action="store_true", help="Forcer la recherche sur le Bureau")

    args = parser.parse_args()

    if not args.cmd or args.cmd == "run":
        main()
    elif args.cmd == "install-deps":
        to_install = ["PyQt6", "requests"]
        if args.with_webengine:
            to_install.append("PyQt6-WebEngine")
        try:
            py = sys.executable
            for pkg in to_install:
                subprocess.check_call([py, "-m", "pip", "install", pkg])
            print("‚úÖ D√©pendances install√©es:", ", ".join(to_install))
        except Exception as e:
            print("‚ùå Erreur installation:", e)
            sys.exit(1)
    elif args.cmd == "sandbox":
        st = _read_state_safe()
        st["sandbox_enabled"] = (args.state == "on")
        if args.mem is not None:
            st["sandbox_memory_enabled"] = (args.mem == "on")
        _write_state_safe(st)
        print(f"üîí sandbox_enabled={st['sandbox_enabled']} | sandbox_memory_enabled={st.get('sandbox_memory_enabled')}")
    elif args.cmd == "run-rapp":
        # R√©solution du Bureau (Desktop/Bureau) multiplateforme
        home = Path.home()
        desktop_candidates = [home / "Desktop", home / "Bureau"]
        desktop_dir = None
        for cand in desktop_candidates:
            if cand.exists():
                desktop_dir = cand
                break

        user_input = args.path.strip() if args.path else ""

        target_path: Optional[Path] = None
        if user_input:
            p = Path(user_input)
            if not p.suffix:
                p = p.with_suffix(".rapp")
            if p.is_absolute() and p.exists():
                target_path = p
            else:
                # Si --desktop est pass√© ou le chemin fourni n'existe pas, tenter sur le Bureau
                if (args.desktop or not p.exists()) and desktop_dir is not None:
                    candidate = desktop_dir / p.name
                    if candidate.exists():
                        target_path = candidate
                # Dernier essai: relatif au CWD
                if target_path is None and Path(p).exists():
                    target_path = Path(p)
        else:
            # Aucun nom fourni: si --desktop, choisir le premier .rapp sur le Bureau
            if args.desktop and desktop_dir is not None:
                rapps = sorted(desktop_dir.glob("*.rapp"))
                if rapps:
                    target_path = rapps[0]

        if target_path is None:
            print("‚ùå Aucun fichier .rapp trouv√©. Fournissez un chemin/nom, ou utilisez --desktop.")
            if desktop_dir is not None:
                try:
                    found = [p.name for p in desktop_dir.glob("*.rapp")]
                    if found:
                        print("‚ÑπÔ∏è Fichiers .rapp d√©tect√©s sur le Bureau:")
                        for name in found:
                            print(f" - {name}")
                except Exception:
                    pass
            sys.exit(1)

        if target_path.suffix.lower() != ".rapp":
            print(f"‚ö†Ô∏è Le fichier n'a pas l'extension .rapp: {target_path.name}")

        # Lancement simple sans UI Qt (√©vite les QMessageBox en CLI)
        try:
            if sys.platform.startswith("win"):
                os.startfile(str(target_path))
            elif sys.platform.startswith("linux"):
                subprocess.Popen(["xdg-open", str(target_path)])
            elif sys.platform == "darwin":
                subprocess.Popen(["open", str(target_path)])
            else:
                # Fallback via URL handler de Qt si dispo
                try:
                    QDesktopServices.openUrl(QUrl.fromLocalFile(str(target_path)))
                except Exception:
                    raise RuntimeError("Ouverture non support√©e sur cette plateforme")
            print(f"‚ñ∂Ô∏è Lancement de {target_path}")
        except Exception as e:
            print(f"‚ùå Impossible de lancer {target_path}: {e}")
            sys.exit(1)
    else:
        parser.print_help()



# -----------------------------

# AJOUTS (NE MODIFIENT PAS L'EXISTANT ‚Äî AJOUTS UNIQUEMENT)

# - Append-only updater

# - Copy-as-updated saver

# - Enhanced UI (appliquer en append / cr√©er copie mise √† jour)

# -----------------------------



def _safe_timestamp() -> str:

    return time.strftime("%Y%m%d_%H%M%S")



def _current_file_path() -> Path:

    try:

        return Path(__file__).resolve()

    except Exception:

        # Fallback: assume running as script in cwd

        return Path(os.path.join(os.getcwd(), "ragnarOS26.py")).resolve()



def _write_file_atomic(path: Path, content: str) -> None:

    tmp = path.with_suffix(path.suffix + ".tmp")

    tmp.write_text(content, encoding="utf-8")

    tmp.replace(path)



def append_only_if_possible(remote_code: str) -> Dict[str, Any]:

    """

    Si remote_code commence exactement par le contenu actuel du fichier,

    on append la queue (remote[len(current):]) au fichier actuel.

    Retourne un dict d√©crivant l'action: {'action':'append', 'appended_bytes': N, 'backup': path}

    Si impossible, retourne {'action': 'cannot_append', 'reason': str}

    """

    current_path = _current_file_path()

    if not current_path.exists():

        return {"action": "error", "reason": "Fichier principal introuvable"}



    current_code = current_path.read_text(encoding="utf-8")

    # Comparaison stricte : remote doit commencer par current

    if remote_code.startswith(current_code):

        tail = remote_code[len(current_code):]

        if not tail.strip():

            return {"action": "noop", "reason": "Remote identique au local (rien √† append)"}

        # Backup current file

        backup = create_backup(current_path)

        # Append tail safely

        with open(current_path, "a", encoding="utf-8") as f:

            f.write("\n\n# ---- AUTO-APPENDED BLOCK START ----\n")

            f.write(tail)

            f.write("\n# ---- AUTO-APPENDED BLOCK END ----\n")

        # Update state version if found in remote

        try:

            new_ver = extract_version_from_code(remote_code)

            st = read_state()

            st["version"] = new_ver

            st["last_auto_append"] = time.strftime("%Y-%m-%d %H:%M:%S")

            write_state(st)

        except Exception:

            pass

        return {"action": "append", "appended_chars": len(tail), "backup": str(backup) if backup else None}

    else:

        return {"action": "cannot_append", "reason": "Remote does not start with current file (append unsafe)"}



def save_full_copy_as_updated(remote_code: str) -> Dict[str, Any]:

    """

    Sauvegarde le remote_code dans backups/ comme copie mise √† jour,

    sans toucher au fichier principal. Retourne {'action':'saved_copy', 'path':...}

    """

    ts = _safe_timestamp()

    name = f"ragnarOS26_updated_{ts}.py"

    dest = BACKUP_DIR / name

    dest.write_text(remote_code, encoding="utf-8")

    # Also save a small metadata file

    meta = {

        "saved_at": time.strftime("%Y-%m-%d %H:%M:%S"),

        "source": "pastebin",

        "paste_id": UPDATE_PASTEBIN_ID,

        "path": str(dest)

    }

    (BACKUP_DIR / (name + ".meta.json")).write_text(json.dumps(meta, ensure_ascii=False, indent=2), encoding="utf-8")

    return {"action": "saved_copy", "path": str(dest), "meta": meta}



class EnhancedUpdaterDialog(UpdaterDialog):

    """

    Version √©tendue du gestionnaire de mise √† jour :

    - propose 'Appliquer en append-only' si possible

    - propose 'Cr√©er copie mise √† jour' sinon (ou en compl√©ment)

    """

    def setup_ui(self):

        # reuse original UI

        super().setup_ui()

        # add extra buttons

        self.append_btn = QtWidgets.QPushButton("üß© Appliquer en append-only (ajoute √† la fin)")

        self.copy_btn = QtWidgets.QPushButton("üìÇ Cr√©er copie mise √† jour (ne modifie pas le principal)")

        # Insert below existing buttons

        parent_layout = self.layout()

        insert_idx = parent_layout.count()

        # place buttons before close (they'll appear under progress)

        parent_layout.addWidget(self.append_btn)

        parent_layout.addWidget(self.copy_btn)

        # connect

        self.append_btn.clicked.connect(self.start_append)

        self.copy_btn.clicked.connect(self.create_copy)



    def start_append(self):

        if not hasattr(self, 'update_info'):

            QtWidgets.QMessageBox.warning(self, "Erreur", "Aucune info de mise √† jour disponible.")

            return

        code = self.update_info.get("code")

        if not code:

            QtWidgets.QMessageBox.warning(self, "Erreur", "Code de mise √† jour manquant.")

            return

        # Try append-only

        try:

            self.append_btn.setEnabled(False)

            res = append_only_if_possible(code)

            if res.get("action") == "append":

                QtWidgets.QMessageBox.information(self, "Append appliqu√©",

                                                  f"Append appliqu√© avec succ√®s ({res.get('appended_chars')} caract√®res).\nBackup: {res.get('backup')}")

                # Update UI state display

                self.details_text.append("\nAppend appliqu√©: " + time.strftime("%Y-%m-%d %H:%M:%S"))

            elif res.get("action") == "noop":

                QtWidgets.QMessageBox.information(self, "Rien √† faire", "Le remote est identique au local.")

            else:

                QtWidgets.QMessageBox.warning(self, "Impossible d'appliquer (append)",

                                              f"Raison: {res.get('reason')}\nUne copie mise √† jour sera cr√©√©e √† la place.")

                # fallback to save copy

                cop = save_full_copy_as_updated(code)

                QtWidgets.QMessageBox.information(self, "Copie cr√©√©e",

                                                  f"Copie sauvegard√©e: {cop.get('path')}")

                self.details_text.append(f"Copie cr√©√©e: {cop.get('path')}")

        except Exception as e:

            QtWidgets.QMessageBox.critical(self, "Erreur append", f"Erreur lors de l'append: {e}")

        finally:

            self.append_btn.setEnabled(True)



    def create_copy(self):

        if not hasattr(self, 'update_info'):

            QtWidgets.QMessageBox.warning(self, "Erreur", "Aucune info de mise √† jour disponible.")

            return

        code = self.update_info.get("code")

        if not code:

            QtWidgets.QMessageBox.warning(self, "Erreur", "Code de mise √† jour manquant.")

            return

        try:

            self.copy_btn.setEnabled(False)

            cop = save_full_copy_as_updated(code)

            QtWidgets.QMessageBox.information(self, "Copie cr√©√©e",

                                              f"Copie sauvegard√©e: {cop.get('path')}\nTu peux la promouvoir manuellement si tu veux.")

            self.details_text.append(f"Copie cr√©√©e: {cop.get('path')}")

        except Exception as e:

            QtWidgets.QMessageBox.critical(self, "Erreur copy", f"Erreur lors de la sauvegarde: {e}")

        finally:

            self.copy_btn.setEnabled(True)



class DevToolDialog(GlassDialog):
    """Outil cach√© pour g√©rer les backups/versions et l'historique."""
    def __init__(self, parent=None):
        super().__init__("üõ†Ô∏è Dev Tool Mises √† Jour (Cach√©)", (880, 640), parent)
        self._backups = []
        self._saved_copies = []
        self._setup_ui()
        self._refresh_lists()

    def _setup_ui(self):
        lay = QtWidgets.QVBoxLayout(self)
        lay.setSpacing(14)
        lay.setContentsMargins(16, 16, 16, 16)
        lay.addWidget(make_header("Dev Tool Mises √† Jour", "Liste des backups et copies sauvegard√©es. Restaurez ou promouvez des versions."))

        self.tabs = QtWidgets.QTabWidget()
        # Onglet Versions
        versions_tab = QtWidgets.QWidget()
        vlay = QtWidgets.QVBoxLayout(versions_tab)
        vlay.setContentsMargins(8,8,8,8)
        self.versions_list = QtWidgets.QTreeWidget()
        self.versions_list.setHeaderLabels(["Type", "Nom", "Version", "Taille", "Chemin"]) 
        self.versions_list.setColumnWidth(0, 110)
        self.versions_list.setColumnWidth(1, 260)
        self.versions_list.setColumnWidth(2, 90)
        self.versions_list.setColumnWidth(3, 80)
        vlay.addWidget(self.versions_list)
        btns = QtWidgets.QHBoxLayout()
        self.restore_btn = QtWidgets.QPushButton("‚Ü©Ô∏è Restaurer Backup")
        self.promote_btn = QtWidgets.QPushButton("‚¨ÜÔ∏è Promouvoir Copie")
        self.refresh_btn = QtWidgets.QPushButton("üîÑ Rafra√Æchir")
        btns.addWidget(self.restore_btn)
        btns.addWidget(self.promote_btn)
        btns.addStretch(1)
        btns.addWidget(self.refresh_btn)
        vlay.addLayout(btns)
        self.tabs.addTab(versions_tab, "üì¶ Versions")

        # Onglet Historique
        hist_tab = QtWidgets.QWidget()
        hlay = QtWidgets.QVBoxLayout(hist_tab)
        hlay.setContentsMargins(8,8,8,8)
        self.history_view = QtWidgets.QTextEdit(); self.history_view.setReadOnly(True)
        self.history_view.setStyleSheet("font-family: 'Consolas','Courier New', monospace; font-size: 12px;")
        hlay.addWidget(self.history_view)
        self.tabs.addTab(hist_tab, "üßæ Historique")

        lay.addWidget(self.tabs)
        close_btn = QtWidgets.QPushButton("‚ùå Fermer")
        close_btn.clicked.connect(self.close)
        lay.addWidget(close_btn, 0, QtCore.Qt.AlignmentFlag.AlignRight)

        # Actions
        self.refresh_btn.clicked.connect(self._refresh_lists)
        self.restore_btn.clicked.connect(self._on_restore_selected)
        self.promote_btn.clicked.connect(self._on_promote_selected)

    def _refresh_lists(self):
        self._backups, self._saved_copies = self._scan_backup_dir()
        self.versions_list.clear()
        for item in self._backups + self._saved_copies:
            twi = QtWidgets.QTreeWidgetItem([
                item["type"], item["name"], item.get("version", "-"),
                str(item.get("size", "")), item["path"]
            ])
            self.versions_list.addTopLevelItem(twi)
        # Historique
        try:
            st = read_state()
            hist = st.get("update_history", [])
        except Exception:
            hist = []
        lines = [f"{h.get('at','?')}: {h.get('from','?')} -> {h.get('to','?')} ({h.get('source','?')}/{h.get('method','?')})" for h in hist]
        self.history_view.setPlainText("\n".join(lines) if lines else "(aucun historique)")

    def _scan_backup_dir(self):
        backups = []
        copies = []
        try:
            for p in sorted(BACKUP_DIR.glob("*")):
                if not p.is_file():
                    continue
                name = p.name
                size = p.stat().st_size
                if ".meta.json" in name:
                    continue
                if ".backup_" in name:
                    # Backup du fichier principal
                    ver = self._extract_version_from_file(p)
                    backups.append({"type": "backup", "name": name, "path": str(p), "version": ver, "size": size})
                elif name.startswith("ragnarOS26_updated_") and name.endswith(".py"):
                    ver = self._extract_version_from_file(p)
                    copies.append({"type": "copy", "name": name, "path": str(p), "version": ver, "size": size})
        except Exception:
            pass
        return backups, copies

    def _extract_version_from_file(self, path: Path) -> str:
        try:
            code = Path(path).read_text(encoding="utf-8")
            return extract_version_from_code(code)
        except Exception:
            return "?"

    def _selected_item(self):
        it = self.versions_list.currentItem()
        if not it:
            return None
        return {
            "type": it.text(0),
            "name": it.text(1),
            "version": it.text(2),
            "path": it.text(4)
        }

    def _on_restore_selected(self):
        it = self._selected_item()
        if not it or it["type"] != "backup":
            QtWidgets.QMessageBox.information(self, "Restaurer", "S√©lectionnez un backup √† restaurer.")
            return
        target = Path(__file__).resolve()
        backup_path = Path(it["path"]) 
        if not backup_path.exists():
            QtWidgets.QMessageBox.warning(self, "Backup", "Fichier de backup introuvable.")
            return
        ok = restore_backup(backup_path, target)
        if ok:
            self._append_history_entry(method="rollback", new_version=self._extract_version_from_file(target))
            QtWidgets.QMessageBox.information(self, "Restaur√©", "Backup restaur√©. L'application va red√©marrer.")
            self._restart_prompt()
        else:
            QtWidgets.QMessageBox.critical(self, "Erreur", "√âchec de la restauration.")

    def _on_promote_selected(self):
        it = self._selected_item()
        if not it or it["type"] != "copy":
            QtWidgets.QMessageBox.information(self, "Promouvoir", "S√©lectionnez une copie mise √† jour.")
            return
        src = Path(it["path"]).resolve()
        if not src.exists():
            QtWidgets.QMessageBox.warning(self, "Copie", "Fichier de copie introuvable.")
            return
        target = Path(__file__).resolve()
        # Cr√©er un backup avant promotion
        create_backup(target)
        try:
            code = src.read_text(encoding="utf-8")
            target.write_text(code, encoding="utf-8")
            self._append_history_entry(method="promote", new_version=self._extract_version_from_file(src))
            QtWidgets.QMessageBox.information(self, "Promu", "Copie promue en version active. Red√©marrage requis.")
            self._restart_prompt()
        except Exception as e:
            QtWidgets.QMessageBox.critical(self, "Erreur", f"Promotion √©chou√©e: {e}")

    def _append_history_entry(self, method: str, new_version: str):
        try:
            st = read_state()
            prev = st.get("version", DEFAULT_LOCAL_VERSION)
            now = time.strftime("%Y-%m-%d %H:%M:%S")
            hist = list(st.get("update_history", []))
            hist.append({"from": prev, "to": new_version, "at": now, "source": "devtool", "method": method})
            st["version"] = new_version
            st["updated_at"] = now
            st["update_history"] = hist[-200:]
            write_state(st)
        except Exception:
            pass

    def _restart_prompt(self):
        reply = QtWidgets.QMessageBox.question(self, "Red√©marrer", "Red√©marrer Ragnar OS maintenant ?",
                                               QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No)
        if reply == QtWidgets.QMessageBox.StandardButton.Yes:
            try:
                QtWidgets.QApplication.quit()
                os.execv(sys.executable, [sys.executable] + sys.argv)
            except Exception:
                pass

# Monkey-patch DesktopPage.show_updater to open EnhancedUpdaterDialog instead of original UpdaterDialog

def _desktop_show_updater_enhanced(self):

    """Remplace l'updater standard par la version am√©lior√©e (append-only / save-copy)"""

    updater_dialog = EnhancedUpdaterDialog(self)

    updater_dialog.exec()



# apply monkey patch (this replaces the original method with the enhanced one)

DesktopPage.show_updater = _desktop_show_updater_enhanced



# Petit message informatif dans le state pour signaler la pr√©sence de la nouvelle option

try:

    st = read_state()

    st.setdefault("features", {})

    st["features"]["append_update"] = True

    write_state(st)

except Exception:

    pass



# Fin des ajouts
# -----------------------------

# === Fonctions multim√©dia manquantes ===
def show_photo_gallery_func():
    """Galerie photos moderne"""
    d = GlassDialog(" Galerie Photos Ragnar", (1200, 800), None)
    lay = QtWidgets.QVBoxLayout(d)
    lay.setSpacing(15)
    lay.setContentsMargins(20, 20, 20, 20)
    
    # Header
    header = make_header("Galerie Photos", "Organisez et visualisez vos photos")
    lay.addWidget(header)
    
    # Grille de photos simul√©es
    photos_card = QtWidgets.QWidget(objectName="GlassCard")
    photos_layout = QtWidgets.QVBoxLayout(photos_card)
    photos_layout.setContentsMargins(16, 16, 16, 16)
    
    photos_grid = QtWidgets.QGridLayout()
    
    # Photos simul√©es
    for i in range(6):
        photo_widget = QtWidgets.QLabel(f" \nPhoto {i+1}")
        photo_widget.setStyleSheet("""
            QLabel {
                background: qlineargradient(x1:0, y1:0, x2:1, y2:1,
                    stop:0 rgba(100, 100, 100, 0.3),
                    stop:1 rgba(150, 150, 150, 0.3));
                border: 2px solid rgba(0, 255, 136, 0.3);
                border-radius: 10px;
                color: white;
                font-size: 14px;
                font-weight: bold;
            }
        """)
        photo_widget.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        photo_widget.setFixedSize(120, 120)
        photos_grid.addWidget(photo_widget, i // 3, i % 3)
    
    photos_layout.addLayout(photos_grid)
    lay.addWidget(photos_card)
    
    # Actions
    actions_layout = QtWidgets.QHBoxLayout()
    import_btn = QtWidgets.QPushButton(" Importer")
    slideshow_btn = QtWidgets.QPushButton("Diaporama")
    edit_btn = QtWidgets.QPushButton(" √âditer")
    close_btn = QtWidgets.QPushButton("Fermer")
    
    import_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, " ", "Formats support√©s :\n‚Ä¢ JPG, PNG, GIF\n‚Ä¢ RAW, TIFF, BMP"))
    close_btn.clicked.connect(d.close)
    
    actions_layout.addWidget(import_btn)
    actions_layout.addWidget(slideshow_btn)
    actions_layout.addWidget(edit_btn)
    actions_layout.addStretch()
    actions_layout.addWidget(close_btn)
    
    lay.addLayout(actions_layout)
    
    d.show()
    fade_in(d, 600)

# Ajouter les m√©thodes manquantes √† la classe DesktopPage
DesktopPage.show_photo_gallery = lambda self: show_photo_gallery_func()
DesktopPage.show_voice_recorder = lambda self: QtWidgets.QMessageBox.information(self, " Enregistreur", "Enregistreur vocal Ragnar !\n\nFonctionnalit√©s :\n‚Ä¢ Haute qualit√©\n‚Ä¢ Effets\n‚Ä¢ Formats multiples")
DesktopPage.show_image_editor = lambda self: QtWidgets.QMessageBox.information(self, " √âditeur Images", "√âditeur d'images Ragnar !\n\nFonctionnalit√©s :\n‚Ä¢ Retouche photo\n‚Ä¢ Filtres\n‚Ä¢ Calques\n‚Ä¢ Outils de dessin")
DesktopPage.show_video_editor = lambda self: QtWidgets.QMessageBox.information(self, " √âditeur Vid√©o", "√âditeur vid√©o Ragnar !\n\nFonctionnalit√©s :\n‚Ä¢ Montage timeline\n‚Ä¢ Effets sp√©ciaux\n‚Ä¢ Transitions\n‚Ä¢ Export 4K")
DesktopPage.show_streaming = lambda self: QtWidgets.QMessageBox.information(self, " Streaming", "Streaming Ragnar !\n\nServices :\n‚Ä¢ Netflix\n‚Ä¢ YouTube\n‚Ä¢ Twitch\n‚Ä¢ Ragnar TV")
DesktopPage.show_karaoke = lambda self: QtWidgets.QMessageBox.information(self, " Karaok√©", "Karaok√© Ragnar !\n\nFonctionnalit√©s :\n‚Ä¢ Milliers de chansons\n‚Ä¢ Paroles synchronis√©es\n‚Ä¢ Enregistrement\n‚Ä¢ Partage")

# === APPLICATIONS SYST√àME AVANC√âES ===
def show_system_monitor_func():
    """Moniteur syst√®me avanc√©"""
    d = GlassDialog("üìä Moniteur Syst√®me Ragnar", (1200, 900), None)
    lay = QtWidgets.QVBoxLayout(d)
    lay.setSpacing(15)
    lay.setContentsMargins(20, 20, 20, 20)
    
    # Header
    header = make_header("Moniteur Syst√®me", "Surveillance en temps r√©el")
    lay.addWidget(header)
    
    # M√©triques syst√®me en grille
    metrics_grid = QtWidgets.QGridLayout()
    
    system_metrics = [
        ("üíª", "CPU", "Intel i7-12700K", "45%", "#00ff88"),
        ("üß†", "RAM", "16 GB DDR4", "68%", "#ffaa00"),
        ("üíæ", "Disque", "SSD 1TB", "23%", "#00aaff"),
        ("üå°Ô∏è", "Temp", "CPU 65¬∞C", "Normal", "#00ff88"),
        ("üîå", "GPU", "RTX 4070", "12%", "#00ff88"),
        ("üåê", "R√©seau", "1 Gbps", "‚Üë15MB ‚Üì45MB", "#00aaff")
    ]
    
    for i, (icon, name, desc, value, color) in enumerate(system_metrics):
        metric_card = QtWidgets.QWidget(objectName="GlassCard")
        metric_layout = QtWidgets.QVBoxLayout(metric_card)
        metric_layout.setContentsMargins(12, 12, 12, 12)
        
        icon_label = QtWidgets.QLabel(icon)
        icon_label.setStyleSheet("font-size: 24px;")
        icon_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        
        name_label = QtWidgets.QLabel(name)
        name_label.setStyleSheet("color: white; font-weight: bold; font-size: 12px;")
        name_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        
        desc_label = QtWidgets.QLabel(desc)
        desc_label.setStyleSheet("color: #cccccc; font-size: 10px;")
        desc_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        
        value_label = QtWidgets.QLabel(value)
        value_label.setStyleSheet(f"color: {color}; font-weight: bold; font-size: 14px;")
        value_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        
        metric_layout.addWidget(icon_label)
        metric_layout.addWidget(name_label)
        metric_layout.addWidget(desc_label)
        metric_layout.addWidget(value_label)
        
        metrics_grid.addWidget(metric_card, i // 3, i % 3)
    
    lay.addLayout(metrics_grid)
    
    # Actions
    actions_layout = QtWidgets.QHBoxLayout()
    
    refresh_btn = QtWidgets.QPushButton("üîÑ Actualiser")
    processes_btn = QtWidgets.QPushButton("‚öôÔ∏è Processus")
    alerts_btn = QtWidgets.QPushButton("üö® Alertes")
    close_btn = QtWidgets.QPushButton("‚ùå Fermer")
    
    refresh_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üîÑ", "Donn√©es actualis√©es !\n\nüìä M√©triques mises √† jour\n‚è±Ô∏è Temps r√©el activ√©\nüîç Surveillance continue"))
    processes_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "‚öôÔ∏è", "Processus syst√®me !\n\n‚öôÔ∏è Processus actifs : 127\nüíª CPU le plus utilis√© : chrome.exe (8.7%)\nüß† RAM le plus utilis√© : ragnarOSupt.exe (245 MB)\nüîß Gestion des processus disponible"))
    close_btn.clicked.connect(d.close)
    
    actions_layout.addWidget(refresh_btn)
    actions_layout.addWidget(processes_btn)
    actions_layout.addWidget(alerts_btn)
    actions_layout.addStretch()
    actions_layout.addWidget(close_btn)
    
    lay.addLayout(actions_layout)
    
    d.show()
    fade_in(d, 600)

def show_terminal_func():
    """Terminal Ragnar avanc√©"""
    d = GlassDialog("üíª Terminal Ragnar", (1200, 800), None)
    lay = QtWidgets.QVBoxLayout(d)
    lay.setSpacing(10)
    lay.setContentsMargins(20, 20, 20, 20)
    
    # Header
    header = make_header("Terminal Ragnar", "Interface en ligne de commande")
    lay.addWidget(header)
    
    # Zone du terminal
    terminal_area = QtWidgets.QWidget(objectName="GlassCard")
    terminal_layout = QtWidgets.QVBoxLayout(terminal_area)
    terminal_layout.setContentsMargins(16, 16, 16, 16)
    
    # √âcran du terminal
    terminal_display = QtWidgets.QTextEdit()
    terminal_display.setStyleSheet("""
        QTextEdit {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            color: #00ff88;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 16px;
            padding: 15px;
            min-height: 500px;
        }
    """)
    
    terminal_content = """Ragnar OS Terminal v26.3.0
Copyright (c) 2024 Ragnar Systems. Tous droits r√©serv√©s.

C:\\Users\\ragnar> dir
 Le volume dans le lecteur C s'appelle RagnarOS
 Le num√©ro de s√©rie du volume est 1234-ABCD

 R√©pertoire de C:\\Users\\ragnar

04/10/2024  22:37    <DIR>          .
04/10/2024  22:37    <DIR>          ..
04/10/2024  15:30    <DIR>          Bureau
04/10/2024  16:45    <DIR>          Documents
04/10/2024  18:20    <DIR>          T√©l√©chargements
04/10/2024  12:15    <DIR>          Images
04/10/2024  14:30    <DIR>          Musique
04/10/2024  19:45    <DIR>          Vid√©os
               0 fichier(s)                0 octets
               8 R√©p(s)  756 234 567 890 octets libres

C:\\Users\\ragnar> ragnar --version
Ragnar OS version 26.3.0
Build: 20241004-2237
Architecture: x64
Kernel: RagnarKernel 5.2.1

C:\\Users\\ragnar> systeminfo
Nom de l'h√¥te:                    RAGNAR-PC
Nom du syst√®me d'exploitation:    Ragnar OS 26.3.0
Version du syst√®me:               26.3.0.2237
Fabricant du syst√®me:             Ragnar Systems
Mod√®le du syst√®me:                RagnarBook Pro
Type de syst√®me:                  PC bas√© sur x64
Processeur(s):                    1 processeur(s) install√©(s).
                                 [01]: Intel64 Family 6 Model 151 Stepping 2 GenuineIntel ~3600 Mhz
M√©moire physique totale:          16 384 MB
M√©moire physique disponible:      5 234 MB

C:\\Users\\ragnar> _"""
    
    terminal_display.setPlainText(terminal_content)
    terminal_layout.addWidget(terminal_display)
    
    # Ligne de commande
    command_layout = QtWidgets.QHBoxLayout()
    
    prompt_label = QtWidgets.QLabel("C:\\Users\\ragnar>")
    prompt_label.setStyleSheet("color: #00ff88; font-family: monospace; font-weight: bold;")
    
    command_input = QtWidgets.QLineEdit()
    command_input.setStyleSheet("""
        QLineEdit {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 136, 0.5);
            border-radius: 4px;
            color: #00ff88;
            font-family: monospace;
            padding: 6px;
        }
    """)
    command_input.setPlaceholderText("Tapez votre commande...")
    
    execute_btn = QtWidgets.QPushButton("‚èé Ex√©cuter")
    
    command_layout.addWidget(prompt_label)
    command_layout.addWidget(command_input)
    command_layout.addWidget(execute_btn)
    
    terminal_layout.addLayout(command_layout)
    lay.addWidget(terminal_area)
    
    # Actions
    actions_layout = QtWidgets.QHBoxLayout()
    
    clear_btn = QtWidgets.QPushButton("üßπ Effacer")
    history_btn = QtWidgets.QPushButton("üìã Historique")
    scripts_btn = QtWidgets.QPushButton("üìú Scripts")
    settings_btn = QtWidgets.QPushButton("‚öôÔ∏è Param√®tres")
    close_btn = QtWidgets.QPushButton("‚ùå Fermer")
    
    def execute_command():
        cmd = command_input.text().strip()
        if cmd:
            current_text = terminal_display.toPlainText()
            new_text = current_text + f"\nC:\\Users\\ragnar> {cmd}\n"
            
            if cmd.lower() == "help":
                new_text += "Commandes disponibles :\n‚Ä¢ dir - Liste les fichiers\n‚Ä¢ cls - Efface l'√©cran\n‚Ä¢ ragnar --version - Version du syst√®me\n‚Ä¢ systeminfo - Informations syst√®me\n‚Ä¢ exit - Fermer le terminal"
            elif cmd.lower() == "cls":
                new_text = "Ragnar OS Terminal v26.3.0\nCopyright (c) 2024 Ragnar Systems.\n\nC:\\Users\\ragnar> "
            elif cmd.lower() == "exit":
                d.close()
                return
            else:
                new_text += f"'{cmd}' n'est pas reconnu en tant que commande interne ou externe.\nTapez 'help' pour voir les commandes disponibles."
            
            new_text += "\n\nC:\\Users\\ragnar> "
            terminal_display.setPlainText(new_text)
            command_input.clear()
            
            # Scroll to bottom
            cursor = terminal_display.textCursor()
            cursor.movePosition(cursor.MoveOperation.End)
            terminal_display.setTextCursor(cursor)
    
    execute_btn.clicked.connect(execute_command)
    command_input.returnPressed.connect(execute_command)
    
    clear_btn.clicked.connect(lambda: terminal_display.setPlainText("Ragnar OS Terminal v26.3.0\nCopyright (c) 2024 Ragnar Systems.\n\nC:\\Users\\ragnar> "))
    history_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "üìã", "Historique des commandes !\n\nüìã Derni√®res commandes :\n‚Ä¢ dir\n‚Ä¢ ragnar --version\n‚Ä¢ systeminfo\n‚Ä¢ help\n‚Ä¢ cls\n\n‚¨ÜÔ∏è Utilisez les fl√®ches pour naviguer"))
    close_btn.clicked.connect(d.close)
    
    actions_layout.addWidget(clear_btn)
    actions_layout.addWidget(history_btn)
    actions_layout.addWidget(scripts_btn)
    actions_layout.addWidget(settings_btn)
    actions_layout.addStretch()
    actions_layout.addWidget(close_btn)
    
    lay.addLayout(actions_layout)
    
    d.show()
    fade_in(d, 600)

# Applications syst√®me avanc√©es
DesktopPage.show_system_monitor = lambda self: show_system_monitor_func()
DesktopPage.show_terminal = lambda self: show_terminal_func()

# Applications utilitaires compl√®tes
DesktopPage.show_backup_manager = lambda self: QtWidgets.QMessageBox.information(self, "üíæ Sauvegarde", "Gestionnaire de Sauvegarde !\n\nüíæ Fonctionnalit√©s :\n‚Ä¢ Sauvegarde automatique\n‚Ä¢ Sauvegarde incr√©mentielle\n‚Ä¢ Restauration rapide\n‚Ä¢ Chiffrement des donn√©es\n‚Ä¢ Planification flexible\n‚Ä¢ Stockage cloud\n\nüìä Derni√®re sauvegarde : Hier 23:00\n‚úÖ Toutes les donn√©es prot√©g√©es")

DesktopPage.show_disk_cleanup = lambda self: QtWidgets.QMessageBox.information(self, "üßπ Nettoyage", "Nettoyage de Disque !\n\nüßπ Analyse du syst√®me :\n‚Ä¢ Fichiers temporaires : 2.3 GB\n‚Ä¢ Cache navigateur : 856 MB\n‚Ä¢ Corbeille : 1.2 GB\n‚Ä¢ Logs syst√®me : 234 MB\n‚Ä¢ Fichiers dupliqu√©s : 567 MB\n\nüíæ Espace r√©cup√©rable : 5.1 GB\nüöÄ Nettoyage recommand√©")

DesktopPage.show_startup_manager = lambda self: QtWidgets.QMessageBox.information(self, "üöÄ D√©marrage", "Gestionnaire de D√©marrage !\n\nüöÄ Applications au d√©marrage :\n‚Ä¢ ‚úÖ RagnarOS Core (Syst√®me)\n‚Ä¢ ‚úÖ Antivirus (S√©curit√©)\n‚Ä¢ ‚ùå Steam (D√©sactiv√©)\n‚Ä¢ ‚úÖ Discord (Activ√©)\n‚Ä¢ ‚ùå Spotify (D√©sactiv√©)\n\n‚è±Ô∏è Temps de d√©marrage : 12 secondes\nüéØ Optimisation possible : -3 sec")


if __name__ == "__main__":
    main()
