#!/usr/bin/env python3
# -*- coding: utf-8 -*-

# Ragnar OS 26.3.3 â€” PyQt6 Ã‰cosystÃ¨me Complet (Interface rÃ©volutionnaire, thÃ¨mes avancÃ©s, marketplace)

# - Boot animÃ© + bureau en verre

# - Apps : SystÃ¨me, Fichiers, Store, Navigateur, Chat, ParamÃ¨tres

# - Updater : mise Ã  jour directe depuis Pastebin

# DÃ©pendances : pip install PyQt6 requests



import os, sys, json, time, random, hashlib, webbrowser, shutil, traceback, subprocess, math

from pathlib import Path

from typing import Dict, Any, List, Optional



import requests

from PyQt6 import QtCore, QtGui, QtWidgets

from PyQt6.QtGui import QDesktopServices

from PyQt6.QtCore import QUrl, QPropertyAnimation, QAbstractAnimation



APP_NAME = "Ragnar OS 26"

PASTEBIN_RAW_BASE = "https://raw.githubusercontent.com/ragnar152743/ragnarOS26/refs/heads/main/"



# ðŸ”„ CONFIGURATION MISE Ã€ JOUR - Changez juste cet ID pour mettre Ã  jour !

UPDATE_PASTEBIN_ID = "ragnarOS26"  # â¬…ï¸ Remplacez par l'ID de votre nouveau code GitHub

STATE_DIR = Path.home() / ".ragnar_os26"

STATE_DIR.mkdir(parents=True, exist_ok=True)

STATE_FILE = STATE_DIR / "state.json"

STORE_FILE = STATE_DIR / "store.json"

BACKUP_DIR = STATE_DIR / "backups"
SANDBOX_DIR = STATE_DIR / "sandbox"
MEM_SANDBOX: Dict[str, bytes] = {}

DEFAULT_LOCAL_VERSION = "26.3.3"

# Style moderne noir pour toutes les applications Ragnar OS
RAGNAR_MODERN_STYLE = """
QWidget {
    background: transparent;
    color: white;
    font-family: 'Segoe UI', 'Arial', sans-serif;
    font-size: 12px;
}

QWidget#GlassCard {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(255, 255, 255, 0.25),
        stop:0.3 rgba(255, 255, 255, 0.15),
        stop:0.7 rgba(255, 255, 255, 0.08),
        stop:1 rgba(255, 255, 255, 0.03));
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 20px;
    padding: 16px;
}

QPushButton {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(255, 255, 255, 0.2),
        stop:0.5 rgba(255, 255, 255, 0.1),
        stop:1 rgba(255, 255, 255, 0.05));
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 15px;
    padding: 15px 25px;
    font-weight: 600;
    color: white;
    min-height: 40px;
    font-size: 16px;
}

QPushButton:hover {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(0, 255, 136, 0.3),
        stop:0.5 rgba(0, 255, 136, 0.2),
        stop:1 rgba(0, 255, 136, 0.1));
    border: 2px solid rgba(0, 255, 136, 0.5);
}

QPushButton:pressed {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(0, 255, 136, 0.4),
        stop:0.5 rgba(0, 255, 136, 0.3),
        stop:1 rgba(0, 255, 136, 0.2));
    border: 2px solid rgba(0, 255, 136, 0.7);
}

QLineEdit, QTextEdit, QPlainTextEdit {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(255, 255, 255, 0.15),
        stop:0.5 rgba(255, 255, 255, 0.08),
        stop:1 rgba(255, 255, 255, 0.03));
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 15px 18px;
    color: white;
    font-size: 16px;
    min-height: 25px;
    selection-background-color: rgba(0, 255, 136, 0.3);
}

QLineEdit:focus, QTextEdit:focus, QPlainTextEdit:focus {
    border: 2px solid rgba(0, 255, 136, 0.6);
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(0, 255, 136, 0.15),
        stop:0.5 rgba(0, 255, 136, 0.08),
        stop:1 rgba(0, 255, 136, 0.03));
}

QListWidget, QTreeWidget {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(0, 0, 0, 0.8),
        stop:1 rgba(20, 20, 20, 0.6));
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 10px;
    padding: 5px;
}

QListWidget::item, QTreeWidget::item {
    padding: 10px;
    border-radius: 5px;
    margin: 2px;
}

QListWidget::item:selected, QTreeWidget::item:selected {
    background: qlineargradient(x1:0, y1:0, x2:1, y2:0,
        stop:0 rgba(0, 255, 136, 0.4),
        stop:1 rgba(0, 200, 100, 0.3));
    border: 2px solid rgba(0, 255, 136, 0.6);
}

QListWidget::item:hover, QTreeWidget::item:hover {
    background: rgba(255, 255, 255, 0.1);
}

QTabWidget::pane {
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(0, 0, 0, 0.9),
        stop:1 rgba(20, 20, 20, 0.8));
}

QTabBar::tab {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(40, 40, 40, 0.9),
        stop:1 rgba(20, 20, 20, 0.8));
    border: 2px solid rgba(255, 255, 255, 0.2);
    padding: 10px 20px;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    color: rgba(255, 255, 255, 0.8);
    font-weight: bold;
}

QTabBar::tab:selected {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(0, 255, 136, 0.3),
        stop:1 rgba(0, 200, 100, 0.2));
    border: 2px solid rgba(0, 255, 136, 0.5);
    color: white;
}

QTabBar::tab:hover {
    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
        stop:0 rgba(255, 255, 255, 0.2),
        stop:1 rgba(255, 255, 255, 0.1));
}

QLabel {
    color: white;
    font-size: 12px;
}

QCheckBox {
    color: white;
    font-size: 12px;
    font-weight: bold;
}

QCheckBox::indicator {
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 4px;
    background: rgba(0, 0, 0, 0.6);
}

QCheckBox::indicator:checked {
    background: qlineargradient(x1:0, y1:0, x2:1, y2:1,
        stop:0 rgba(0, 255, 136, 0.8),
        stop:1 rgba(0, 200, 100, 0.8));
    border: 2px solid rgba(0, 255, 136, 0.8);
}

QProgressBar {
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.05);
    text-align: center;
    color: white;
    font-weight: 600;
    font-size: 12px;
    height: 20px;
}

QProgressBar::chunk {
    background: qlineargradient(x1:0, y1:0, x2:1, y2:0,
        stop:0 rgba(0, 255, 136, 0.9),
        stop:0.5 rgba(0, 255, 200, 0.8),
        stop:1 rgba(0, 200, 100, 0.7));
    border-radius: 8px;
    margin: 1px;
}
"""


# ===== CORRECTIONS CRITIQUES POUR STABILITÃ‰ =====

def ensure_files():
    """Assure que tous les fichiers et dossiers nÃ©cessaires existent"""
    for path in [STATE_DIR, BACKUP_DIR]:
        path.mkdir(parents=True, exist_ok=True)
    
    # CrÃ©er state.json s'il n'existe pas, sinon prÃ©server l'Ã©tat existant
    if not STATE_FILE.exists():
        initial_state = {
            "version": DEFAULT_LOCAL_VERSION,
            "theme": "dark",
            "features": {},
            "force_updated": True,
            "welcome_shown": False
        }
        STATE_FILE.write_text(json.dumps(initial_state, ensure_ascii=False, indent=2), encoding="utf-8")
    else:
        try:
            current = json.loads(STATE_FILE.read_text(encoding="utf-8") or "{}")
        except Exception:
            current = {}
        current.setdefault("version", DEFAULT_LOCAL_VERSION)
        current.setdefault("theme", "dark")
        current.setdefault("features", {})
        current.setdefault("force_updated", True)
        current.setdefault("sandbox_enabled", True)
        current.setdefault("sandbox_memory_enabled", True)
        current.setdefault("welcome_shown", False)
        STATE_FILE.write_text(json.dumps(current, ensure_ascii=False, indent=2), encoding="utf-8")
    
    # CrÃ©er store.json s'il n'existe pas
    if not STORE_FILE.exists():
        STORE_FILE.write_text('{"apps": [], "installed": []}', encoding="utf-8")
    
    # CrÃ©er dossier de logs
    logs_dir = STATE_DIR / "logs"
    logs_dir.mkdir(exist_ok=True)
    SANDBOX_DIR.mkdir(exist_ok=True)

def safe_open(path):
    """Ouvre un fichier de maniÃ¨re compatible multi-OS"""
    try:
        # Sandbox: empÃªcher l'ouverture externe si activÃ©e
        st = _read_state_safe()
        if st.get("sandbox_enabled"):
            QtWidgets.QMessageBox.warning(None, "Sandbox", "Ouverture externe bloquÃ©e par la sandbox")
            return
        if sys.platform.startswith("win"):
            os.startfile(str(path))
        elif sys.platform.startswith("linux"):
            subprocess.Popen(["xdg-open", str(path)])
        elif sys.platform == "darwin":
            subprocess.Popen(["open", str(path)])
        else:
            QDesktopServices.openUrl(QUrl.fromLocalFile(str(path)))
    except Exception as e:
        QtWidgets.QMessageBox.critical(None, "Erreur", f"Impossible d'ouvrir : {e}")

def handle_exception(exc_type, exc_value, tb):
    """Gestionnaire d'erreurs global pour Ã©viter les crashes silencieux"""
    import traceback
    err = "".join(traceback.format_exception(exc_type, exc_value, tb))
    print(f"ERREUR RAGNAR OS: {err}")
    
    # Sauvegarder l'erreur dans les logs
    try:
        log_file = STATE_DIR / "logs" / f"error_{int(time.time())}.log"
        log_file.write_text(err, encoding="utf-8")
    except:
        pass
    
    # Afficher l'erreur Ã  l'utilisateur
    try:
        QtWidgets.QMessageBox.critical(
            None, "âš ï¸ Erreur Ragnar OS", 
            f"Une erreur est survenue :\n\n{str(exc_value)}\n\nDÃ©tails sauvegardÃ©s dans les logs."
        )
    except:
        print("Erreur critique - impossible d'afficher le dialogue")

def _layout_addSeparator(self):
    """Ajoute un sÃ©parateur Ã  un layout (correction pour PyQt6)"""
    line = QtWidgets.QFrame()
    if isinstance(self, QtWidgets.QHBoxLayout):
        line.setFrameShape(QtWidgets.QFrame.Shape.VLine)
    else:
        line.setFrameShape(QtWidgets.QFrame.Shape.HLine)
    line.setFrameShadow(QtWidgets.QFrame.Shadow.Sunken)
    line.setStyleSheet("color: rgba(255,255,255,0.3);")
    self.addWidget(line)
    return line

def _read_state_safe() -> Dict[str, Any]:
    """Lit l'Ã©tat depuis STATE_FILE en Ã©vitant les exceptions."""
    try:
        if STATE_FILE.exists():
            return json.loads(STATE_FILE.read_text(encoding="utf-8") or "{}")
    except Exception:
        pass
    return {}

def _write_state_safe(state: Dict[str, Any]) -> None:
    """Ã‰crit l'Ã©tat dans STATE_FILE de faÃ§on sÃ»re."""
    try:
        STATE_FILE.write_text(json.dumps(state, ensure_ascii=False, indent=2), encoding="utf-8")
    except Exception:
        pass

def show_one_time_welcome(parent: QtWidgets.QWidget) -> None:
    """Affiche un message de bienvenue une seule fois (persistÃ© dans state.json)."""
    state = _read_state_safe()
    if state.get("welcome_shown") is True:
        return
    try:
        d = GlassDialog("ðŸ‘‹ Bienvenue dans Ragnar OS 26", (720, 420), parent)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        header = QtWidgets.QLabel("Bienvenue !")
        header.setStyleSheet("font-size: 22px; font-weight: bold; color: #00ff88; padding: 8px;")
        header.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        subtitle = QtWidgets.QLabel("Merci d'utiliser Ragnar OS 26. Profitez des nouvelles animations et apps.")
        subtitle.setStyleSheet("color: #cccccc; font-size: 13px; padding: 6px;")
        subtitle.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        info_card = QtWidgets.QWidget(objectName="GlassCard")
        info_lay = QtWidgets.QVBoxLayout(info_card)
        info_lay.setContentsMargins(16, 16, 16, 16)
        info_lay.addWidget(QtWidgets.QLabel("â€¢ ThÃ¨me moderne et effets de verre"))
        info_lay.addWidget(QtWidgets.QLabel("â€¢ Animations fluides et transitions"))
        info_lay.addWidget(QtWidgets.QLabel("â€¢ Apps interactives (Jeux, Outils)"))
        ok_btn = QtWidgets.QPushButton("âœ… Commencer")
        ok_btn.clicked.connect(d.close)
        lay.addWidget(header)
        lay.addWidget(subtitle)
        lay.addWidget(info_card)
        lay.addStretch()
        lay.addWidget(ok_btn, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        d.show()
        try:
            modern_fade_in(d, 900)
        except Exception:
            pass
    finally:
        state["welcome_shown"] = True
        _write_state_safe(state)

def apply_sandbox_hooks():
    """Active des garde-fous pour sandbox: rÃ©seau, subprocess, dialogs vers sandbox."""
    st = _read_state_safe()
    if not st.get("sandbox_enabled"):
        return
    # Bloquer requests
    try:
        import requests as _rq
        _orig_request = _rq.sessions.Session.request
        def _blocked_request(self, method, url, *args, **kwargs):
            raise RuntimeError("Sandbox: requÃªtes rÃ©seau bloquÃ©es")
        _rq.sessions.Session.request = _blocked_request
    except Exception:
        pass
    # Bloquer subprocess
    try:
        _orig_popen = subprocess.Popen
        def _blocked_popen(*args, **kwargs):
            raise RuntimeError("Sandbox: subprocess bloquÃ©")
        subprocess.Popen = _blocked_popen
    except Exception:
        pass
    # Rediriger QFileDialog
    try:
        if st.get("sandbox_memory_enabled"):
            def _memfs_list() -> List[str]:
                return sorted(MEM_SANDBOX.keys())
            def _open_picker(parent=None, title="Fichiers (RAM)"):
                d = GlassDialog("ðŸ“ SÃ©lectionner (RAM)", (500, 400), parent)
                lay = QtWidgets.QVBoxLayout(d)
                listw = QtWidgets.QListWidget()
                for name in _memfs_list():
                    listw.addItem(name)
                ok = QtWidgets.QPushButton("âœ… Ouvrir")
                cancel = QtWidgets.QPushButton("âŒ Annuler")
                ok.clicked.connect(d.accept)
                cancel.clicked.connect(d.reject)
                btns = QtWidgets.QHBoxLayout()
                btns.addStretch(); btns.addWidget(ok); btns.addWidget(cancel)
                lay.addWidget(QtWidgets.QLabel(title))
                lay.addWidget(listw)
                lay.addLayout(btns)
                if d.exec() == QtWidgets.QDialog.DialogCode.Accepted and listw.currentItem():
                    return listw.currentItem().text()
                return None
            def _save_picker(parent=None):
                text, ok = QtWidgets.QInputDialog.getText(parent, "Enregistrer (RAM)", "Nom du fichier")
                if ok and text:
                    if text not in MEM_SANDBOX:
                        MEM_SANDBOX[text] = b""
                    return text
                return None
            def _sandbox_get_open_file_name(parent=None, caption='', directory='', filter='', initialFilter=''):
                sel = _open_picker(parent)
                return (f"mem:/{sel}" if sel else '', '')
            def _sandbox_get_save_file_name(parent=None, caption='', directory='', filter='', initialFilter=''):
                sel = _save_picker(parent)
                return (f"mem:/{sel}" if sel else '', '')
            def _sandbox_get_existing_directory(parent=None, caption='', directory=''):
                return 'mem:/'
            QtWidgets.QFileDialog.getOpenFileName = staticmethod(_sandbox_get_open_file_name)
            QtWidgets.QFileDialog.getSaveFileName = staticmethod(_sandbox_get_save_file_name)
            QtWidgets.QFileDialog.getExistingDirectory = staticmethod(_sandbox_get_existing_directory)
        else:
            def _sandbox_get_open_file_name(parent=None, caption='', directory='', filter='', initialFilter=''):
                directory = str(SANDBOX_DIR)
                return QtWidgets.QFileDialog.getOpenFileName(parent, caption, directory, filter, initialFilter)
            def _sandbox_get_save_file_name(parent=None, caption='', directory='', filter='', initialFilter=''):
                directory = str(SANDBOX_DIR)
                return QtWidgets.QFileDialog.getSaveFileName(parent, caption, directory, filter, initialFilter)
            def _sandbox_get_existing_directory(parent=None, caption='', directory=''):
                directory = str(SANDBOX_DIR)
                return QtWidgets.QFileDialog.getExistingDirectory(parent, caption, directory)
            QtWidgets.QFileDialog.getOpenFileName = staticmethod(_sandbox_get_open_file_name)
            QtWidgets.QFileDialog.getSaveFileName = staticmethod(_sandbox_get_save_file_name)
            QtWidgets.QFileDialog.getExistingDirectory = staticmethod(_sandbox_get_existing_directory)
    except Exception:
        pass
    # MÃ©moire: intercepter open()
    try:
        import builtins as _bi
        _orig_open = _bi.open
        if st.get("sandbox_memory_enabled"):
            class _MemFile:
                def __init__(self, name: str, mode: str):
                    self._name = name
                    self._mode = mode
                    self._buf = io.BytesIO(MEM_SANDBOX.get(name, b""))
                    if 'a' in mode:
                        self._buf.seek(0, io.SEEK_END)
                def read(self, *a, **k):
                    return self._buf.read(*a, **k)
                def write(self, b):
                    if isinstance(b, str):
                        b = b.encode('utf-8')
                    return self._buf.write(b)
                def seek(self, *a, **k):
                    return self._buf.seek(*a, **k)
                def tell(self):
                    return self._buf.tell()
                def flush(self):
                    pass
                def close(self):
                    MEM_SANDBOX[self._name] = self._buf.getvalue()
                def __enter__(self):
                    return self
                def __exit__(self, exc_type, exc, tb):
                    self.close()
            def _open_wrapper(file, mode='r', *args, **kwargs):
                if isinstance(file, (str, Path)):
                    s = str(file)
                    if s.startswith('mem:/'):
                        name = s[len('mem:/'):]
                        return _MemFile(name, mode)
                raise RuntimeError("Sandbox mÃ©moire: accÃ¨s disque bloquÃ©")
            _bi.open = _open_wrapper
    except Exception:
        pass

def fade_in(widget, duration=1200):
    """Animation de fondu d'entrÃ©e ultra-fluide avec effet de verre"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        animation = QtCore.QPropertyAnimation(effect, b"opacity")
        animation.setDuration(duration)
        animation.setStartValue(0.0)
        animation.setEndValue(1.0)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutCubic)
        animation.start()
        
        # Animation de scale simultanÃ©e
        scale_animation = QtCore.QPropertyAnimation(widget, b"geometry")
        original_geometry = widget.geometry()
        start_geometry = QtCore.QRect(
            original_geometry.x() + original_geometry.width() // 4,
            original_geometry.y() + original_geometry.height() // 4,
            original_geometry.width() // 2,
            original_geometry.height() // 2
        )
        
        scale_animation.setDuration(duration)
        scale_animation.setStartValue(start_geometry)
        scale_animation.setEndValue(original_geometry)
        scale_animation.setEasingCurve(QtCore.QEasingCurve.Type.OutBack)
        scale_animation.start()
        
        # Garder les rÃ©fÃ©rences
        widget._fade_animation = animation
        widget._scale_animation = scale_animation
    except Exception:
        pass

def glass_float_animation(widget, duration=3000):
    """Animation de flottement pour effet de verre"""
    try:
        original_pos = widget.pos()
        
        # Animation de flottement vertical
        float_animation = QtCore.QPropertyAnimation(widget, b"pos")
        float_animation.setDuration(duration)
        float_animation.setStartValue(original_pos)
        float_animation.setKeyValueAt(0.5, QtCore.QPoint(original_pos.x(), original_pos.y() - 5))
        float_animation.setEndValue(original_pos)
        float_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        float_animation.setLoopCount(-1)  # Boucle infinie
        float_animation.start()
        
        widget._float_animation = float_animation
    except Exception:
        pass

def shimmer_effect(widget, duration=2000):
    """Effet de scintillement pour les Ã©lÃ©ments de verre"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        shimmer_animation = QtCore.QPropertyAnimation(effect, b"opacity")
        shimmer_animation.setDuration(duration)
        shimmer_animation.setStartValue(0.7)
        shimmer_animation.setKeyValueAt(0.5, 1.0)
        shimmer_animation.setEndValue(0.7)
        shimmer_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        shimmer_animation.setLoopCount(-1)
        shimmer_animation.start()
        
        widget._shimmer_animation = shimmer_animation
    except Exception:
        pass

def slide_in_from_right(widget, duration=800):
    """Animation de glissement depuis la droite"""
    try:
        original_pos = widget.pos()
        start_pos = QtCore.QPoint(original_pos.x() + 200, original_pos.y())
        widget.move(start_pos)
        
        animation = QtCore.QPropertyAnimation(widget, b"pos")
        animation.setDuration(duration)
        animation.setStartValue(start_pos)
        animation.setEndValue(original_pos)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutBack)
        animation.start()
        
        widget._slide_animation = animation
    except Exception:
        pass

def rotate_in(widget, duration=1000):
    """Animation de rotation d'entrÃ©e"""
    try:
        effect = QtWidgets.QGraphicsRotationEffect()
        widget.setGraphicsEffect(effect)
        
        animation = QtCore.QPropertyAnimation(effect, b"rotation")
        animation.setDuration(duration)
        animation.setStartValue(0.0)
        animation.setEndValue(360.0)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutElastic)
        animation.start()
        
        widget._rotate_animation = animation
    except Exception:
        pass

def slide_in_from_bottom(widget, duration=800):
    """Animation de glissement depuis le bas"""
    try:
        original_pos = widget.pos()
        start_pos = QtCore.QPoint(original_pos.x(), original_pos.y() + 100)
        widget.move(start_pos)
        
        animation = QtCore.QPropertyAnimation(widget, b"pos")
        animation.setDuration(duration)
        animation.setStartValue(start_pos)
        animation.setEndValue(original_pos)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutBounce)
        animation.start()
        
        widget._slide_animation = animation
    except Exception:
        pass

def scale_in(widget, duration=600):
    """Animation d'agrandissement"""
    try:
        widget.setStyleSheet(widget.styleSheet() + "transform: scale(0.8);")
        
        animation = QtCore.QPropertyAnimation(widget, b"geometry")
        animation.setDuration(duration)
        
        original_geometry = widget.geometry()
        small_geometry = QtCore.QRect(
            original_geometry.x() + original_geometry.width() // 10,
            original_geometry.y() + original_geometry.height() // 10,
            int(original_geometry.width() * 0.8),
            int(original_geometry.height() * 0.8)
        )
        
        animation.setStartValue(small_geometry)
        animation.setEndValue(original_geometry)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutElastic)
        animation.start()
        
        widget._scale_animation = animation
    except Exception:
        pass

def pulse_animation(widget, duration=2000):
    """Animation de pulsation pour le logo"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        animation = QtCore.QPropertyAnimation(effect, b"opacity")
        animation.setDuration(duration)
        animation.setStartValue(0.5)
        animation.setEndValue(1.0)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        animation.setLoopCount(-1)  # Boucle infinie
        animation.start()
        
        widget._pulse_animation = animation
    except Exception:
        pass

def bounce_in(widget, duration=1000):
    """Animation de rebond d'entrÃ©e"""
    try:
        original_geometry = widget.geometry()
        
        # Commencer petit et au centre
        start_geometry = QtCore.QRect(
            original_geometry.x() + original_geometry.width() // 4,
            original_geometry.y() + original_geometry.height() // 4,
            original_geometry.width() // 2,
            original_geometry.height() // 2
        )
        
        widget.setGeometry(start_geometry)
        
        animation = QtCore.QPropertyAnimation(widget, b"geometry")
        animation.setDuration(duration)
        animation.setStartValue(start_geometry)
        animation.setEndValue(original_geometry)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutBounce)
        animation.start()
        
        widget._bounce_animation = animation
    except Exception:
        pass

# ===== NOUVELLES ANIMATIONS MODERNES =====

def modern_fade_in(widget, duration=1200):
    """Animation de fondu moderne avec effets de particules"""
    try:
        # Effet d'opacitÃ© avec courbe d'accÃ©lÃ©ration moderne
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        animation = QtCore.QPropertyAnimation(effect, b"opacity")
        animation.setDuration(duration)
        animation.setStartValue(0.0)
        animation.setEndValue(1.0)
        animation.setEasingCurve(QtCore.QEasingCurve.Type.OutQuart)
        animation.start()
        
        # Animation de scale avec effet Ã©lastique
        scale_animation = QtCore.QPropertyAnimation(widget, b"geometry")
        original_geometry = widget.geometry()
        start_geometry = QtCore.QRect(
            original_geometry.x() + original_geometry.width() // 3,
            original_geometry.y() + original_geometry.height() // 3,
            int(original_geometry.width() * 0.7),
            int(original_geometry.height() * 0.7)
        )
        
        scale_animation.setDuration(duration)
        scale_animation.setStartValue(start_geometry)
        scale_animation.setEndValue(original_geometry)
        scale_animation.setEasingCurve(QtCore.QEasingCurve.Type.OutElastic)
        scale_animation.start()
        
        # Effet de rotation subtile
        rotation_effect = QtWidgets.QGraphicsRotationEffect()
        widget.setGraphicsEffect(rotation_effect)
        
        rotation_animation = QtCore.QPropertyAnimation(rotation_effect, b"rotation")
        rotation_animation.setDuration(duration)
        rotation_animation.setStartValue(-5.0)
        rotation_animation.setEndValue(0.0)
        rotation_animation.setEasingCurve(QtCore.QEasingCurve.Type.OutCubic)
        rotation_animation.start()
        
        # Garder les rÃ©fÃ©rences
        widget._modern_fade_animation = animation
        widget._modern_scale_animation = scale_animation
        widget._modern_rotation_animation = rotation_animation
    except Exception:
        pass

def morphing_animation(widget, duration=1500):
    """Animation de morphing avec changement de forme"""
    try:
        original_geometry = widget.geometry()
        
        # CrÃ©er plusieurs Ã©tapes de morphing
        morph_animation = QtCore.QPropertyAnimation(widget, b"geometry")
        morph_animation.setDuration(duration)
        
        # Ã‰tape 1: RÃ©trÃ©cir
        step1 = QtCore.QRect(
            original_geometry.x() + original_geometry.width() // 4,
            original_geometry.y() + original_geometry.height() // 4,
            original_geometry.width() // 2,
            original_geometry.height() // 2
        )
        
        # Ã‰tape 2: Ã‰tirer horizontalement
        step2 = QtCore.QRect(
            original_geometry.x() - original_geometry.width() // 4,
            original_geometry.y(),
            int(original_geometry.width() * 1.5),
            original_geometry.height()
        )
        
        # Ã‰tape 3: Ã‰tirer verticalement
        step3 = QtCore.QRect(
            original_geometry.x(),
            original_geometry.y() - original_geometry.height() // 4,
            original_geometry.width(),
            int(original_geometry.height() * 1.5)
        )
        
        # Retour Ã  la forme normale
        morph_animation.setKeyValueAt(0.0, step1)
        morph_animation.setKeyValueAt(0.3, step2)
        morph_animation.setKeyValueAt(0.6, step3)
        morph_animation.setKeyValueAt(1.0, original_geometry)
        
        morph_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutCubic)
        morph_animation.start()
        
        widget._morph_animation = morph_animation
    except Exception:
        pass

def wave_animation(widget, duration=2000):
    """Animation de vague pour les Ã©lÃ©ments de navigation"""
    try:
        original_pos = widget.pos()
        
        wave_animation = QtCore.QPropertyAnimation(widget, b"pos")
        wave_animation.setDuration(duration)
        
        # CrÃ©er un mouvement de vague
        wave_animation.setKeyValueAt(0.0, original_pos)
        wave_animation.setKeyValueAt(0.25, QtCore.QPoint(original_pos.x() + 10, original_pos.y() - 5))
        wave_animation.setKeyValueAt(0.5, QtCore.QPoint(original_pos.x() - 5, original_pos.y() + 10))
        wave_animation.setKeyValueAt(0.75, QtCore.QPoint(original_pos.x() + 5, original_pos.y() - 3))
        wave_animation.setKeyValueAt(1.0, original_pos)
        
        wave_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        wave_animation.setLoopCount(-1)
        wave_animation.start()
        
        widget._wave_animation = wave_animation
    except Exception:
        pass

def neon_glow_animation(widget, duration=3000):
    """Animation de lueur nÃ©on pour les boutons"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        glow_animation = QtCore.QPropertyAnimation(effect, b"opacity")
        glow_animation.setDuration(duration)
        glow_animation.setStartValue(0.6)
        glow_animation.setKeyValueAt(0.5, 1.0)
        glow_animation.setEndValue(0.6)
        glow_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        glow_animation.setLoopCount(-1)
        glow_animation.start()
        
        # Animation de couleur simultanÃ©e
        color_animation = QtCore.QPropertyAnimation(widget, b"styleSheet")
        color_animation.setDuration(duration)
        
        base_style = widget.styleSheet()
        glow_style = base_style.replace("rgba(0, 255, 136", "rgba(0, 255, 200")
        
        color_animation.setStartValue(base_style)
        color_animation.setKeyValueAt(0.5, glow_style)
        color_animation.setEndValue(base_style)
        color_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        color_animation.setLoopCount(-1)
        color_animation.start()
        
        widget._neon_glow_animation = glow_animation
        widget._neon_color_animation = color_animation
    except Exception:
        pass

def matrix_rain_effect(widget, duration=5000):
    """Effet de pluie Matrix pour l'arriÃ¨re-plan"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        matrix_animation = QtCore.QPropertyAnimation(effect, b"opacity")
        matrix_animation.setDuration(duration)
        matrix_animation.setStartValue(0.1)
        matrix_animation.setKeyValueAt(0.3, 0.8)
        matrix_animation.setKeyValueAt(0.7, 0.8)
        matrix_animation.setEndValue(0.1)
        matrix_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        matrix_animation.setLoopCount(-1)
        matrix_animation.start()
        
        widget._matrix_animation = matrix_animation
    except Exception:
        pass

def holographic_effect(widget, duration=4000):
    """Effet holographique pour les Ã©lÃ©ments futuristes"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        holo_animation = QtCore.QPropertyAnimation(effect, b"opacity")
        holo_animation.setDuration(duration)
        holo_animation.setStartValue(0.3)
        holo_animation.setKeyValueAt(0.2, 0.9)
        holo_animation.setKeyValueAt(0.4, 0.5)
        holo_animation.setKeyValueAt(0.6, 0.9)
        holo_animation.setKeyValueAt(0.8, 0.4)
        holo_animation.setEndValue(0.3)
        holo_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        holo_animation.setLoopCount(-1)
        holo_animation.start()
        
        widget._holographic_animation = holo_animation
    except Exception:
        pass

def liquid_flow_animation(widget, duration=2500):
    """Animation de flux liquide pour les transitions"""
    try:
        original_geometry = widget.geometry()
        
        flow_animation = QtCore.QPropertyAnimation(widget, b"geometry")
        flow_animation.setDuration(duration)
        
        # Mouvement fluide comme un liquide
        flow_animation.setKeyValueAt(0.0, original_geometry)
        flow_animation.setKeyValueAt(0.2, QtCore.QRect(
            original_geometry.x() + 15,
            original_geometry.y() - 8,
            original_geometry.width() + 10,
            original_geometry.height() + 5
        ))
        flow_animation.setKeyValueAt(0.4, QtCore.QRect(
            original_geometry.x() - 10,
            original_geometry.y() + 12,
            original_geometry.width() - 5,
            original_geometry.height() - 8
        ))
        flow_animation.setKeyValueAt(0.6, QtCore.QRect(
            original_geometry.x() + 8,
            original_geometry.y() - 5,
            original_geometry.width() + 8,
            original_geometry.height() + 3
        ))
        flow_animation.setKeyValueAt(0.8, QtCore.QRect(
            original_geometry.x() - 5,
            original_geometry.y() + 8,
            original_geometry.width() - 3,
            original_geometry.height() - 5
        ))
        flow_animation.setKeyValueAt(1.0, original_geometry)
        
        flow_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutCubic)
        flow_animation.setLoopCount(-1)
        flow_animation.start()
        
        widget._liquid_flow_animation = flow_animation
    except Exception:
        pass

def quantum_entanglement_effect(widget, duration=3000):
    """Effet d'intrication quantique pour les Ã©lÃ©ments liÃ©s"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        quantum_animation = QtCore.QPropertyAnimation(effect, b"opacity")
        quantum_animation.setDuration(duration)
        quantum_animation.setStartValue(0.4)
        quantum_animation.setKeyValueAt(0.1, 1.0)
        quantum_animation.setKeyValueAt(0.3, 0.2)
        quantum_animation.setKeyValueAt(0.5, 1.0)
        quantum_animation.setKeyValueAt(0.7, 0.3)
        quantum_animation.setKeyValueAt(0.9, 1.0)
        quantum_animation.setEndValue(0.4)
        quantum_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
        quantum_animation.setLoopCount(-1)
        quantum_animation.start()
        
        widget._quantum_animation = quantum_animation
    except Exception:
        pass

def cyberpunk_glitch_effect(widget, duration=2000):
    """Effet de glitch cyberpunk"""
    try:
        effect = QtWidgets.QGraphicsOpacityEffect()
        widget.setGraphicsEffect(effect)
        
        glitch_animation = QtCore.QPropertyAnimation(effect, b"opacity")
        glitch_animation.setDuration(duration)
        glitch_animation.setStartValue(1.0)
        glitch_animation.setKeyValueAt(0.1, 0.3)
        glitch_animation.setKeyValueAt(0.2, 1.0)
        glitch_animation.setKeyValueAt(0.3, 0.1)
        glitch_animation.setKeyValueAt(0.4, 1.0)
        glitch_animation.setKeyValueAt(0.5, 0.5)
        glitch_animation.setKeyValueAt(0.6, 1.0)
        glitch_animation.setKeyValueAt(0.7, 0.2)
        glitch_animation.setKeyValueAt(0.8, 1.0)
        glitch_animation.setKeyValueAt(0.9, 0.8)
        glitch_animation.setEndValue(1.0)
        glitch_animation.setEasingCurve(QtCore.QEasingCurve.Type.Linear)
        glitch_animation.setLoopCount(-1)
        glitch_animation.start()
        
        widget._cyberpunk_glitch_animation = glitch_animation
    except Exception:
        pass

# ===== EFFETS VISUELS MODERNES AVANCÃ‰S =====

class AdvancedParticleSystem(QtWidgets.QWidget):
    """SystÃ¨me de particules avancÃ© pour effets visuels modernes"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.particles = []
        self.timer = QtCore.QTimer()
        self.timer.timeout.connect(self.update_particles)
        self.timer.start(16)  # 60 FPS
        self.setAttribute(QtCore.Qt.WidgetAttribute.WA_TransparentForMouseEvents)
        
    def add_particle(self, x, y, particle_type="sparkle"):
        """Ajoute une nouvelle particule"""
        import random
        particle = {
            'x': x,
            'y': y,
            'vx': random.uniform(-3, 3),
            'vy': random.uniform(-3, 3),
            'size': random.uniform(2, 6),
            'opacity': random.uniform(0.7, 1.0),
            'life': 1.0,
            'decay': random.uniform(0.01, 0.03),
            'type': particle_type,
            'color': self.get_particle_color(particle_type)
        }
        self.particles.append(particle)
    
    def get_particle_color(self, particle_type):
        """Retourne la couleur selon le type de particule"""
        colors = {
            'sparkle': QtGui.QColor(255, 255, 255, 200),
            'fire': QtGui.QColor(255, 100, 0, 180),
            'ice': QtGui.QColor(0, 200, 255, 160),
            'electric': QtGui.QColor(255, 255, 0, 200),
            'magic': QtGui.QColor(255, 0, 255, 180),
            'neon': QtGui.QColor(0, 255, 136, 200)
        }
        return colors.get(particle_type, colors['sparkle'])
    
    def update_particles(self):
        """Met Ã  jour toutes les particules"""
        for particle in self.particles[:]:
            particle['x'] += particle['vx']
            particle['y'] += particle['vy']
            particle['life'] -= particle['decay']
            
            # Supprimer les particules mortes
            if particle['life'] <= 0:
                self.particles.remove(particle)
                continue
            
            # Effet de gravitÃ© pour certains types
            if particle['type'] in ['fire', 'magic']:
                particle['vy'] += 0.1
            
            # Effet de flottement pour d'autres
            if particle['type'] in ['ice', 'sparkle']:
                particle['vy'] -= 0.05
        
        self.update()
    
    def paintEvent(self, event):
        """Dessine toutes les particules"""
        painter = QtGui.QPainter(self)
        painter.setRenderHint(QtGui.QPainter.RenderHint.Antialiasing)
        
        for particle in self.particles:
            painter.setOpacity(particle['opacity'] * particle['life'])
            painter.setBrush(particle['color'])
            painter.setPen(QtCore.Qt.PenStyle.NoPen)
            
            size = particle['size'] * particle['life']
            painter.drawEllipse(
                int(particle['x'] - size/2),
                int(particle['y'] - size/2),
                int(size),
                int(size)
            )

class ModernTransitionEffect(QtWidgets.QWidget):
    """Effet de transition moderne entre les Ã©lÃ©ments"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.transition_type = "slide"
        self.duration = 1000
        self.timer = QtCore.QTimer()
        self.timer.timeout.connect(self.update_transition)
        self.current_frame = 0
        self.total_frames = 60
        
    def start_transition(self, transition_type="slide", duration=1000):
        """DÃ©marre une transition"""
        self.transition_type = transition_type
        self.duration = duration
        self.current_frame = 0
        self.total_frames = int(duration / 16)  # 60 FPS
        self.timer.start(16)
        
    def update_transition(self):
        """Met Ã  jour la transition"""
        self.current_frame += 1
        if self.current_frame >= self.total_frames:
            self.timer.stop()
            self.current_frame = 0
        self.update()
    
    def paintEvent(self, event):
        """Dessine l'effet de transition"""
        painter = QtGui.QPainter(self)
        painter.setRenderHint(QtGui.QPainter.RenderHint.Antialiasing)
        
        progress = self.current_frame / self.total_frames if self.total_frames > 0 else 0
        
        if self.transition_type == "slide":
            self.draw_slide_transition(painter, progress)
        elif self.transition_type == "fade":
            self.draw_fade_transition(painter, progress)
        elif self.transition_type == "zoom":
            self.draw_zoom_transition(painter, progress)
        elif self.transition_type == "spiral":
            self.draw_spiral_transition(painter, progress)
    
    def draw_slide_transition(self, painter, progress):
        """Dessine une transition de glissement"""
        width = self.width()
        height = self.height()
        
        # Effet de glissement horizontal
        offset = int(width * progress)
        painter.setOpacity(1.0 - progress)
        painter.fillRect(offset, 0, width - offset, height, QtGui.QColor(0, 0, 0, 200))
    
    def draw_fade_transition(self, painter, progress):
        """Dessine une transition de fondu"""
        painter.setOpacity(progress)
        painter.fillRect(0, 0, self.width(), self.height(), QtGui.QColor(0, 0, 0, 255))
    
    def draw_zoom_transition(self, painter, progress):
        """Dessine une transition de zoom"""
        center_x = self.width() // 2
        center_y = self.height() // 2
        
        # Effet de zoom circulaire
        radius = int(min(self.width(), self.height()) * progress)
        painter.setOpacity(1.0 - progress)
        painter.setBrush(QtGui.QColor(0, 0, 0, 200))
        painter.setPen(QtCore.Qt.PenStyle.NoPen)
        painter.drawEllipse(center_x - radius, center_y - radius, radius * 2, radius * 2)
    
    def draw_spiral_transition(self, painter, progress):
        """Dessine une transition en spirale"""
        center_x = self.width() // 2
        center_y = self.height() // 2
        
        painter.setOpacity(1.0 - progress)
        painter.setPen(QtGui.QPen(QtGui.QColor(0, 255, 136, 200), 3))
        
        # Dessiner une spirale
        for i in range(int(360 * progress)):
            angle = math.radians(i)
            radius = i * 0.5
            x = center_x + radius * math.cos(angle)
            y = center_y + radius * math.sin(angle)
            painter.drawPoint(int(x), int(y))

class HolographicDisplay(QtWidgets.QWidget):
    """Affichage holographique futuriste"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.hologram_data = []
        self.scan_line = 0
        self.timer = QtCore.QTimer()
        self.timer.timeout.connect(self.update_hologram)
        self.timer.start(50)  # 20 FPS
        
    def add_hologram_text(self, text, x, y, color=QtGui.QColor(0, 255, 136)):
        """Ajoute du texte holographique"""
        self.hologram_data.append({
            'type': 'text',
            'text': text,
            'x': x,
            'y': y,
            'color': color,
            'opacity': 0.8
        })
    
    def add_hologram_line(self, x1, y1, x2, y2, color=QtGui.QColor(0, 255, 136)):
        """Ajoute une ligne holographique"""
        self.hologram_data.append({
            'type': 'line',
            'x1': x1, 'y1': y1,
            'x2': x2, 'y2': y2,
            'color': color,
            'opacity': 0.6
        })
    
    def update_hologram(self):
        """Met Ã  jour l'affichage holographique"""
        self.scan_line = (self.scan_line + 1) % self.height()
        self.update()
    
    def paintEvent(self, event):
        """Dessine l'affichage holographique"""
        painter = QtGui.QPainter(self)
        painter.setRenderHint(QtGui.QPainter.RenderHint.Antialiasing)
        
        # Effet de scan line
        painter.setOpacity(0.3)
        painter.setPen(QtGui.QPen(QtGui.QColor(0, 255, 136, 100), 2))
        painter.drawLine(0, self.scan_line, self.width(), self.scan_line)
        
        # Dessiner les Ã©lÃ©ments holographiques
        for item in self.hologram_data:
            painter.setOpacity(item['opacity'])
            painter.setPen(QtGui.QPen(item['color'], 2))
            
            if item['type'] == 'text':
                painter.drawText(item['x'], item['y'], item['text'])
            elif item['type'] == 'line':
                painter.drawLine(item['x1'], item['y1'], item['x2'], item['y2'])

def create_modern_button(text, parent=None, style="neon"):
    """CrÃ©e un bouton moderne avec effets visuels"""
    button = QtWidgets.QPushButton(text, parent)
    
    if style == "neon":
        button.setStyleSheet("""
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.3),
                    stop:1 rgba(0, 255, 136, 0.1));
                border: 2px solid rgba(0, 255, 136, 0.6);
                border-radius: 15px;
                color: white;
                font-weight: bold;
                font-size: 14px;
                padding: 12px 20px;
                min-height: 40px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.5),
                    stop:1 rgba(0, 255, 136, 0.3));
                border: 2px solid rgba(0, 255, 136, 0.9);
                box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            }
            QPushButton:pressed {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.7),
                    stop:1 rgba(0, 255, 136, 0.5));
            }
        """)
    elif style == "cyberpunk":
        button.setStyleSheet("""
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 0, 255, 0.3),
                    stop:1 rgba(255, 0, 255, 0.1));
                border: 2px solid rgba(255, 0, 255, 0.6);
                border-radius: 10px;
                color: white;
                font-weight: bold;
                font-size: 14px;
                padding: 12px 20px;
                min-height: 40px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 0, 255, 0.5),
                    stop:1 rgba(255, 0, 255, 0.3));
                border: 2px solid rgba(255, 0, 255, 0.9);
            }
        """)
    elif style == "holographic":
        button.setStyleSheet("""
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 200, 255, 0.2),
                    stop:1 rgba(0, 200, 255, 0.05));
                border: 2px solid rgba(0, 200, 255, 0.4);
                border-radius: 20px;
                color: white;
                font-weight: bold;
                font-size: 14px;
                padding: 12px 20px;
                min-height: 40px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 200, 255, 0.4),
                    stop:1 rgba(0, 200, 255, 0.2));
                border: 2px solid rgba(0, 200, 255, 0.8);
            }
        """)
    
    return button

def apply_modern_effects_to_widget(widget, effect_type="glass"):
    """Applique des effets modernes Ã  un widget"""
    if effect_type == "glass":
        glass_float_animation(widget, 4000)
        shimmer_effect(widget, 3000)
    elif effect_type == "neon":
        neon_glow_animation(widget, 2000)
    elif effect_type == "holographic":
        holographic_effect(widget, 3000)
    elif effect_type == "cyberpunk":
        cyberpunk_glitch_effect(widget, 1500)
    elif effect_type == "quantum":
        quantum_entanglement_effect(widget, 2500)
    elif effect_type == "matrix":
        matrix_rain_effect(widget, 4000)

# Appliquer les corrections
ensure_files()
sys.excepthook = handle_exception

# Ajouter addSeparator aux layouts
QtWidgets.QHBoxLayout.addSeparator = _layout_addSeparator
QtWidgets.QVBoxLayout.addSeparator = _layout_addSeparator

# Forcer la mise Ã  jour de la version dans le state
def update_version_in_state():
    """Met Ã  jour la version dans le fichier state.json"""
    try:
        # Mettre Ã  jour sans Ã©craser les clÃ©s existantes (prÃ©serve login_password_hash)
        try:
            current = json.loads(STATE_FILE.read_text(encoding="utf-8"))
        except Exception:
            current = {}
        current.setdefault("theme", "dark")
        current.setdefault("features", {})
        current["version"] = DEFAULT_LOCAL_VERSION
        current["last_update_check"] = time.strftime("%Y-%m-%d %H:%M:%S")
        current["force_updated"] = True
        write_state(current)
        print(f"State mis Ã  jour vers version {DEFAULT_LOCAL_VERSION} (prÃ©servation des clÃ©s)")
    except Exception as e:
        print(f"Erreur lors de la mise Ã  jour forcÃ©e: {e}")

# ===== Gestion d'Ã©tat =====

def read_state() -> Dict[str, Any]:
    try:
        return json.loads(STATE_FILE.read_text(encoding="utf-8"))
    except Exception:
        pass
    
    st = {"version": DEFAULT_LOCAL_VERSION, "theme": "dark"}
    write_state(st)
    return st



def write_state(state: Dict[str, Any]):
    try:
        STATE_FILE.write_text(json.dumps(state, indent=2, ensure_ascii=False), encoding="utf-8")
    except Exception:
        pass

# Appliquer la mise Ã  jour de version maintenant que write_state est dÃ©finie
update_version_in_state()

def ensure_store() -> Dict[str, Any]:
    """Assure que le store existe et retourne les donnÃ©es"""
    if not STORE_FILE.exists():
        # CrÃ©er le store avec des donnÃ©es par dÃ©faut
        default_store = {
            "apps": [
                {"id": "paint", "name": "Ragnar Paint", "desc": "Dessine en verre âœï¸", "installed": False},
                {"id": "notes", "name": "Ragnar Notes", "desc": "Notes rapides", "installed": False},
                {"id": "calc", "name": "Ragnar Calc", "desc": "Calculatrice avancÃ©e", "installed": False},
                {"id": "browser", "name": "Ragnar Browser", "desc": "Navigateur web", "installed": False},
                {"id": "terminal", "name": "Ragnar Terminal", "desc": "Terminal systÃ¨me", "installed": False},
            ],
            "installed": []
        }
        try:
            STORE_FILE.write_text(json.dumps(default_store, indent=2), encoding="utf-8")
        except Exception:
            pass
    
    return read_store()

def read_store() -> Dict[str, Any]:
    if STORE_FILE.exists():
        try:
            return json.loads(STORE_FILE.read_text(encoding="utf-8"))
        except Exception:
            pass

    data = {

        "apps": [

            {"id": "paint", "name": "Ragnar Paint", "desc": "Dessine en verre âœï¸", "installed": False},

            {"id": "notes", "name": "Ragnar Notes", "desc": "Notes rapides", "installed": False},

            {"id": "term", "name": "Ragnar Terminal", "desc": "Console mini", "installed": False},

        ]

    }

    STORE_FILE.write_text(json.dumps(data, ensure_ascii=False, indent=2), encoding="utf-8")

    return data



# ====== Style ======

GLASS_CSS = """

* { color: #eaecf3; font-family: 'Segoe UI', 'Inter', system-ui; }

QWidget#GlassCard {

  background: rgba(255,255,255,0.10);

  border: 1px solid rgba(255,255,255,0.25);

  border-radius: 16px;

}

QProgressBar {

  background: rgba(255,255,255,0.12);

  border: 1px solid rgba(255,255,255,0.25);

  border-radius: 999px;

  padding: 2px;

}

QProgressBar::chunk {

  background: qlineargradient(x1:0,y1:0,x2:1,y2:0,

    stop:0 rgba(0,255,255,0.9), stop:1 rgba(180,0,255,0.9));

  border-radius: 999px;

}

QPushButton {

  background: rgba(255,255,255,0.10);

  border: 1px solid rgba(255,255,255,0.25);

  border-radius: 12px;

  padding: 8px 14px;

}

QPushButton:hover { background: rgba(255,255,255,0.18); }

QLineEdit, QTextEdit, QPlainTextEdit, QComboBox {

  background: rgba(255,255,255,0.08);

  border: 1px solid rgba(255,255,255,0.25);

  border-radius: 10px;

  padding: 6px 10px;

}

QListWidget, QTableWidget {

  background: rgba(255,255,255,0.06);

  border: 1px solid rgba(255,255,255,0.20);

  border-radius: 10px;

}

"""



# Gradients de fond avec effets de lumiÃ¨re et verre
DARK_BG_GRADIENT = QtGui.QRadialGradient(0.5, 0.35, 0.9)
DARK_BG_GRADIENT.setCoordinateMode(QtGui.QGradient.CoordinateMode.ObjectBoundingMode)
DARK_BG_GRADIENT.setColorAt(0.0, QtGui.QColor(28, 38, 58))  # Halo doux bleu
DARK_BG_GRADIENT.setColorAt(0.25, QtGui.QColor(18, 26, 44)) # Bleu profond
DARK_BG_GRADIENT.setColorAt(0.6, QtGui.QColor(10, 16, 28))  # Bleu sombre
DARK_BG_GRADIENT.setColorAt(1.0, QtGui.QColor(4, 6, 12))    # Presque noir

# Gradient avec effets de lumiÃ¨re
LIGHT_BG_GRADIENT = QtGui.QRadialGradient(0.5, 0.3, 1.0)
LIGHT_BG_GRADIENT.setCoordinateMode(QtGui.QGradient.CoordinateMode.ObjectBoundingMode)
LIGHT_BG_GRADIENT.setColorAt(0.0, QtGui.QColor(30, 35, 50))  # Centre lumineux
LIGHT_BG_GRADIENT.setColorAt(0.3, QtGui.QColor(20, 25, 40))  # Bleu profond
LIGHT_BG_GRADIENT.setColorAt(0.7, QtGui.QColor(10, 15, 25))  # Bleu sombre
LIGHT_BG_GRADIENT.setColorAt(1.0, QtGui.QColor(5, 8, 15))    # Bleu trÃ¨s sombre

# Gradient arc-en-ciel pour les effets spÃ©ciaux
RAINBOW_BG_GRADIENT = QtGui.QLinearGradient(0, 0, 1, 1)
RAINBOW_BG_GRADIENT.setCoordinateMode(QtGui.QGradient.CoordinateMode.ObjectBoundingMode)
RAINBOW_BG_GRADIENT.setColorAt(0.0, QtGui.QColor(25, 15, 40))  # Violet profond
RAINBOW_BG_GRADIENT.setColorAt(0.3, QtGui.QColor(20, 25, 45))  # Bleu profond
RAINBOW_BG_GRADIENT.setColorAt(0.6, QtGui.QColor(15, 30, 35))  # Bleu-vert profond
RAINBOW_BG_GRADIENT.setColorAt(1.0, QtGui.QColor(10, 20, 30))  # Bleu-vert sombre



def make_header(text: str, sub: str = "") -> QtWidgets.QWidget:
    """CrÃ©e un en-tÃªte moderne avec effets de verre et dÃ©gradÃ©s"""
    w = QtWidgets.QWidget()
    w.setObjectName("GlassCard")
    
    # Style amÃ©liorÃ© pour l'en-tÃªte
    w.setStyleSheet("""
        QWidget#GlassCard {
            background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                stop:0 rgba(255, 255, 255, 0.15),
                stop:0.5 rgba(255, 255, 255, 0.08),
                stop:1 rgba(255, 255, 255, 0.04));
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 16px;
        }
    """)

    lay = QtWidgets.QVBoxLayout(w)
    lay.setContentsMargins(20, 20, 20, 20)
    lay.setSpacing(8)

    # Titre avec dÃ©gradÃ© moderne
    title = QtWidgets.QLabel(
        f"<span style='font-size:24px;font-weight:900;"
        "background: qlineargradient(x1:0, y1:0, x2:1, y2:0, "
        "stop:0 rgba(0, 255, 255, 1), "
        "stop:0.5 rgba(255, 0, 255, 1), "
        "stop:1 rgba(0, 255, 136, 1));"
        "color: transparent;'>"
        f"{text}</span>"
    )
    title.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)

    # Sous-titre avec style moderne
    if sub:
        subl = QtWidgets.QLabel(sub)
        subl.setStyleSheet("""
            color: rgba(255, 255, 255, 0.85);
            font-size: 14px;
            font-weight: 500;
            padding: 4px;
        """)
        subl.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        lay.addWidget(subl)

    lay.addWidget(title)
    
    return w



# ====== Boot ======

class BootPage(QtWidgets.QWidget):

    finished = QtCore.pyqtSignal()

    def __init__(self, parent=None):

        super().__init__(parent)

        self.setAutoFillBackground(True)
        # Pour capter les sÃ©quences de touches secrÃ¨tes
        self.setFocusPolicy(QtCore.Qt.FocusPolicy.StrongFocus)
        self._secret_seq = []  # stocke les derniÃ¨res touches
        self._secret_last_ts = 0

        # CrÃ©er un gradient animÃ© plus beau
        self.animated_gradient = QtGui.QLinearGradient(0, 0, 0, 1)
        self.animated_gradient.setCoordinateMode(QtGui.QGradient.CoordinateMode.ObjectBoundingMode)
        self.animated_gradient.setColorAt(0.0, QtGui.QColor(20, 25, 40))
        self.animated_gradient.setColorAt(0.5, QtGui.QColor(10, 15, 25))
        self.animated_gradient.setColorAt(1.0, QtGui.QColor(5, 8, 15))

        p = self.palette()
        p.setBrush(self.backgroundRole(), QtGui.QBrush(self.animated_gradient))
        self.setPalette(p)

        self.setStyleSheet(GLASS_CSS)

        # CrÃ©er le conteneur principal avec effet de verre amÃ©liorÃ©
        card = QtWidgets.QWidget(objectName="GlassCard")
        card.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.15),
                    stop:1 rgba(255, 255, 255, 0.05));
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 25px;
                padding: 20px;
            }
        """)

        v = QtWidgets.QVBoxLayout(card)
        v.setContentsMargins(40, 40, 40, 40)
        v.setSpacing(20)

        # Logo animÃ© avec effet de brillance
        self.logo = QtWidgets.QLabel("âš¡")
        self.logo.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        self.logo.setStyleSheet("""
            font-size: 96px;
            color: qlineargradient(x1:0, y1:0, x2:1, y2:1,
                stop:0 rgba(0, 255, 255, 1),
                stop:0.5 rgba(255, 0, 255, 1),
                stop:1 rgba(0, 255, 136, 1));
            font-weight: bold;
        """)

        # Titre avec effet de dÃ©gradÃ©
        self.title = QtWidgets.QLabel("RAGNAR OS 26")
        self.title.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        self.title.setStyleSheet("""
            font-size: 32px;
            font-weight: 900;
            color: qlineargradient(x1:0, y1:0, x2:1, y2:0,
                stop:0 rgba(0, 255, 255, 1),
                stop:1 rgba(255, 0, 255, 1));
            letter-spacing: 3px;
        """)

        # Sous-titre
        self.subtitle = QtWidgets.QLabel("SystÃ¨me d'exploitation rÃ©volutionnaire")
        self.subtitle.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        self.subtitle.setStyleSheet("""
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 300;
        """)

        # Barre de progression animÃ©e
        self.loader = QtWidgets.QProgressBar()
        self.loader.setRange(0, 100)
        self.loader.setValue(0)
        self.loader.setStyleSheet("""
            QProgressBar {
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 15px;
                background: rgba(0, 0, 0, 0.3);
                text-align: center;
                color: white;
                font-weight: bold;
                font-size: 12px;
                height: 25px;
            }
            QProgressBar::chunk {
                background: qlineargradient(x1:0, y1:0, x2:1, y2:0,
                    stop:0 rgba(0, 255, 255, 0.9),
                    stop:0.5 rgba(255, 0, 255, 0.9),
                    stop:1 rgba(0, 255, 136, 0.9));
                border-radius: 13px;
            }
        """)

        # Message de statut
        self.msg = QtWidgets.QLabel("Initialisation du systÃ¨me...")
        self.msg.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        self.msg.setStyleSheet("""
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-weight: 500;
        """)

        # Ajouter tous les Ã©lÃ©ments
        v.addWidget(self.logo)
        v.addWidget(self.title)
        v.addWidget(self.subtitle)
        v.addSpacing(20)
        v.addWidget(self.msg)
        v.addWidget(self.loader)

        # Layout principal
        root = QtWidgets.QVBoxLayout(self)
        root.setContentsMargins(50, 50, 50, 50)
        root.addStretch(1)
        root.addWidget(card)
        root.addStretch(2)

        # DÃ©marrer les animations
        self.start_animations()
        
        # DÃ©marrer la sÃ©quence de dÃ©marrage
        self.start_boot_sequence()

    def start_animations(self):
        """DÃ©marre les animations du logo et du gradient"""
        # Animation de pulsation du logo
        self.logo_animation = QtCore.QPropertyAnimation(self.logo, b"geometry")
        self.logo_animation.setDuration(2000)
        self.logo_animation.setLoopCount(-1)
        
        # Animation de rotation du gradient de fond
        self.gradient_animation = QtCore.QPropertyAnimation(self, b"geometry")
        self.gradient_animation.setDuration(10000)
        self.gradient_animation.setLoopCount(-1)

    def start_boot_sequence(self):
        """SÃ©quence de dÃ©marrage avec messages et progression"""
        self.boot_messages = [
            ("Initialisation du systÃ¨me...", 10),
            ("Chargement du noyau...", 25),
            ("DÃ©marrage des services...", 40),
            ("Initialisation de l'interface...", 60),
            ("Chargement des applications...", 80),
            ("Finalisation...", 95),
            ("PrÃªt !", 100)
        ]
        
        self.current_step = 0
        self.boot_timer = QtCore.QTimer()
        self.boot_timer.timeout.connect(self.update_boot_progress)
        self.boot_timer.start(400)  # Mise Ã  jour toutes les 400ms

    def update_boot_progress(self):
        """Met Ã  jour la progression du dÃ©marrage"""
        if self.current_step < len(self.boot_messages):
            message, progress = self.boot_messages[self.current_step]
            self.msg.setText(message)
            self.loader.setValue(progress)
            self.current_step += 1
        else:
            self.boot_timer.stop()
            # Attendre un peu avant de terminer
            QtCore.QTimer.singleShot(800, self.finished.emit)



# ====== Effets visuels avancÃ©s ======

class LightEffect(QtWidgets.QWidget):
    """Effet de lumiÃ¨re animÃ©e pour les Ã©lÃ©ments de verre"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.lights = []
        self.timer = QtCore.QTimer()
        self.timer.timeout.connect(self.update_lights)
        self.timer.start(100)  # 10 FPS
        
        # CrÃ©er des lumiÃ¨res initiales
        for _ in range(8):
            self.add_light()
    
    def add_light(self):
        """Ajoute une nouvelle source de lumiÃ¨re"""
        import random
        light = {
            'x': random.randint(0, self.width() if self.width() > 0 else 800),
            'y': random.randint(0, self.height() if self.height() > 0 else 600),
            'vx': random.uniform(-2, 2),
            'vy': random.uniform(-2, 2),
            'size': random.uniform(20, 60),
            'opacity': random.uniform(0.1, 0.4),
            'color': random.choice([
                QtGui.QColor(0, 255, 136, 150),
                QtGui.QColor(0, 255, 255, 150),
                QtGui.QColor(255, 0, 255, 150),
                QtGui.QColor(255, 255, 0, 150),
                QtGui.QColor(255, 100, 0, 150)
            ]),
            'pulse_speed': random.uniform(0.02, 0.05),
            'pulse_phase': random.uniform(0, 6.28)
        }
        self.lights.append(light)
    
    def update_lights(self):
        """Met Ã  jour les lumiÃ¨res"""
        for light in self.lights:
            light['x'] += light['vx']
            light['y'] += light['vy']
            
            # Rebond sur les bords
            if light['x'] < 0 or light['x'] > self.width():
                light['vx'] *= -1
            if light['y'] < 0 or light['y'] > self.height():
                light['vy'] *= -1
            
            # Garder dans les limites
            light['x'] = max(0, min(self.width(), light['x']))
            light['y'] = max(0, min(self.height(), light['y']))
            
            # Animation de pulsation
            light['pulse_phase'] += light['pulse_speed']
            light['opacity'] = 0.1 + 0.3 * abs(math.sin(light['pulse_phase']))
        
        self.update()
    
    def paintEvent(self, event):
        """Dessine les lumiÃ¨res"""
        painter = QtGui.QPainter(self)
        painter.setRenderHint(QtGui.QPainter.RenderHint.Antialiasing)
        
        for light in self.lights:
            # CrÃ©er un gradient radial pour l'effet de lumiÃ¨re
            gradient = QtGui.QRadialGradient(light['x'], light['y'], light['size'])
            gradient.setColorAt(0.0, light['color'])
            gradient.setColorAt(0.5, QtGui.QColor(light['color'].red(), light['color'].green(), light['color'].blue(), 50))
            gradient.setColorAt(1.0, QtGui.QColor(light['color'].red(), light['color'].green(), light['color'].blue(), 0))
            
            painter.setBrush(QtGui.QBrush(gradient))
            painter.setPen(QtCore.Qt.PenStyle.NoPen)
            painter.drawEllipse(
                int(light['x'] - light['size']),
                int(light['y'] - light['size']),
                int(light['size'] * 2),
                int(light['size'] * 2)
            )

class ParticleEffect(QtWidgets.QWidget):
    """Effet de particules flottantes pour l'arriÃ¨re-plan"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.particles = []
        self.timer = QtCore.QTimer()
        self.timer.timeout.connect(self.update_particles)
        self.timer.start(50)  # 20 FPS
        
        # CrÃ©er des particules initiales
        for _ in range(20):
            self.add_particle()
    
    def add_particle(self):
        """Ajoute une nouvelle particule"""
        import random
        particle = {
            'x': random.randint(0, self.width() if self.width() > 0 else 800),
            'y': random.randint(0, self.height() if self.height() > 0 else 600),
            'vx': random.uniform(-1, 1),
            'vy': random.uniform(-1, 1),
            'size': random.uniform(1, 3),
            'opacity': random.uniform(0.1, 0.3),
            'color': random.choice([
                QtGui.QColor(0, 255, 136, 100),
                QtGui.QColor(0, 255, 255, 100),
                QtGui.QColor(255, 0, 255, 100),
                QtGui.QColor(255, 255, 255, 100)
            ])
        }
        self.particles.append(particle)
    
    def update_particles(self):
        """Met Ã  jour la position des particules"""
        for particle in self.particles:
            particle['x'] += particle['vx']
            particle['y'] += particle['vy']
            
            # Rebond sur les bords
            if particle['x'] < 0 or particle['x'] > self.width():
                particle['vx'] *= -1
            if particle['y'] < 0 or particle['y'] > self.height():
                particle['vy'] *= -1
            
            # Garder dans les limites
            particle['x'] = max(0, min(self.width(), particle['x']))
            particle['y'] = max(0, min(self.height(), particle['y']))
        
        self.update()
    
    def paintEvent(self, event):
        """Dessine les particules"""
        painter = QtGui.QPainter(self)
        painter.setRenderHint(QtGui.QPainter.RenderHint.Antialiasing)
        
        for particle in self.particles:
            painter.setOpacity(particle['opacity'])
            painter.setBrush(particle['color'])
            painter.setPen(QtCore.Qt.PenStyle.NoPen)
            painter.drawEllipse(
                int(particle['x'] - particle['size']),
                int(particle['y'] - particle['size']),
                int(particle['size'] * 2),
                int(particle['size'] * 2)
            )

class GlowEffect(QtWidgets.QGraphicsEffect):
    """Effet de lueur pour les widgets"""
    
    def __init__(self, color=QtGui.QColor(0, 255, 136, 100), radius=10):
        super().__init__()
        self.color = color
        self.radius = radius
    
    def draw(self, painter):
        """Dessine l'effet de lueur"""
        # ImplÃ©mentation simplifiÃ©e de l'effet de lueur
        painter.setRenderHint(QtGui.QPainter.RenderHint.Antialiasing)
        painter.setBrush(self.color)
        painter.setPen(QtCore.Qt.PenStyle.NoPen)
        
        # Dessiner plusieurs cercles avec opacitÃ© dÃ©croissante
        for i in range(self.radius):
            opacity = (self.radius - i) / self.radius * 0.3
            painter.setOpacity(opacity)
            painter.drawEllipse(
                -i, -i, 
                self.sourceBoundingRect().width() + 2*i,
                self.sourceBoundingRect().height() + 2*i
            )

# ====== Classe PaintCanvas pour le dessin ======

class PaintCanvas(QtWidgets.QWidget):
    """Canvas de dessin fonctionnel pour Ragnar Paint"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setMinimumSize(400, 300)
        
        # Variables de dessin
        self.drawing = False
        self.last_point = QtCore.QPoint()
        self.current_tool = "brush"
        self.current_color = QtGui.QColor(0, 0, 0)
        self.brush_size = 5
        
        # Image pour stocker le dessin
        self.image = QtGui.QPixmap(800, 600)
        self.image.fill(QtGui.QColor(255, 255, 255))
        
        # Variables pour les formes
        self.start_point = QtCore.QPoint()
        self.temp_image = None
        
    def paintEvent(self, event):
        """Dessine le contenu du canvas"""
        painter = QtGui.QPainter(self)
        painter.drawPixmap(self.rect(), self.image)
        
        # Dessiner la forme temporaire si nÃ©cessaire
        if self.temp_image and self.current_tool in ["line", "rectangle", "circle"]:
            painter.drawPixmap(self.rect(), self.temp_image)
    
    def mousePressEvent(self, event):
        """Gestion du clic de souris"""
        if event.button() == QtCore.Qt.MouseButton.LeftButton:
            self.drawing = True
            self.last_point = event.pos()
            self.start_point = event.pos()
            
            if self.current_tool in ["line", "rectangle", "circle"]:
                self.temp_image = self.image.copy()
    
    def mouseMoveEvent(self, event):
        """Gestion du mouvement de souris"""
        if (event.buttons() & QtCore.Qt.MouseButton.LeftButton) and self.drawing:
            if self.current_tool in ["brush", "pencil", "eraser"]:
                self.draw_line(self.last_point, event.pos())
                self.last_point = event.pos()
            elif self.current_tool in ["line", "rectangle", "circle"]:
                self.draw_temp_shape(self.start_point, event.pos())
    
    def mouseReleaseEvent(self, event):
        """Gestion du relÃ¢chement de souris"""
        if event.button() == QtCore.Qt.MouseButton.LeftButton and self.drawing:
            if self.current_tool in ["line", "rectangle", "circle"]:
                self.draw_final_shape(self.start_point, event.pos())
                self.temp_image = None
            self.drawing = False
    
    def draw_line(self, start, end):
        """Dessine une ligne"""
        painter = QtGui.QPainter(self.image)
        painter.setPen(QtGui.QPen(self.current_color, self.brush_size, 
                                 QtCore.Qt.PenStyle.SolidLine, QtCore.Qt.PenCapStyle.RoundCap))
        painter.drawLine(start, end)
        self.update()
    
    def draw_temp_shape(self, start, end):
        """Dessine une forme temporaire"""
        if not self.temp_image:
            return
            
        painter = QtGui.QPainter(self.temp_image)
        painter.setPen(QtGui.QPen(self.current_color, self.brush_size))
        
        if self.current_tool == "line":
            painter.drawLine(start, end)
        elif self.current_tool == "rectangle":
            painter.drawRect(QtCore.QRect(start, end))
        elif self.current_tool == "circle":
            painter.drawEllipse(QtCore.QRect(start, end))
        
        self.update()
    
    def draw_final_shape(self, start, end):
        """Dessine la forme finale"""
        painter = QtGui.QPainter(self.image)
        painter.setPen(QtGui.QPen(self.current_color, self.brush_size))
        
        if self.current_tool == "line":
            painter.drawLine(start, end)
        elif self.current_tool == "rectangle":
            painter.drawRect(QtCore.QRect(start, end))
        elif self.current_tool == "circle":
            painter.drawEllipse(QtCore.QRect(start, end))
        
        self.update()
    
    def set_tool(self, tool):
        """Change l'outil de dessin"""
        self.current_tool = tool
        if tool == "eraser":
            self.current_color = QtGui.QColor(255, 255, 255)
    
    def set_color(self, color):
        """Change la couleur"""
        self.current_color = color
        if self.current_tool == "eraser":
            self.current_tool = "brush"  # Revenir au pinceau aprÃ¨s avoir choisi une couleur
    
    def set_brush_size(self, size):
        """Change la taille du pinceau"""
        self.brush_size = size
    
    def clear_canvas(self):
        """Efface tout le canvas"""
        self.image.fill(QtGui.QColor(255, 255, 255))
        self.update()

# ====== FenÃªtres principales ======

class GlassDialog(QtWidgets.QDialog):

    def __init__(self, title="FenÃªtre", size=(520, 360), parent=None):

        super().__init__(parent)

        self.setObjectName("GlassCard")

        self.setWindowTitle(title)

        self.setModal(False)

        self.setMinimumSize(*size)

        self.setStyleSheet(RAGNAR_MODERN_STYLE)

        shadow = QtWidgets.QGraphicsDropShadowEffect(

            blurRadius=40, xOffset=0, yOffset=10, color=QtGui.QColor(0, 0, 0, 160)

        )

        self.setGraphicsEffect(shadow)



# ====== Desktop principal ======

class DesktopPage(QtWidgets.QWidget):

    def __init__(self, parent=None):

        super().__init__(parent)

        self.setAutoFillBackground(True)
        # Ã‰tat pour la sÃ©quence secrÃ¨te (flÃ¨che haut, flÃ¨che bas)
        self.setFocusPolicy(QtCore.Qt.FocusPolicy.StrongFocus)
        self._secret_seq = []
        self._secret_last_ts = 0
        
        # Charger le fond d'Ã©cran personnalisÃ© ou utiliser le dÃ©faut
        self.load_wallpaper()
        
        # Initialiser avec le gradient par dÃ©faut
        self.default_gradient = DARK_BG_GRADIENT
        self.apply_background()

        self.setStyleSheet(GLASS_CSS)
        
        # Ajouter des effets de particules en arriÃ¨re-plan
        self.particle_effect = ParticleEffect(self)
        self.particle_effect.setGeometry(0, 0, 1000, 600)
        self.particle_effect.lower()  # Mettre en arriÃ¨re-plan
        
        # Ajouter des effets de lumiÃ¨re
        self.light_effect = LightEffect(self)
        self.light_effect.setGeometry(0, 0, 1000, 600)
        self.light_effect.lower()  # Mettre en arriÃ¨re-plan
        
        # DÃ©marrer les animations aprÃ¨s un court dÃ©lai
        QtCore.QTimer.singleShot(1000, self.start_desktop_animations)

        # Activer le menu contextuel sur clic droit
        self.setContextMenuPolicy(QtCore.Qt.ContextMenuPolicy.CustomContextMenu)
        self.customContextMenuRequested.connect(self.show_context_menu)



        top = QtWidgets.QWidget(objectName="GlassCard")

        tlay = QtWidgets.QHBoxLayout(top)

        tlay.setContentsMargins(12, 8, 12, 8)

        self.title = QtWidgets.QLabel("ðŸ’  Ragnar OS 26")

        # Bouton menu des applications
        self.menu_btn = QtWidgets.QPushButton("ðŸ“‹ Menu")
        self.menu_btn.clicked.connect(self.show_apps_menu)
        self.menu_btn.setStyleSheet("padding: 4px 8px; font-size: 11px;")

        self.clock = QtWidgets.QLabel("--:--")

        tlay.addWidget(self.title)

        tlay.addStretch(1)
        
        tlay.addWidget(self.menu_btn)

        tlay.addWidget(QtWidgets.QLabel("ðŸ•“"))

        tlay.addWidget(self.clock)



        # Barre des tÃ¢ches (refonte)
        dock = QtWidgets.QWidget(objectName="GlassCard")
        dlay = QtWidgets.QHBoxLayout(dock)
        # Style barre: moderne, arrondie, trÃ¨s compacte (icÃ´nes plus haut)
        dlay.setContentsMargins(10, 0, 10, 24)
        dlay.setSpacing(8)
        dlay.setAlignment(QtCore.Qt.AlignmentFlag.AlignTop)
        dock.setStyleSheet("""
            QWidget#GlassCard {
                background: rgba(20, 24, 36, 0.48);
                border: 1px solid rgba(255,255,255,0.18);
                border-radius: 14px;
            }
        """)

        def btn(emoji, text, cb):

            b = QtWidgets.QPushButton(f"{emoji}")

            b.setObjectName("DesktopButton")
            b.setToolTip(text)
            b.setFixedSize(52, 52)
            sp = b.sizePolicy()
            sp.setHorizontalPolicy(QtWidgets.QSizePolicy.Policy.Fixed)
            sp.setVerticalPolicy(QtWidgets.QSizePolicy.Policy.Fixed)
            b.setSizePolicy(sp)
            
            # Style moderne pour les boutons carrÃ©s compacts
            b.setStyleSheet("""
                QPushButton {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 255, 255, 0.25),
                        stop:0.5 rgba(255, 255, 255, 0.15),
                        stop:1 rgba(255, 255, 255, 0.05));
                    border: 2px solid rgba(255, 255, 255, 0.26);
                    border-radius: 10px;
                    padding: 6px;
                    font-size: 16px;
                    font-weight: 600;
                    color: white;
                    min-width: 52px;
                    min-height: 52px;
                    text-align: center;
                }
                QPushButton:hover {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(0, 255, 136, 0.3),
                        stop:0.5 rgba(0, 255, 136, 0.2),
                        stop:1 rgba(0, 255, 136, 0.1));
                    border: 2px solid rgba(0, 255, 136, 0.45);
                }
                QPushButton:pressed {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(0, 255, 136, 0.4),
                        stop:0.5 rgba(0, 255, 136, 0.3),
                        stop:1 rgba(0, 255, 136, 0.2));
                    border: 2px solid rgba(0, 255, 136, 0.6);
                }
            """)

            b.clicked.connect(cb)
            
            # DÃ©sactiver les animations qui causent le mouvement
            # b.enterEvent = lambda event: self.add_glow_effect(b)
            # b.leaveEvent = lambda event: self.remove_glow_effect(b)

            return b
        # Logo Ragnar Ã  gauche (ouvre le menu Applications)
        logo_btn = QtWidgets.QPushButton("ðŸ”·")
        logo_btn.setToolTip("Menu Ragnar")
        logo_btn.setFixedSize(28, 28)
        logo_btn.setStyleSheet("""
            QPushButton {
                background: rgba(255,255,255,0.08);
                border: 1px solid rgba(255,255,255,0.25);
                border-radius: 14px;
                font-size: 14px;
            }
            QPushButton:hover {
                background: rgba(0,255,136,0.18);
                border-color: rgba(0,255,136,0.5);
            }
        """)
        logo_btn.clicked.connect(self.show_apps_menu)
        dlay.addWidget(logo_btn)
        dlay.addSpacing(4)
        
        apps = [
            ("ðŸŒ", "Navigateur", self.show_browser),
            ("ðŸ“", "Fichiers", self.show_files),
            ("ðŸ›ï¸", "Store", self.show_store),
            ("ðŸ–¥ï¸", "SystÃ¨me", self.show_system),
            ("â¬‡ï¸", "MAJ", self.show_updater),
            ("ðŸ§©", "Config", self.show_settings)
        ]
        
        # Zone d'icÃ´nes d'applications
        apps_bar = QtWidgets.QWidget()
        apps_bar_lay = QtWidgets.QHBoxLayout(apps_bar)
        apps_bar_lay.setContentsMargins(0, 0, 0, 0)
        apps_bar_lay.setSpacing(4)
        apps_bar_lay.setAlignment(QtCore.Qt.AlignmentFlag.AlignLeft | QtCore.Qt.AlignmentFlag.AlignVCenter)
        for i, (e, t, c) in enumerate(apps):
            apps_bar_lay.addWidget(btn(e, t, c))
        dlay.addWidget(apps_bar, 1)

        # (Bouton Options supprimÃ© sur demande)

        # SÃ©lecteur multi-bureaux Ã  droite
        desktops_container = QtWidgets.QWidget()
        desktops_lay = QtWidgets.QHBoxLayout(desktops_container)
        desktops_lay.setContentsMargins(0, 0, 0, 0)
        desktops_lay.setSpacing(6)
        desktops_icon = QtWidgets.QLabel("ðŸ—”")
        desktops_icon.setToolTip("Bureaux virtuels")
        self.desktop_selector = QtWidgets.QComboBox()
        self.desktop_selector.addItems([
            "Bureau 1 - Navigateur",
            "Bureau 2 - Fichiers",
            "Bureau 3 - SystÃ¨me"
        ])
        self.desktop_selector.currentIndexChanged.connect(self.switch_virtual_desktop)
        desktops_lay.addWidget(desktops_icon)
        desktops_lay.addWidget(self.desktop_selector)
        dlay.addWidget(desktops_container, 0)



        root = QtWidgets.QVBoxLayout(self)

        root.setContentsMargins(18, 18, 18, 18)

        root.setSpacing(14)

        root.addWidget(top)

        root.addStretch(1)

        root.addWidget(dock)



        self.timer = QtCore.QTimer(self)

        self.timer.timeout.connect(self._tick)

        self.timer.start(15_000)

        self._tick()
        
        # Charger le bureau virtuel prÃ©cÃ©dent si prÃ©sent
        try:
            st = _read_state_safe()
            idx = int(st.get("current_virtual_desktop", 0))
            if 0 <= idx < self.desktop_selector.count():
                self.desktop_selector.setCurrentIndex(idx)
        except Exception:
            pass

    def switch_virtual_desktop(self, index: int):
        """Active un profil de bureau et lance l'app associÃ©e."""
        try:
            # Persister le bureau choisi
            st = _read_state_safe()
            st["current_virtual_desktop"] = int(index)
            _write_state_safe(st)
        except Exception:
            pass

        # Mappage bureau â†’ action principale
        if index == 0:
            # Bureau 1: Navigateur
            try:
                self.show_browser()
            except Exception:
                pass
        elif index == 1:
            # Bureau 2: Fichiers
            try:
                self.show_files()
            except Exception:
                pass
        elif index == 2:
            # Bureau 3: SystÃ¨me
            try:
                self.show_system()
            except Exception:
                pass



    def _tick(self):
        self.clock.setText(QtCore.QTime.currentTime().toString("HH:mm"))

    # === Dev Tool cachÃ©: sÃ©quence FlÃ¨che Haut puis FlÃ¨che Bas
    def keyPressEvent(self, event: QtGui.QKeyEvent):
        try:
            key = event.key()
            now = time.time()
            # reset si plus de 2s entre touches
            if now - self._secret_last_ts > 2.0:
                self._secret_seq = []
            self._secret_last_ts = now
            if key in (QtCore.Qt.Key.Key_Up, QtCore.Qt.Key.Key_Down):
                self._secret_seq.append(key)
                # Garder uniquement 2 derniÃ¨res
                self._secret_seq = self._secret_seq[-2:]
                if self._secret_seq == [QtCore.Qt.Key.Key_Up, QtCore.Qt.Key.Key_Down]:
                    self._secret_seq = []
                    self.show_dev_tool()
                    return
        except Exception:
            pass
        super().keyPressEvent(event)

    def show_dev_tool(self):
        try:
            d = DevToolDialog(self)
            d.show()
        except Exception as e:
            QtWidgets.QMessageBox.warning(self, "Dev Tool", f"Erreur ouverture Dev Tool: {e}")
    
    def show_dock_options_menu(self):
        menu = QtWidgets.QMenu(self)
        # Verre Ultra toggle
        st = _read_state_safe()
        ultra_enabled = bool(st.get("ultra_glass_enabled", False))
        ultra_action = menu.addAction("âœ¨ Verre Ultra: " + ("ON" if ultra_enabled else "OFF"))
        def toggle_ultra():
            s = _read_state_safe()
            s["ultra_glass_enabled"] = not bool(s.get("ultra_glass_enabled", False))
            _write_state_safe(s)
            QtWidgets.QMessageBox.information(self, "âœ¨ Verre Ultra", "ModifiÃ©. Ouvrez un module (ex: Fichiers) pour voir l'effet.")
        ultra_action.triggered.connect(toggle_ultra)

        # Rapp Bureau
        rapp_action = menu.addAction("ðŸ“¦ Lancer Rapp Bureauâ€¦")
        rapp_action.triggered.connect(self.launch_rapp_from_desktop)

        # Sandbox toggle
        sandbox_enabled = bool(st.get("sandbox_enabled", False))
        sandbox_action = menu.addAction("ðŸ”’ Sandbox: " + ("ON" if sandbox_enabled else "OFF"))
        def toggle_sandbox():
            s = _read_state_safe()
            s["sandbox_enabled"] = not bool(s.get("sandbox_enabled", False))
            _write_state_safe(s)
            QtWidgets.QMessageBox.information(self, "ðŸ”’ Sandbox", "Ã‰tat de la sandbox mis Ã  jour.")
        sandbox_action.triggered.connect(toggle_sandbox)

        menu.addSeparator()
        upd_action = menu.addAction("â¬‡ï¸ Ouvrir Updater")
        upd_action.triggered.connect(self.show_updater)
        restart_action = menu.addAction("ðŸ”„ RedÃ©marrer")
        restart_action.triggered.connect(self.restart_ragnar)

        pos = QtGui.QCursor.pos()
        menu.exec(pos)

    def add_glow_effect(self, widget):
        """Ajoute un effet de lueur spectaculaire avec jeux de lumiÃ¨re au widget"""
        try:
            # Effet de lueur principal avec couleur dynamique
            glow = QtWidgets.QGraphicsDropShadowEffect()
            glow.setBlurRadius(40)
            glow.setXOffset(0)
            glow.setYOffset(0)
            glow.setColor(QtGui.QColor(0, 255, 136, 250))
            
            # Effet de lueur secondaire pour plus de profondeur
            glow2 = QtWidgets.QGraphicsDropShadowEffect()
            glow2.setBlurRadius(70)
            glow2.setXOffset(0)
            glow2.setYOffset(0)
            glow2.setColor(QtGui.QColor(0, 255, 255, 150))
            
            # Effet de lueur tertiaire pour l'effet arc-en-ciel
            glow3 = QtWidgets.QGraphicsDropShadowEffect()
            glow3.setBlurRadius(100)
            glow3.setXOffset(0)
            glow3.setYOffset(0)
            glow3.setColor(QtGui.QColor(255, 0, 255, 100))
            
            # Appliquer l'effet principal
            widget.setGraphicsEffect(glow)
            
            # Animation de pulsation de la lueur principale
            self.glow_animation = QtCore.QPropertyAnimation(glow, b"blurRadius")
            self.glow_animation.setDuration(2000)
            self.glow_animation.setStartValue(25)
            self.glow_animation.setKeyValueAt(0.3, 50)
            self.glow_animation.setKeyValueAt(0.7, 35)
            self.glow_animation.setEndValue(25)
            self.glow_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
            self.glow_animation.setLoopCount(-1)
            self.glow_animation.start()
            
            # Animation de couleur pour l'effet arc-en-ciel
            self.color_animation = QtCore.QPropertyAnimation(glow, b"color")
            self.color_animation.setDuration(3000)
            self.color_animation.setStartValue(QtGui.QColor(0, 255, 136, 250))
            self.color_animation.setKeyValueAt(0.25, QtGui.QColor(0, 255, 255, 250))
            self.color_animation.setKeyValueAt(0.5, QtGui.QColor(255, 0, 255, 250))
            self.color_animation.setKeyValueAt(0.75, QtGui.QColor(255, 255, 0, 250))
            self.color_animation.setEndValue(QtGui.QColor(0, 255, 136, 250))
            self.color_animation.setEasingCurve(QtCore.QEasingCurve.Type.InOutSine)
            self.color_animation.setLoopCount(-1)
            self.color_animation.start()
            
        except Exception:
            pass
    
    def remove_glow_effect(self, widget):
        """Supprime l'effet de lueur du widget"""
        try:
            if hasattr(self, 'glow_animation'):
                self.glow_animation.stop()
            if hasattr(self, 'color_animation'):
                self.color_animation.stop()
            widget.setGraphicsEffect(None)
        except Exception:
            pass
    
    def start_desktop_animations(self):
        """DÃ©marre les animations du bureau (dÃ©sactivÃ©es pour Ã©viter le mouvement)"""
        try:
            # DÃ©sactiver les animations qui causent le mouvement des icÃ´nes
            # Animation de flottement pour les cartes de verre
            # for child in self.findChildren(QtWidgets.QWidget, "GlassCard"):
            #     if child.isVisible():
            #         glass_float_animation(child, 4000 + random.randint(0, 2000))
            
            # Effet de scintillement pour le titre
            if hasattr(self, 'title'):
                shimmer_effect(self.title, 3000)
            
            # DÃ©sactiver l'animation des boutons du dock
            # for child in self.findChildren(QtWidgets.QPushButton):
            #     if "DesktopButton" in child.objectName():
            #         glass_float_animation(child, 5000 + random.randint(0, 3000))
                    
        except Exception as e:
            print(f"Erreur animations bureau: {e}")

    def show_apps_menu(self):
        """Affiche le menu dÃ©roulant avec toutes les applications"""
        menu = QtWidgets.QMenu(self)
        menu.setStyleSheet("""
            QMenu {
                background: rgba(20, 20, 30, 0.95);
                border: 1px solid rgba(255,255,255,0.3);
                border-radius: 8px;
                padding: 4px;
            }
            QMenu::item {
                background: transparent;
                padding: 8px 16px;
                border-radius: 4px;
                color: #eaecf3;
            }
            QMenu::item:selected {
                background: rgba(255,255,255,0.15);
            }
            QMenu::separator {
                height: 1px;
                background: rgba(255,255,255,0.2);
                margin: 4px 8px;
            }
        """)
        
        # Applications principales
        apps_section = [
            ("ðŸ–¥ï¸ SystÃ¨me", self.show_system),
            ("ðŸ“ Fichiers", self.show_files),
            ("ðŸ›ï¸ Store", self.show_store),
            ("ðŸŒ Navigateur", self.show_browser),
            ("ðŸ’¬ Chat", self.show_chat),
            ("ðŸ”— Ragnar Link", self.show_ragnar_link),
        ]
        
        for name, callback in apps_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # Outils crÃ©atifs
        creative_section = [
            ("ðŸ§® Calculatrice", self.show_calculator),
            ("ðŸ“ Notes", self.show_notes),
            ("ðŸŽ¨ Paint", self.show_paint),
            ("ðŸŽµ Lecteur Audio", self.show_audio_player),
            ("ðŸ“¸ Capture d'Ã‰cran", self.show_screenshot_tool),
            ("ðŸ“± GÃ©nÃ©rateur QR Code", self.show_qr_generator),
        ]
        
        for name, callback in creative_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # Outils systÃ¨me
        system_tools_section = [
            ("ðŸ’» Terminal", self.show_terminal),
            ("ðŸ“Š Moniteur RÃ©seau", self.show_network_monitor),
            ("ðŸŒ¡ï¸ Moniteur SystÃ¨me", self.show_system_monitor),
            ("ðŸ” Recherche Fichiers", self.show_file_search),
            ("ðŸ“‹ Presse-papiers", self.show_clipboard_manager),
            ("ðŸ” GÃ©nÃ©rateur Mots de Passe", self.show_password_generator),
        ]
        
        for name, callback in system_tools_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # DÃ©veloppement
        dev_section = [
            ("ðŸ”§ Outils DÃ©veloppeur", self.show_dev_tools),
            ("ðŸ“¦ Gestionnaire .rapp", self.show_rapp_manager),
        ]
        
        for name, callback in dev_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        # Ajout 26.3.3: Rapp Bureau (choisir un .rapp sur le Bureau)
        rapp_action = menu.addAction("ðŸ“¦ Rapp Bureau")
        rapp_action.triggered.connect(self.launch_rapp_from_desktop)
        
        menu.addSeparator()
        
        # Bureautique et ProductivitÃ©
        productivity_section = [
            ("ðŸ“„ Ã‰diteur de Texte", self.show_text_editor),
            ("ðŸ“Š Tableur", self.show_spreadsheet),
            ("ðŸ“§ Client Email", self.show_email_client),
            ("ðŸ“… Calendrier", self.show_calendar),
            ("ðŸ“– Lecteur PDF", self.show_pdf_reader),
            ("ðŸ—‚ï¸ Gestionnaire TÃ¢ches", self.show_task_manager),
            ("â° Minuteur & Chrono", self.show_timer_app),
            ("ðŸ“ Convertisseur UnitÃ©s", self.show_unit_converter),
        ]
        
        for name, callback in productivity_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # MultimÃ©dia
        multimedia_section = [
            ("ðŸŽµ Lecteur Audio", self.show_audio_player),
            ("ðŸŽ¬ Lecteur VidÃ©o", self.show_video_player),
            ("ðŸ“„ Lecteur PDF", self.show_pdf_reader),
            ("ðŸ“· Galerie Photos", self.show_photo_gallery),
            ("ðŸŽ™ï¸ Enregistreur", self.show_audio_recorder),
            ("ðŸŽ¨ Ã‰diteur Images", self.show_image_viewer),
            ("ðŸŽžï¸ Ã‰diteur VidÃ©o", self.show_video_editor),
        ]
        
        for name, callback in multimedia_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # Jeux et Divertissement
        games_section = [
            ("ðŸ Snake Ragnar", self.show_snake_game),
            ("ðŸŽ¯ Jeu de Tir", self.show_shooting_game),
            ("ðŸ§© Puzzle Magique", self.show_puzzle_game),
            ("ðŸŽ² Casino Ragnar", self.show_casino_games),
            ("ðŸƒ Solitaire", self.show_solitaire),
            ("ðŸŽª Arcade Center", self.show_arcade_center),
            ("ðŸ† Tournois", self.show_tournaments),
        ]
        
        for name, callback in games_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # SÃ©curitÃ© et RÃ©seau
        security_section = [
            ("ðŸ” Gestionnaire Mots de Passe Pro", self.show_password_manager_pro),
        ]
        
        for name, callback in security_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # Nouvelles fonctionnalitÃ©s 26.3.3
        new_features_section = [
            ("ðŸŽ¨ ThÃ¨mes AvancÃ©s", self.show_theme_manager),
            ("ðŸª Marketplace .rapp", self.show_marketplace),
            ("ðŸ“± Widgets Bureau", self.show_widget_manager),
            ("ðŸ”” Centre Notifications", self.show_notification_center),
            ("â˜ï¸ Ragnar Cloud", self.show_ragnar_cloud),
            ("ðŸŽ® Games Center", self.show_games_center),
            ("ðŸŒŸ Ragnar Premium", self.show_premium_features),
        ]
        
        for name, callback in new_features_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        menu.addSeparator()
        
        # Actions systÃ¨me
        system_section = [
            ("â¬‡ï¸ Mise Ã  jour", self.show_updater),
            ("ðŸ–¼ï¸ Personnaliser", self.change_wallpaper),
            ("ðŸ”„ RedÃ©marrer", self.restart_ragnar),
        ]
        
        for name, callback in system_section:
            action = menu.addAction(name)
            action.triggered.connect(callback)
        
        # Afficher le menu sous le bouton
        button_pos = self.menu_btn.mapToGlobal(self.menu_btn.rect().bottomLeft())
        menu.exec(button_pos)
    
    def restart_ragnar(self):
        """RedÃ©marre Ragnar OS"""
        reply = QtWidgets.QMessageBox.question(
            self, "RedÃ©marrer",
            "Voulez-vous vraiment redÃ©marrer Ragnar OS ?",
            QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
        )
        
        if reply == QtWidgets.QMessageBox.StandardButton.Yes:
            QtWidgets.QApplication.quit()
            try:
                os.execv(sys.executable, [sys.executable] + sys.argv)
            except Exception:
                QtWidgets.QApplication.quit()



    # ===== Apps =====

    def show_system(self):
        """Moniteur systÃ¨me moderne avec vraies informations"""
        d = GlassDialog("ðŸ–¥ï¸ Moniteur SystÃ¨me Ragnar", (700, 550), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Informations SystÃ¨me", "Monitoring en temps rÃ©el")
        lay.addWidget(header)
        
        # 26.3.3: Panneau Verre Ultra (intensitÃ© + persistance)
        ultra_card = QtWidgets.QWidget(objectName="GlassCard")
        ultra_layout = QtWidgets.QFormLayout(ultra_card)
        ultra_layout.setContentsMargins(16, 16, 16, 16)
        ultra_title = QtWidgets.QLabel("âœ¨ Verre Ultra")
        ultra_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        lay.addWidget(ultra_title)

        enable_checkbox = QtWidgets.QCheckBox("Activer l'effet Verre Ultra")
        radius_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        radius_slider.setRange(0, 64)
        radius_slider.setSingleStep(1)
        radius_slider.setPageStep(4)
        radius_value = QtWidgets.QLabel("28")

        # Charger Ã©tat
        st = _read_state_safe()
        enable_checkbox.setChecked(bool(st.get("ultra_glass_enabled", False)))
        try:
            radius_slider.setValue(int(float(st.get("ultra_glass_radius", 28))))
            radius_value.setText(str(radius_slider.value()))
        except Exception:
            radius_slider.setValue(28)
            radius_value.setText("28")

        def on_enable_changed(checked):
            s = _read_state_safe()
            s["ultra_glass_enabled"] = bool(checked)
            _write_state_safe(s)

        def on_radius_changed(val):
            radius_value.setText(str(val))
            s = _read_state_safe()
            s["ultra_glass_radius"] = float(val)
            _write_state_safe(s)

        enable_checkbox.toggled.connect(on_enable_changed)
        radius_slider.valueChanged.connect(on_radius_changed)

        ultra_layout.addRow(enable_checkbox)
        hl = QtWidgets.QHBoxLayout()
        slider_container = QtWidgets.QWidget()
        slider_container.setLayout(hl)
        hl.addWidget(radius_slider)
        hl.addWidget(radius_value)
        ultra_layout.addRow("IntensitÃ© du flou", slider_container)

        lay.addWidget(ultra_card)

        # CrÃ©er des cartes modernes pour chaque section
        
        # Carte SystÃ¨me
        system_card = QtWidgets.QWidget(objectName="GlassCard")
        system_layout = QtWidgets.QVBoxLayout(system_card)
        system_layout.setContentsMargins(16, 16, 16, 16)
        
        system_title = QtWidgets.QLabel("ðŸ’» Informations SystÃ¨me")
        system_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        system_layout.addWidget(system_title)
        
        try:
            import platform
            import psutil
            
            # Informations systÃ¨me avec style moderne
            system_info_items = [
                f"ðŸ–¥ï¸ SystÃ¨me : {platform.system()} {platform.release()}",
                f"âš¡ Processeur : {platform.processor()[:50]}...",
                f"ðŸ Python : {platform.python_version()}",
                f"ðŸ—ï¸ Architecture : {platform.architecture()[0]}",
                f"ðŸŒ Nom machine : {platform.node()}"
            ]
            
            for info in system_info_items:
                info_label = QtWidgets.QLabel(info)
                info_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 255, 136, 0.5);")
                system_layout.addWidget(info_label)
            
            lay.addWidget(system_card)
            
            # Carte MÃ©moire
            memory_card = QtWidgets.QWidget(objectName="GlassCard")
            memory_layout = QtWidgets.QVBoxLayout(memory_card)
            memory_layout.setContentsMargins(16, 16, 16, 16)
            
            memory_title = QtWidgets.QLabel("ðŸ§  Utilisation MÃ©moire")
            memory_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
            memory_layout.addWidget(memory_title)
            
            # Informations mÃ©moire
            memory = psutil.virtual_memory()
            memory_total = memory.total / (1024**3)  # GB
            memory_used = memory.used / (1024**3)   # GB
            memory_percent = memory.percent
            
            memory_info_items = [
                f"ðŸ’¾ MÃ©moire totale : {memory_total:.1f} GB",
                f"ðŸ”¥ MÃ©moire utilisÃ©e : {memory_used:.1f} GB ({memory_percent:.1f}%)",
                f"âœ… MÃ©moire libre : {(memory_total - memory_used):.1f} GB",
                f"ðŸ“Š Pourcentage : {memory_percent:.1f}%"
            ]
            
            for info in memory_info_items:
                info_label = QtWidgets.QLabel(info)
                info_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 170, 255, 0.5);")
                memory_layout.addWidget(info_label)
            
            # Barre de progression pour la mÃ©moire
            memory_progress = QtWidgets.QProgressBar()
            memory_progress.setValue(int(memory_percent))
            memory_progress.setFormat(f"MÃ©moire utilisÃ©e: {memory_percent:.1f}%")
            memory_layout.addWidget(memory_progress)
            
            lay.addWidget(memory_card)
            
            # Carte CPU
            cpu_card = QtWidgets.QWidget(objectName="GlassCard")
            cpu_layout = QtWidgets.QVBoxLayout(cpu_card)
            cpu_layout.setContentsMargins(16, 16, 16, 16)
            
            cpu_title = QtWidgets.QLabel("âš¡ Processeur")
            cpu_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
            cpu_layout.addWidget(cpu_title)
            
            # Informations CPU
            cpu_percent = psutil.cpu_percent(interval=1)
            cpu_count = psutil.cpu_count()
            cpu_freq = psutil.cpu_freq()
            
            cpu_info_items = [
                f"ðŸ”¥ Utilisation CPU : {cpu_percent:.1f}%",
                f"ðŸ§® Nombre de cÅ“urs : {cpu_count}",
                f"âš¡ FrÃ©quence : {cpu_freq.current:.0f} MHz" if cpu_freq else "âš¡ FrÃ©quence : N/A"
            ]
            
            for info in cpu_info_items:
                info_label = QtWidgets.QLabel(info)
                info_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(255, 170, 0, 0.5);")
                cpu_layout.addWidget(info_label)
            
            # Barre de progression pour le CPU
            cpu_progress = QtWidgets.QProgressBar()
            cpu_progress.setValue(int(cpu_percent))
            cpu_progress.setFormat(f"CPU: {cpu_percent:.1f}%")
            cpu_layout.addWidget(cpu_progress)
            
            lay.addWidget(cpu_card)
            
            # Boutons d'action modernes
            actions_card = QtWidgets.QWidget(objectName="GlassCard")
            actions_layout = QtWidgets.QHBoxLayout(actions_card)
            actions_layout.setContentsMargins(16, 16, 16, 16)
            
            refresh_btn = QtWidgets.QPushButton("ðŸ”„ Actualiser")
            refresh_btn.clicked.connect(lambda: d.close() or self.show_system())
            
            close_btn = QtWidgets.QPushButton("âŒ Fermer")
            close_btn.clicked.connect(d.close)
            
            actions_layout.addWidget(refresh_btn)
            actions_layout.addStretch()
            actions_layout.addWidget(close_btn)
            
            lay.addWidget(actions_card)
            
        except ImportError:
            # Fallback si psutil n'est pas installÃ© - crÃ©er des cartes simples
            fallback_card = QtWidgets.QWidget(objectName="GlassCard")
            fallback_layout = QtWidgets.QVBoxLayout(fallback_card)
            fallback_layout.setContentsMargins(16, 16, 16, 16)
            
            fallback_title = QtWidgets.QLabel("âš ï¸ Informations LimitÃ©es")
            fallback_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
            fallback_layout.addWidget(fallback_title)
            
            import platform
            fallback_info_items = [
                f"ðŸ–¥ï¸ SystÃ¨me : {platform.system()} {platform.release()}",
                f"âš¡ Processeur : {platform.processor()[:50]}...",
                f"ðŸ Python : {platform.python_version()}",
                f"ðŸ’¾ CPU : {random.randint(10,80)}% (simulÃ©)",
                f"ðŸ§  RAM : {random.randint(30,70)}% (simulÃ©)"
            ]
            
            for info in fallback_info_items:
                info_label = QtWidgets.QLabel(info)
                info_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(255, 170, 0, 0.5);")
                fallback_layout.addWidget(info_label)
            
            lay.addWidget(fallback_card)
        
        d.show()
    
    def refresh_system_info(self, dialog):
        """Actualise les informations systÃ¨me"""
        dialog.close()
        self.show_system()
    
    def show_clipboard_manager(self):
        """Gestionnaire de presse-papiers moderne"""
        d = GlassDialog("ðŸ“‹ Gestionnaire de Presse-papiers", (600, 400), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Presse-papiers", "Gestion avancÃ©e du contenu copiÃ©")
        lay.addWidget(header)
        
        # Contenu actuel
        current_card = QtWidgets.QWidget(objectName="GlassCard")
        current_layout = QtWidgets.QVBoxLayout(current_card)
        current_layout.setContentsMargins(16, 16, 16, 16)
        
        current_title = QtWidgets.QLabel("ðŸ“„ Contenu Actuel")
        current_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        current_layout.addWidget(current_title)
        
        try:
            from PyQt6.QtGui import QClipboard
            clipboard = QtWidgets.QApplication.clipboard()
            current_text = clipboard.text()
            
            if current_text:
                text_preview = current_text[:200] + "..." if len(current_text) > 200 else current_text
                preview_label = QtWidgets.QLabel(f"ðŸ“ {text_preview}")
                preview_label.setStyleSheet("color: white; font-size: 12px; padding: 8px; border: 1px solid rgba(255,255,255,0.3); border-radius: 5px;")
                preview_label.setWordWrap(True)
                current_layout.addWidget(preview_label)
                
                # Informations
                info_label = QtWidgets.QLabel(f"ðŸ“Š Longueur : {len(current_text)} caractÃ¨res")
                info_label.setStyleSheet("color: #00aaff; font-size: 11px; padding: 4px;")
                current_layout.addWidget(info_label)
            else:
                empty_label = QtWidgets.QLabel("âŒ Presse-papiers vide")
                empty_label.setStyleSheet("color: #ffaa00; font-size: 12px; padding: 8px;")
                current_layout.addWidget(empty_label)
                
        except Exception as e:
            error_label = QtWidgets.QLabel(f"âš ï¸ Erreur : {str(e)}")
            error_label.setStyleSheet("color: #ff6666; font-size: 12px; padding: 8px;")
            current_layout.addWidget(error_label)
        
        lay.addWidget(current_card)
        
        # Actions
        actions_card = QtWidgets.QWidget(objectName="GlassCard")
        actions_layout = QtWidgets.QHBoxLayout(actions_card)
        actions_layout.setContentsMargins(16, 16, 16, 16)
        
        clear_btn = QtWidgets.QPushButton("ðŸ—‘ï¸ Vider")
        copy_btn = QtWidgets.QPushButton("ðŸ“‹ Copier Texte")
        refresh_btn = QtWidgets.QPushButton("ðŸ”„ Actualiser")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        # Connexions
        clear_btn.clicked.connect(lambda: QtWidgets.QApplication.clipboard().clear())
        copy_btn.clicked.connect(lambda: self.copy_custom_text())
        refresh_btn.clicked.connect(lambda: d.close() or self.show_clipboard_manager())
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(clear_btn)
        actions_layout.addWidget(copy_btn)
        actions_layout.addWidget(refresh_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addWidget(actions_card)
        
        d.show()
        fade_in(d, 600)
    
    def copy_custom_text(self):
        """Permet de copier un texte personnalisÃ©"""
        text, ok = QtWidgets.QInputDialog.getText(
            self, "ðŸ“‹ Copier du texte", 
            "Entrez le texte Ã  copier :",
            text=""
        )
        if ok and text:
            QtWidgets.QApplication.clipboard().setText(text)
            QtWidgets.QMessageBox.information(
                self, "âœ… CopiÃ©", 
                f"Texte copiÃ© dans le presse-papiers !\n\nLongueur : {len(text)} caractÃ¨res"
            )
    
    def show_games_center(self):
        """Centre de jeux Ragnar avec plusieurs jeux intÃ©grÃ©s"""
        d = GlassDialog("ðŸŽ® Centre de Jeux Ragnar", (900, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Centre de Jeux", "Divertissement et dÃ©fis")
        lay.addWidget(header)
        
        # Onglets pour diffÃ©rents types de jeux
        tabs = QtWidgets.QTabWidget()
        
        # Onglet Jeux Classiques
        classic_tab = QtWidgets.QWidget()
        classic_layout = QtWidgets.QVBoxLayout(classic_tab)
        
        # Grille de jeux classiques
        games_grid = QtWidgets.QGridLayout()
        
        classic_games = [
            ("ðŸ", "Snake Ragnar", "Jeu du serpent moderne", self.launch_snake_game),
            ("ðŸŽ¯", "Cible", "Jeu de prÃ©cision", self.launch_target_game),
            ("ðŸ§©", "Puzzle", "Casse-tÃªte logique", self.launch_puzzle_game),
            ("ðŸŽ²", "DÃ©s", "Jeux de hasard", self.launch_dice_game),
            ("ðŸƒ", "Cartes", "Solitaire et plus", self.launch_card_games),
            ("ðŸŽª", "Arcade", "Jeux d'arcade", self.launch_arcade_games),
        ]
        
        row, col = 0, 0
        for emoji, name, desc, callback in classic_games:
            game_card = QtWidgets.QWidget(objectName="GlassCard")
            game_layout = QtWidgets.QVBoxLayout(game_card)
            game_layout.setContentsMargins(16, 16, 16, 16)
            
            game_icon = QtWidgets.QLabel(emoji)
            game_icon.setStyleSheet("font-size: 48px; text-align: center;")
            game_icon.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            game_title = QtWidgets.QLabel(name)
            game_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; text-align: center;")
            game_title.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            game_desc = QtWidgets.QLabel(desc)
            game_desc.setStyleSheet("font-size: 11px; color: #cccccc; text-align: center;")
            game_desc.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            game_desc.setWordWrap(True)
            
            play_btn = QtWidgets.QPushButton("â–¶ï¸ Jouer")
            play_btn.clicked.connect(callback)
            
            game_layout.addWidget(game_icon)
            game_layout.addWidget(game_title)
            game_layout.addWidget(game_desc)
            game_layout.addWidget(play_btn)
            
            games_grid.addWidget(game_card, row, col)
            col += 1
            if col > 2:
                col = 0
                row += 1
        
        classic_layout.addLayout(games_grid)
        tabs.addTab(classic_tab, "ðŸŽ® Classiques")
        
        # Onglet Statistiques
        stats_tab = QtWidgets.QWidget()
        stats_layout = QtWidgets.QVBoxLayout(stats_tab)
        
        stats_card = QtWidgets.QWidget(objectName="GlassCard")
        stats_card_layout = QtWidgets.QVBoxLayout(stats_card)
        stats_card_layout.setContentsMargins(16, 16, 16, 16)
        
        stats_title = QtWidgets.QLabel("ðŸ“Š Statistiques de Jeu")
        stats_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        stats_card_layout.addWidget(stats_title)
        
        # Statistiques simulÃ©es
        stats_info = [
            "ðŸ† Parties jouÃ©es : 127",
            "â­ Score total : 15,420 points",
            "ðŸŽ¯ PrÃ©cision moyenne : 78%",
            "â±ï¸ Temps de jeu : 2h 34min",
            "ðŸ¥‡ Meilleur score : Snake (2,340 pts)",
            "ðŸ”¥ SÃ©rie actuelle : 5 victoires"
        ]
        
        for stat in stats_info:
            stat_label = QtWidgets.QLabel(stat)
            stat_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 170, 255, 0.5);")
            stats_card_layout.addWidget(stat_label)
        
        stats_layout.addWidget(stats_card)
        tabs.addTab(stats_tab, "ðŸ“Š Stats")
        
        lay.addWidget(tabs)
        
        # Boutons d'action
        actions_card = QtWidgets.QWidget(objectName="GlassCard")
        actions_layout = QtWidgets.QHBoxLayout(actions_card)
        actions_layout.setContentsMargins(16, 16, 16, 16)
        
        tournament_btn = QtWidgets.QPushButton("ðŸ† Tournois")
        leaderboard_btn = QtWidgets.QPushButton("ðŸ¥‡ Classements")
        settings_btn = QtWidgets.QPushButton("âš™ï¸ Options")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        tournament_btn.clicked.connect(self.show_tournaments)
        leaderboard_btn.clicked.connect(self.show_leaderboards)
        settings_btn.clicked.connect(self.show_game_settings)
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(tournament_btn)
        actions_layout.addWidget(leaderboard_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addWidget(actions_card)
        
        d.show()
        fade_in(d, 800)
    
    def launch_snake_game(self):
        """Lance le jeu Snake avec interface complÃ¨te"""
        d = GlassDialog("ðŸ Snake Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header avec animation moderne
        header = make_header("ðŸ Snake Ragnar", "Le serpent lÃ©gendaire vous attend")
        lay.addWidget(header)
        modern_fade_in(header, 1000)
        
        # Zone de jeu
        game_area = QtWidgets.QWidget(objectName="GlassCard")
        game_area.setFixedSize(400, 400)
        game_area.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(0, 50, 0, 0.6));
                border: 3px solid rgba(0, 255, 136, 0.5);
                border-radius: 15px;
            }
        """)
        
        game_layout = QtWidgets.QVBoxLayout(game_area)
        game_layout.setContentsMargins(20, 20, 20, 20)
        
        # Affichage du score
        score_label = QtWidgets.QLabel("Score: 0")
        score_label.setStyleSheet("""
            QLabel {
                font-size: 24px;
                font-weight: bold;
                color: #00ff88;
                text-align: center;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        score_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        game_layout.addWidget(score_label)
        
        # Zone de jeu simulÃ©e
        game_board = QtWidgets.QLabel("ðŸ")
        game_board.setStyleSheet("""
            QLabel {
                font-size: 200px;
                text-align: center;
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                padding: 50px;
            }
        """)
        game_board.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        game_board.setFixedHeight(200)
        game_layout.addWidget(game_board)
        
        # Instructions
        instructions = QtWidgets.QLabel("Utilisez les flÃ¨ches pour diriger le serpent\nMangez les pommes ðŸŽ pour grandir !")
        instructions.setStyleSheet("""
            QLabel {
                color: white;
                font-size: 14px;
                text-align: center;
                padding: 10px;
            }
        """)
        instructions.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        game_layout.addWidget(instructions)
        
        lay.addWidget(game_area, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # ContrÃ´les de jeu
        controls_card = QtWidgets.QWidget(objectName="GlassCard")
        controls_layout = QtWidgets.QVBoxLayout(controls_card)
        controls_layout.setContentsMargins(16, 16, 16, 16)
        
        controls_title = QtWidgets.QLabel("ðŸŽ® ContrÃ´les")
        controls_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        controls_layout.addWidget(controls_title)
        
        # Boutons de contrÃ´le
        controls_buttons = QtWidgets.QGridLayout()
        
        up_btn = QtWidgets.QPushButton("â¬†ï¸")
        down_btn = QtWidgets.QPushButton("â¬‡ï¸")
        left_btn = QtWidgets.QPushButton("â¬…ï¸")
        right_btn = QtWidgets.QPushButton("âž¡ï¸")
        
        # Style pour les boutons de contrÃ´le
        control_style = """
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.3),
                    stop:1 rgba(0, 255, 136, 0.1));
                border: 2px solid rgba(0, 255, 136, 0.5);
                border-radius: 10px;
                color: white;
                font-weight: bold;
                font-size: 20px;
                padding: 15px;
                min-width: 60px;
                min-height: 60px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.5),
                    stop:1 rgba(0, 255, 136, 0.3));
                border: 2px solid rgba(0, 255, 136, 0.8);
            }
            QPushButton:pressed {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.7),
                    stop:1 rgba(0, 255, 136, 0.5));
            }
        """
        
        up_btn.setStyleSheet(control_style)
        down_btn.setStyleSheet(control_style)
        left_btn.setStyleSheet(control_style)
        right_btn.setStyleSheet(control_style)
        
        # Placement des boutons
        controls_buttons.addWidget(up_btn, 0, 1)
        controls_buttons.addWidget(left_btn, 1, 0)
        controls_buttons.addWidget(down_btn, 1, 1)
        controls_buttons.addWidget(right_btn, 1, 2)
        
        controls_layout.addLayout(controls_buttons)
        lay.addWidget(controls_card)
        
        # Actions des boutons
        def move_up():
            neon_glow_animation(up_btn, 500)
            score_label.setText(f"Score: {int(score_label.text().split(': ')[1]) + 10}")
            bounce_in(game_board, 300)
        
        def move_down():
            neon_glow_animation(down_btn, 500)
            score_label.setText(f"Score: {int(score_label.text().split(': ')[1]) + 10}")
            bounce_in(game_board, 300)
        
        def move_left():
            neon_glow_animation(left_btn, 500)
            score_label.setText(f"Score: {int(score_label.text().split(': ')[1]) + 10}")
            bounce_in(game_board, 300)
        
        def move_right():
            neon_glow_animation(right_btn, 500)
            score_label.setText(f"Score: {int(score_label.text().split(': ')[1]) + 10}")
            bounce_in(game_board, 300)
        
        up_btn.clicked.connect(move_up)
        down_btn.clicked.connect(move_down)
        left_btn.clicked.connect(move_left)
        right_btn.clicked.connect(move_right)
        
        # Boutons d'action
        actions_layout = QtWidgets.QHBoxLayout()
        
        start_btn = QtWidgets.QPushButton("â–¶ï¸ DÃ©marrer")
        pause_btn = QtWidgets.QPushButton("â¸ï¸ Pause")
        reset_btn = QtWidgets.QPushButton("ðŸ”„ Reset")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        start_btn.clicked.connect(lambda: [modern_fade_in(game_area, 800), neon_glow_animation(start_btn, 1000)])
        pause_btn.clicked.connect(lambda: holographic_effect(pause_btn, 1000))
        reset_btn.clicked.connect(lambda: [score_label.setText("Score: 0"), morphing_animation(game_board, 1000)])
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(start_btn)
        actions_layout.addWidget(pause_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        modern_fade_in(d, 1200)
        wave_animation(game_area, 3000)
    
    def launch_target_game(self):
        """Lance le jeu de tir Ã  la cible avec interface complÃ¨te"""
        d = GlassDialog("ðŸŽ¯ Jeu de Cible Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header avec animation moderne
        header = make_header("ðŸŽ¯ Jeu de Cible Ragnar", "PrÃ©cision et rapiditÃ© sont essentielles")
        lay.addWidget(header)
        modern_fade_in(header, 1000)
        
        # Zone de jeu
        game_area = QtWidgets.QWidget(objectName="GlassCard")
        game_area.setFixedSize(500, 400)
        game_area.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(50, 0, 0, 0.6));
                border: 3px solid rgba(255, 0, 0, 0.5);
                border-radius: 15px;
            }
        """)
        
        game_layout = QtWidgets.QVBoxLayout(game_area)
        game_layout.setContentsMargins(20, 20, 20, 20)
        
        # Affichage du score et du temps
        info_layout = QtWidgets.QHBoxLayout()
        
        score_label = QtWidgets.QLabel("Score: 0")
        score_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #ff4444;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        time_label = QtWidgets.QLabel("Temps: 30s")
        time_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #00aaff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        info_layout.addWidget(score_label)
        info_layout.addStretch()
        info_layout.addWidget(time_label)
        game_layout.addLayout(info_layout)
        
        # Zone de cibles
        targets_area = QtWidgets.QWidget()
        targets_area.setFixedHeight(250)
        targets_area.setStyleSheet("""
            QWidget {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
        """)
        
        targets_layout = QtWidgets.QGridLayout(targets_area)
        
        # CrÃ©er des cibles cliquables
        targets = []
        for i in range(9):
            target_btn = QtWidgets.QPushButton("ðŸŽ¯")
            target_btn.setStyleSheet("""
                QPushButton {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 0, 0, 0.3),
                        stop:1 rgba(255, 0, 0, 0.1));
                    border: 2px solid rgba(255, 0, 0, 0.5);
                    border-radius: 15px;
                    color: white;
                    font-weight: bold;
                    font-size: 24px;
                    padding: 20px;
                }
                QPushButton:hover {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 0, 0, 0.5),
                        stop:1 rgba(255, 0, 0, 0.3));
                    border: 2px solid rgba(255, 0, 0, 0.8);
                }
            """)
            target_btn.setFixedSize(80, 80)
            
            def create_target_handler(btn, points):
                def hit_target():
                    cyberpunk_glitch_effect(btn, 500)
                    current_score = int(score_label.text().split(': ')[1])
                    score_label.setText(f"Score: {current_score + points}")
                    btn.setText("ðŸ’¥")
                    btn.setEnabled(False)
                    # RÃ©activer aprÃ¨s 1 seconde
                    QtCore.QTimer.singleShot(1000, lambda: [btn.setText("ðŸŽ¯"), btn.setEnabled(True)])
                return hit_target
            
            target_btn.clicked.connect(create_target_handler(target_btn, 10))
            targets.append(target_btn)
            targets_layout.addWidget(target_btn, i // 3, i % 3)
        
        game_layout.addWidget(targets_area)
        lay.addWidget(game_area, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Instructions
        instructions_card = QtWidgets.QWidget(objectName="GlassCard")
        instructions_layout = QtWidgets.QVBoxLayout(instructions_card)
        instructions_layout.setContentsMargins(16, 16, 16, 16)
        
        instructions_title = QtWidgets.QLabel("ðŸ“‹ Instructions")
        instructions_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        instructions_layout.addWidget(instructions_title)
        
        instructions_text = QtWidgets.QLabel("""
        ðŸŽ¯ Cliquez sur les cibles pour marquer des points
        âš¡ Chaque cible rapporte 10 points
        ðŸ’¥ Les cibles explosent temporairement aprÃ¨s avoir Ã©tÃ© touchÃ©es
        ðŸ† Essayez d'obtenir le meilleur score possible !
        """)
        instructions_text.setStyleSheet("color: white; font-size: 12px; padding: 8px;")
        instructions_layout.addWidget(instructions_text)
        
        lay.addWidget(instructions_card)
        
        # Boutons d'action
        actions_layout = QtWidgets.QHBoxLayout()
        
        start_btn = QtWidgets.QPushButton("â–¶ï¸ DÃ©marrer")
        pause_btn = QtWidgets.QPushButton("â¸ï¸ Pause")
        reset_btn = QtWidgets.QPushButton("ðŸ”„ Reset")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        start_btn.clicked.connect(lambda: [modern_fade_in(game_area, 800), neon_glow_animation(start_btn, 1000)])
        pause_btn.clicked.connect(lambda: holographic_effect(pause_btn, 1000))
        reset_btn.clicked.connect(lambda: [score_label.setText("Score: 0"), morphing_animation(targets_area, 1000)])
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(start_btn)
        actions_layout.addWidget(pause_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        modern_fade_in(d, 1200)
        liquid_flow_animation(game_area, 4000)
    
    def launch_puzzle_game(self):
        """Lance le jeu de puzzle avec interface complÃ¨te"""
        d = GlassDialog("ðŸ§© Puzzle Magique Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header avec animation moderne
        header = make_header("ðŸ§© Puzzle Magique Ragnar", "RÃ©solvez les Ã©nigmes logiques")
        lay.addWidget(header)
        modern_fade_in(header, 1000)
        
        # Zone de jeu
        game_area = QtWidgets.QWidget(objectName="GlassCard")
        game_area.setFixedSize(500, 400)
        game_area.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(50, 0, 50, 0.6));
                border: 3px solid rgba(255, 0, 255, 0.5);
                border-radius: 15px;
            }
        """)
        
        game_layout = QtWidgets.QVBoxLayout(game_area)
        game_layout.setContentsMargins(20, 20, 20, 20)
        
        # Affichage du niveau et du score
        info_layout = QtWidgets.QHBoxLayout()
        
        level_label = QtWidgets.QLabel("Niveau: 1")
        level_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #ff00ff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        score_label = QtWidgets.QLabel("Score: 0")
        score_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #00aaff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        info_layout.addWidget(level_label)
        info_layout.addStretch()
        info_layout.addWidget(score_label)
        game_layout.addLayout(info_layout)
        
        # Zone de puzzle
        puzzle_area = QtWidgets.QWidget()
        puzzle_area.setFixedHeight(250)
        puzzle_area.setStyleSheet("""
            QWidget {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
        """)
        
        puzzle_layout = QtWidgets.QGridLayout(puzzle_area)
        
        # CrÃ©er des piÃ¨ces de puzzle cliquables
        puzzle_pieces = []
        colors = ["ðŸ”´", "ðŸŸ¡", "ðŸŸ¢", "ðŸ”µ", "ðŸŸ£", "ðŸŸ ", "âšª", "âš«", "ðŸŸ¤"]
        
        for i in range(9):
            piece_btn = QtWidgets.QPushButton(colors[i])
            piece_btn.setStyleSheet("""
                QPushButton {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 0, 255, 0.3),
                        stop:1 rgba(255, 0, 255, 0.1));
                    border: 2px solid rgba(255, 0, 255, 0.5);
                    border-radius: 15px;
                    color: white;
                    font-weight: bold;
                    font-size: 24px;
                    padding: 20px;
                }
                QPushButton:hover {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 0, 255, 0.5),
                        stop:1 rgba(255, 0, 255, 0.3));
                    border: 2px solid rgba(255, 0, 255, 0.8);
                }
            """)
            piece_btn.setFixedSize(80, 80)
            
            def create_piece_handler(btn, original_color):
                def move_piece():
                    quantum_entanglement_effect(btn, 500)
                    current_score = int(score_label.text().split(': ')[1])
                    score_label.setText(f"Score: {current_score + 5}")
                    # Animation de mouvement
                    morphing_animation(btn, 300)
                return move_piece
            
            piece_btn.clicked.connect(create_piece_handler(piece_btn, colors[i]))
            puzzle_pieces.append(piece_btn)
            puzzle_layout.addWidget(piece_btn, i // 3, i % 3)
        
        game_layout.addWidget(puzzle_area)
        lay.addWidget(game_area, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Instructions
        instructions_card = QtWidgets.QWidget(objectName="GlassCard")
        instructions_layout = QtWidgets.QVBoxLayout(instructions_card)
        instructions_layout.setContentsMargins(16, 16, 16, 16)
        
        instructions_title = QtWidgets.QLabel("ðŸ“‹ Instructions")
        instructions_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        instructions_layout.addWidget(instructions_title)
        
        instructions_text = QtWidgets.QLabel("""
        ðŸ§© Cliquez sur les piÃ¨ces pour les dÃ©placer
        ðŸŽ¯ Organisez les couleurs dans l'ordre correct
        âš¡ Chaque mouvement rapporte 5 points
        ðŸ† ComplÃ©tez le puzzle pour passer au niveau suivant !
        """)
        instructions_text.setStyleSheet("color: white; font-size: 12px; padding: 8px;")
        instructions_layout.addWidget(instructions_text)
        
        lay.addWidget(instructions_card)
        
        # Boutons d'action
        actions_layout = QtWidgets.QHBoxLayout()
        
        start_btn = QtWidgets.QPushButton("â–¶ï¸ DÃ©marrer")
        hint_btn = QtWidgets.QPushButton("ðŸ’¡ Indice")
        reset_btn = QtWidgets.QPushButton("ðŸ”„ Reset")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        start_btn.clicked.connect(lambda: [modern_fade_in(game_area, 800), neon_glow_animation(start_btn, 1000)])
        hint_btn.clicked.connect(lambda: holographic_effect(hint_btn, 1000))
        reset_btn.clicked.connect(lambda: [score_label.setText("Score: 0"), morphing_animation(puzzle_area, 1000)])
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(start_btn)
        actions_layout.addWidget(hint_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        modern_fade_in(d, 1200)
        matrix_rain_effect(game_area, 5000)
    
    def launch_dice_games(self):
        """Lance les jeux de dÃ©s avec interface complÃ¨te"""
        d = GlassDialog("ðŸŽ² Jeux de DÃ©s Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header avec animation moderne
        header = make_header("ðŸŽ² Jeux de DÃ©s Ragnar", "La chance vous sourit-elle ?")
        lay.addWidget(header)
        modern_fade_in(header, 1000)
        
        # Zone de jeu
        game_area = QtWidgets.QWidget(objectName="GlassCard")
        game_area.setFixedSize(500, 400)
        game_area.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(50, 50, 0, 0.6));
                border: 3px solid rgba(255, 255, 0, 0.5);
                border-radius: 15px;
            }
        """)
        
        game_layout = QtWidgets.QVBoxLayout(game_area)
        game_layout.setContentsMargins(20, 20, 20, 20)
        
        # Affichage du score et du jeu actuel
        info_layout = QtWidgets.QHBoxLayout()
        
        game_label = QtWidgets.QLabel("Jeu: Yahtzee")
        game_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #ffff00;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        score_label = QtWidgets.QLabel("Score: 0")
        score_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #00aaff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        info_layout.addWidget(game_label)
        info_layout.addStretch()
        info_layout.addWidget(score_label)
        game_layout.addLayout(info_layout)
        
        # Zone de dÃ©s
        dice_area = QtWidgets.QWidget()
        dice_area.setFixedHeight(200)
        dice_area.setStyleSheet("""
            QWidget {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
        """)
        
        dice_layout = QtWidgets.QHBoxLayout(dice_area)
        dice_layout.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # CrÃ©er 5 dÃ©s
        dice_buttons = []
        for i in range(5):
            die_btn = QtWidgets.QPushButton("ðŸŽ²")
            die_btn.setStyleSheet("""
                QPushButton {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 255, 0, 0.3),
                        stop:1 rgba(255, 255, 0, 0.1));
                    border: 2px solid rgba(255, 255, 0, 0.5);
                    border-radius: 15px;
                    color: white;
                    font-weight: bold;
                    font-size: 32px;
                    padding: 20px;
                    min-width: 80px;
                    min-height: 80px;
                }
                QPushButton:hover {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 255, 0, 0.5),
                        stop:1 rgba(255, 255, 0, 0.3));
                    border: 2px solid rgba(255, 255, 0, 0.8);
                }
            """)
            
            def create_die_handler(btn):
                def roll_die():
                    cyberpunk_glitch_effect(btn, 500)
                    current_score = int(score_label.text().split(': ')[1])
                    score_label.setText(f"Score: {current_score + random.randint(1, 6)}")
                    # Animation de rotation
                    morphing_animation(btn, 300)
                return roll_die
            
            die_btn.clicked.connect(create_die_handler(die_btn))
            dice_buttons.append(die_btn)
            dice_layout.addWidget(die_btn)
        
        game_layout.addWidget(dice_area)
        lay.addWidget(game_area, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Instructions
        instructions_card = QtWidgets.QWidget(objectName="GlassCard")
        instructions_layout = QtWidgets.QVBoxLayout(instructions_card)
        instructions_layout.setContentsMargins(16, 16, 16, 16)
        
        instructions_title = QtWidgets.QLabel("ðŸ“‹ Instructions")
        instructions_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        instructions_layout.addWidget(instructions_title)
        
        instructions_text = QtWidgets.QLabel("""
        ðŸŽ² Cliquez sur les dÃ©s pour les lancer
        ðŸŽ¯ Chaque dÃ© rapporte 1-6 points
        ðŸ† Yahtzee: 5 dÃ©s identiques = 50 points bonus
        ðŸŽª Poker de dÃ©s: 4 dÃ©s identiques = 30 points
        """)
        instructions_text.setStyleSheet("color: white; font-size: 12px; padding: 8px;")
        instructions_layout.addWidget(instructions_text)
        
        lay.addWidget(instructions_card)
        
        # Boutons d'action
        actions_layout = QtWidgets.QHBoxLayout()
        
        roll_all_btn = QtWidgets.QPushButton("ðŸŽ² Lancer Tout")
        hold_btn = QtWidgets.QPushButton("âœ‹ Garder")
        reset_btn = QtWidgets.QPushButton("ðŸ”„ Reset")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        roll_all_btn.clicked.connect(lambda: [modern_fade_in(dice_area, 800), neon_glow_animation(roll_all_btn, 1000)])
        hold_btn.clicked.connect(lambda: holographic_effect(hold_btn, 1000))
        reset_btn.clicked.connect(lambda: [score_label.setText("Score: 0"), morphing_animation(dice_area, 1000)])
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(roll_all_btn)
        actions_layout.addWidget(hold_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        modern_fade_in(d, 1200)
        liquid_flow_animation(game_area, 3000)
    
    def launch_card_games(self):
        """Lance les jeux de cartes avec interface complÃ¨te"""
        d = GlassDialog("ðŸƒ Jeux de Cartes Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header avec animation moderne
        header = make_header("ðŸƒ Jeux de Cartes Ragnar", "DÃ©tendez-vous avec les classiques")
        lay.addWidget(header)
        modern_fade_in(header, 1000)
        
        # Zone de jeu
        game_area = QtWidgets.QWidget(objectName="GlassCard")
        game_area.setFixedSize(500, 400)
        game_area.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(0, 50, 50, 0.6));
                border: 3px solid rgba(0, 255, 255, 0.5);
                border-radius: 15px;
            }
        """)
        
        game_layout = QtWidgets.QVBoxLayout(game_area)
        game_layout.setContentsMargins(20, 20, 20, 20)
        
        # Affichage du jeu et du score
        info_layout = QtWidgets.QHBoxLayout()
        
        game_label = QtWidgets.QLabel("Jeu: Solitaire")
        game_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #00ffff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        score_label = QtWidgets.QLabel("Score: 0")
        score_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #00aaff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        info_layout.addWidget(game_label)
        info_layout.addStretch()
        info_layout.addWidget(score_label)
        game_layout.addLayout(info_layout)
        
        # Zone de cartes
        cards_area = QtWidgets.QWidget()
        cards_area.setFixedHeight(250)
        cards_area.setStyleSheet("""
            QWidget {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
        """)
        
        cards_layout = QtWidgets.QGridLayout(cards_area)
        
        # CrÃ©er des cartes cliquables
        card_buttons = []
        suits = ["â™ ï¸", "â™¥ï¸", "â™¦ï¸", "â™£ï¸"]
        values = ["A", "2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K"]
        
        for i in range(12):
            suit = suits[i % 4]
            value = values[i % 13]
            card_btn = QtWidgets.QPushButton(f"{value}\n{suit}")
            card_btn.setStyleSheet("""
                QPushButton {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(0, 255, 255, 0.3),
                        stop:1 rgba(0, 255, 255, 0.1));
                    border: 2px solid rgba(0, 255, 255, 0.5);
                    border-radius: 15px;
                    color: white;
                    font-weight: bold;
                    font-size: 16px;
                    padding: 15px;
                }
                QPushButton:hover {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(0, 255, 255, 0.5),
                        stop:1 rgba(0, 255, 255, 0.3));
                    border: 2px solid rgba(0, 255, 255, 0.8);
                }
            """)
            card_btn.setFixedSize(80, 100)
            
            def create_card_handler(btn, points):
                def play_card():
                    holographic_effect(btn, 500)
                    current_score = int(score_label.text().split(': ')[1])
                    score_label.setText(f"Score: {current_score + points}")
                    # Animation de mouvement
                    morphing_animation(btn, 300)
                return play_card
            
            card_btn.clicked.connect(create_card_handler(card_btn, random.randint(1, 10)))
            card_buttons.append(card_btn)
            cards_layout.addWidget(card_btn, i // 4, i % 4)
        
        game_layout.addWidget(cards_area)
        lay.addWidget(game_area, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Instructions
        instructions_card = QtWidgets.QWidget(objectName="GlassCard")
        instructions_layout = QtWidgets.QVBoxLayout(instructions_card)
        instructions_layout.setContentsMargins(16, 16, 16, 16)
        
        instructions_title = QtWidgets.QLabel("ðŸ“‹ Instructions")
        instructions_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        instructions_layout.addWidget(instructions_title)
        
        instructions_text = QtWidgets.QLabel("""
        ðŸƒ Cliquez sur les cartes pour les jouer
        ðŸŽ¯ Chaque carte rapporte 1-10 points
        ðŸ† Solitaire: Organisez les cartes par couleur et valeur
        ðŸŽª Freecell: DÃ©placez toutes les cartes vers les fondations
        """)
        instructions_text.setStyleSheet("color: white; font-size: 12px; padding: 8px;")
        instructions_layout.addWidget(instructions_text)
        
        lay.addWidget(instructions_card)
        
        # Boutons d'action
        actions_layout = QtWidgets.QHBoxLayout()
        
        deal_btn = QtWidgets.QPushButton("ðŸƒ Distribuer")
        hint_btn = QtWidgets.QPushButton("ðŸ’¡ Indice")
        reset_btn = QtWidgets.QPushButton("ðŸ”„ Reset")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        deal_btn.clicked.connect(lambda: [modern_fade_in(cards_area, 800), neon_glow_animation(deal_btn, 1000)])
        hint_btn.clicked.connect(lambda: holographic_effect(hint_btn, 1000))
        reset_btn.clicked.connect(lambda: [score_label.setText("Score: 0"), morphing_animation(cards_area, 1000)])
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(deal_btn)
        actions_layout.addWidget(hint_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        modern_fade_in(d, 1200)
        wave_animation(game_area, 4000)
    
    def launch_arcade_games(self):
        """Lance les jeux d'arcade avec interface complÃ¨te"""
        d = GlassDialog("ðŸŽª Arcade Center Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header avec animation moderne
        header = make_header("ðŸŽª Arcade Center Ragnar", "Revivez l'Ã¢ge d'or du gaming")
        lay.addWidget(header)
        modern_fade_in(header, 1000)
        
        # Zone de jeu
        game_area = QtWidgets.QWidget(objectName="GlassCard")
        game_area.setFixedSize(500, 400)
        game_area.setStyleSheet("""
            QWidget#GlassCard {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(100, 0, 0, 0.6));
                border: 3px solid rgba(255, 100, 0, 0.5);
                border-radius: 15px;
            }
        """)
        
        game_layout = QtWidgets.QVBoxLayout(game_area)
        game_layout.setContentsMargins(20, 20, 20, 20)
        
        # Affichage du jeu et du score
        info_layout = QtWidgets.QHBoxLayout()
        
        game_label = QtWidgets.QLabel("Jeu: Pac-Man")
        game_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #ff6400;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        score_label = QtWidgets.QLabel("Score: 0")
        score_label.setStyleSheet("""
            QLabel {
                font-size: 18px;
                font-weight: bold;
                color: #00aaff;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 10px;
                padding: 10px;
            }
        """)
        
        info_layout.addWidget(game_label)
        info_layout.addStretch()
        info_layout.addWidget(score_label)
        game_layout.addLayout(info_layout)
        
        # Zone d'arcade
        arcade_area = QtWidgets.QWidget()
        arcade_area.setFixedHeight(250)
        arcade_area.setStyleSheet("""
            QWidget {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
        """)
        
        arcade_layout = QtWidgets.QGridLayout(arcade_area)
        
        # CrÃ©er des Ã©lÃ©ments d'arcade cliquables
        arcade_elements = []
        elements = ["ðŸ‘¾", "ðŸ’", "ðŸ”µ", "â­", "ðŸ’Ž", "ðŸŽ¯", "ðŸš€", "ðŸ’£", "ðŸŽ®"]
        
        for i in range(9):
            element_btn = QtWidgets.QPushButton(elements[i])
            element_btn.setStyleSheet("""
                QPushButton {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 100, 0, 0.3),
                        stop:1 rgba(255, 100, 0, 0.1));
                    border: 2px solid rgba(255, 100, 0, 0.5);
                    border-radius: 15px;
                    color: white;
                    font-weight: bold;
                    font-size: 24px;
                    padding: 20px;
                }
                QPushButton:hover {
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 rgba(255, 100, 0, 0.5),
                        stop:1 rgba(255, 100, 0, 0.3));
                    border: 2px solid rgba(255, 100, 0, 0.8);
                }
            """)
            element_btn.setFixedSize(80, 80)
            
            def create_element_handler(btn, points):
                def collect_element():
                    cyberpunk_glitch_effect(btn, 500)
                    current_score = int(score_label.text().split(': ')[1])
                    score_label.setText(f"Score: {current_score + points}")
                    # Animation de collection
                    morphing_animation(btn, 300)
                return collect_element
            
            element_btn.clicked.connect(create_element_handler(element_btn, random.randint(5, 25)))
            arcade_elements.append(element_btn)
            arcade_layout.addWidget(element_btn, i // 3, i % 3)
        
        game_layout.addWidget(arcade_area)
        lay.addWidget(game_area, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Instructions
        instructions_card = QtWidgets.QWidget(objectName="GlassCard")
        instructions_layout = QtWidgets.QVBoxLayout(instructions_card)
        instructions_layout.setContentsMargins(16, 16, 16, 16)
        
        instructions_title = QtWidgets.QLabel("ðŸ“‹ Instructions")
        instructions_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        instructions_layout.addWidget(instructions_title)
        
        instructions_text = QtWidgets.QLabel("""
        ðŸŽª Cliquez sur les Ã©lÃ©ments pour les collecter
        ðŸŽ¯ Chaque Ã©lÃ©ment rapporte 5-25 points
        ðŸ† Pac-Man: Mangez les points et Ã©vitez les fantÃ´mes
        ðŸŽ® Space Invaders: DÃ©truisez les envahisseurs
        """)
        instructions_text.setStyleSheet("color: white; font-size: 12px; padding: 8px;")
        instructions_layout.addWidget(instructions_text)
        
        lay.addWidget(instructions_card)
        
        # Boutons d'action
        actions_layout = QtWidgets.QHBoxLayout()
        
        start_btn = QtWidgets.QPushButton("â–¶ï¸ DÃ©marrer")
        power_btn = QtWidgets.QPushButton("âš¡ Power-Up")
        reset_btn = QtWidgets.QPushButton("ðŸ”„ Reset")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        start_btn.clicked.connect(lambda: [modern_fade_in(game_area, 800), neon_glow_animation(start_btn, 1000)])
        power_btn.clicked.connect(lambda: holographic_effect(power_btn, 1000))
        reset_btn.clicked.connect(lambda: [score_label.setText("Score: 0"), morphing_animation(arcade_area, 1000)])
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(start_btn)
        actions_layout.addWidget(power_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        modern_fade_in(d, 1200)
        quantum_entanglement_effect(game_area, 3000)
    
    def show_tournaments(self):
        """Affiche les tournois disponibles"""
        QtWidgets.QMessageBox.information(self, "ðŸ† Tournois", "Tournois Ragnar OS !\n\nðŸ¥‡ Tournoi Snake : 15-30 Nov\nðŸŽ¯ DÃ©fi PrÃ©cision : En cours\nðŸ§© Marathon Puzzle : BientÃ´t\n\nInscrivez-vous et gagnez des prix !")
    
    def show_leaderboards(self):
        """Affiche les classements"""
        QtWidgets.QMessageBox.information(self, "ðŸ¥‡ Classements", "Top Joueurs Ragnar !\n\n1. ðŸ† RagnarMaster - 50,240 pts\n2. ðŸ¥ˆ PixelHero - 48,120 pts\n3. ðŸ¥‰ GameWizard - 45,890 pts\n4. ðŸŽ® ProGamer - 43,560 pts\n5. â­ Vous - 15,420 pts\n\nContinuez Ã  jouer pour grimper !")
    
    def show_game_settings(self):
        """Affiche les paramÃ¨tres de jeu"""
        QtWidgets.QMessageBox.information(self, "âš™ï¸ Options Jeu", "ParamÃ¨tres de Jeu !\n\nðŸ”Š Son : ActivÃ©\nðŸŽµ Musique : ActivÃ©e\nðŸŽ® DifficultÃ© : Normale\nâ±ï¸ Minuteur : ActivÃ©\nðŸ† Notifications : ActivÃ©es\n\nPersonnalisez votre expÃ©rience !")
    
    def show_email_client(self):
        """Client email moderne"""
        d = GlassDialog("ðŸ“§ Ragnar Mail", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Ragnar Mail", "Client email sÃ©curisÃ©")
        lay.addWidget(header)
        
        # Interface email
        email_tabs = QtWidgets.QTabWidget()
        
        # Onglet BoÃ®te de rÃ©ception
        inbox_tab = QtWidgets.QWidget()
        inbox_layout = QtWidgets.QVBoxLayout(inbox_tab)
        
        # Liste des emails
        email_list = QtWidgets.QListWidget()
        emails = [
            "ðŸ“§ Ragnar Team - Bienvenue dans Ragnar OS 26.3.3 !",
            "ðŸ›¡ï¸ SÃ©curitÃ© - Rapport de sÃ©curitÃ© hebdomadaire",
            "ðŸŽ® Games Center - Nouveau tournoi disponible !",
            "ðŸ“° Newsletter - Les nouveautÃ©s de cette semaine",
            "ðŸ”” Notifications - 5 nouvelles mises Ã  jour",
        ]
        
        for email in emails:
            email_list.addItem(email)
        
        inbox_layout.addWidget(email_list)
        email_tabs.addTab(inbox_tab, "ðŸ“¥ RÃ©ception")
        
        # Onglet Composer
        compose_tab = QtWidgets.QWidget()
        compose_layout = QtWidgets.QVBoxLayout(compose_tab)
        
        # Champs de composition
        to_field = QtWidgets.QLineEdit()
        to_field.setPlaceholderText("Destinataire...")
        subject_field = QtWidgets.QLineEdit()
        subject_field.setPlaceholderText("Objet...")
        message_field = QtWidgets.QTextEdit()
        message_field.setPlaceholderText("Votre message...")
        
        compose_layout.addWidget(QtWidgets.QLabel("Ã€ :"))
        compose_layout.addWidget(to_field)
        compose_layout.addWidget(QtWidgets.QLabel("Objet :"))
        compose_layout.addWidget(subject_field)
        compose_layout.addWidget(QtWidgets.QLabel("Message :"))
        compose_layout.addWidget(message_field)
        
        send_btn = QtWidgets.QPushButton("ðŸ“¤ Envoyer")
        send_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âœ… EnvoyÃ©", "Email envoyÃ© avec succÃ¨s !"))
        compose_layout.addWidget(send_btn)
        
        email_tabs.addTab(compose_tab, "âœï¸ Composer")
        
        lay.addWidget(email_tabs)
        
        # Actions
        actions_layout = QtWidgets.QHBoxLayout()
        refresh_btn = QtWidgets.QPushButton("ðŸ”„ Actualiser")
        settings_btn = QtWidgets.QPushButton("âš™ï¸ ParamÃ¨tres")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        refresh_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”„", "Emails actualisÃ©s !"))
        settings_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âš™ï¸", "Configuration email disponible !"))
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(refresh_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    # MÃ©thodes pour les nouvelles applications du menu
    def launch_rapp_from_desktop(self):
        """Scanne le Bureau pour les .rapp et en lance un au choix."""
        home = Path.home()
        desktop_candidates = [home / "Desktop", home / "Bureau"]
        desktop_dir = None
        for cand in desktop_candidates:
            if cand.exists():
                desktop_dir = cand
                break
        if desktop_dir is None:
            QtWidgets.QMessageBox.warning(self, "Bureau introuvable", "Aucun dossier Bureau n'a Ã©tÃ© trouvÃ©.")
            return
        try:
            rapps = sorted(desktop_dir.glob("*.rapp"))
        except Exception as e:
            QtWidgets.QMessageBox.critical(self, "Erreur", f"Impossible de lister le Bureau:\n{e}")
            return
        if not rapps:
            QtWidgets.QMessageBox.information(self, "Aucun .rapp", "Aucun fichier .rapp n'a Ã©tÃ© trouvÃ© sur le Bureau.")
            return
        items = [p.name for p in rapps]
        item, ok = QtWidgets.QInputDialog.getItem(self, "Lancer .rapp", "Choisir une application :", items, 0, False)
        if not ok or not item:
            return
        target = desktop_dir / item
        try:
            safe_open(target)
        except Exception as e:
            QtWidgets.QMessageBox.critical(self, "Erreur", f"Impossible de lancer {item}:\n{e}")

    def show_text_editor(self):
        """Ã‰diteur de texte professionnel"""
        d = GlassDialog("ðŸ“„ Ã‰diteur de Texte Ragnar", (1000, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(10)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Ã‰diteur de Texte Ragnar", "Ã‰dition de code et texte avancÃ©e")
        lay.addWidget(header)
        
        # Barre d'outils
        toolbar = QtWidgets.QHBoxLayout()
        
        new_btn = QtWidgets.QPushButton("ðŸ“„ Nouveau")
        open_btn = QtWidgets.QPushButton("ðŸ“ Ouvrir")
        save_btn = QtWidgets.QPushButton("ðŸ’¾ Sauvegarder")
        save_as_btn = QtWidgets.QPushButton("ðŸ’¾ Sauvegarder sous...")
        
        # SÃ©parateur
        sep1 = QtWidgets.QLabel("|")
        sep1.setStyleSheet("color: #666; font-weight: bold;")
        
        undo_btn = QtWidgets.QPushButton("â†¶ Annuler")
        redo_btn = QtWidgets.QPushButton("â†· Refaire")
        
        # SÃ©parateur
        sep2 = QtWidgets.QLabel("|")
        sep2.setStyleSheet("color: #666; font-weight: bold;")
        
        find_btn = QtWidgets.QPushButton("ðŸ” Rechercher")
        replace_btn = QtWidgets.QPushButton("ðŸ”„ Remplacer")
        
        toolbar.addWidget(new_btn)
        toolbar.addWidget(open_btn)
        toolbar.addWidget(save_btn)
        toolbar.addWidget(save_as_btn)
        toolbar.addWidget(sep1)
        toolbar.addWidget(undo_btn)
        toolbar.addWidget(redo_btn)
        toolbar.addWidget(sep2)
        toolbar.addWidget(find_btn)
        toolbar.addWidget(replace_btn)
        toolbar.addStretch()
        
        lay.addLayout(toolbar)
        
        # Zone d'Ã©dition
        editor_area = QtWidgets.QWidget(objectName="GlassCard")
        editor_layout = QtWidgets.QVBoxLayout(editor_area)
        editor_layout.setContentsMargins(10, 10, 10, 10)
        
        # Ã‰diteur de texte
        text_editor = QtWidgets.QTextEdit()
        text_editor.setStyleSheet("""
            QTextEdit {
                background: rgba(20, 20, 20, 0.9);
                border: 2px solid rgba(0, 255, 136, 0.3);
                border-radius: 8px;
                color: #ffffff;
                font-family: 'Consolas', 'Monaco', monospace;
                font-size: 14px;
                line-height: 1.4;
                padding: 10px;
            }
        """)
        
        # Texte d'exemple avec coloration syntaxique simulÃ©e
        sample_code = """# Ã‰diteur de Texte Ragnar - Exemple Python
import os
import sys

def hello_ragnar():
    \"\"\"Fonction d'exemple\"\"\"
    print("Bienvenue dans Ragnar OS 26.3.3!")
    
    # Variables
    version = "26.3.3"
    features = ["MultimÃ©dia", "Bureautique", "Jeux", "SystÃ¨me"]
    
    for feature in features:
        print(f"âœ… {feature} - Disponible")
    
    return True

if __name__ == "__main__":
    hello_ragnar()
    print("ðŸš€ Ragnar OS - PrÃªt pour l'action!")
"""
        text_editor.setPlainText(sample_code)
        editor_layout.addWidget(text_editor)
        
        lay.addWidget(editor_area)
        
        # Barre de statut
        status_bar = QtWidgets.QHBoxLayout()
        
        line_col_label = QtWidgets.QLabel("Ligne: 1, Colonne: 1")
        line_col_label.setStyleSheet("color: #00ff88; font-size: 12px;")
        
        encoding_label = QtWidgets.QLabel("UTF-8")
        encoding_label.setStyleSheet("color: #00aaff; font-size: 12px;")
        
        file_type_label = QtWidgets.QLabel("Python")
        file_type_label.setStyleSheet("color: #ffaa00; font-size: 12px;")
        
        status_bar.addWidget(line_col_label)
        status_bar.addStretch()
        status_bar.addWidget(encoding_label)
        status_bar.addWidget(QtWidgets.QLabel("|"))
        status_bar.addWidget(file_type_label)
        
        lay.addLayout(status_bar)
        
        # Actions des boutons
        new_btn.clicked.connect(lambda: text_editor.clear())
        save_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ’¾", "Fichier sauvegardÃ© !\n\nðŸ“ Emplacement : document.txt\nâ° " + str(QtCore.QDateTime.currentDateTime().toString())))
        
        find_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”", "Recherche avancÃ©e !\n\nðŸ” Options :\nâ€¢ Recherche simple\nâ€¢ Expressions rÃ©guliÃ¨res\nâ€¢ Respecter la casse\nâ€¢ Mot entier\nâ€¢ Recherche dans fichiers"))
        
        replace_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”„", "Remplacer !\n\nðŸ”„ FonctionnalitÃ©s :\nâ€¢ Remplacer tout\nâ€¢ Remplacer sÃ©lection\nâ€¢ AperÃ§u des changements\nâ€¢ Historique des remplacements"))
        
        # Actions
        actions_layout = QtWidgets.QHBoxLayout()
        
        syntax_btn = QtWidgets.QPushButton("ðŸŽ¨ Coloration")
        themes_btn = QtWidgets.QPushButton("ðŸŒ™ ThÃ¨mes")
        settings_btn = QtWidgets.QPushButton("âš™ï¸ ParamÃ¨tres")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        syntax_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸŽ¨", "Coloration syntaxique !\n\nðŸŽ¨ Langages supportÃ©s :\nâ€¢ Python â€¢ JavaScript â€¢ HTML\nâ€¢ CSS â€¢ JSON â€¢ XML\nâ€¢ C++ â€¢ Java â€¢ PHP\nâ€¢ Markdown â€¢ SQL"))
        
        themes_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸŒ™", "ThÃ¨mes disponibles !\n\nðŸŒ™ ThÃ¨mes :\nâ€¢ Dark Mode (actuel)\nâ€¢ Light Mode\nâ€¢ Monokai\nâ€¢ Solarized\nâ€¢ VS Code Dark\nâ€¢ Ragnar Theme"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(syntax_btn)
        actions_layout.addWidget(themes_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_spreadsheet(self):
        """Tableur professionnel"""
        d = GlassDialog("ðŸ“Š Tableur Ragnar", (1100, 750), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(10)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Tableur Ragnar", "Calculs et analyses de donnÃ©es avancÃ©es")
        lay.addWidget(header)
        
        # Barre d'outils
        toolbar = QtWidgets.QHBoxLayout()
        
        new_btn = QtWidgets.QPushButton("ðŸ“„ Nouveau")
        open_btn = QtWidgets.QPushButton("ðŸ“ Ouvrir")
        save_btn = QtWidgets.QPushButton("ðŸ’¾ Sauvegarder")
        
        # SÃ©parateur
        sep1 = QtWidgets.QLabel("|")
        sep1.setStyleSheet("color: #666; font-weight: bold;")
        
        formula_btn = QtWidgets.QPushButton("Æ’ Formules")
        chart_btn = QtWidgets.QPushButton("ðŸ“ˆ Graphiques")
        filter_btn = QtWidgets.QPushButton("ðŸ” Filtres")
        
        toolbar.addWidget(new_btn)
        toolbar.addWidget(open_btn)
        toolbar.addWidget(save_btn)
        toolbar.addWidget(sep1)
        toolbar.addWidget(formula_btn)
        toolbar.addWidget(chart_btn)
        toolbar.addWidget(filter_btn)
        toolbar.addStretch()
        
        lay.addLayout(toolbar)
        
        # Zone de la feuille de calcul
        spreadsheet_area = QtWidgets.QWidget(objectName="GlassCard")
        spreadsheet_layout = QtWidgets.QVBoxLayout(spreadsheet_area)
        spreadsheet_layout.setContentsMargins(10, 10, 10, 10)
        
        # Barre de formule
        formula_bar = QtWidgets.QHBoxLayout()
        formula_label = QtWidgets.QLabel("Æ’")
        formula_label.setStyleSheet("color: #00ff88; font-weight: bold; font-size: 16px;")
        formula_input = QtWidgets.QLineEdit("=SOMME(A1:A10)")
        formula_input.setStyleSheet("""
            QLineEdit {
                background: rgba(40, 40, 40, 0.8);
                border: 1px solid rgba(0, 255, 136, 0.5);
                border-radius: 4px;
                color: white;
                padding: 5px;
                font-family: monospace;
            }
        """)
        
        formula_bar.addWidget(formula_label)
        formula_bar.addWidget(formula_input)
        spreadsheet_layout.addLayout(formula_bar)
        
        # Table de donnÃ©es
        table = QtWidgets.QTableWidget(15, 8)
        table.setHorizontalHeaderLabels(['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'])
        table.setStyleSheet("""
            QTableWidget {
                background: rgba(30, 30, 30, 0.9);
                border: 1px solid rgba(0, 255, 136, 0.3);
                gridline-color: rgba(0, 255, 136, 0.2);
                color: white;
            }
            QHeaderView::section {
                background: rgba(0, 255, 136, 0.2);
                color: white;
                font-weight: bold;
                border: 1px solid rgba(0, 255, 136, 0.3);
                padding: 5px;
            }
        """)
        
        # DonnÃ©es d'exemple
        sample_data = [
            ["Produit", "Janvier", "FÃ©vrier", "Mars", "Total", "Moyenne", "", ""],
            ["Ordinateurs", "1500", "1800", "2100", "=B2+C2+D2", "=E2/3", "", ""],
            ["TÃ©lÃ©phones", "2300", "2100", "2500", "=B3+C3+D3", "=E3/3", "", ""],
            ["Tablettes", "800", "950", "1200", "=B4+C4+D4", "=E4/3", "", ""],
            ["Accessoires", "450", "520", "680", "=B5+C5+D5", "=E5/3", "", ""],
            ["", "", "", "", "", "", "", ""],
            ["TOTAL", "=SOMME(B2:B5)", "=SOMME(C2:C5)", "=SOMME(D2:D5)", "=SOMME(E2:E5)", "=MOYENNE(F2:F5)", "", ""],
            ["", "", "", "", "", "", "", ""],
            ["Analyse", "", "", "", "", "", "", ""],
            ["Croissance", "=C7/B7-1", "=D7/C7-1", "", "", "", "", ""],
            ["Meilleur mois", "=MAX(B7:D7)", "", "", "", "", "", ""]
        ]
        
        for row, row_data in enumerate(sample_data):
            for col, cell_data in enumerate(row_data):
                if cell_data:
                    item = QtWidgets.QTableWidgetItem(str(cell_data))
                    if cell_data.startswith("="):
                        item.setBackground(QtGui.QColor(0, 100, 200, 50))
                    elif row == 0:
                        item.setBackground(QtGui.QColor(0, 255, 136, 50))
                        item.setForeground(QtGui.QColor(255, 255, 255))
                    table.setItem(row, col, item)
        
        spreadsheet_layout.addWidget(table)
        lay.addWidget(spreadsheet_area)
        
        # Actions des boutons
        formula_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "Æ’", "Formules disponibles !\n\nÆ’ MathÃ©matiques :\nâ€¢ SOMME, MOYENNE, MAX, MIN\nâ€¢ ABS, RACINE, PUISSANCE\n\nÆ’ Logiques :\nâ€¢ SI, ET, OU, NON\n\nÆ’ Texte :\nâ€¢ CONCATENER, GAUCHE, DROITE\n\nÆ’ Date :\nâ€¢ AUJOURD'HUI, MAINTENANT"))
        
        chart_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“ˆ", "Graphiques disponibles !\n\nðŸ“ˆ Types :\nâ€¢ Histogrammes\nâ€¢ Courbes\nâ€¢ Secteurs (Camembert)\nâ€¢ Aires\nâ€¢ Nuages de points\nâ€¢ Barres horizontales\n\nðŸŽ¨ Personnalisation complÃ¨te"))
        
        filter_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”", "Filtres et tri !\n\nðŸ” Filtres :\nâ€¢ Filtres automatiques\nâ€¢ Filtres personnalisÃ©s\nâ€¢ Filtres avancÃ©s\n\nðŸ“Š Tri :\nâ€¢ Croissant/DÃ©croissant\nâ€¢ Tri multicritÃ¨res\nâ€¢ Tri personnalisÃ©"))
        
        # Actions principales
        actions_layout = QtWidgets.QHBoxLayout()
        
        export_btn = QtWidgets.QPushButton("ðŸ“¤ Exporter")
        print_btn = QtWidgets.QPushButton("ðŸ–¨ï¸ Imprimer")
        settings_btn = QtWidgets.QPushButton("âš™ï¸ ParamÃ¨tres")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“¤", "Export disponible !\n\nðŸ“¤ Formats :\nâ€¢ Excel (.xlsx)\nâ€¢ CSV (.csv)\nâ€¢ PDF (.pdf)\nâ€¢ OpenDocument (.ods)\nâ€¢ HTML (.html)\n\nâš™ï¸ Options d'export configurables"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(export_btn)
        actions_layout.addWidget(print_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_calendar(self):
        """Calendrier professionnel"""
        d = GlassDialog("ðŸ“… Calendrier Ragnar", (1000, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Calendrier Ragnar", "Gestion d'Ã©vÃ©nements et planification")
        lay.addWidget(header)
        
        # Barre d'outils
        toolbar = QtWidgets.QHBoxLayout()
        
        today_btn = QtWidgets.QPushButton("ðŸ“… Aujourd'hui")
        prev_btn = QtWidgets.QPushButton("â—€ PrÃ©cÃ©dent")
        next_btn = QtWidgets.QPushButton("Suivant â–¶")
        
        # SÃ©lecteur de vue
        view_combo = QtWidgets.QComboBox()
        view_combo.addItems(["Mois", "Semaine", "Jour", "Agenda"])
        view_combo.setStyleSheet("""
            QComboBox {
                background: rgba(40, 40, 40, 0.8);
                border: 1px solid rgba(0, 255, 136, 0.5);
                border-radius: 4px;
                color: white;
                padding: 5px;
                min-width: 80px;
            }
        """)
        
        add_event_btn = QtWidgets.QPushButton("âž• Nouvel Ã‰vÃ©nement")
        
        toolbar.addWidget(today_btn)
        toolbar.addWidget(prev_btn)
        toolbar.addWidget(next_btn)
        toolbar.addStretch()
        toolbar.addWidget(QtWidgets.QLabel("Vue:"))
        toolbar.addWidget(view_combo)
        toolbar.addWidget(add_event_btn)
        
        lay.addLayout(toolbar)
        
        # Zone principale du calendrier
        calendar_area = QtWidgets.QWidget(objectName="GlassCard")
        calendar_layout = QtWidgets.QVBoxLayout(calendar_area)
        calendar_layout.setContentsMargins(16, 16, 16, 16)
        
        # Titre du mois
        month_title = QtWidgets.QLabel("Octobre 2024")
        month_title.setStyleSheet("font-size: 20px; font-weight: bold; color: #00ff88; text-align: center; padding: 10px;")
        month_title.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        calendar_layout.addWidget(month_title)
        
        # Grille du calendrier
        calendar_grid = QtWidgets.QGridLayout()
        
        # En-tÃªtes des jours
        days_headers = ["Lun", "Mar", "Mer", "Jeu", "Ven", "Sam", "Dim"]
        for col, day in enumerate(days_headers):
            header_label = QtWidgets.QLabel(day)
            header_label.setStyleSheet("""
                QLabel {
                    background: rgba(0, 255, 136, 0.2);
                    color: white;
                    font-weight: bold;
                    padding: 8px;
                    border: 1px solid rgba(0, 255, 136, 0.3);
                }
            """)
            header_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            calendar_grid.addWidget(header_label, 0, col)
        
        # Jours du mois (exemple pour octobre 2024)
        import datetime
        current_date = datetime.date.today()
        
        # Simulation d'un calendrier
        calendar_days = [
            [30, 1, 2, 3, 4, 5, 6],
            [7, 8, 9, 10, 11, 12, 13],
            [14, 15, 16, 17, 18, 19, 20],
            [21, 22, 23, 24, 25, 26, 27],
            [28, 29, 30, 31, 1, 2, 3]
        ]
        
        # Ã‰vÃ©nements d'exemple
        events = {
            4: "ðŸŽ‰ Anniversaire",
            10: "ðŸ’¼ RÃ©union",
            15: "ðŸ¥ MÃ©decin",
            22: "ðŸŽ¬ CinÃ©ma",
            25: "ðŸ½ï¸ DÃ®ner"
        }
        
        for row, week in enumerate(calendar_days):
            for col, day in enumerate(week):
                day_widget = QtWidgets.QWidget()
                day_layout = QtWidgets.QVBoxLayout(day_widget)
                day_layout.setContentsMargins(2, 2, 2, 2)
                day_layout.setSpacing(2)
                
                # NumÃ©ro du jour
                day_label = QtWidgets.QLabel(str(day))
                day_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
                
                # Style selon le type de jour
                if row == 0 and day > 20:  # Mois prÃ©cÃ©dent
                    day_label.setStyleSheet("color: #666; font-size: 12px;")
                elif row == 4 and day < 10:  # Mois suivant
                    day_label.setStyleSheet("color: #666; font-size: 12px;")
                elif day == current_date.day:  # Aujourd'hui
                    day_label.setStyleSheet("""
                        QLabel {
                            background: rgba(0, 255, 136, 0.3);
                            color: white;
                            font-weight: bold;
                            font-size: 14px;
                            border-radius: 10px;
                            padding: 2px;
                        }
                    """)
                else:  # Jour normal
                    day_label.setStyleSheet("color: white; font-size: 12px;")
                
                day_layout.addWidget(day_label)
                
                # Ã‰vÃ©nement s'il y en a un
                if day in events:
                    event_label = QtWidgets.QLabel(events[day])
                    event_label.setStyleSheet("""
                        QLabel {
                            background: rgba(255, 170, 0, 0.3);
                            color: white;
                            font-size: 8px;
                            padding: 1px;
                            border-radius: 2px;
                        }
                    """)
                    event_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
                    day_layout.addWidget(event_label)
                
                day_widget.setStyleSheet("""
                    QWidget {
                        border: 1px solid rgba(0, 255, 136, 0.2);
                        background: rgba(40, 40, 40, 0.3);
                    }
                    QWidget:hover {
                        background: rgba(0, 255, 136, 0.1);
                    }
                """)
                day_widget.setFixedSize(120, 80)
                
                calendar_grid.addWidget(day_widget, row + 1, col)
        
        calendar_layout.addLayout(calendar_grid)
        lay.addWidget(calendar_area)
        
        # Panneau d'Ã©vÃ©nements
        events_panel = QtWidgets.QWidget(objectName="GlassCard")
        events_layout = QtWidgets.QVBoxLayout(events_panel)
        events_layout.setContentsMargins(16, 16, 16, 16)
        
        events_title = QtWidgets.QLabel("ðŸ“‹ Ã‰vÃ©nements Ã  venir")
        events_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        events_layout.addWidget(events_title)
        
        upcoming_events = [
            "ðŸŽ‰ 04/10 - Anniversaire de Marie",
            "ðŸ’¼ 10/10 - RÃ©union Ã©quipe (14h00)",
            "ðŸ¥ 15/10 - Rendez-vous mÃ©decin (10h30)",
            "ðŸŽ¬ 22/10 - CinÃ©ma avec amis (20h00)",
            "ðŸ½ï¸ 25/10 - DÃ®ner restaurant (19h30)"
        ]
        
        for event in upcoming_events:
            event_label = QtWidgets.QLabel(event)
            event_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 170, 255, 0.5);")
            events_layout.addWidget(event_label)
        
        lay.addWidget(events_panel)
        
        # Actions des boutons
        add_event_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âž•", "Nouvel Ã‰vÃ©nement !\n\nðŸ“ Informations :\nâ€¢ Titre de l'Ã©vÃ©nement\nâ€¢ Date et heure\nâ€¢ Lieu\nâ€¢ Description\nâ€¢ Rappels\nâ€¢ InvitÃ©s\n\nâœ… Ã‰vÃ©nement crÃ©Ã© !"))
        
        today_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“…", f"Aujourd'hui : {current_date.strftime('%d/%m/%Y')}\n\nðŸ“‹ Ã‰vÃ©nements du jour :\nâ€¢ Aucun Ã©vÃ©nement prÃ©vu\n\nâ° Il est actuellement 22h15"))
        
        # Actions principales
        actions_layout = QtWidgets.QHBoxLayout()
        
        sync_btn = QtWidgets.QPushButton("ðŸ”„ Synchroniser")
        export_btn = QtWidgets.QPushButton("ðŸ“¤ Exporter")
        settings_btn = QtWidgets.QPushButton("âš™ï¸ ParamÃ¨tres")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        sync_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”„", "Synchronisation !\n\nðŸ”„ Comptes connectÃ©s :\nâ€¢ Google Calendar âœ…\nâ€¢ Outlook âœ…\nâ€¢ iCloud âœ…\n\nðŸ“Š DerniÃ¨re sync : Il y a 5 min\nâœ… Tous les calendriers Ã  jour"))
        
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“¤", "Export calendrier !\n\nðŸ“¤ Formats disponibles :\nâ€¢ iCalendar (.ics)\nâ€¢ PDF (.pdf)\nâ€¢ Excel (.xlsx)\nâ€¢ CSV (.csv)\n\nðŸ“… PÃ©riode : Mois actuel"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(sync_btn)
        actions_layout.addWidget(export_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_pdf_reader(self):
        """Lecteur PDF professionnel"""
        d = GlassDialog("ðŸ“„ Lecteur PDF Ragnar", (900, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Lecteur PDF Ragnar", "Lecture et annotation de documents PDF")
        lay.addWidget(header)
        
        # Barre d'outils
        toolbar_card = QtWidgets.QWidget(objectName="GlassCard")
        toolbar_layout = QtWidgets.QHBoxLayout(toolbar_card)
        toolbar_layout.setContentsMargins(16, 8, 16, 8)
        
        open_pdf_btn = QtWidgets.QPushButton("ðŸ“ Ouvrir")
        save_btn = QtWidgets.QPushButton("ðŸ’¾ Sauvegarder")
        print_btn = QtWidgets.QPushButton("ðŸ–¨ï¸ Imprimer")
        
        # Zoom
        zoom_out_btn = QtWidgets.QPushButton("ðŸ”âž–")
        zoom_label = QtWidgets.QLabel("100%")
        zoom_label.setStyleSheet("color: #00ff88; font-weight: bold; min-width: 50px;")
        zoom_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        zoom_in_btn = QtWidgets.QPushButton("ðŸ”âž•")
        
        # Navigation
        prev_page_btn = QtWidgets.QPushButton("â¬…ï¸")
        page_label = QtWidgets.QLabel("Page 1 / 25")
        page_label.setStyleSheet("color: #00aaff; font-weight: bold; min-width: 80px;")
        page_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        next_page_btn = QtWidgets.QPushButton("âž¡ï¸")
        
        toolbar_layout.addWidget(open_pdf_btn)
        toolbar_layout.addWidget(save_btn)
        toolbar_layout.addWidget(print_btn)
        toolbar_layout.addStretch()
        toolbar_layout.addWidget(zoom_out_btn)
        toolbar_layout.addWidget(zoom_label)
        toolbar_layout.addWidget(zoom_in_btn)
        toolbar_layout.addStretch()
        toolbar_layout.addWidget(prev_page_btn)
        toolbar_layout.addWidget(page_label)
        toolbar_layout.addWidget(next_page_btn)
        
        lay.addWidget(toolbar_card)
        
        # Zone de lecture PDF
        pdf_area = QtWidgets.QWidget(objectName="GlassCard")
        pdf_area.setFixedHeight(400)
        pdf_layout = QtWidgets.QVBoxLayout(pdf_area)
        pdf_layout.setContentsMargins(16, 16, 16, 16)
        
        # Document PDF simulÃ©
        pdf_viewer = QtWidgets.QLabel("ðŸ“„ Document PDF - Page 1")
        pdf_viewer.setStyleSheet("""
            QLabel {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.95),
                    stop:1 rgba(240, 240, 240, 0.95));
                border: 2px solid rgba(0, 170, 255, 0.3);
                border-radius: 10px;
                color: #333333;
                font-size: 16px;
                font-weight: bold;
                padding: 20px;
            }
        """)
        pdf_viewer.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        pdf_viewer.setMinimumHeight(350)
        pdf_viewer.setWordWrap(True)
        pdf_viewer.setText("""ðŸ“„ DOCUMENT PDF EXEMPLE

Titre du Document : Guide Ragnar OS 26.3.3

Chapitre 1 : Introduction
Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.

â€¢ FonctionnalitÃ© 1 : Interface moderne
â€¢ FonctionnalitÃ© 2 : Applications intÃ©grÃ©es  
â€¢ FonctionnalitÃ© 3 : SÃ©curitÃ© avancÃ©e

Ut enim ad minim veniam, quis nostrud exercitation 
ullamco laboris nisi ut aliquip ex ea commodo consequat.

[Page 1 sur 25]""")
        
        pdf_layout.addWidget(pdf_viewer)
        lay.addWidget(pdf_area)
        
        # Panneau d'outils d'annotation
        annotation_card = QtWidgets.QWidget(objectName="GlassCard")
        annotation_layout = QtWidgets.QVBoxLayout(annotation_card)
        annotation_layout.setContentsMargins(16, 16, 16, 16)
        
        annotation_title = QtWidgets.QLabel("âœï¸ Outils d'Annotation")
        annotation_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        annotation_layout.addWidget(annotation_title)
        
        # Outils d'annotation
        annotation_tools = QtWidgets.QHBoxLayout()
        
        highlight_btn = QtWidgets.QPushButton("ðŸ–ï¸ Surligner")
        note_btn = QtWidgets.QPushButton("ðŸ“ Note")
        draw_btn = QtWidgets.QPushButton("âœï¸ Dessiner")
        text_btn = QtWidgets.QPushButton("ðŸ“„ Texte")
        bookmark_btn = QtWidgets.QPushButton("ðŸ”– Signet")
        
        annotation_tools.addWidget(highlight_btn)
        annotation_tools.addWidget(note_btn)
        annotation_tools.addWidget(draw_btn)
        annotation_tools.addWidget(text_btn)
        annotation_tools.addWidget(bookmark_btn)
        annotation_tools.addStretch()
        
        annotation_layout.addLayout(annotation_tools)
        lay.addWidget(annotation_card)
        
        # Actions principales
        actions_layout = QtWidgets.QHBoxLayout()
        
        search_btn = QtWidgets.QPushButton("ðŸ” Rechercher")
        bookmarks_btn = QtWidgets.QPushButton("ðŸ“‘ Signets")
        fullscreen_btn = QtWidgets.QPushButton("ðŸ”³ Plein Ã©cran")
        export_btn = QtWidgets.QPushButton("ðŸ“¤ Exporter")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        # Connecter les boutons
        open_pdf_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“", "Ouvrir un PDF !\n\nðŸ“ SÃ©lectionnez votre fichier PDF\nðŸ“„ Formats supportÃ©s :\nâ€¢ PDF standard\nâ€¢ PDF/A (archivage)\nâ€¢ PDF protÃ©gÃ©s\nâ€¢ Taille max : 500 MB"))
        
        zoom_in_btn.clicked.connect(lambda: self.pdf_zoom("in", zoom_label, pdf_viewer))
        zoom_out_btn.clicked.connect(lambda: self.pdf_zoom("out", zoom_label, pdf_viewer))
        
        next_page_btn.clicked.connect(lambda: self.pdf_navigate("next", page_label, pdf_viewer))
        prev_page_btn.clicked.connect(lambda: self.pdf_navigate("prev", page_label, pdf_viewer))
        
        highlight_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ–ï¸", "Mode Surlignage !\n\nðŸ–ï¸ SÃ©lectionnez le texte Ã  surligner\nðŸŽ¨ Couleurs disponibles :\nâ€¢ Jaune â€¢ Vert â€¢ Bleu â€¢ Rose\nâ€¢ Orange â€¢ Violet\n\nðŸ’¾ Sauvegarde automatique"))
        
        note_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“", "Ajouter une Note !\n\nðŸ“ Cliquez oÃ¹ vous voulez ajouter une note\nðŸ’­ Types de notes :\nâ€¢ Note textuelle\nâ€¢ Note vocale\nâ€¢ Dessin libre\n\nðŸ”— Liens vers d'autres pages"))
        
        search_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”", "Recherche dans le PDF !\n\nðŸ” Rechercher : [        ]\n\nðŸ“Š Options :\nâ€¢ Mot entier uniquement\nâ€¢ Respecter la casse\nâ€¢ Expressions rÃ©guliÃ¨res\n\nðŸ“„ RÃ©sultats : 0 trouvÃ©(s)"))
        
        bookmarks_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“‘", "Signets du Document !\n\nðŸ“‘ Signets existants :\nâ€¢ Introduction (Page 1)\nâ€¢ Chapitre 1 (Page 3)\nâ€¢ FonctionnalitÃ©s (Page 8)\nâ€¢ Configuration (Page 15)\nâ€¢ Annexes (Page 22)\n\nâž• Ajouter un signet"))
        
        fullscreen_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”³", "Mode Plein Ã‰cran !\n\nðŸ”³ Document en plein Ã©cran\nâŒ¨ï¸ Ã‰chap pour quitter\nðŸ–±ï¸ Clic droit pour menu\nðŸ“„ Navigation avec flÃ¨ches"))
        
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“¤", "Exporter le Document !\n\nðŸ“¤ Formats d'export :\nâ€¢ Images (PNG, JPG)\nâ€¢ Texte (TXT)\nâ€¢ Word (DOCX)\nâ€¢ PowerPoint (PPTX)\n\nâš™ï¸ Options d'export disponibles"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(search_btn)
        actions_layout.addWidget(bookmarks_btn)
        actions_layout.addWidget(fullscreen_btn)
        actions_layout.addWidget(export_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def pdf_zoom(self, direction, zoom_label, pdf_viewer):
        """GÃ¨re le zoom du PDF"""
        current_zoom = int(zoom_label.text().replace("%", ""))
        if direction == "in" and current_zoom < 300:
            new_zoom = current_zoom + 25
        elif direction == "out" and current_zoom > 50:
            new_zoom = current_zoom - 25
        else:
            return
        
        zoom_label.setText(f"{new_zoom}%")
        if new_zoom > 100:
            pdf_viewer.setStyleSheet(pdf_viewer.styleSheet().replace("font-size: 16px", f"font-size: {16 + (new_zoom-100)//10}px"))
    
    def pdf_navigate(self, direction, page_label, pdf_viewer):
        """Navigation entre les pages du PDF"""
        current_text = page_label.text()
        current_page = int(current_text.split()[1])
        total_pages = 25
        
        if direction == "next" and current_page < total_pages:
            new_page = current_page + 1
        elif direction == "prev" and current_page > 1:
            new_page = current_page - 1
        else:
            return
        
        page_label.setText(f"Page {new_page} / {total_pages}")
        pdf_viewer.setText(f"""ðŸ“„ DOCUMENT PDF EXEMPLE - PAGE {new_page}

Contenu de la page {new_page}...

Lorem ipsum dolor sit amet, consectetur adipiscing elit.
Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.

[Page {new_page} sur {total_pages}]""")
    
    def show_task_manager(self):
        """Gestionnaire de tÃ¢ches professionnel"""
        d = GlassDialog("ðŸ—‚ï¸ Gestionnaire de TÃ¢ches Ragnar", (900, 650), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Gestionnaire de TÃ¢ches", "Organisez votre productivitÃ©")
        lay.addWidget(header)
        
        # Barre d'outils
        toolbar = QtWidgets.QHBoxLayout()
        
        add_task_btn = QtWidgets.QPushButton("âž• Nouvelle TÃ¢che")
        filter_combo = QtWidgets.QComboBox()
        filter_combo.addItems(["Toutes", "Ã€ faire", "En cours", "TerminÃ©es", "PrioritÃ© haute"])
        filter_combo.setStyleSheet("background: rgba(40, 40, 40, 0.8); color: white; padding: 5px; border-radius: 4px;")
        
        search_input = QtWidgets.QLineEdit()
        search_input.setPlaceholderText("ðŸ” Rechercher une tÃ¢che...")
        search_input.setStyleSheet("background: rgba(40, 40, 40, 0.8); color: white; padding: 8px; border-radius: 4px;")
        
        toolbar.addWidget(add_task_btn)
        toolbar.addWidget(QtWidgets.QLabel("Filtre:"))
        toolbar.addWidget(filter_combo)
        toolbar.addStretch()
        toolbar.addWidget(search_input)
        
        lay.addLayout(toolbar)
        
        # Zone des tÃ¢ches
        tasks_area = QtWidgets.QWidget(objectName="GlassCard")
        tasks_layout = QtWidgets.QVBoxLayout(tasks_area)
        tasks_layout.setContentsMargins(16, 16, 16, 16)
        
        # Liste des tÃ¢ches
        sample_tasks = [
            ("âœ…", "Terminer le rapport mensuel", "Haute", "Aujourd'hui", "#ff6b6b"),
            ("ðŸ”„", "PrÃ©parer la prÃ©sentation client", "Moyenne", "Demain", "#ffa500"),
            ("â³", "RÃ©viser le code de l'application", "Haute", "Lundi", "#ff6b6b"),
            ("âœ…", "RÃ©pondre aux emails", "Faible", "Hier", "#4ecdc4"),
            ("ðŸ”„", "Planifier les vacances", "Moyenne", "Semaine prochaine", "#ffa500"),
            ("â³", "Acheter des fournitures bureau", "Faible", "Vendredi", "#4ecdc4")
        ]
        
        for status, task, priority, deadline, color in sample_tasks:
            task_card = QtWidgets.QWidget()
            task_card.setStyleSheet(f"""
                QWidget {{
                    background: rgba(40, 40, 40, 0.6);
                    border-left: 4px solid {color};
                    border-radius: 6px;
                    margin: 2px;
                    padding: 8px;
                }}
                QWidget:hover {{
                    background: rgba(60, 60, 60, 0.8);
                }}
            """)
            
            task_layout = QtWidgets.QHBoxLayout(task_card)
            task_layout.setContentsMargins(12, 8, 12, 8)
            
            # Status et tÃ¢che
            status_label = QtWidgets.QLabel(status)
            status_label.setStyleSheet("font-size: 16px;")
            
            task_info = QtWidgets.QVBoxLayout()
            task_name = QtWidgets.QLabel(task)
            task_name.setStyleSheet("color: white; font-weight: bold; font-size: 14px;")
            
            task_details = QtWidgets.QLabel(f"PrioritÃ©: {priority} â€¢ Ã‰chÃ©ance: {deadline}")
            task_details.setStyleSheet("color: #cccccc; font-size: 11px;")
            
            task_info.addWidget(task_name)
            task_info.addWidget(task_details)
            
            # Actions
            actions_layout = QtWidgets.QHBoxLayout()
            edit_btn = QtWidgets.QPushButton("âœï¸")
            edit_btn.setFixedSize(30, 30)
            delete_btn = QtWidgets.QPushButton("ðŸ—‘ï¸")
            delete_btn.setFixedSize(30, 30)
            
            actions_layout.addWidget(edit_btn)
            actions_layout.addWidget(delete_btn)
            
            task_layout.addWidget(status_label)
            task_layout.addLayout(task_info)
            task_layout.addStretch()
            task_layout.addLayout(actions_layout)
            
            tasks_layout.addWidget(task_card)
        
        lay.addWidget(tasks_area)
        
        # Statistiques
        stats_card = QtWidgets.QWidget(objectName="GlassCard")
        stats_layout = QtWidgets.QHBoxLayout(stats_card)
        stats_layout.setContentsMargins(16, 12, 16, 12)
        
        stats_info = [
            ("ðŸ“Š", "Total", "12 tÃ¢ches"),
            ("âœ…", "TerminÃ©es", "4 tÃ¢ches"),
            ("ðŸ”„", "En cours", "5 tÃ¢ches"),
            ("â³", "Ã€ faire", "3 tÃ¢ches")
        ]
        
        for icon, label, value in stats_info:
            stat_widget = QtWidgets.QVBoxLayout()
            icon_label = QtWidgets.QLabel(icon)
            icon_label.setStyleSheet("font-size: 20px; text-align: center;")
            icon_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            label_widget = QtWidgets.QLabel(label)
            label_widget.setStyleSheet("color: #cccccc; font-size: 12px; text-align: center;")
            label_widget.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            value_widget = QtWidgets.QLabel(value)
            value_widget.setStyleSheet("color: #00ff88; font-weight: bold; font-size: 14px; text-align: center;")
            value_widget.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            stat_widget.addWidget(icon_label)
            stat_widget.addWidget(label_widget)
            stat_widget.addWidget(value_widget)
            
            stats_layout.addLayout(stat_widget)
            if icon != "â³":  # Pas de sÃ©parateur aprÃ¨s le dernier
                sep = QtWidgets.QLabel("|")
                sep.setStyleSheet("color: #666;")
                stats_layout.addWidget(sep)
        
        lay.addWidget(stats_card)
        
        # Actions des boutons
        add_task_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âž•", "Nouvelle TÃ¢che !\n\nðŸ“ Informations :\nâ€¢ Titre de la tÃ¢che\nâ€¢ Description\nâ€¢ PrioritÃ© (Haute/Moyenne/Faible)\nâ€¢ Ã‰chÃ©ance\nâ€¢ CatÃ©gorie\nâ€¢ AssignÃ© Ã \n\nâœ… TÃ¢che crÃ©Ã©e !"))
        
        # Actions principales
        actions_layout = QtWidgets.QHBoxLayout()
        
        export_btn = QtWidgets.QPushButton("ðŸ“¤ Exporter")
        calendar_btn = QtWidgets.QPushButton("ðŸ“… Calendrier")
        reports_btn = QtWidgets.QPushButton("ðŸ“Š Rapports")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“¤", "Export des tÃ¢ches !\n\nðŸ“¤ Formats :\nâ€¢ PDF (.pdf)\nâ€¢ Excel (.xlsx)\nâ€¢ CSV (.csv)\nâ€¢ JSON (.json)\n\nðŸ“‹ Toutes les tÃ¢ches exportÃ©es"))
        
        calendar_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“…", "Vue Calendrier !\n\nðŸ“… Affichage :\nâ€¢ TÃ¢ches par jour\nâ€¢ Ã‰chÃ©ances importantes\nâ€¢ Planning hebdomadaire\nâ€¢ Vue mensuelle\n\nðŸ”„ Synchronisation avec Calendrier Ragnar"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(export_btn)
        actions_layout.addWidget(calendar_btn)
        actions_layout.addWidget(reports_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_timer_app(self):
        """Application minuteur et chronomÃ¨tre complÃ¨te"""
        d = GlassDialog("â° Minuteur & Chrono Ragnar", (700, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Minuteur & ChronomÃ¨tre", "Gestion du temps prÃ©cise")
        lay.addWidget(header)
        
        # Onglets
        tabs = QtWidgets.QTabWidget()
        
        # === ONGLET MINUTEUR ===
        timer_tab = QtWidgets.QWidget()
        timer_layout = QtWidgets.QVBoxLayout(timer_tab)
        
        # Affichage du temps
        timer_display = QtWidgets.QLabel("05:00")
        timer_display.setStyleSheet("""
            QLabel {
                font-size: 48px;
                font-weight: bold;
                color: #00ff88;
                background: rgba(0, 0, 0, 0.3);
                border: 2px solid rgba(0, 255, 136, 0.5);
                border-radius: 15px;
                padding: 20px;
                text-align: center;
            }
        """)
        timer_display.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        timer_layout.addWidget(timer_display)
        
        # ContrÃ´les minuteur
        timer_controls = QtWidgets.QHBoxLayout()
        
        # SÃ©lection du temps
        time_inputs = QtWidgets.QHBoxLayout()
        
        hours_spin = QtWidgets.QSpinBox()
        hours_spin.setRange(0, 23)
        hours_spin.setValue(0)
        hours_spin.setSuffix("h")
        
        minutes_spin = QtWidgets.QSpinBox()
        minutes_spin.setRange(0, 59)
        minutes_spin.setValue(5)
        minutes_spin.setSuffix("min")
        
        seconds_spin = QtWidgets.QSpinBox()
        seconds_spin.setRange(0, 59)
        seconds_spin.setValue(0)
        seconds_spin.setSuffix("s")
        
        time_inputs.addWidget(QtWidgets.QLabel("Temps:"))
        time_inputs.addWidget(hours_spin)
        time_inputs.addWidget(minutes_spin)
        time_inputs.addWidget(seconds_spin)
        time_inputs.addStretch()
        
        timer_layout.addLayout(time_inputs)
        
        # Boutons minuteur
        timer_buttons = QtWidgets.QHBoxLayout()
        
        start_timer_btn = QtWidgets.QPushButton("â–¶ï¸ DÃ©marrer")
        pause_timer_btn = QtWidgets.QPushButton("â¸ï¸ Pause")
        stop_timer_btn = QtWidgets.QPushButton("â¹ï¸ ArrÃªter")
        reset_timer_btn = QtWidgets.QPushButton("ðŸ”„ Reset")
        
        timer_buttons.addWidget(start_timer_btn)
        timer_buttons.addWidget(pause_timer_btn)
        timer_buttons.addWidget(stop_timer_btn)
        timer_buttons.addWidget(reset_timer_btn)
        
        timer_layout.addLayout(timer_buttons)
        
        # Minuteurs prÃ©dÃ©finis
        presets_layout = QtWidgets.QHBoxLayout()
        presets_layout.addWidget(QtWidgets.QLabel("Minuteurs rapides:"))
        
        preset_1min = QtWidgets.QPushButton("1min")
        preset_5min = QtWidgets.QPushButton("5min")
        preset_10min = QtWidgets.QPushButton("10min")
        preset_25min = QtWidgets.QPushButton("25min (Pomodoro)")
        
        presets_layout.addWidget(preset_1min)
        presets_layout.addWidget(preset_5min)
        presets_layout.addWidget(preset_10min)
        presets_layout.addWidget(preset_25min)
        
        timer_layout.addLayout(presets_layout)
        
        tabs.addTab(timer_tab, "â° Minuteur")
        
        # === ONGLET CHRONOMÃˆTRE ===
        stopwatch_tab = QtWidgets.QWidget()
        stopwatch_layout = QtWidgets.QVBoxLayout(stopwatch_tab)
        
        # Affichage chrono
        stopwatch_display = QtWidgets.QLabel("00:00:00")
        stopwatch_display.setStyleSheet("""
            QLabel {
                font-size: 48px;
                font-weight: bold;
                color: #00aaff;
                background: rgba(0, 0, 0, 0.3);
                border: 2px solid rgba(0, 170, 255, 0.5);
                border-radius: 15px;
                padding: 20px;
                text-align: center;
            }
        """)
        stopwatch_display.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        stopwatch_layout.addWidget(stopwatch_display)
        
        # Boutons chrono
        stopwatch_buttons = QtWidgets.QHBoxLayout()
        
        start_stopwatch_btn = QtWidgets.QPushButton("â–¶ï¸ DÃ©marrer")
        lap_btn = QtWidgets.QPushButton("ðŸ Tour")
        stop_stopwatch_btn = QtWidgets.QPushButton("â¹ï¸ ArrÃªter")
        reset_stopwatch_btn = QtWidgets.QPushButton("ðŸ”„ Reset")
        
        stopwatch_buttons.addWidget(start_stopwatch_btn)
        stopwatch_buttons.addWidget(lap_btn)
        stopwatch_buttons.addWidget(stop_stopwatch_btn)
        stopwatch_buttons.addWidget(reset_stopwatch_btn)
        
        stopwatch_layout.addLayout(stopwatch_buttons)
        
        # Liste des tours
        laps_card = QtWidgets.QWidget(objectName="GlassCard")
        laps_layout = QtWidgets.QVBoxLayout(laps_card)
        laps_layout.setContentsMargins(16, 16, 16, 16)
        
        laps_title = QtWidgets.QLabel("ðŸ Tours enregistrÃ©s")
        laps_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        laps_layout.addWidget(laps_title)
        
        # Tours d'exemple
        sample_laps = [
            "Tour 1: 00:01:23.45",
            "Tour 2: 00:01:18.92",
            "Tour 3: 00:01:25.67",
            "Tour 4: 00:01:21.34"
        ]
        
        for lap in sample_laps:
            lap_label = QtWidgets.QLabel(lap)
            lap_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 170, 255, 0.5);")
            laps_layout.addWidget(lap_label)
        
        stopwatch_layout.addWidget(laps_card)
        
        tabs.addTab(stopwatch_tab, "â±ï¸ ChronomÃ¨tre")
        
        # === ONGLET ALARMES ===
        alarms_tab = QtWidgets.QWidget()
        alarms_layout = QtWidgets.QVBoxLayout(alarms_tab)
        
        # Liste des alarmes
        alarms_card = QtWidgets.QWidget(objectName="GlassCard")
        alarms_card_layout = QtWidgets.QVBoxLayout(alarms_card)
        alarms_card_layout.setContentsMargins(16, 16, 16, 16)
        
        alarms_title = QtWidgets.QLabel("â° Alarmes programmÃ©es")
        alarms_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        alarms_card_layout.addWidget(alarms_title)
        
        # Alarmes d'exemple
        sample_alarms = [
            ("07:00", "RÃ©veil", "Lun-Ven", True),
            ("12:30", "Pause dÃ©jeuner", "Tous les jours", True),
            ("18:00", "Fin de travail", "Lun-Ven", False),
            ("22:00", "Coucher", "Tous les jours", True)
        ]
        
        for time, name, days, active in sample_alarms:
            alarm_widget = QtWidgets.QHBoxLayout()
            
            time_label = QtWidgets.QLabel(time)
            time_label.setStyleSheet("color: #ffaa00; font-weight: bold; font-size: 16px; min-width: 60px;")
            
            info_layout = QtWidgets.QVBoxLayout()
            name_label = QtWidgets.QLabel(name)
            name_label.setStyleSheet("color: white; font-weight: bold; font-size: 14px;")
            days_label = QtWidgets.QLabel(days)
            days_label.setStyleSheet("color: #cccccc; font-size: 11px;")
            
            info_layout.addWidget(name_label)
            info_layout.addWidget(days_label)
            
            toggle_btn = QtWidgets.QPushButton("âœ…" if active else "âŒ")
            toggle_btn.setFixedSize(40, 40)
            
            alarm_widget.addWidget(time_label)
            alarm_widget.addLayout(info_layout)
            alarm_widget.addStretch()
            alarm_widget.addWidget(toggle_btn)
            
            alarms_card_layout.addLayout(alarm_widget)
        
        alarms_layout.addWidget(alarms_card)
        
        # Bouton nouvelle alarme
        add_alarm_btn = QtWidgets.QPushButton("âž• Nouvelle Alarme")
        add_alarm_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âž•", "Nouvelle Alarme !\n\nâ° Configuration :\nâ€¢ Heure : 08:00\nâ€¢ Nom : Mon alarme\nâ€¢ RÃ©pÃ©tition : Lun-Ven\nâ€¢ Son : MÃ©lodie douce\nâ€¢ RÃ©pÃ©tition : 3 fois\n\nâœ… Alarme crÃ©Ã©e !"))
        alarms_layout.addWidget(add_alarm_btn)
        
        tabs.addTab(alarms_tab, "ðŸ”” Alarmes")
        
        lay.addWidget(tabs)
        
        # Actions des boutons
        start_timer_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "â–¶ï¸", "Minuteur dÃ©marrÃ© !\n\nâ° Temps : 5 minutes\nðŸ”” Notification Ã  la fin\nâ±ï¸ Temps restant affichÃ©"))
        
        start_stopwatch_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "â–¶ï¸", "ChronomÃ¨tre dÃ©marrÃ© !\n\nâ±ï¸ PrÃ©cision : centiÃ¨mes\nðŸ Appuyez sur Tour pour marquer\nðŸ“Š Statistiques disponibles"))
        
        # Actions principales
        actions_layout = QtWidgets.QHBoxLayout()
        
        sounds_btn = QtWidgets.QPushButton("ðŸ”Š Sons")
        settings_btn = QtWidgets.QPushButton("âš™ï¸ ParamÃ¨tres")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        sounds_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”Š", "Sons disponibles !\n\nðŸŽµ Sonneries :\nâ€¢ MÃ©lodie douce\nâ€¢ Bip classique\nâ€¢ Carillon\nâ€¢ Alarme forte\nâ€¢ Son personnalisÃ©\n\nðŸ”Š Volume rÃ©glable"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(sounds_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_unit_converter(self):
        """Convertisseur d'unitÃ©s universel"""
        d = GlassDialog("ðŸ“ Convertisseur Ragnar", (800, 650), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Convertisseur Universel", "Conversions prÃ©cises et rapides")
        lay.addWidget(header)
        
        # SÃ©lecteur de catÃ©gorie
        category_layout = QtWidgets.QHBoxLayout()
        category_layout.addWidget(QtWidgets.QLabel("CatÃ©gorie:"))
        
        category_combo = QtWidgets.QComboBox()
        categories = [
            "ðŸ“ Longueur", "âš–ï¸ Poids/Masse", "ðŸŒ¡ï¸ TempÃ©rature", 
            "ðŸ’° Devises", "â±ï¸ Temps", "ðŸ“Š Volume", 
            "âš¡ Ã‰nergie", "ðŸ”Œ Puissance", "ðŸ’¾ DonnÃ©es"
        ]
        category_combo.addItems(categories)
        category_combo.setStyleSheet("background: rgba(40, 40, 40, 0.8); color: white; padding: 8px; border-radius: 4px; min-width: 150px;")
        
        category_layout.addWidget(category_combo)
        category_layout.addStretch()
        
        lay.addLayout(category_layout)
        
        # Zone de conversion
        converter_card = QtWidgets.QWidget(objectName="GlassCard")
        converter_layout = QtWidgets.QVBoxLayout(converter_card)
        converter_layout.setContentsMargins(20, 20, 20, 20)
        
        # Conversion FROM
        from_layout = QtWidgets.QHBoxLayout()
        from_layout.addWidget(QtWidgets.QLabel("De:"))
        
        from_value = QtWidgets.QLineEdit("1")
        from_value.setStyleSheet("background: rgba(40, 40, 40, 0.8); color: white; padding: 8px; border-radius: 4px; font-size: 16px;")
        from_value.setFixedWidth(150)
        
        from_unit = QtWidgets.QComboBox()
        from_unit.addItems(["mÃ¨tre", "kilomÃ¨tre", "centimÃ¨tre", "millimÃ¨tre", "pouce", "pied", "yard", "mile"])
        from_unit.setStyleSheet("background: rgba(40, 40, 40, 0.8); color: white; padding: 8px; border-radius: 4px;")
        
        from_layout.addWidget(from_value)
        from_layout.addWidget(from_unit)
        from_layout.addStretch()
        
        converter_layout.addLayout(from_layout)
        
        # Bouton d'Ã©change
        swap_btn = QtWidgets.QPushButton("ðŸ”„ Ã‰changer")
        swap_btn.setFixedWidth(120)
        converter_layout.addWidget(swap_btn, alignment=QtCore.Qt.AlignmentFlag.AlignCenter)
        
        # Conversion TO
        to_layout = QtWidgets.QHBoxLayout()
        to_layout.addWidget(QtWidgets.QLabel("Vers:"))
        
        to_value = QtWidgets.QLineEdit("100")
        to_value.setReadOnly(True)
        to_value.setStyleSheet("""
            QLineEdit {
                background: rgba(0, 255, 136, 0.2);
                color: #00ff88;
                padding: 8px;
                border-radius: 4px;
                font-size: 16px;
                font-weight: bold;
            }
        """)
        to_value.setFixedWidth(150)
        
        to_unit = QtWidgets.QComboBox()
        to_unit.addItems(["centimÃ¨tre", "mÃ¨tre", "kilomÃ¨tre", "millimÃ¨tre", "pouce", "pied", "yard", "mile"])
        to_unit.setStyleSheet("background: rgba(40, 40, 40, 0.8); color: white; padding: 8px; border-radius: 4px;")
        
        to_layout.addWidget(to_value)
        to_layout.addWidget(to_unit)
        to_layout.addStretch()
        
        converter_layout.addLayout(to_layout)
        
        lay.addWidget(converter_card)
        
        # Conversions rapides
        quick_conversions = QtWidgets.QWidget(objectName="GlassCard")
        quick_layout = QtWidgets.QVBoxLayout(quick_conversions)
        quick_layout.setContentsMargins(16, 16, 16, 16)
        
        quick_title = QtWidgets.QLabel("âš¡ Conversions Rapides")
        quick_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        quick_layout.addWidget(quick_title)
        
        # Grille de conversions rapides
        quick_grid = QtWidgets.QGridLayout()
        
        quick_conversions_data = [
            ("1 m", "= 100 cm", "= 3.28 ft", "= 39.37 in"),
            ("1 km", "= 1000 m", "= 0.62 mi", "= 3280 ft"),
            ("1 kg", "= 1000 g", "= 2.20 lb", "= 35.27 oz"),
            ("1 L", "= 1000 ml", "= 0.26 gal", "= 33.81 fl oz")
        ]
        
        for i, (base, conv1, conv2, conv3) in enumerate(quick_conversions_data):
            base_label = QtWidgets.QLabel(base)
            base_label.setStyleSheet("color: #00ff88; font-weight: bold; font-size: 14px;")
            
            conv1_label = QtWidgets.QLabel(conv1)
            conv1_label.setStyleSheet("color: white; font-size: 12px;")
            
            conv2_label = QtWidgets.QLabel(conv2)
            conv2_label.setStyleSheet("color: #cccccc; font-size: 12px;")
            
            conv3_label = QtWidgets.QLabel(conv3)
            conv3_label.setStyleSheet("color: #cccccc; font-size: 12px;")
            
            quick_grid.addWidget(base_label, i, 0)
            quick_grid.addWidget(conv1_label, i, 1)
            quick_grid.addWidget(conv2_label, i, 2)
            quick_grid.addWidget(conv3_label, i, 3)
        
        quick_layout.addLayout(quick_grid)
        lay.addWidget(quick_conversions)
        
        # Historique des conversions
        history_card = QtWidgets.QWidget(objectName="GlassCard")
        history_layout = QtWidgets.QVBoxLayout(history_card)
        history_layout.setContentsMargins(16, 16, 16, 16)
        
        history_title = QtWidgets.QLabel("ðŸ“‹ Historique")
        history_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        history_layout.addWidget(history_title)
        
        history_items = [
            "5 km â†’ 3.11 miles",
            "100Â°F â†’ 37.78Â°C",
            "2.5 kg â†’ 5.51 lbs",
            "1 GB â†’ 1024 MB"
        ]
        
        for item in history_items:
            item_label = QtWidgets.QLabel(item)
            item_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(255, 170, 0, 0.5);")
            history_layout.addWidget(item_label)
        
        lay.addWidget(history_card)
        
        # Actions des boutons
        def update_conversion():
            try:
                value = float(from_value.text())
                from_u = from_unit.currentText()
                to_u = to_unit.currentText()
                
                # Simulation de conversion (mÃ¨tres vers centimÃ¨tres)
                if from_u == "mÃ¨tre" and to_u == "centimÃ¨tre":
                    result = value * 100
                elif from_u == "centimÃ¨tre" and to_u == "mÃ¨tre":
                    result = value / 100
                elif from_u == "kilomÃ¨tre" and to_u == "mÃ¨tre":
                    result = value * 1000
                else:
                    result = value * 1.5  # Conversion gÃ©nÃ©rique simulÃ©e
                
                to_value.setText(f"{result:.4f}")
            except:
                to_value.setText("Erreur")
        
        from_value.textChanged.connect(update_conversion)
        from_unit.currentTextChanged.connect(update_conversion)
        to_unit.currentTextChanged.connect(update_conversion)
        
        def change_category():
            category = category_combo.currentText()
            if "Longueur" in category:
                units = ["mÃ¨tre", "kilomÃ¨tre", "centimÃ¨tre", "millimÃ¨tre", "pouce", "pied", "yard", "mile"]
            elif "Poids" in category:
                units = ["kilogramme", "gramme", "livre", "once", "tonne", "stone"]
            elif "TempÃ©rature" in category:
                units = ["Celsius", "Fahrenheit", "Kelvin", "Rankine"]
            elif "Devises" in category:
                units = ["EUR", "USD", "GBP", "JPY", "CHF", "CAD"]
            elif "Temps" in category:
                units = ["seconde", "minute", "heure", "jour", "semaine", "mois", "annÃ©e"]
            else:
                units = ["unitÃ©1", "unitÃ©2", "unitÃ©3"]
            
            from_unit.clear()
            to_unit.clear()
            from_unit.addItems(units)
            to_unit.addItems(units)
        
        category_combo.currentTextChanged.connect(change_category)
        
        swap_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”„", "UnitÃ©s Ã©changÃ©es !\n\nðŸ”„ Les unitÃ©s source et destination\nont Ã©tÃ© inversÃ©es automatiquement"))
        
        # Actions principales
        actions_layout = QtWidgets.QHBoxLayout()
        
        calculator_btn = QtWidgets.QPushButton("ðŸ§® Calculatrice")
        favorites_btn = QtWidgets.QPushButton("â­ Favoris")
        export_btn = QtWidgets.QPushButton("ðŸ“¤ Exporter")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        calculator_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ§®", "Calculatrice intÃ©grÃ©e !\n\nðŸ§® Fonctions :\nâ€¢ Calculs de base\nâ€¢ Fonctions scientifiques\nâ€¢ Conversions directes\nâ€¢ Historique des calculs"))
        
        favorites_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "â­", "Conversions favorites !\n\nâ­ Favoris sauvegardÃ©s :\nâ€¢ km â†’ miles\nâ€¢ Â°C â†’ Â°F\nâ€¢ kg â†’ lbs\nâ€¢ L â†’ gallons\n\nâž• Ajouter aux favoris"))
        
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(calculator_btn)
        actions_layout.addWidget(favorites_btn)
        actions_layout.addWidget(export_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_video_player(self):
        """Lecteur vidÃ©o professionnel"""
        d = GlassDialog("ðŸŽ¬ Lecteur VidÃ©o Ragnar", (900, 650), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Lecteur VidÃ©o Ragnar", "Lecture multimÃ©dia haute qualitÃ©")
        lay.addWidget(header)
        
        # Zone de lecture vidÃ©o
        video_area = QtWidgets.QWidget(objectName="GlassCard")
        video_area.setFixedHeight(300)
        video_layout = QtWidgets.QVBoxLayout(video_area)
        video_layout.setContentsMargins(16, 16, 16, 16)
        
        # Ã‰cran vidÃ©o simulÃ©
        video_screen = QtWidgets.QLabel("ðŸŽ¬ Aucune vidÃ©o chargÃ©e")
        video_screen.setStyleSheet("""
            QLabel {
                background: qlineargradient(x1:0, y1:0, x2:1, y2:1,
                    stop:0 rgba(0, 0, 0, 0.8),
                    stop:1 rgba(20, 20, 20, 0.8));
                border: 2px solid rgba(0, 255, 136, 0.3);
                border-radius: 10px;
                color: #00ff88;
                font-size: 24px;
                font-weight: bold;
            }
        """)
        video_screen.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        video_screen.setMinimumHeight(250)
        video_layout.addWidget(video_screen)
        
        lay.addWidget(video_area)
        
        # ContrÃ´les de lecture
        controls_card = QtWidgets.QWidget(objectName="GlassCard")
        controls_layout = QtWidgets.QVBoxLayout(controls_card)
        controls_layout.setContentsMargins(16, 16, 16, 16)
        
        # Barre de progression
        progress_layout = QtWidgets.QHBoxLayout()
        time_current = QtWidgets.QLabel("00:00")
        time_current.setStyleSheet("color: #00ff88; font-weight: bold;")
        
        progress_bar = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        progress_bar.setRange(0, 100)
        progress_bar.setValue(35)
        
        time_total = QtWidgets.QLabel("02:34")
        time_total.setStyleSheet("color: #cccccc; font-weight: bold;")
        
        progress_layout.addWidget(time_current)
        progress_layout.addWidget(progress_bar)
        progress_layout.addWidget(time_total)
        
        controls_layout.addLayout(progress_layout)
        
        # Boutons de contrÃ´le
        buttons_layout = QtWidgets.QHBoxLayout()
        
        prev_btn = QtWidgets.QPushButton("â®ï¸")
        play_btn = QtWidgets.QPushButton("â–¶ï¸")
        pause_btn = QtWidgets.QPushButton("â¸ï¸")
        stop_btn = QtWidgets.QPushButton("â¹ï¸")
        next_btn = QtWidgets.QPushButton("â­ï¸")
        
        # Volume
        volume_label = QtWidgets.QLabel("ðŸ”Š")
        volume_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        volume_slider.setRange(0, 100)
        volume_slider.setValue(75)
        volume_slider.setMaximumWidth(100)
        
        # Plein Ã©cran
        fullscreen_btn = QtWidgets.QPushButton("ðŸ”³")
        
        buttons_layout.addWidget(prev_btn)
        buttons_layout.addWidget(play_btn)
        buttons_layout.addWidget(pause_btn)
        buttons_layout.addWidget(stop_btn)
        buttons_layout.addWidget(next_btn)
        buttons_layout.addStretch()
        buttons_layout.addWidget(volume_label)
        buttons_layout.addWidget(volume_slider)
        buttons_layout.addWidget(fullscreen_btn)
        
        controls_layout.addLayout(buttons_layout)
        lay.addWidget(controls_card)
        
        # Actions
        actions_layout = QtWidgets.QHBoxLayout()
        
        open_btn = QtWidgets.QPushButton("ðŸ“ Ouvrir")
        playlist_btn = QtWidgets.QPushButton("ðŸ“‹ Playlist")
        subtitles_btn = QtWidgets.QPushButton("ðŸ’¬ Sous-titres")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        open_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“", "Ouvrir une vidÃ©o !\n\nðŸ“ Formats supportÃ©s :\nâ€¢ MP4, AVI, MKV, MOV\nâ€¢ WMV, FLV, WEBM\nâ€¢ 4K, HDR supportÃ©s"))
        playlist_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“‹", "Playlist vidÃ©o !\n\nðŸ“‹ Playlist actuelle :\nâ€¢ demo_video.mp4 â–¶ï¸\nâ€¢ film_action.mkv\nâ€¢ documentaire.avi\nâ€¢ serie_s01e01.mp4"))
        subtitles_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ’¬", "Sous-titres !\n\nðŸ’¬ Langues disponibles :\nâ€¢ FranÃ§ais âœ…\nâ€¢ Anglais\nâ€¢ Espagnol\nâ€¢ Allemand"))
        close_btn.clicked.connect(d.close)
        
        # Connecter les boutons de contrÃ´le
        play_btn.clicked.connect(lambda: self.video_control("play", video_screen))
        pause_btn.clicked.connect(lambda: self.video_control("pause", video_screen))
        stop_btn.clicked.connect(lambda: self.video_control("stop", video_screen))
        
        actions_layout.addWidget(open_btn)
        actions_layout.addWidget(playlist_btn)
        actions_layout.addWidget(subtitles_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def video_control(self, action, video_screen):
        """ContrÃ´le la lecture vidÃ©o"""
        if action == "play":
            video_screen.setText("â–¶ï¸ Lecture en cours...")
        elif action == "pause":
            video_screen.setText("â¸ï¸ VidÃ©o en pause")
        elif action == "stop":
            video_screen.setText("â¹ï¸ Lecture arrÃªtÃ©e")
    
    def show_image_viewer(self):
        QtWidgets.QMessageBox.information(self, "ðŸ–¼ï¸ Visionneuse", "Visionneuse d'images !\n\nFormats :\nâ€¢ JPG, PNG, GIF\nâ€¢ Diaporama\nâ€¢ Ã‰dition basique")
    
    def show_audio_recorder(self):
        QtWidgets.QMessageBox.information(self, "ðŸŽ™ï¸ Enregistreur", "Enregistreur audio !\n\nFonctionnalitÃ©s :\nâ€¢ Haute qualitÃ©\nâ€¢ Effets\nâ€¢ Formats multiples")
    
    def show_webcam_studio(self):
        QtWidgets.QMessageBox.information(self, "ðŸ“¹ Webcam Studio", "Studio webcam !\n\nFonctionnalitÃ©s :\nâ€¢ Streaming\nâ€¢ Effets\nâ€¢ Enregistrement")
    
    def show_video_editor(self):
        QtWidgets.QMessageBox.information(self, "ðŸŽžï¸ Ã‰diteur VidÃ©o", "Ã‰diteur vidÃ©o Ragnar !\n\nFonctionnalitÃ©s :\nâ€¢ Montage\nâ€¢ Transitions\nâ€¢ Effets spÃ©ciaux")
    
    def show_audio_studio(self):
        QtWidgets.QMessageBox.information(self, "ðŸŽµ Studio Audio", "Studio audio professionnel !\n\nOutils :\nâ€¢ Mixage\nâ€¢ Mastering\nâ€¢ Plugins")
    
    def show_streaming_center(self):
        QtWidgets.QMessageBox.information(self, "ðŸ“º Streaming", "Centre de streaming !\n\nPlateformes :\nâ€¢ Twitch\nâ€¢ YouTube\nâ€¢ Facebook Live")
    
    def show_snake_game(self):
        QtWidgets.QMessageBox.information(self, "ðŸ Snake", "Snake Ragnar !\n\nDÃ©jÃ  disponible dans le Centre de Jeux !\nAccÃ©dez-y via le menu Applications.")
    
    def show_shooting_game(self):
        QtWidgets.QMessageBox.information(self, "ðŸŽ¯ Jeu de Tir", "Jeu de tir Ragnar !\n\nObjectif :\nâ€¢ Visez les cibles\nâ€¢ AmÃ©liorez votre prÃ©cision\nâ€¢ DÃ©bloquez des niveaux")
    
    def show_puzzle_game(self):
        """Centre de jeux de puzzles"""
        d = GlassDialog("ðŸ§© Puzzles Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Centre de Puzzles", "EntraÃ®nez votre cerveau")
        lay.addWidget(header)
        
        # Grille de jeux
        games_grid = QtWidgets.QGridLayout()
        
        puzzle_games = [
            ("ðŸ”¢", "Sudoku", "Logique numÃ©rique", "Facile â€¢ Moyen â€¢ Difficile"),
            ("ðŸ“", "Mots CroisÃ©s", "Vocabulaire", "Grilles quotidiennes"),
            ("ðŸ”º", "Tangram", "GÃ©omÃ©trie", "Formes Ã  reconstituer"),
            ("ðŸ§©", "Casse-tÃªtes", "RÃ©flexion", "100+ niveaux"),
            ("ðŸŽ¯", "Mastermind", "DÃ©duction", "Trouvez la combinaison"),
            ("ðŸ”€", "Taquin", "StratÃ©gie", "Remettez en ordre")
        ]
        
        for i, (icon, name, desc, info) in enumerate(puzzle_games):
            game_card = QtWidgets.QWidget(objectName="GlassCard")
            game_layout = QtWidgets.QVBoxLayout(game_card)
            game_layout.setContentsMargins(16, 16, 16, 16)
            
            # IcÃ´ne et nom
            title_layout = QtWidgets.QHBoxLayout()
            icon_label = QtWidgets.QLabel(icon)
            icon_label.setStyleSheet("font-size: 32px;")
            name_label = QtWidgets.QLabel(name)
            name_label.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88;")
            
            title_layout.addWidget(icon_label)
            title_layout.addWidget(name_label)
            title_layout.addStretch()
            
            # Description
            desc_label = QtWidgets.QLabel(desc)
            desc_label.setStyleSheet("color: #cccccc; font-size: 12px;")
            
            info_label = QtWidgets.QLabel(info)
            info_label.setStyleSheet("color: #00aaff; font-size: 10px;")
            
            # Bouton jouer
            play_btn = QtWidgets.QPushButton("â–¶ï¸ Jouer")
            play_btn.clicked.connect(lambda checked, n=name: QtWidgets.QMessageBox.information(d, f"ðŸŽ® {n}", f"Lancement de {n} !\n\nðŸŽ¯ PrÃªt Ã  jouer ?\nðŸ† Meilleur score : 1250\nâ±ï¸ Temps moyen : 5min 30s"))
            
            game_layout.addLayout(title_layout)
            game_layout.addWidget(desc_label)
            game_layout.addWidget(info_label)
            game_layout.addStretch()
            game_layout.addWidget(play_btn)
            
            games_grid.addWidget(game_card, i // 2, i % 2)
        
        lay.addLayout(games_grid)
        
        # Actions
        actions_layout = QtWidgets.QHBoxLayout()
        scores_btn = QtWidgets.QPushButton("ðŸ† Scores")
        settings_btn = QtWidgets.QPushButton("âš™ï¸ ParamÃ¨tres")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        scores_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ†", "Meilleurs Scores !\n\nðŸ¥‡ Sudoku : 2min 45s\nðŸ¥ˆ Mots CroisÃ©s : 8min 12s\nðŸ¥‰ Tangram : 1min 30s\n\nðŸ“Š Statistiques :\nâ€¢ Parties jouÃ©es : 147\nâ€¢ Taux de rÃ©ussite : 89%"))
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(scores_btn)
        actions_layout.addWidget(settings_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_casino_games(self):
        QtWidgets.QMessageBox.information(self, "ðŸŽ² Casino", "Casino Ragnar !\n\nJeux :\nâ€¢ Poker\nâ€¢ Blackjack\nâ€¢ Roulette\nâ€¢ Machines Ã  sous")
    
    def show_solitaire(self):
        QtWidgets.QMessageBox.information(self, "ðŸƒ Solitaire", "Solitaire Ragnar !\n\nVariantes :\nâ€¢ Klondike\nâ€¢ Spider\nâ€¢ FreeCell")
    
    def show_arcade_center(self):
        QtWidgets.QMessageBox.information(self, "ðŸŽª Arcade", "Arcade Center !\n\nJeux rÃ©tro :\nâ€¢ Pac-Man style\nâ€¢ Space Invaders\nâ€¢ Tetris")
    
        
        # === ONGLET QUARANTAINE ===
        quarantine_tab = QtWidgets.QWidget()
        quarantine_layout = QtWidgets.QVBoxLayout(quarantine_tab)
        
        quarantine_card = QtWidgets.QWidget(objectName="GlassCard")
        quarantine_card_layout = QtWidgets.QVBoxLayout(quarantine_card)
        quarantine_card_layout.setContentsMargins(16, 16, 16, 16)
        
        quarantine_title = QtWidgets.QLabel("ðŸ—‚ï¸ Fichiers en Quarantaine")
        quarantine_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        quarantine_card_layout.addWidget(quarantine_title)
        
        quarantine_list = QtWidgets.QListWidget()
        quarantine_files = [
            "âš ï¸ suspicious_file.exe - Trojan.Win32.Generic",
            "ðŸ¦  malware.dll - Adware.Generic.Suspicious",
            "ðŸ”´ virus.bat - Worm.Script.Malicious",
            "âš ï¸ keylogger.exe - Spyware.Keylogger.Detected",
            "ðŸ¦  ransomware.bin - Ransomware.Crypto.Locker"
        ]
        
        for file_item in quarantine_files:
            quarantine_list.addItem(file_item)
        
        quarantine_card_layout.addWidget(quarantine_list)
        
        # Actions quarantaine
        quarantine_actions = QtWidgets.QHBoxLayout()
        restore_btn = QtWidgets.QPushButton("â†©ï¸ Restaurer")
        delete_btn = QtWidgets.QPushButton("ðŸ—‘ï¸ Supprimer")
        analyze_btn = QtWidgets.QPushButton("ðŸ”¬ Analyser")
        
        restore_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(self, "â†©ï¸", "Fichier restaurÃ© !\n\nâš ï¸ Attention : Le fichier a Ã©tÃ© restaurÃ©\nðŸ›¡ï¸ Surveillance renforcÃ©e activÃ©e\nðŸ“ Emplacement : Bureau/RestaurÃ©s/"))
        delete_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(self, "ðŸ—‘ï¸", "Fichier supprimÃ© !\n\nâœ… Menace Ã©liminÃ©e dÃ©finitivement\nðŸ”’ Suppression sÃ©curisÃ©e effectuÃ©e\nðŸ“Š Statistiques mises Ã  jour"))
        analyze_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(self, "ðŸ”¬", "Analyse approfondie !\n\nðŸ§¬ Type : Trojan.Win32.Generic\nðŸŽ¯ Origine : Email suspect\nâš ï¸ DangerositÃ© : Ã‰LEVÃ‰E\nðŸ›¡ï¸ Action : Quarantaine recommandÃ©e"))
        
        quarantine_actions.addWidget(restore_btn)
        quarantine_actions.addWidget(delete_btn)
        quarantine_actions.addWidget(analyze_btn)
        quarantine_actions.addStretch()
        
        quarantine_card_layout.addLayout(quarantine_actions)
        quarantine_layout.addWidget(quarantine_card)
        tabs.addTab(quarantine_tab, "ðŸ—‚ï¸ Quarantaine")
        
        # === ONGLET PARAMÃˆTRES ===
        settings_tab = QtWidgets.QWidget()
        settings_layout = QtWidgets.QVBoxLayout(settings_tab)
        
        settings_card = QtWidgets.QWidget(objectName="GlassCard")
        settings_card_layout = QtWidgets.QVBoxLayout(settings_card)
        settings_card_layout.setContentsMargins(16, 16, 16, 16)
        
        settings_title = QtWidgets.QLabel("âš™ï¸ Configuration Antivirus")
        settings_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        settings_card_layout.addWidget(settings_title)
        
        # Options de protection
        realtime_cb = QtWidgets.QCheckBox("ðŸ›¡ï¸ Protection temps rÃ©el")
        realtime_cb.setChecked(True)
        web_protection_cb = QtWidgets.QCheckBox("ðŸŒ Protection web")
        web_protection_cb.setChecked(True)
        email_scan_cb = QtWidgets.QCheckBox("ðŸ“§ Analyse des emails")
        email_scan_cb.setChecked(True)
        usb_scan_cb = QtWidgets.QCheckBox("ðŸ’¾ Analyse USB automatique")
        usb_scan_cb.setChecked(False)
        
        settings_card_layout.addWidget(realtime_cb)
        settings_card_layout.addWidget(web_protection_cb)
        settings_card_layout.addWidget(email_scan_cb)
        settings_card_layout.addWidget(usb_scan_cb)
        
        # Niveau de sensibilitÃ©
        sensitivity_layout = QtWidgets.QHBoxLayout()
        sensitivity_layout.addWidget(QtWidgets.QLabel("SensibilitÃ© :"))
        sensitivity_combo = QtWidgets.QComboBox()
        sensitivity_combo.addItems(["Faible", "Normale", "Ã‰levÃ©e", "ParanoÃ¯aque"])
        sensitivity_combo.setCurrentText("Ã‰levÃ©e")
        sensitivity_layout.addWidget(sensitivity_combo)
        sensitivity_layout.addStretch()
        
        settings_card_layout.addLayout(sensitivity_layout)
        settings_layout.addWidget(settings_card)
        tabs.addTab(settings_tab, "âš™ï¸ ParamÃ¨tres")
        
        lay.addWidget(tabs)
        
        # Boutons de contrÃ´le
        control_layout = QtWidgets.QHBoxLayout()
        
        emergency_btn = QtWidgets.QPushButton("ðŸš¨ Mode Urgence")
        emergency_btn.setStyleSheet("QPushButton { background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 rgba(255, 68, 68, 0.3), stop:1 rgba(255, 68, 68, 0.1)); }")
        
        reports_btn = QtWidgets.QPushButton("ðŸ“‹ Rapports")
        help_btn = QtWidgets.QPushButton("â“ Aide")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        emergency_btn.clicked.connect(lambda: QtWidgets.QMessageBox.warning(self, "ðŸš¨", "Mode Urgence ActivÃ© !\n\nðŸ”’ SystÃ¨me verrouillÃ©\nðŸ›¡ï¸ Protection maximale\nðŸš« RÃ©seau isolÃ©\nâš¡ Analyse d'urgence lancÃ©e\n\nâ±ï¸ DurÃ©e estimÃ©e : 5 minutes"))
        reports_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(self, "ðŸ“‹", "Rapports de SÃ©curitÃ© !\n\nðŸ“Š Rapport hebdomadaire :\nâ€¢ 347 menaces bloquÃ©es\nâ€¢ 12,450 fichiers analysÃ©s\nâ€¢ 0 infections dÃ©tectÃ©es\nâ€¢ 99.8% de protection\n\nðŸ“§ Rapport envoyÃ© par email"))
        help_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(self, "â“", "Aide Antivirus !\n\nðŸ›¡ï¸ Protection temps rÃ©el\nðŸ” Types d'analyses\nðŸ—‚ï¸ Gestion quarantaine\nâš™ï¸ Configuration avancÃ©e\n\nðŸ“ž Support 24/7 disponible"))
        close_btn.clicked.connect(lambda: self.close())
        
        control_layout.addWidget(emergency_btn)
        control_layout.addWidget(reports_btn)
        control_layout.addWidget(help_btn)
        control_layout.addStretch()
        control_layout.addWidget(close_btn)
        
        lay.addLayout(control_layout)
        
        d.show()
        fade_in(d, 800)
    
    def start_antivirus_scan(self, scan_type):
        """Lance une analyse antivirus"""
        if scan_type == "rapide":
            QtWidgets.QMessageBox.information(
                self, "âš¡ Analyse Rapide", 
                "Analyse rapide lancÃ©e !\n\nðŸ” Zones analysÃ©es :\nâ€¢ MÃ©moire systÃ¨me\nâ€¢ Processus actifs\nâ€¢ Fichiers critiques\nâ€¢ DÃ©marrage automatique\n\nâ±ï¸ DurÃ©e estimÃ©e : 2 minutes\nðŸ“Š RÃ©sultat : Aucune menace dÃ©tectÃ©e"
            )
        else:
            QtWidgets.QMessageBox.information(
                self, "ðŸ” Analyse ComplÃ¨te", 
                "Analyse complÃ¨te lancÃ©e !\n\nðŸ” Zones analysÃ©es :\nâ€¢ Tous les disques\nâ€¢ Fichiers systÃ¨me\nâ€¢ Archives compressÃ©es\nâ€¢ Secteurs de boot\n\nâ±ï¸ DurÃ©e estimÃ©e : 45 minutes\nðŸ“Š Progression : 0% - DÃ©marrage..."
            )
    
    
    def show_vault(self):
        """Application supprimÃ©e"""
        QtWidgets.QMessageBox.information(self, "ðŸš« Application SupprimÃ©e", "Cette application a Ã©tÃ© supprimÃ©e de Ragnar OS 26.3.3")
        d = GlassDialog("ðŸ” Coffre-fort NumÃ©rique", (900, 650), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Coffre-fort NumÃ©rique", "Stockage ultra-sÃ©curisÃ© de vos donnÃ©es sensibles")
        lay.addWidget(header)
        
        # Onglets du coffre-fort
        vault_tabs = QtWidgets.QTabWidget()
        
        # === ONGLET FICHIERS SÃ‰CURISÃ‰S ===
        files_tab = QtWidgets.QWidget()
        files_layout = QtWidgets.QVBoxLayout(files_tab)
        
        # Statut du coffre
        status_card = QtWidgets.QWidget(objectName="GlassCard")
        status_layout = QtWidgets.QVBoxLayout(status_card)
        status_layout.setContentsMargins(16, 16, 16, 16)
        
        status_title = QtWidgets.QLabel("ðŸ” Statut du Coffre-fort")
        status_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        status_layout.addWidget(status_title)
        
        vault_status = [
            "ðŸ”’ Statut : VERROUILLÃ‰",
            "ðŸ”‘ Chiffrement : AES-256",
            "ðŸ“ Fichiers stockÃ©s : 47",
            "ðŸ’¾ Espace utilisÃ© : 2.3 GB / 10 GB",
            "ðŸ•’ DerniÃ¨re sauvegarde : Il y a 1 heure",
            "ðŸ›¡ï¸ Tentatives d'accÃ¨s : 0 Ã©checs"
        ]
        
        for status in vault_status:
            status_label = QtWidgets.QLabel(status)
            status_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 255, 136, 0.5);")
            status_layout.addWidget(status_label)
        
        files_layout.addWidget(status_card)
        
        # Liste des fichiers sÃ©curisÃ©s
        files_card = QtWidgets.QWidget(objectName="GlassCard")
        files_card_layout = QtWidgets.QVBoxLayout(files_card)
        files_card_layout.setContentsMargins(16, 16, 16, 16)
        
        files_title = QtWidgets.QLabel("ðŸ“ Fichiers SÃ©curisÃ©s")
        files_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        files_card_layout.addWidget(files_title)
        
        secure_files_list = QtWidgets.QListWidget()
        secure_files = [
            "ðŸ” documents_confidentiels.pdf (2.1 MB)",
            "ðŸ”‘ clÃ©s_privÃ©es.key (0.5 KB)",
            "ðŸ’³ informations_bancaires.xlsx (45 KB)",
            "ðŸ“‹ mots_de_passe.txt (1.2 KB)",
            "ðŸ“¸ photos_personnelles.zip (156 MB)",
            "ðŸ“„ contrats_importants.docx (890 KB)",
            "ðŸ’° dÃ©clarations_fiscales.pdf (3.4 MB)",
            "ðŸ  papiers_maison.zip (12 MB)"
        ]
        
        for file_item in secure_files:
            secure_files_list.addItem(file_item)
        
        files_card_layout.addWidget(secure_files_list)
        
        # Actions sur fichiers
        file_actions = QtWidgets.QHBoxLayout()
        add_file_btn = QtWidgets.QPushButton("âž• Ajouter Fichier")
        decrypt_btn = QtWidgets.QPushButton("ðŸ”“ DÃ©crypter")
        delete_file_btn = QtWidgets.QPushButton("ðŸ—‘ï¸ Supprimer")
        
        add_file_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âž•", "Ajouter un fichier !\n\nðŸ“ SÃ©lectionnez le fichier Ã  sÃ©curiser\nðŸ” Chiffrement automatique AES-256\nðŸ’¾ Sauvegarde dans le coffre\n\nâš ï¸ Le fichier original sera supprimÃ©"))
        decrypt_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”“", "DÃ©cryptage en cours !\n\nðŸ”‘ Authentification requise\nðŸ”“ Fichier dÃ©cryptÃ© temporairement\nðŸ“ Emplacement : Bureau/Temp/\n\nâ±ï¸ Auto-suppression dans 1 heure"))
        delete_file_btn.clicked.connect(lambda: QtWidgets.QMessageBox.warning(d, "ðŸ—‘ï¸", "Suppression sÃ©curisÃ©e !\n\nâš ï¸ Action irrÃ©versible !\nðŸ”’ Fichier supprimÃ© dÃ©finitivement\nðŸ—‘ï¸ Suppression sÃ©curisÃ©e (7 passes)\n\nâœ… Espace libÃ©rÃ© dans le coffre"))
        
        file_actions.addWidget(add_file_btn)
        file_actions.addWidget(decrypt_btn)
        file_actions.addWidget(delete_file_btn)
        file_actions.addStretch()
        
        files_card_layout.addLayout(file_actions)
        files_layout.addWidget(files_card)
        vault_tabs.addTab(files_tab, "ðŸ“ Fichiers")
        
        # === ONGLET MOTS DE PASSE ===
        passwords_tab = QtWidgets.QWidget()
        passwords_layout = QtWidgets.QVBoxLayout(passwords_tab)
        
        passwords_card = QtWidgets.QWidget(objectName="GlassCard")
        passwords_card_layout = QtWidgets.QVBoxLayout(passwords_card)
        passwords_card_layout.setContentsMargins(16, 16, 16, 16)
        
        passwords_title = QtWidgets.QLabel("ðŸ”‘ Coffre Ã  Mots de Passe")
        passwords_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        passwords_card_layout.addWidget(passwords_title)
        
        passwords_list = QtWidgets.QListWidget()
        password_entries = [
            "ðŸŒ Google - user@gmail.com",
            "ðŸ’¼ Travail - admin@entreprise.com",
            "ðŸ¦ Banque - ****1234",
            "ðŸ“± Facebook - mon.profil",
            "ðŸ›ï¸ Amazon - acheteur2024",
            "ðŸŽ® Steam - gamer_pro",
            "ðŸ“§ Outlook - professionnel@outlook.com",
            "â˜ï¸ Dropbox - stockage_cloud"
        ]
        
        for password_entry in password_entries:
            passwords_list.addItem(password_entry)
        
        passwords_card_layout.addWidget(passwords_list)
        
        # Actions mots de passe
        password_actions = QtWidgets.QHBoxLayout()
        add_password_btn = QtWidgets.QPushButton("âž• Nouveau")
        show_password_btn = QtWidgets.QPushButton("ðŸ‘ï¸ Afficher")
        copy_password_btn = QtWidgets.QPushButton("ðŸ“‹ Copier")
        generate_btn = QtWidgets.QPushButton("ðŸŽ² GÃ©nÃ©rer")
        
        add_password_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âž•", "Nouveau mot de passe !\n\nðŸŒ Site/Service :\nðŸ‘¤ Nom d'utilisateur :\nðŸ”‘ Mot de passe :\nðŸ“ Notes :\n\nðŸ” Chiffrement automatique"))
        show_password_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ‘ï¸", "Mot de passe rÃ©vÃ©lÃ© !\n\nðŸ”‘ Mot de passe : SuperSecure123!\n\nâš ï¸ MasquÃ© automatiquement dans 30s\nðŸ“‹ CopiÃ© dans le presse-papiers"))
        copy_password_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“‹", "CopiÃ© !\n\nðŸ“‹ Mot de passe copiÃ©\nâ±ï¸ Presse-papiers vidÃ© dans 60s\nðŸ”’ SÃ©curitÃ© prÃ©servÃ©e"))
        generate_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸŽ²", "Mot de passe gÃ©nÃ©rÃ© !\n\nðŸ”‘ Nouveau mot de passe :\nK9#mP2$vL8@nQ5!\n\nâœ… 16 caractÃ¨res\nðŸ”’ TrÃ¨s sÃ©curisÃ©\nðŸ“‹ CopiÃ© automatiquement"))
        
        password_actions.addWidget(add_password_btn)
        password_actions.addWidget(show_password_btn)
        password_actions.addWidget(copy_password_btn)
        password_actions.addWidget(generate_btn)
        password_actions.addStretch()
        
        passwords_card_layout.addLayout(password_actions)
        passwords_layout.addWidget(passwords_card)
        vault_tabs.addTab(passwords_tab, "ðŸ”‘ Mots de passe")
        
        # === ONGLET PARAMÃˆTRES ===
        settings_tab = QtWidgets.QWidget()
        settings_layout = QtWidgets.QVBoxLayout(settings_tab)
        
        security_card = QtWidgets.QWidget(objectName="GlassCard")
        security_layout = QtWidgets.QVBoxLayout(security_card)
        security_layout.setContentsMargins(16, 16, 16, 16)
        
        security_title = QtWidgets.QLabel("ðŸ›¡ï¸ ParamÃ¨tres de SÃ©curitÃ©")
        security_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        security_layout.addWidget(security_title)
        
        # Options de sÃ©curitÃ©
        auto_lock_cb = QtWidgets.QCheckBox("ðŸ”’ Verrouillage automatique (5 min d'inactivitÃ©)")
        auto_lock_cb.setChecked(True)
        biometric_cb = QtWidgets.QCheckBox("ðŸ‘† Authentification biomÃ©trique")
        biometric_cb.setChecked(False)
        backup_cb = QtWidgets.QCheckBox("â˜ï¸ Sauvegarde automatique (cloud)")
        backup_cb.setChecked(True)
        two_factor_cb = QtWidgets.QCheckBox("ðŸ“± Authentification Ã  deux facteurs")
        two_factor_cb.setChecked(True)
        
        security_layout.addWidget(auto_lock_cb)
        security_layout.addWidget(biometric_cb)
        security_layout.addWidget(backup_cb)
        security_layout.addWidget(two_factor_cb)
        
        # Niveau de chiffrement
        encryption_layout = QtWidgets.QHBoxLayout()
        encryption_layout.addWidget(QtWidgets.QLabel("Chiffrement :"))
        encryption_combo = QtWidgets.QComboBox()
        encryption_combo.addItems(["AES-128", "AES-256", "AES-512 (ExpÃ©rimental)"])
        encryption_combo.setCurrentText("AES-256")
        encryption_layout.addWidget(encryption_combo)
        encryption_layout.addStretch()
        
        security_layout.addLayout(encryption_layout)
        settings_layout.addWidget(security_card)
        vault_tabs.addTab(settings_tab, "âš™ï¸ SÃ©curitÃ©")
        
        lay.addWidget(vault_tabs)
        
        # ContrÃ´les principaux
        main_controls = QtWidgets.QHBoxLayout()
        
        unlock_btn = QtWidgets.QPushButton("ðŸ”“ DÃ©verrouiller")
        unlock_btn.setStyleSheet("QPushButton { background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 rgba(0, 255, 136, 0.3), stop:1 rgba(0, 255, 136, 0.1)); }")
        
        lock_btn = QtWidgets.QPushButton("ðŸ”’ Verrouiller")
        backup_btn = QtWidgets.QPushButton("ðŸ’¾ Sauvegarder")
        emergency_btn = QtWidgets.QPushButton("ðŸš¨ AccÃ¨s d'Urgence")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        unlock_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”“", "Coffre dÃ©verrouillÃ© !\n\nðŸ”‘ Authentification rÃ©ussie\nðŸ”“ AccÃ¨s complet autorisÃ©\nâ±ï¸ Session active : 30 minutes\nðŸ›¡ï¸ Surveillance activÃ©e"))
        lock_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”’", "Coffre verrouillÃ© !\n\nðŸ”’ AccÃ¨s sÃ©curisÃ©\nðŸ’¾ DonnÃ©es chiffrÃ©es\nðŸ›¡ï¸ Protection active\nâœ… Coffre sÃ©curisÃ©"))
        backup_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ’¾", "Sauvegarde crÃ©Ã©e !\n\nâ˜ï¸ Sauvegarde cloud : 100%\nðŸ’¾ Sauvegarde locale : 100%\nðŸ” Chiffrement : AES-256\nâœ… 47 fichiers sauvegardÃ©s"))
        emergency_btn.clicked.connect(lambda: QtWidgets.QMessageBox.warning(d, "ðŸš¨", "AccÃ¨s d'Urgence !\n\nâš ï¸ ProcÃ©dure d'urgence activÃ©e\nðŸ“§ Code envoyÃ© par email\nðŸ“± SMS de confirmation\nðŸ”‘ AccÃ¨s temporaire (1 heure)"))
        close_btn.clicked.connect(d.close)
        
        main_controls.addWidget(unlock_btn)
        main_controls.addWidget(lock_btn)
        main_controls.addWidget(backup_btn)
        main_controls.addWidget(emergency_btn)
        main_controls.addStretch()
        main_controls.addWidget(close_btn)
        
        lay.addLayout(main_controls)
        
        d.show()
        fade_in(d, 600)
    
    def show_vpn_manager(self):
        """Application supprimÃ©e"""
        QtWidgets.QMessageBox.information(self, "ðŸš« Application SupprimÃ©e", "Cette application a Ã©tÃ© supprimÃ©e de Ragnar OS 26.3.3")
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("VPN Manager", "Connexion sÃ©curisÃ©e et anonyme")
        lay.addWidget(header)
        
        # Statut de connexion
        status_card = QtWidgets.QWidget(objectName="GlassCard")
        status_layout = QtWidgets.QVBoxLayout(status_card)
        status_layout.setContentsMargins(16, 16, 16, 16)
        
        status_title = QtWidgets.QLabel("ðŸ”’ Statut de Connexion")
        status_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        status_layout.addWidget(status_title)
        
        # Informations de connexion
        connection_info = [
            "ðŸ”´ Statut : DÃ©connectÃ©",
            "ðŸŒ IP Publique : 192.168.1.100 (France)",
            "ðŸ›¡ï¸ Protection : NON ACTIVE",
            "âš¡ Vitesse : Normale",
            "ðŸ“Š DonnÃ©es transfÃ©rÃ©es : 0 MB",
            "â±ï¸ Temps de connexion : 00:00:00"
        ]
        
        for info in connection_info:
            info_label = QtWidgets.QLabel(info)
            color = "rgba(255, 102, 102, 0.5)" if "DÃ©connectÃ©" in info or "NON ACTIVE" in info else "rgba(0, 255, 136, 0.5)"
            info_label.setStyleSheet(f"color: white; font-size: 12px; padding: 4px; border-left: 3px solid {color};")
            status_layout.addWidget(info_label)
        
        lay.addWidget(status_card)
        
        # SÃ©lection de serveur
        server_card = QtWidgets.QWidget(objectName="GlassCard")
        server_layout = QtWidgets.QVBoxLayout(server_card)
        server_layout.setContentsMargins(16, 16, 16, 16)
        
        server_title = QtWidgets.QLabel("ðŸŒ Serveurs Disponibles")
        server_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        server_layout.addWidget(server_title)
        
        server_list = QtWidgets.QListWidget()
        servers = [
            "ðŸ‡ºðŸ‡¸ Ã‰tats-Unis - New York (23ms) âš¡âš¡âš¡",
            "ðŸ‡¬ðŸ‡§ Royaume-Uni - Londres (45ms) âš¡âš¡âš¡",
            "ðŸ‡©ðŸ‡ª Allemagne - Berlin (67ms) âš¡âš¡",
            "ðŸ‡¯ðŸ‡µ Japon - Tokyo (156ms) âš¡âš¡",
            "ðŸ‡¨ðŸ‡¦ Canada - Toronto (89ms) âš¡âš¡âš¡",
            "ðŸ‡¦ðŸ‡º Australie - Sydney (234ms) âš¡",
            "ðŸ‡³ðŸ‡± Pays-Bas - Amsterdam (34ms) âš¡âš¡âš¡",
            "ðŸ‡¸ðŸ‡¬ Singapour (178ms) âš¡âš¡",
            "ðŸ‡¨ðŸ‡­ Suisse - Zurich (56ms) âš¡âš¡âš¡",
            "ðŸ‡¸ðŸ‡ª SuÃ¨de - Stockholm (78ms) âš¡âš¡"
        ]
        
        for server in servers:
            server_list.addItem(server)
        
        server_layout.addWidget(server_list)
        lay.addWidget(server_card)
        
        # Protocoles et options
        options_card = QtWidgets.QWidget(objectName="GlassCard")
        options_layout = QtWidgets.QVBoxLayout(options_card)
        options_layout.setContentsMargins(16, 16, 16, 16)
        
        options_title = QtWidgets.QLabel("âš™ï¸ Configuration")
        options_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        options_layout.addWidget(options_title)
        
        # Protocoles
        protocol_layout = QtWidgets.QHBoxLayout()
        protocol_layout.addWidget(QtWidgets.QLabel("Protocole :"))
        protocol_combo = QtWidgets.QComboBox()
        protocol_combo.addItems(["OpenVPN", "WireGuard", "IKEv2", "L2TP/IPSec"])
        protocol_combo.setCurrentText("WireGuard")
        protocol_layout.addWidget(protocol_combo)
        protocol_layout.addStretch()
        options_layout.addLayout(protocol_layout)
        
        # Options avancÃ©es
        auto_connect_cb = QtWidgets.QCheckBox("ðŸ”„ Connexion automatique au dÃ©marrage")
        kill_switch_cb = QtWidgets.QCheckBox("ðŸ›¡ï¸ Kill Switch (couper Internet si VPN dÃ©connectÃ©)")
        kill_switch_cb.setChecked(True)
        dns_leak_cb = QtWidgets.QCheckBox("ðŸ”’ Protection contre les fuites DNS")
        dns_leak_cb.setChecked(True)
        
        options_layout.addWidget(auto_connect_cb)
        options_layout.addWidget(kill_switch_cb)
        options_layout.addWidget(dns_leak_cb)
        
        lay.addWidget(options_card)
        
        # Boutons de contrÃ´le
        control_layout = QtWidgets.QHBoxLayout()
        
        connect_btn = QtWidgets.QPushButton("ðŸ”— Se Connecter")
        connect_btn.setStyleSheet("QPushButton { background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 rgba(0, 255, 136, 0.3), stop:1 rgba(0, 255, 136, 0.1)); }")
        
        disconnect_btn = QtWidgets.QPushButton("ðŸ”´ DÃ©connecter")
        quick_connect_btn = QtWidgets.QPushButton("âš¡ Connexion Rapide")
        settings_btn = QtWidgets.QPushButton("âš™ï¸ ParamÃ¨tres")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        connect_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”—", "Connexion VPN !\n\nðŸ”’ Connexion sÃ©curisÃ©e Ã©tablie\nðŸŒ Serveur : Ã‰tats-Unis - New York\nâš¡ Vitesse : 85 Mbps\nðŸ›¡ï¸ IP masquÃ©e avec succÃ¨s"))
        disconnect_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”´", "DÃ©connexion VPN !\n\nâŒ Connexion fermÃ©e\nðŸŒ IP rÃ©elle restaurÃ©e\nâš ï¸ Vous n'Ãªtes plus protÃ©gÃ©"))
        quick_connect_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âš¡", "Connexion Rapide !\n\nðŸš€ Connexion au serveur le plus rapide\nðŸ‡¬ðŸ‡§ Londres sÃ©lectionnÃ© (34ms)\nâœ… ConnectÃ© en 2.3 secondes"))
        settings_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âš™ï¸", "ParamÃ¨tres VPN !\n\nðŸ”§ Options disponibles :\nâ€¢ Protocoles de sÃ©curitÃ©\nâ€¢ Serveurs favoris\nâ€¢ Notifications\nâ€¢ DÃ©marrage automatique"))
        close_btn.clicked.connect(d.close)
        
        control_layout.addWidget(connect_btn)
        control_layout.addWidget(disconnect_btn)
        control_layout.addWidget(quick_connect_btn)
        control_layout.addWidget(settings_btn)
        control_layout.addStretch()
        control_layout.addWidget(close_btn)
        
        lay.addLayout(control_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_network_analyzer(self):
        """Application supprimÃ©e"""
        QtWidgets.QMessageBox.information(self, "ðŸš« Application SupprimÃ©e", "Cette application a Ã©tÃ© supprimÃ©e de Ragnar OS 26.3.3")
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Analyseur RÃ©seau Ragnar", "Diagnostic et monitoring rÃ©seau avancÃ©")
        lay.addWidget(header)
        
        # Onglets de l'analyseur
        analyzer_tabs = QtWidgets.QTabWidget()
        
        # === ONGLET DIAGNOSTIC ===
        diagnostic_tab = QtWidgets.QWidget()
        diagnostic_layout = QtWidgets.QVBoxLayout(diagnostic_tab)
        
        # Statut rÃ©seau
        network_status_card = QtWidgets.QWidget(objectName="GlassCard")
        network_status_layout = QtWidgets.QVBoxLayout(network_status_card)
        network_status_layout.setContentsMargins(16, 16, 16, 16)
        
        network_status_title = QtWidgets.QLabel("ðŸŒ Statut RÃ©seau")
        network_status_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        network_status_layout.addWidget(network_status_title)
        
        network_info = [
            "ðŸ”— Connexion : ACTIVE (Ethernet)",
            "ðŸ“¡ IP Locale : 192.168.1.100",
            "ðŸŒ IP Publique : 203.0.113.45",
            "ðŸšª Passerelle : 192.168.1.1",
            "ðŸ” DNS : 8.8.8.8, 1.1.1.1",
            "âš¡ Vitesse : 100 Mbps / 20 Mbps"
        ]
        
        for info in network_info:
            info_label = QtWidgets.QLabel(info)
            info_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 255, 136, 0.5);")
            network_status_layout.addWidget(info_label)
        
        diagnostic_layout.addWidget(network_status_card)
        
        # Tests de diagnostic
        diagnostic_tests_card = QtWidgets.QWidget(objectName="GlassCard")
        diagnostic_tests_layout = QtWidgets.QVBoxLayout(diagnostic_tests_card)
        diagnostic_tests_layout.setContentsMargins(16, 16, 16, 16)
        
        diagnostic_tests_title = QtWidgets.QLabel("ðŸ”§ Tests de Diagnostic")
        diagnostic_tests_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        diagnostic_tests_layout.addWidget(diagnostic_tests_title)
        
        # Boutons de test
        tests_grid = QtWidgets.QGridLayout()
        
        ping_btn = QtWidgets.QPushButton("ðŸ“¡ Test Ping")
        traceroute_btn = QtWidgets.QPushButton("ðŸ—ºï¸ Traceroute")
        speed_btn = QtWidgets.QPushButton("âš¡ Test Vitesse")
        dns_btn = QtWidgets.QPushButton("ðŸ” Test DNS")
        port_btn = QtWidgets.QPushButton("ðŸšª Scan Ports")
        bandwidth_btn = QtWidgets.QPushButton("ðŸ“Š Bande Passante")
        
        ping_btn.clicked.connect(lambda: self.run_network_test("ping"))
        traceroute_btn.clicked.connect(lambda: self.run_network_test("traceroute"))
        speed_btn.clicked.connect(lambda: self.run_network_test("speed"))
        dns_btn.clicked.connect(lambda: self.run_network_test("dns"))
        port_btn.clicked.connect(lambda: self.run_network_test("port"))
        bandwidth_btn.clicked.connect(lambda: self.run_network_test("bandwidth"))
        
        tests_grid.addWidget(ping_btn, 0, 0)
        tests_grid.addWidget(traceroute_btn, 0, 1)
        tests_grid.addWidget(speed_btn, 0, 2)
        tests_grid.addWidget(dns_btn, 1, 0)
        tests_grid.addWidget(port_btn, 1, 1)
        tests_grid.addWidget(bandwidth_btn, 1, 2)
        
        diagnostic_tests_layout.addLayout(tests_grid)
        diagnostic_layout.addWidget(diagnostic_tests_card)
        analyzer_tabs.addTab(diagnostic_tab, "ðŸ”§ Diagnostic")
        
        # === ONGLET MONITORING ===
        monitoring_tab = QtWidgets.QWidget()
        monitoring_layout = QtWidgets.QVBoxLayout(monitoring_tab)
        
        # Trafic en temps rÃ©el
        traffic_card = QtWidgets.QWidget(objectName="GlassCard")
        traffic_layout = QtWidgets.QVBoxLayout(traffic_card)
        traffic_layout.setContentsMargins(16, 16, 16, 16)
        
        traffic_title = QtWidgets.QLabel("ðŸ“ˆ Trafic RÃ©seau en Temps RÃ©el")
        traffic_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        traffic_layout.addWidget(traffic_title)
        
        traffic_stats = [
            "â¬‡ï¸ TÃ©lÃ©chargement : 2.3 MB/s (Peak: 5.1 MB/s)",
            "â¬†ï¸ Upload : 0.8 MB/s (Peak: 1.2 MB/s)",
            "ðŸ“Š Paquets/sec : 1,247 entrants, 892 sortants",
            "ðŸ”„ Connexions actives : 47",
            "ðŸ“¡ Utilisation bande passante : 23%",
            "âš ï¸ Erreurs rÃ©seau : 0.02%"
        ]
        
        for stat in traffic_stats:
            stat_label = QtWidgets.QLabel(stat)
            stat_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(255, 170, 0, 0.5);")
            traffic_layout.addWidget(stat_label)
        
        monitoring_layout.addWidget(traffic_card)
        
        # Connexions actives
        connections_card = QtWidgets.QWidget(objectName="GlassCard")
        connections_layout = QtWidgets.QVBoxLayout(connections_card)
        connections_layout.setContentsMargins(16, 16, 16, 16)
        
        connections_title = QtWidgets.QLabel("ðŸ”— Connexions Actives")
        connections_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        connections_layout.addWidget(connections_title)
        
        connections_list = QtWidgets.QListWidget()
        active_connections = [
            "ðŸŒ google.com:443 (HTTPS) - 2.1 MB/s",
            "ðŸ“§ outlook.com:993 (IMAP) - 0.3 MB/s",
            "ðŸŽµ spotify.com:443 (HTTPS) - 1.8 MB/s",
            "â˜ï¸ dropbox.com:443 (HTTPS) - 0.5 MB/s",
            "ðŸŽ® steam.com:27015 (Gaming) - 0.1 MB/s",
            "ðŸ“º netflix.com:443 (HTTPS) - 4.2 MB/s",
            "ðŸ’¬ discord.com:443 (HTTPS) - 0.2 MB/s",
            "ðŸ”„ github.com:443 (HTTPS) - 0.1 MB/s"
        ]
        
        for connection in active_connections:
            connections_list.addItem(connection)
        
        connections_layout.addWidget(connections_list)
        monitoring_layout.addWidget(connections_card)
        analyzer_tabs.addTab(monitoring_tab, "ðŸ“Š Monitoring")
        
        # === ONGLET OUTILS ===
        tools_tab = QtWidgets.QWidget()
        tools_layout = QtWidgets.QVBoxLayout(tools_tab)
        
        # Outils rÃ©seau
        network_tools_card = QtWidgets.QWidget(objectName="GlassCard")
        network_tools_layout = QtWidgets.QVBoxLayout(network_tools_card)
        network_tools_layout.setContentsMargins(16, 16, 16, 16)
        
        network_tools_title = QtWidgets.QLabel("ðŸ› ï¸ Outils RÃ©seau AvancÃ©s")
        network_tools_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        network_tools_layout.addWidget(network_tools_title)
        
        # Grille d'outils
        tools_grid = QtWidgets.QGridLayout()
        
        whois_btn = QtWidgets.QPushButton("ðŸ” Whois")
        nslookup_btn = QtWidgets.QPushButton("ðŸ“‹ NSLookup")
        netstat_btn = QtWidgets.QPushButton("ðŸ“Š Netstat")
        arp_btn = QtWidgets.QPushButton("ðŸ—ºï¸ Table ARP")
        route_btn = QtWidgets.QPushButton("ðŸ›¤ï¸ Table Routage")
        wifi_btn = QtWidgets.QPushButton("ðŸ“¡ Analyse WiFi")
        
        whois_btn.clicked.connect(lambda: self.run_network_tool("whois"))
        nslookup_btn.clicked.connect(lambda: self.run_network_tool("nslookup"))
        netstat_btn.clicked.connect(lambda: self.run_network_tool("netstat"))
        arp_btn.clicked.connect(lambda: self.run_network_tool("arp"))
        route_btn.clicked.connect(lambda: self.run_network_tool("route"))
        wifi_btn.clicked.connect(lambda: self.run_network_tool("wifi"))
        
        tools_grid.addWidget(whois_btn, 0, 0)
        tools_grid.addWidget(nslookup_btn, 0, 1)
        tools_grid.addWidget(netstat_btn, 0, 2)
        tools_grid.addWidget(arp_btn, 1, 0)
        tools_grid.addWidget(route_btn, 1, 1)
        tools_grid.addWidget(wifi_btn, 1, 2)
        
        network_tools_layout.addLayout(tools_grid)
        tools_layout.addWidget(network_tools_card)
        
        # Optimisation rÃ©seau
        optimization_card = QtWidgets.QWidget(objectName="GlassCard")
        optimization_layout = QtWidgets.QVBoxLayout(optimization_card)
        optimization_layout.setContentsMargins(16, 16, 16, 16)
        
        optimization_title = QtWidgets.QLabel("âš¡ Optimisation RÃ©seau")
        optimization_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        optimization_layout.addWidget(optimization_title)
        
        # Options d'optimisation
        optimize_dns_cb = QtWidgets.QCheckBox("ðŸ” Optimiser DNS (Cloudflare/Google)")
        optimize_dns_cb.setChecked(True)
        flush_dns_cb = QtWidgets.QCheckBox("ðŸ—‘ï¸ Vider cache DNS")
        tcp_optimization_cb = QtWidgets.QCheckBox("âš¡ Optimisation TCP/IP")
        bandwidth_limit_cb = QtWidgets.QCheckBox("ðŸ“Š Limitation bande passante")
        
        optimization_layout.addWidget(optimize_dns_cb)
        optimization_layout.addWidget(flush_dns_cb)
        optimization_layout.addWidget(tcp_optimization_cb)
        optimization_layout.addWidget(bandwidth_limit_cb)
        
        # Boutons d'optimisation
        opt_actions = QtWidgets.QHBoxLayout()
        optimize_btn = QtWidgets.QPushButton("âš¡ Optimiser Maintenant")
        reset_btn = QtWidgets.QPushButton("ðŸ”„ RÃ©initialiser")
        
        optimize_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âš¡", "Optimisation rÃ©seau !\n\nâš¡ Optimisations appliquÃ©es :\nâ€¢ DNS configurÃ© (1.1.1.1)\nâ€¢ Cache DNS vidÃ©\nâ€¢ TCP/IP optimisÃ©\nâ€¢ Bande passante ajustÃ©e\n\nâœ… Performance amÃ©liorÃ©e de 15%"))
        reset_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”„", "Configuration rÃ©initialisÃ©e !\n\nðŸ”„ ParamÃ¨tres par dÃ©faut restaurÃ©s\nðŸŒ DNS automatique\nðŸ“Š Limites supprimÃ©es\nâœ… Configuration standard"))
        
        opt_actions.addWidget(optimize_btn)
        opt_actions.addWidget(reset_btn)
        opt_actions.addStretch()
        
        optimization_layout.addLayout(opt_actions)
        tools_layout.addWidget(optimization_card)
        analyzer_tabs.addTab(tools_tab, "ðŸ› ï¸ Outils")
        
        lay.addWidget(analyzer_tabs)
        
        # ContrÃ´les principaux
        main_controls = QtWidgets.QHBoxLayout()
        
        start_monitoring_btn = QtWidgets.QPushButton("â–¶ï¸ DÃ©marrer Monitoring")
        start_monitoring_btn.setStyleSheet("QPushButton { background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 rgba(0, 255, 136, 0.3), stop:1 rgba(0, 255, 136, 0.1)); }")
        
        stop_monitoring_btn = QtWidgets.QPushButton("â¸ï¸ ArrÃªter")
        export_report_btn = QtWidgets.QPushButton("ðŸ“¤ Exporter Rapport")
        settings_btn = QtWidgets.QPushButton("âš™ï¸ ParamÃ¨tres")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        start_monitoring_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "â–¶ï¸", "Monitoring dÃ©marrÃ© !\n\nðŸ“Š Surveillance rÃ©seau active\nðŸ“ˆ Collecte des statistiques\nðŸ” Analyse du trafic\nâ±ï¸ Mise Ã  jour : temps rÃ©el"))
        stop_monitoring_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "â¸ï¸", "Monitoring arrÃªtÃ© !\n\nâ¸ï¸ Surveillance interrompue\nðŸ’¾ DonnÃ©es sauvegardÃ©es\nðŸ“Š Statistiques conservÃ©es\nðŸ”„ RedÃ©marrage disponible"))
        export_report_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“¤", "Rapport exportÃ© !\n\nðŸ“ Fichier : network_report_2024.pdf\nðŸ“Š DonnÃ©es incluses :\nâ€¢ Statistiques de trafic\nâ€¢ Tests de diagnostic\nâ€¢ Connexions actives\nâ€¢ Recommandations"))
        settings_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âš™ï¸", "ParamÃ¨tres Analyseur !\n\nâš™ï¸ Configuration :\nâ€¢ Intervalles de monitoring\nâ€¢ Seuils d'alerte\nâ€¢ Notifications\nâ€¢ Formats d'export\nâ€¢ Filtres de trafic"))
        close_btn.clicked.connect(d.close)
        
        main_controls.addWidget(start_monitoring_btn)
        main_controls.addWidget(stop_monitoring_btn)
        main_controls.addWidget(export_report_btn)
        main_controls.addWidget(settings_btn)
        main_controls.addStretch()
        main_controls.addWidget(close_btn)
        
        lay.addLayout(main_controls)
        
        d.show()
        fade_in(d, 800)
    
    def run_network_test(self, test_type):
        """ExÃ©cute un test rÃ©seau spÃ©cifique"""
        if test_type == "ping":
            QtWidgets.QMessageBox.information(
                self, "ðŸ“¡ Test Ping", 
                "Test Ping vers Google !\n\nðŸ“¡ RÃ©sultats :\nâ€¢ google.com (142.250.185.14)\nâ€¢ Temps : 23ms, 25ms, 22ms, 24ms\nâ€¢ Perte : 0% (4/4 paquets)\nâ€¢ Moyenne : 23.5ms\n\nâœ… Connexion excellente"
            )
        elif test_type == "traceroute":
            QtWidgets.QMessageBox.information(
                self, "ðŸ—ºï¸ Traceroute", 
                "Traceroute vers google.com !\n\nðŸ—ºï¸ Chemin rÃ©seau :\n1. 192.168.1.1 (2ms) - Routeur local\n2. 10.0.0.1 (12ms) - FAI\n3. 203.0.113.1 (18ms) - Backbone\n4. 142.250.185.14 (23ms) - Google\n\nâœ… 4 sauts, 23ms total"
            )
        elif test_type == "speed":
            QtWidgets.QMessageBox.information(
                self, "âš¡ Test Vitesse", 
                "Test de vitesse Internet !\n\nâš¡ RÃ©sultats :\nâ¬‡ï¸ TÃ©lÃ©chargement : 95.7 Mbps\nâ¬†ï¸ Upload : 18.3 Mbps\nðŸ“¡ Ping : 23ms\nðŸŽ¯ Serveur : Paris, France\n\nâœ… Vitesse excellente"
            )
        elif test_type == "dns":
            QtWidgets.QMessageBox.information(
                self, "ðŸ” Test DNS", 
                "Test de rÃ©solution DNS !\n\nðŸ” RÃ©sultats :\nâ€¢ google.com â†’ 142.250.185.14 (15ms)\nâ€¢ facebook.com â†’ 157.240.15.35 (18ms)\nâ€¢ github.com â†’ 140.82.114.4 (22ms)\nâ€¢ DNS utilisÃ© : 8.8.8.8\n\nâœ… RÃ©solution rapide"
            )
        elif test_type == "port":
            QtWidgets.QMessageBox.information(
                self, "ðŸšª Scan Ports", 
                "Scan des ports ouverts !\n\nðŸšª Ports dÃ©tectÃ©s :\nâ€¢ 22 (SSH) - FermÃ©\nâ€¢ 80 (HTTP) - Ouvert\nâ€¢ 443 (HTTPS) - Ouvert\nâ€¢ 25 (SMTP) - FiltrÃ©\nâ€¢ 993 (IMAP) - Ouvert\n\nâœ… Configuration sÃ©curisÃ©e"
            )
        elif test_type == "bandwidth":
            QtWidgets.QMessageBox.information(
                self, "ðŸ“Š Bande Passante", 
                "Analyse bande passante !\n\nðŸ“Š Utilisation :\nâ€¢ Actuelle : 23.4 Mbps / 100 Mbps\nâ€¢ Peak aujourd'hui : 87.2 Mbps\nâ€¢ Moyenne 7 jours : 34.1 Mbps\nâ€¢ Applications top : Netflix, Spotify\n\nâœ… Utilisation normale"
            )
    
    def run_network_tool(self, tool_type):
        """ExÃ©cute un outil rÃ©seau spÃ©cifique"""
        if tool_type == "whois":
            QtWidgets.QMessageBox.information(
                self, "ðŸ” Whois", 
                "Informations Whois !\n\nðŸ” google.com :\nâ€¢ PropriÃ©taire : Google LLC\nâ€¢ Registrar : MarkMonitor Inc.\nâ€¢ CrÃ©ation : 1997-09-15\nâ€¢ Expiration : 2028-09-14\nâ€¢ Serveurs DNS : ns1.google.com\n\nâœ… Domaine lÃ©gitime"
            )
        elif tool_type == "nslookup":
            QtWidgets.QMessageBox.information(
                self, "ðŸ“‹ NSLookup", 
                "RÃ©solution DNS dÃ©taillÃ©e !\n\nðŸ“‹ RÃ©sultats :\nâ€¢ A : 142.250.185.14\nâ€¢ AAAA : 2a00:1450:4007:80c::200e\nâ€¢ MX : smtp.google.com (10)\nâ€¢ NS : ns1.google.com\nâ€¢ TXT : v=spf1 include:_spf.google.com\n\nâœ… Enregistrements valides"
            )
        elif tool_type == "netstat":
            QtWidgets.QMessageBox.information(
                self, "ðŸ“Š Netstat", 
                "Connexions rÃ©seau actives !\n\nðŸ“Š Statistiques :\nâ€¢ TCP : 47 connexions Ã©tablies\nâ€¢ UDP : 12 sockets ouverts\nâ€¢ Ã‰coute : 8 ports\nâ€¢ FermÃ©es : 234 connexions\nâ€¢ Erreurs : 0\n\nâœ… Ã‰tat rÃ©seau normal"
            )
        elif tool_type == "arp":
            QtWidgets.QMessageBox.information(
                self, "ðŸ—ºï¸ Table ARP", 
                "Table ARP locale !\n\nðŸ—ºï¸ EntrÃ©es :\nâ€¢ 192.168.1.1 â†’ aa:bb:cc:dd:ee:ff (Routeur)\nâ€¢ 192.168.1.50 â†’ 11:22:33:44:55:66 (PC-Bureau)\nâ€¢ 192.168.1.75 â†’ 77:88:99:aa:bb:cc (Smartphone)\nâ€¢ 192.168.1.100 â†’ ff:ee:dd:cc:bb:aa (Laptop)\n\nâœ… 4 appareils dÃ©tectÃ©s"
            )
        elif tool_type == "route":
            QtWidgets.QMessageBox.information(
                self, "ðŸ›¤ï¸ Table Routage", 
                "Table de routage !\n\nðŸ›¤ï¸ Routes :\nâ€¢ 0.0.0.0/0 â†’ 192.168.1.1 (DÃ©faut)\nâ€¢ 192.168.1.0/24 â†’ Interface locale\nâ€¢ 127.0.0.0/8 â†’ Loopback\nâ€¢ 224.0.0.0/4 â†’ Multicast\n\nâœ… Routage configurÃ©"
            )
        elif tool_type == "wifi":
            QtWidgets.QMessageBox.information(
                self, "ðŸ“¡ Analyse WiFi", 
                "RÃ©seaux WiFi dÃ©tectÃ©s !\n\nðŸ“¡ RÃ©seaux :\nâ€¢ MonWiFi (WPA2) - Signal: -45dBm â­â­â­â­â­\nâ€¢ Voisin_WiFi (WPA2) - Signal: -67dBm â­â­â­\nâ€¢ FreeWiFi (Ouvert) - Signal: -78dBm â­â­\nâ€¢ Box_1234 (WPA3) - Signal: -82dBm â­\n\nâœ… 4 rÃ©seaux disponibles"
            )
    
    def show_ad_blocker(self):
        """Application supprimÃ©e"""
        QtWidgets.QMessageBox.information(self, "ðŸš« Application SupprimÃ©e", "Cette application a Ã©tÃ© supprimÃ©e de Ragnar OS 26.3.3")
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Bloqueur de PublicitÃ©s", "Protection contre les pubs et trackers")
        lay.addWidget(header)
        
        # Statut du bloqueur
        status_card = QtWidgets.QWidget(objectName="GlassCard")
        status_layout = QtWidgets.QVBoxLayout(status_card)
        status_layout.setContentsMargins(16, 16, 16, 16)
        
        status_title = QtWidgets.QLabel("ðŸ›¡ï¸ Statut de Protection")
        status_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        status_layout.addWidget(status_title)
        
        # Statistiques
        stats_info = [
            "âœ… Bloqueur activÃ© : OUI",
            "ðŸš« PublicitÃ©s bloquÃ©es aujourd'hui : 1,247",
            "ðŸ” Trackers bloquÃ©s : 89",
            "âš¡ Sites accÃ©lÃ©rÃ©s : 23",
            "ðŸ’¾ DonnÃ©es Ã©conomisÃ©es : 15.2 MB",
            "ðŸ”’ Malware bloquÃ© : 3 tentatives"
        ]
        
        for stat in stats_info:
            stat_label = QtWidgets.QLabel(stat)
            stat_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 255, 136, 0.5);")
            status_layout.addWidget(stat_label)
        
        lay.addWidget(status_card)
        
        # Configuration
        config_card = QtWidgets.QWidget(objectName="GlassCard")
        config_layout = QtWidgets.QVBoxLayout(config_card)
        config_layout.setContentsMargins(16, 16, 16, 16)
        
        config_title = QtWidgets.QLabel("âš™ï¸ Configuration")
        config_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        config_layout.addWidget(config_title)
        
        # Options de blocage
        block_ads_cb = QtWidgets.QCheckBox("ðŸš« Bloquer les publicitÃ©s")
        block_ads_cb.setChecked(True)
        block_trackers_cb = QtWidgets.QCheckBox("ðŸ” Bloquer les trackers")
        block_trackers_cb.setChecked(True)
        block_malware_cb = QtWidgets.QCheckBox("ðŸ›¡ï¸ Bloquer les malwares")
        block_malware_cb.setChecked(True)
        block_social_cb = QtWidgets.QCheckBox("ðŸ“± Bloquer widgets sociaux")
        block_social_cb.setChecked(False)
        
        config_layout.addWidget(block_ads_cb)
        config_layout.addWidget(block_trackers_cb)
        config_layout.addWidget(block_malware_cb)
        config_layout.addWidget(block_social_cb)
        
        lay.addWidget(config_card)
        
        # Listes de filtres
        filters_card = QtWidgets.QWidget(objectName="GlassCard")
        filters_layout = QtWidgets.QVBoxLayout(filters_card)
        filters_layout.setContentsMargins(16, 16, 16, 16)
        
        filters_title = QtWidgets.QLabel("ðŸ“‹ Listes de Filtres")
        filters_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        filters_layout.addWidget(filters_title)
        
        filter_list = QtWidgets.QListWidget()
        filters = [
            "âœ… EasyList (PublicitÃ©s gÃ©nÃ©rales)",
            "âœ… EasyPrivacy (Trackers)",
            "âœ… Malware Domains (SÃ©curitÃ©)",
            "âœ… Fanboy's Annoyances (Popups)",
            "âšª Adblock Warning Removal",
            "âšª Anti-Facebook (RÃ©seaux sociaux)"
        ]
        
        for filter_item in filters:
            filter_list.addItem(filter_item)
        
        filters_layout.addWidget(filter_list)
        lay.addWidget(filters_card)
        
        # Actions
        actions_layout = QtWidgets.QHBoxLayout()
        
        update_btn = QtWidgets.QPushButton("ðŸ”„ Mettre Ã  jour les filtres")
        whitelist_btn = QtWidgets.QPushButton("ðŸ“ Liste blanche")
        stats_btn = QtWidgets.QPushButton("ðŸ“Š Statistiques")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        update_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”„", "Filtres mis Ã  jour !\n\nâ€¢ 12,450 nouvelles entrÃ©es\nâ€¢ 3 domaines malveillants ajoutÃ©s\nâ€¢ Performance optimisÃ©e"))
        whitelist_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“", "Liste blanche !\n\nSites autorisÃ©s :\nâ€¢ google.com\nâ€¢ youtube.com\nâ€¢ github.com\n\nAjoutez des sites de confiance."))
        stats_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“Š", "Statistiques dÃ©taillÃ©es !\n\nðŸ“ˆ Cette semaine :\nâ€¢ 8,934 pubs bloquÃ©es\nâ€¢ 567 trackers stoppÃ©s\nâ€¢ 45.8 MB Ã©conomisÃ©s\nâ€¢ 12 malwares bloquÃ©s"))
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(update_btn)
        actions_layout.addWidget(whitelist_btn)
        actions_layout.addWidget(stats_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def show_password_manager_pro(self):
        """Gestionnaire de mots de passe professionnel"""
        d = GlassDialog("ðŸ” Gestionnaire de Mots de Passe Pro", (850, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Gestionnaire de Mots de Passe Pro", "SÃ©curitÃ© et gestion avancÃ©e de vos identifiants")
        lay.addWidget(header)
        
        # Onglets du gestionnaire
        password_tabs = QtWidgets.QTabWidget()
        
        # === ONGLET COFFRE-FORT ===
        vault_tab = QtWidgets.QWidget()
        vault_layout = QtWidgets.QVBoxLayout(vault_tab)
        
        # Statut de sÃ©curitÃ©
        security_card = QtWidgets.QWidget(objectName="GlassCard")
        security_layout = QtWidgets.QVBoxLayout(security_card)
        security_layout.setContentsMargins(16, 16, 16, 16)
        
        security_title = QtWidgets.QLabel("ðŸ›¡ï¸ Statut de SÃ©curitÃ©")
        security_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        security_layout.addWidget(security_title)
        
        security_stats = [
            "ðŸ”’ Coffre-fort : VERROUILLÃ‰",
            "ðŸ”‘ Mots de passe stockÃ©s : 127",
            "âš ï¸ Mots de passe faibles : 3",
            "ðŸ”„ DerniÃ¨re synchronisation : Il y a 5 min",
            "ðŸ›¡ï¸ Chiffrement : AES-256",
            "ðŸ“± Authentification 2FA : ACTIVE"
        ]
        
        for stat in security_stats:
            stat_label = QtWidgets.QLabel(stat)
            stat_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 255, 136, 0.5);")
            security_layout.addWidget(stat_label)
        
        vault_layout.addWidget(security_card)
        
        # Liste des mots de passe
        passwords_card = QtWidgets.QWidget(objectName="GlassCard")
        passwords_layout = QtWidgets.QVBoxLayout(passwords_card)
        passwords_layout.setContentsMargins(16, 16, 16, 16)
        
        passwords_title = QtWidgets.QLabel("ðŸ”‘ Coffre Ã  Mots de Passe")
        passwords_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        passwords_layout.addWidget(passwords_title)
        
        passwords_list = QtWidgets.QListWidget()
        password_entries = [
            "ðŸŒ Google (user@gmail.com) - â­â­â­â­â­",
            "ðŸ’¼ Entreprise (admin@work.com) - â­â­â­â­âšª",
            "ðŸ¦ Banque CrÃ©dit (****1234) - â­â­â­â­â­",
            "ðŸ“± Facebook (mon.profil) - â­â­âšªâšªâšª",
            "ðŸ›ï¸ Amazon (acheteur2024) - â­â­â­â­âšª",
            "ðŸŽ® Steam (gamer_pro) - â­â­â­â­â­",
            "ðŸ“§ Outlook (pro@outlook.com) - â­â­â­â­âšª",
            "â˜ï¸ Dropbox (cloud_user) - â­â­â­â­â­",
            "ðŸŽµ Spotify (music_lover) - â­â­â­âšªâšª",
            "ðŸ“º Netflix (streaming) - â­â­â­â­âšª"
        ]
        
        for entry in password_entries:
            passwords_list.addItem(entry)
        
        passwords_layout.addWidget(passwords_list)
        
        # Actions sur mots de passe
        password_actions = QtWidgets.QHBoxLayout()
        add_btn = QtWidgets.QPushButton("âž• Ajouter")
        edit_btn = QtWidgets.QPushButton("âœï¸ Modifier")
        copy_btn = QtWidgets.QPushButton("ðŸ“‹ Copier")
        generate_btn = QtWidgets.QPushButton("ðŸŽ² GÃ©nÃ©rer")
        
        add_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âž•", "Ajouter un mot de passe !\n\nðŸŒ Site/Application :\nðŸ‘¤ Nom d'utilisateur :\nðŸ”‘ Mot de passe :\nðŸ“ Notes :\nðŸ·ï¸ CatÃ©gorie :\n\nðŸ” Chiffrement automatique"))
        edit_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âœï¸", "Modifier l'entrÃ©e !\n\nðŸ“ EntrÃ©e sÃ©lectionnÃ©e : Google\n\nâœï¸ Champs modifiables :\nâ€¢ Nom d'utilisateur\nâ€¢ Mot de passe\nâ€¢ Notes\nâ€¢ CatÃ©gorie"))
        copy_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“‹", "Mot de passe copiÃ© !\n\nðŸ“‹ CopiÃ© dans le presse-papiers\nâ±ï¸ Auto-effacement dans 60 secondes\nðŸ”’ SÃ©curitÃ© prÃ©servÃ©e"))
        generate_btn.clicked.connect(lambda: self.generate_secure_password())
        
        password_actions.addWidget(add_btn)
        password_actions.addWidget(edit_btn)
        password_actions.addWidget(copy_btn)
        password_actions.addWidget(generate_btn)
        password_actions.addStretch()
        
        passwords_layout.addLayout(password_actions)
        vault_layout.addWidget(passwords_card)
        password_tabs.addTab(vault_tab, "ðŸ”‘ Coffre-fort")
        
        # === ONGLET AUDIT ===
        audit_tab = QtWidgets.QWidget()
        audit_layout = QtWidgets.QVBoxLayout(audit_tab)
        
        audit_card = QtWidgets.QWidget(objectName="GlassCard")
        audit_card_layout = QtWidgets.QVBoxLayout(audit_card)
        audit_card_layout.setContentsMargins(16, 16, 16, 16)
        
        audit_title = QtWidgets.QLabel("ðŸ” Audit de SÃ©curitÃ©")
        audit_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        audit_card_layout.addWidget(audit_title)
        
        audit_results = QtWidgets.QListWidget()
        audit_items = [
            "ðŸ”´ CRITIQUE - Facebook : Mot de passe trop faible (6 caractÃ¨res)",
            "ðŸŸ  ATTENTION - Spotify : Mot de passe rÃ©utilisÃ© (Amazon)",
            "ðŸ”´ CRITIQUE - LinkedIn : Pas de majuscules ni chiffres",
            "ðŸŸ¢ SÃ‰CURISÃ‰ - Google : Mot de passe fort (16 caractÃ¨res)",
            "ðŸŸ  ATTENTION - Twitter : DerniÃ¨re modification il y a 2 ans",
            "ðŸŸ¢ SÃ‰CURISÃ‰ - Banque : Authentification 2FA active",
            "ðŸ”´ URGENT - Email perso : Compromis dans une fuite de donnÃ©es",
            "ðŸŸ¢ EXCELLENT - Steam : Mot de passe unique et complexe"
        ]
        
        for item in audit_items:
            audit_results.addItem(item)
        
        audit_card_layout.addWidget(audit_results)
        
        # Actions audit
        audit_actions = QtWidgets.QHBoxLayout()
        scan_btn = QtWidgets.QPushButton("ðŸ” Nouvelle Analyse")
        fix_btn = QtWidgets.QPushButton("ðŸ”§ Corriger Automatiquement")
        report_btn = QtWidgets.QPushButton("ðŸ“‹ Rapport DÃ©taillÃ©")
        
        scan_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”", "Analyse de sÃ©curitÃ© !\n\nðŸ” Analyse en cours...\nâ€¢ VÃ©rification force des mots de passe\nâ€¢ DÃ©tection des doublons\nâ€¢ ContrÃ´le des fuites de donnÃ©es\n\nâ±ï¸ DurÃ©e estimÃ©e : 30 secondes"))
        fix_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”§", "Correction automatique !\n\nðŸ”§ Actions effectuÃ©es :\nâ€¢ 3 mots de passe renforcÃ©s\nâ€¢ 2 doublons Ã©liminÃ©s\nâ€¢ 1 compromis remplacÃ©\n\nâœ… SÃ©curitÃ© amÃ©liorÃ©e de 85%"))
        report_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“‹", "Rapport de sÃ©curitÃ© !\n\nðŸ“Š Score global : 78/100\n\nðŸ“ˆ AmÃ©liorations :\nâ€¢ Renforcer 3 mots de passe\nâ€¢ Activer 2FA sur 5 comptes\nâ€¢ Changer 1 mot de passe compromis\n\nðŸ“§ Rapport envoyÃ© par email"))
        
        audit_actions.addWidget(scan_btn)
        audit_actions.addWidget(fix_btn)
        audit_actions.addWidget(report_btn)
        audit_actions.addStretch()
        
        audit_card_layout.addLayout(audit_actions)
        audit_layout.addWidget(audit_card)
        password_tabs.addTab(audit_tab, "ðŸ” Audit")
        
        # === ONGLET GÃ‰NÃ‰RATEUR ===
        generator_tab = QtWidgets.QWidget()
        generator_layout = QtWidgets.QVBoxLayout(generator_tab)
        
        generator_card = QtWidgets.QWidget(objectName="GlassCard")
        generator_card_layout = QtWidgets.QVBoxLayout(generator_card)
        generator_card_layout.setContentsMargins(16, 16, 16, 16)
        
        generator_title = QtWidgets.QLabel("ðŸŽ² GÃ©nÃ©rateur de Mots de Passe")
        generator_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        generator_card_layout.addWidget(generator_title)
        
        # Options de gÃ©nÃ©ration
        length_layout = QtWidgets.QHBoxLayout()
        length_layout.addWidget(QtWidgets.QLabel("Longueur :"))
        length_spin = QtWidgets.QSpinBox()
        length_spin.setRange(8, 64)
        length_spin.setValue(16)
        length_layout.addWidget(length_spin)
        length_layout.addStretch()
        generator_card_layout.addLayout(length_layout)
        
        # Cases Ã  cocher pour les options
        uppercase_cb = QtWidgets.QCheckBox("ðŸ”¤ Majuscules (A-Z)")
        uppercase_cb.setChecked(True)
        lowercase_cb = QtWidgets.QCheckBox("ðŸ”¡ Minuscules (a-z)")
        lowercase_cb.setChecked(True)
        numbers_cb = QtWidgets.QCheckBox("ðŸ”¢ Chiffres (0-9)")
        numbers_cb.setChecked(True)
        symbols_cb = QtWidgets.QCheckBox("ðŸ”£ Symboles (!@#$%)")
        symbols_cb.setChecked(True)
        
        generator_card_layout.addWidget(uppercase_cb)
        generator_card_layout.addWidget(lowercase_cb)
        generator_card_layout.addWidget(numbers_cb)
        generator_card_layout.addWidget(symbols_cb)
        
        # Mot de passe gÃ©nÃ©rÃ©
        generated_password = QtWidgets.QLineEdit()
        generated_password.setPlaceholderText("Le mot de passe gÃ©nÃ©rÃ© apparaÃ®tra ici...")
        generated_password.setReadOnly(True)
        generator_card_layout.addWidget(generated_password)
        
        # Actions gÃ©nÃ©rateur
        gen_actions = QtWidgets.QHBoxLayout()
        generate_new_btn = QtWidgets.QPushButton("ðŸŽ² GÃ©nÃ©rer")
        copy_gen_btn = QtWidgets.QPushButton("ðŸ“‹ Copier")
        test_strength_btn = QtWidgets.QPushButton("ðŸ’ª Tester Force")
        
        generate_new_btn.clicked.connect(lambda: self.generate_password_display(generated_password, length_spin.value()))
        copy_gen_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“‹", "Mot de passe copiÃ© !\n\nðŸ“‹ CopiÃ© dans le presse-papiers\nâ±ï¸ Effacement automatique dans 60s\nðŸ”’ PrÃªt Ã  Ãªtre utilisÃ©"))
        test_strength_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ’ª", "Test de force !\n\nðŸ’ª Force : TRÃˆS Ã‰LEVÃ‰E\nâ­ Score : 95/100\n\nâœ… CritÃ¨res respectÃ©s :\nâ€¢ Longueur suffisante\nâ€¢ CaractÃ¨res variÃ©s\nâ€¢ Entropie Ã©levÃ©e\nâ€¢ RÃ©sistant aux attaques"))
        
        gen_actions.addWidget(generate_new_btn)
        gen_actions.addWidget(copy_gen_btn)
        gen_actions.addWidget(test_strength_btn)
        gen_actions.addStretch()
        
        generator_card_layout.addLayout(gen_actions)
        generator_layout.addWidget(generator_card)
        password_tabs.addTab(generator_tab, "ðŸŽ² GÃ©nÃ©rateur")
        
        lay.addWidget(password_tabs)
        
        # ContrÃ´les principaux
        main_controls = QtWidgets.QHBoxLayout()
        
        unlock_vault_btn = QtWidgets.QPushButton("ðŸ”“ DÃ©verrouiller")
        unlock_vault_btn.setStyleSheet("QPushButton { background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 rgba(0, 255, 136, 0.3), stop:1 rgba(0, 255, 136, 0.1)); }")
        
        sync_btn = QtWidgets.QPushButton("ðŸ”„ Synchroniser")
        backup_btn = QtWidgets.QPushButton("ðŸ’¾ Sauvegarder")
        import_btn = QtWidgets.QPushButton("ðŸ“¥ Importer")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        unlock_vault_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”“", "Coffre dÃ©verrouillÃ© !\n\nðŸ”‘ Authentification rÃ©ussie\nðŸ”“ AccÃ¨s complet aux mots de passe\nâ±ï¸ Session : 30 minutes\nðŸ›¡ï¸ Surveillance activÃ©e"))
        sync_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”„", "Synchronisation !\n\nâ˜ï¸ Synchronisation cloud en cours...\nðŸ“± Appareils synchronisÃ©s : 3\nâœ… 127 entrÃ©es mises Ã  jour\nðŸ”’ Chiffrement de bout en bout"))
        backup_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ’¾", "Sauvegarde crÃ©Ã©e !\n\nðŸ’¾ Sauvegarde locale : 100%\nâ˜ï¸ Sauvegarde cloud : 100%\nðŸ” Chiffrement : AES-256\nðŸ“… Date : Aujourd'hui"))
        import_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“¥", "Importer des donnÃ©es !\n\nðŸ“ Formats supportÃ©s :\nâ€¢ .csv (Excel)\nâ€¢ .json (Ragnar)\nâ€¢ .1pux (1Password)\nâ€¢ .xml (KeePass)\n\nðŸ“¥ PrÃªt Ã  importer"))
        close_btn.clicked.connect(d.close)
        
        main_controls.addWidget(unlock_vault_btn)
        main_controls.addWidget(sync_btn)
        main_controls.addWidget(backup_btn)
        main_controls.addWidget(import_btn)
        main_controls.addStretch()
        main_controls.addWidget(close_btn)
        
        lay.addLayout(main_controls)
        
        d.show()
        fade_in(d, 600)
    
    def generate_secure_password(self):
        """GÃ©nÃ¨re un mot de passe sÃ©curisÃ©"""
        import random
        import string
        
        chars = string.ascii_letters + string.digits + "!@#$%^&*"
        password = ''.join(random.choice(chars) for _ in range(16))
        
        QtWidgets.QMessageBox.information(
            self, "ðŸŽ² Mot de passe gÃ©nÃ©rÃ©", 
            f"Nouveau mot de passe sÃ©curisÃ© !\n\nðŸ”‘ Mot de passe :\n{password}\n\nâœ… 16 caractÃ¨res\nðŸ’ª Force : TRÃˆS Ã‰LEVÃ‰E\nðŸ“‹ CopiÃ© automatiquement"
        )
    
    def generate_password_display(self, line_edit, length):
        """GÃ©nÃ¨re et affiche un mot de passe"""
        import random
        import string
        
        chars = string.ascii_letters + string.digits + "!@#$%^&*"
        password = ''.join(random.choice(chars) for _ in range(length))
        line_edit.setText(password)
    
    def show_firewall(self):
        """Application supprimÃ©e"""
        QtWidgets.QMessageBox.information(self, "ðŸš« Application SupprimÃ©e", "Cette application a Ã©tÃ© supprimÃ©e de Ragnar OS 26.3.3")
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Pare-feu Ragnar Pro", "Protection rÃ©seau intelligente et monitoring avancÃ©")
        lay.addWidget(header)
        
        # Onglets du pare-feu
        firewall_tabs = QtWidgets.QTabWidget()
        
        # === ONGLET PROTECTION ===
        protection_tab = QtWidgets.QWidget()
        protection_layout = QtWidgets.QVBoxLayout(protection_tab)
        
        # Statut du pare-feu
        status_card = QtWidgets.QWidget(objectName="GlassCard")
        status_layout = QtWidgets.QVBoxLayout(status_card)
        status_layout.setContentsMargins(16, 16, 16, 16)
        
        status_title = QtWidgets.QLabel("ðŸ›¡ï¸ Statut du Pare-feu")
        status_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        status_layout.addWidget(status_title)
        
        firewall_status = [
            ("âœ…", "Pare-feu", "ACTIF", "#00ff88"),
            ("âœ…", "Protection entrante", "ACTIVE", "#00ff88"),
            ("âœ…", "Protection sortante", "ACTIVE", "#00ff88"),
            ("âœ…", "DÃ©tection d'intrusion", "ACTIVE", "#00ff88"),
            ("âš ï¸", "Mode furtif", "INACTIF", "#ffaa00"),
            ("âœ…", "Blocage automatique", "ACTIF", "#00ff88")
        ]
        
        for icon, feature, status, color in firewall_status:
            status_item = QtWidgets.QHBoxLayout()
            status_icon = QtWidgets.QLabel(icon)
            status_icon.setStyleSheet("font-size: 16px;")
            status_name = QtWidgets.QLabel(feature)
            status_name.setStyleSheet("color: white; font-size: 12px;")
            status_value = QtWidgets.QLabel(status)
            status_value.setStyleSheet(f"color: {color}; font-weight: bold; font-size: 12px;")
            
            status_item.addWidget(status_icon)
            status_item.addWidget(status_name)
            status_item.addStretch()
            status_item.addWidget(status_value)
            
            status_layout.addLayout(status_item)
        
        protection_layout.addWidget(status_card)
        
        # Statistiques rÃ©seau
        network_stats_card = QtWidgets.QWidget(objectName="GlassCard")
        network_stats_layout = QtWidgets.QVBoxLayout(network_stats_card)
        network_stats_layout.setContentsMargins(16, 16, 16, 16)
        
        network_stats_title = QtWidgets.QLabel("ðŸ“Š Statistiques RÃ©seau")
        network_stats_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        network_stats_layout.addWidget(network_stats_title)
        
        network_stats = [
            "ðŸš« Connexions bloquÃ©es aujourd'hui : 234",
            "ðŸ” Tentatives d'intrusion : 12",
            "ðŸ“ˆ Trafic entrant : 156.7 MB",
            "ðŸ“‰ Trafic sortant : 89.3 MB",
            "âš¡ Connexions actives : 47",
            "ðŸŒ Ports ouverts : 8"
        ]
        
        for stat in network_stats:
            stat_label = QtWidgets.QLabel(stat)
            stat_label.setStyleSheet("color: white; font-size: 12px; padding: 4px; border-left: 3px solid rgba(0, 170, 255, 0.5);")
            network_stats_layout.addWidget(stat_label)
        
        protection_layout.addWidget(network_stats_card)
        
        # Actions rapides
        quick_actions_card = QtWidgets.QWidget(objectName="GlassCard")
        quick_actions_layout = QtWidgets.QHBoxLayout(quick_actions_card)
        quick_actions_layout.setContentsMargins(16, 16, 16, 16)
        
        stealth_btn = QtWidgets.QPushButton("ðŸ‘» Mode Furtif")
        block_all_btn = QtWidgets.QPushButton("ðŸš« Bloquer Tout")
        allow_all_btn = QtWidgets.QPushButton("âœ… Autoriser Tout")
        
        stealth_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ‘»", "Mode Furtif ActivÃ© !\n\nðŸ”’ SystÃ¨me invisible sur le rÃ©seau\nðŸš« RÃ©ponses aux pings dÃ©sactivÃ©es\nðŸ›¡ï¸ Ports fermÃ©s silencieusement\nðŸ‘» FurtivitÃ© maximale"))
        block_all_btn.clicked.connect(lambda: QtWidgets.QMessageBox.warning(d, "ðŸš«", "Blocage Total ActivÃ© !\n\nðŸš« Toutes les connexions bloquÃ©es\nâš ï¸ Internet inaccessible\nðŸ›¡ï¸ Protection maximale\nâ±ï¸ Mode temporaire recommandÃ©"))
        allow_all_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âœ…", "Autorisation Totale !\n\nâœ… Toutes les connexions autorisÃ©es\nâš ï¸ Protection rÃ©duite\nðŸŒ AccÃ¨s Internet complet\nðŸ›¡ï¸ Surveillance maintenue"))
        
        quick_actions_layout.addWidget(stealth_btn)
        quick_actions_layout.addWidget(block_all_btn)
        quick_actions_layout.addWidget(allow_all_btn)
        quick_actions_layout.addStretch()
        
        protection_layout.addWidget(quick_actions_card)
        firewall_tabs.addTab(protection_tab, "ðŸ›¡ï¸ Protection")
        
        # === ONGLET RÃˆGLES ===
        rules_tab = QtWidgets.QWidget()
        rules_layout = QtWidgets.QVBoxLayout(rules_tab)
        
        rules_card = QtWidgets.QWidget(objectName="GlassCard")
        rules_card_layout = QtWidgets.QVBoxLayout(rules_card)
        rules_card_layout.setContentsMargins(16, 16, 16, 16)
        
        rules_title = QtWidgets.QLabel("ðŸ“‹ RÃ¨gles de Pare-feu")
        rules_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        rules_card_layout.addWidget(rules_title)
        
        rules_list = QtWidgets.QListWidget()
        firewall_rules = [
            "âœ… AUTORISER - HTTP/HTTPS (80, 443) - Sortant",
            "âœ… AUTORISER - DNS (53) - Sortant",
            "ðŸš« BLOQUER - Telnet (23) - Entrant/Sortant",
            "âœ… AUTORISER - SSH (22) - Entrant (IP spÃ©cifiques)",
            "ðŸš« BLOQUER - FTP (21) - Entrant",
            "âœ… AUTORISER - Email (25, 110, 143, 993, 995) - Sortant",
            "ðŸš« BLOQUER - Partage Windows (445) - Entrant",
            "âš ï¸ SURVEILLER - P2P (BitTorrent) - Sortant"
        ]
        
        for rule in firewall_rules:
            rules_list.addItem(rule)
        
        rules_card_layout.addWidget(rules_list)
        
        # Actions sur rÃ¨gles
        rules_actions = QtWidgets.QHBoxLayout()
        add_rule_btn = QtWidgets.QPushButton("âž• Nouvelle RÃ¨gle")
        edit_rule_btn = QtWidgets.QPushButton("âœï¸ Modifier")
        delete_rule_btn = QtWidgets.QPushButton("ðŸ—‘ï¸ Supprimer")
        import_rules_btn = QtWidgets.QPushButton("ðŸ“¥ Importer")
        
        add_rule_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âž•", "Nouvelle RÃ¨gle !\n\nðŸŽ¯ Action : Autoriser/Bloquer\nðŸŒ Direction : Entrant/Sortant\nðŸ”Œ Port : 80, 443, etc.\nðŸ“ IP : Toutes ou spÃ©cifiques\nðŸ“‹ Description : Optionnelle"))
        edit_rule_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âœï¸", "Modifier la RÃ¨gle !\n\nðŸ“ RÃ¨gle sÃ©lectionnÃ©e :\nAUTORISER - HTTP (80) - Sortant\n\nâœï¸ Modifications disponibles :\nâ€¢ Action â€¢ Port â€¢ Direction â€¢ IP"))
        delete_rule_btn.clicked.connect(lambda: QtWidgets.QMessageBox.warning(d, "ðŸ—‘ï¸", "Supprimer la RÃ¨gle !\n\nâš ï¸ ÃŠtes-vous sÃ»r ?\nðŸ—‘ï¸ RÃ¨gle supprimÃ©e dÃ©finitivement\nðŸ”„ Pare-feu redÃ©marrÃ©\nâœ… Nouvelle configuration active"))
        import_rules_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“¥", "Importer des RÃ¨gles !\n\nðŸ“ Formats supportÃ©s :\nâ€¢ .firewall (Ragnar)\nâ€¢ .xml (Standard)\nâ€¢ .json (Configuration)\n\nðŸ“¥ 12 rÃ¨gles importÃ©es avec succÃ¨s"))
        
        rules_actions.addWidget(add_rule_btn)
        rules_actions.addWidget(edit_rule_btn)
        rules_actions.addWidget(delete_rule_btn)
        rules_actions.addWidget(import_rules_btn)
        rules_actions.addStretch()
        
        rules_card_layout.addLayout(rules_actions)
        rules_layout.addWidget(rules_card)
        firewall_tabs.addTab(rules_tab, "ðŸ“‹ RÃ¨gles")
        
        # === ONGLET MONITORING ===
        monitoring_tab = QtWidgets.QWidget()
        monitoring_layout = QtWidgets.QVBoxLayout(monitoring_tab)
        
        monitoring_card = QtWidgets.QWidget(objectName="GlassCard")
        monitoring_card_layout = QtWidgets.QVBoxLayout(monitoring_card)
        monitoring_card_layout.setContentsMargins(16, 16, 16, 16)
        
        monitoring_title = QtWidgets.QLabel("ðŸ“¡ Monitoring en Temps RÃ©el")
        monitoring_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        monitoring_card_layout.addWidget(monitoring_title)
        
        monitoring_list = QtWidgets.QListWidget()
        monitoring_events = [
            "ðŸ”´ BLOQUÃ‰ - 192.168.1.100:445 â†’ Tentative SMB",
            "âœ… AUTORISÃ‰ - google.com:443 â†’ Navigation HTTPS",
            "âš ï¸ SUSPECT - 203.0.113.1:22 â†’ Tentative SSH rÃ©pÃ©tÃ©e",
            "âœ… AUTORISÃ‰ - outlook.com:993 â†’ Email IMAP",
            "ðŸ”´ BLOQUÃ‰ - 198.51.100.1:23 â†’ Tentative Telnet",
            "âœ… AUTORISÃ‰ - github.com:443 â†’ DÃ©veloppement",
            "âš ï¸ ANALYSE - torrent.tracker:6881 â†’ Trafic P2P",
            "ðŸ”´ BLOQUÃ‰ - malware.site:80 â†’ Site malveillant"
        ]
        
        for event in monitoring_events:
            monitoring_list.addItem(event)
        
        monitoring_card_layout.addWidget(monitoring_list)
        
        # ContrÃ´les monitoring
        monitoring_controls = QtWidgets.QHBoxLayout()
        pause_btn = QtWidgets.QPushButton("â¸ï¸ Pause")
        clear_btn = QtWidgets.QPushButton("ðŸ—‘ï¸ Effacer")
        export_btn = QtWidgets.QPushButton("ðŸ“¤ Exporter")
        alerts_btn = QtWidgets.QPushButton("ðŸ”” Alertes")
        
        pause_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "â¸ï¸", "Monitoring en Pause !\n\nâ¸ï¸ Surveillance interrompue\nðŸ’¾ Ã‰vÃ©nements sauvegardÃ©s\nðŸ”„ Reprise disponible\nâš ï¸ Protection maintenue"))
        clear_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ—‘ï¸", "Journal EffacÃ© !\n\nðŸ—‘ï¸ Tous les Ã©vÃ©nements supprimÃ©s\nðŸ†• Journal rÃ©initialisÃ©\nðŸ“Š Statistiques conservÃ©es\nâœ… PrÃªt pour nouveaux Ã©vÃ©nements"))
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“¤", "Journal ExportÃ© !\n\nðŸ“ Fichier : firewall_log_2024.txt\nðŸ“Š 2,847 Ã©vÃ©nements exportÃ©s\nðŸ“ Emplacement : Documents/Ragnar/\nâœ… Export terminÃ©"))
        alerts_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ””", "Configuration Alertes !\n\nðŸ”” Types d'alertes :\nâ€¢ Tentatives d'intrusion\nâ€¢ Trafic suspect\nâ€¢ RÃ¨gles violÃ©es\nâ€¢ Seuils dÃ©passÃ©s\n\nðŸ“§ Notifications par email activÃ©es"))
        
        monitoring_controls.addWidget(pause_btn)
        monitoring_controls.addWidget(clear_btn)
        monitoring_controls.addWidget(export_btn)
        monitoring_controls.addWidget(alerts_btn)
        monitoring_controls.addStretch()
        
        monitoring_card_layout.addLayout(monitoring_controls)
        monitoring_layout.addWidget(monitoring_card)
        firewall_tabs.addTab(monitoring_tab, "ðŸ“¡ Monitoring")
        
        lay.addWidget(firewall_tabs)
        
        # ContrÃ´les principaux
        main_controls = QtWidgets.QHBoxLayout()
        
        enable_btn = QtWidgets.QPushButton("ðŸŸ¢ Activer")
        enable_btn.setStyleSheet("QPushButton { background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 rgba(0, 255, 136, 0.3), stop:1 rgba(0, 255, 136, 0.1)); }")
        
        disable_btn = QtWidgets.QPushButton("ðŸ”´ DÃ©sactiver")
        restart_btn = QtWidgets.QPushButton("ðŸ”„ RedÃ©marrer")
        config_btn = QtWidgets.QPushButton("âš™ï¸ Configuration")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        enable_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸŸ¢", "Pare-feu ActivÃ© !\n\nðŸ›¡ï¸ Protection rÃ©seau active\nðŸ“‹ RÃ¨gles appliquÃ©es\nðŸ“¡ Monitoring dÃ©marrÃ©\nâœ… SystÃ¨me sÃ©curisÃ©"))
        disable_btn.clicked.connect(lambda: QtWidgets.QMessageBox.warning(d, "ðŸ”´", "Pare-feu DÃ©sactivÃ© !\n\nâš ï¸ Protection rÃ©seau arrÃªtÃ©e\nðŸš« RÃ¨gles inactives\nðŸ“¡ Monitoring stoppÃ©\nâš ï¸ SystÃ¨me vulnÃ©rable"))
        restart_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”„", "Pare-feu RedÃ©marrÃ© !\n\nðŸ”„ Service redÃ©marrÃ©\nðŸ“‹ RÃ¨gles rechargÃ©es\nðŸ“¡ Monitoring rÃ©initialisÃ©\nâœ… SystÃ¨me opÃ©rationnel"))
        config_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âš™ï¸", "Configuration AvancÃ©e !\n\nâš™ï¸ Options disponibles :\nâ€¢ Profils de sÃ©curitÃ©\nâ€¢ Notifications\nâ€¢ Journalisation\nâ€¢ Performance\nâ€¢ Sauvegarde"))
        close_btn.clicked.connect(d.close)
        
        main_controls.addWidget(enable_btn)
        main_controls.addWidget(disable_btn)
        main_controls.addWidget(restart_btn)
        main_controls.addWidget(config_btn)
        main_controls.addStretch()
        main_controls.addWidget(close_btn)
        
        lay.addLayout(main_controls)
        
        d.show()
        fade_in(d, 800)
    
    def show_theme_manager(self):
        """Gestionnaire de thÃ¨mes avancÃ©"""
        d = GlassDialog("ðŸŽ¨ Gestionnaire de ThÃ¨mes Ragnar", (900, 650), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header
        header = make_header("Gestionnaire de ThÃ¨mes", "Personnalisez votre expÃ©rience visuelle")
        lay.addWidget(header)
        
        # ThÃ¨me actuel
        current_card = QtWidgets.QWidget(objectName="GlassCard")
        current_layout = QtWidgets.QVBoxLayout(current_card)
        current_layout.setContentsMargins(16, 16, 16, 16)
        
        current_title = QtWidgets.QLabel("ðŸŒŸ ThÃ¨me Actuel")
        current_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00ff88; padding: 8px;")
        current_layout.addWidget(current_title)
        
        current_theme_info = QtWidgets.QLabel("ðŸ–¤ Ragnar Modern Dark - Le thÃ¨me noir Ã©lÃ©gant avec accents verts")
        current_theme_info.setStyleSheet("color: white; font-size: 12px; padding: 8px; border: 1px solid rgba(0, 255, 136, 0.3); border-radius: 5px;")
        current_layout.addWidget(current_theme_info)
        
        lay.addWidget(current_card)
        
        # Galerie de thÃ¨mes
        themes_card = QtWidgets.QWidget(objectName="GlassCard")
        themes_layout = QtWidgets.QVBoxLayout(themes_card)
        themes_layout.setContentsMargins(16, 16, 16, 16)
        
        themes_title = QtWidgets.QLabel("ðŸŽ¨ ThÃ¨mes Disponibles")
        themes_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        themes_layout.addWidget(themes_title)
        
        # Grille de thÃ¨mes
        themes_grid = QtWidgets.QGridLayout()
        
        themes_data = [
            ("ðŸ–¤", "Ragnar Dark", "ThÃ¨me sombre moderne", "#000000", "#00ff88"),
            ("âšª", "Ragnar Light", "ThÃ¨me clair Ã©lÃ©gant", "#ffffff", "#0066cc"),
            ("ðŸ”µ", "Ocean Blue", "Bleu profond apaisant", "#001122", "#00aaff"),
            ("ðŸ”´", "Fire Red", "Rouge passion intense", "#220000", "#ff4444"),
            ("ðŸŸ¢", "Forest Green", "Vert nature relaxant", "#002200", "#44ff44"),
            ("ðŸŸ£", "Royal Purple", "Violet royal luxueux", "#220022", "#aa44ff"),
            ("ðŸŸ ", "Sunset Orange", "Orange coucher de soleil", "#221100", "#ff8844"),
            ("ðŸŒˆ", "Rainbow", "Multicolore dynamique", "#111111", "#ff00ff"),
        ]
        
        row, col = 0, 0
        for emoji, name, desc, bg_color, accent_color in themes_data:
            theme_widget = QtWidgets.QWidget()
            theme_widget.setFixedSize(200, 120)
            theme_widget.setStyleSheet(f"""
                QWidget {{
                    background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                        stop:0 {bg_color}cc,
                        stop:1 {bg_color}88);
                    border: 2px solid {accent_color}66;
                    border-radius: 10px;
                }}
                QWidget:hover {{
                    border: 2px solid {accent_color};
                }}
            """)
            
            theme_layout = QtWidgets.QVBoxLayout(theme_widget)
            theme_layout.setContentsMargins(8, 8, 8, 8)
            
            theme_icon = QtWidgets.QLabel(emoji)
            theme_icon.setStyleSheet("font-size: 24px; color: white;")
            theme_icon.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            theme_name = QtWidgets.QLabel(name)
            theme_name.setStyleSheet(f"font-size: 12px; font-weight: bold; color: {accent_color};")
            theme_name.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            
            theme_desc = QtWidgets.QLabel(desc)
            theme_desc.setStyleSheet("font-size: 9px; color: #cccccc;")
            theme_desc.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            theme_desc.setWordWrap(True)
            
            apply_btn = QtWidgets.QPushButton("Appliquer")
            apply_btn.setStyleSheet(f"""
                QPushButton {{
                    background: {accent_color}44;
                    border: 1px solid {accent_color};
                    border-radius: 4px;
                    color: white;
                    font-size: 9px;
                    padding: 4px;
                }}
                QPushButton:hover {{
                    background: {accent_color}66;
                }}
            """)
            apply_btn.clicked.connect(lambda checked, n=name: self.apply_theme(n))
            
            theme_layout.addWidget(theme_icon)
            theme_layout.addWidget(theme_name)
            theme_layout.addWidget(theme_desc)
            theme_layout.addWidget(apply_btn)
            
            themes_grid.addWidget(theme_widget, row, col)
            col += 1
            if col > 3:
                col = 0
                row += 1
        
        themes_layout.addLayout(themes_grid)
        lay.addWidget(themes_card)
        
        # Options avancÃ©es
        options_card = QtWidgets.QWidget(objectName="GlassCard")
        options_layout = QtWidgets.QVBoxLayout(options_card)
        options_layout.setContentsMargins(16, 16, 16, 16)
        
        options_title = QtWidgets.QLabel("âš™ï¸ Options AvancÃ©es")
        options_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #ffaa00; padding: 8px;")
        options_layout.addWidget(options_title)
        
        # Options
        auto_dark_cb = QtWidgets.QCheckBox("ðŸŒ™ Mode sombre automatique (selon l'heure)")
        animations_cb = QtWidgets.QCheckBox("âœ¨ Animations et transitions")
        animations_cb.setChecked(True)
        transparency_cb = QtWidgets.QCheckBox("ðŸ‘» Effets de transparence")
        transparency_cb.setChecked(True)
        
        options_layout.addWidget(auto_dark_cb)
        options_layout.addWidget(animations_cb)
        options_layout.addWidget(transparency_cb)
        
        lay.addWidget(options_card)
        
        # Actions
        actions_layout = QtWidgets.QHBoxLayout()
        
        create_btn = QtWidgets.QPushButton("ðŸŽ¨ CrÃ©er un ThÃ¨me")
        import_btn = QtWidgets.QPushButton("ðŸ“¥ Importer")
        export_btn = QtWidgets.QPushButton("ðŸ“¤ Exporter")
        reset_btn = QtWidgets.QPushButton("ðŸ”„ RÃ©initialiser")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        create_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸŽ¨", "CrÃ©ateur de ThÃ¨me !\n\nðŸŽ¨ CrÃ©ez votre thÃ¨me personnalisÃ© :\nâ€¢ Choisissez les couleurs\nâ€¢ DÃ©finissez les polices\nâ€¢ Ajustez la transparence\nâ€¢ PrÃ©visualisez en temps rÃ©el"))
        import_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“¥", "Importer un ThÃ¨me !\n\nðŸ“ Formats supportÃ©s :\nâ€¢ .ragnar-theme\nâ€¢ .json\nâ€¢ .css\n\nImportez des thÃ¨mes de la communautÃ© !"))
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“¤", "Exporter le ThÃ¨me !\n\nðŸ’¾ ThÃ¨me exportÃ© :\nâ€¢ ragnar-dark-modern.theme\nâ€¢ Partagez avec la communautÃ©\nâ€¢ Sauvegarde automatique"))
        reset_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”„", "RÃ©initialisation !\n\nðŸ”„ ThÃ¨me par dÃ©faut restaurÃ©\nðŸ–¤ Ragnar Modern Dark appliquÃ©\nâœ… ParamÃ¨tres rÃ©initialisÃ©s"))
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(create_btn)
        actions_layout.addWidget(import_btn)
        actions_layout.addWidget(export_btn)
        actions_layout.addWidget(reset_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addLayout(actions_layout)
        
        d.show()
        fade_in(d, 600)
    
    def apply_theme(self, theme_name):
        """Applique un thÃ¨me sÃ©lectionnÃ©"""
        QtWidgets.QMessageBox.information(
            self, "ðŸŽ¨ ThÃ¨me AppliquÃ©", 
            f"ThÃ¨me '{theme_name}' appliquÃ© !\n\nâœ¨ Changements :\nâ€¢ Interface mise Ã  jour\nâ€¢ Couleurs modifiÃ©es\nâ€¢ Animations adaptÃ©es\n\nRedÃ©marrage recommandÃ© pour une application complÃ¨te."
        )
    
    def show_marketplace(self):
        QtWidgets.QMessageBox.information(self, "ðŸª Marketplace", "Marketplace .rapp !\n\nContenu :\nâ€¢ Applications\nâ€¢ ThÃ¨mes\nâ€¢ Extensions\nâ€¢ Outils")
    
    def show_widget_manager(self):
        QtWidgets.QMessageBox.information(self, "ðŸ“± Widgets", "Gestionnaire de widgets !\n\nWidgets :\nâ€¢ MÃ©tÃ©o\nâ€¢ Horloge\nâ€¢ SystÃ¨me\nâ€¢ PersonnalisÃ©s")
    
    def show_notification_center(self):
        QtWidgets.QMessageBox.information(self, "ðŸ”” Notifications", "Centre de notifications !\n\nFonctionnalitÃ©s :\nâ€¢ Historique\nâ€¢ Filtres\nâ€¢ Actions rapides")
    
    def show_ragnar_cloud(self):
        QtWidgets.QMessageBox.information(self, "â˜ï¸ Ragnar Cloud", "Ragnar Cloud !\n\nServices :\nâ€¢ Stockage\nâ€¢ Synchronisation\nâ€¢ Partage\nâ€¢ Sauvegarde")
    
    def show_ai_assistant(self):
        """Application supprimÃ©e"""
        QtWidgets.QMessageBox.information(self, "ðŸš« Application SupprimÃ©e", "Cette application a Ã©tÃ© supprimÃ©e de Ragnar OS 26.3.3")
    
    def show_premium_features(self):
        QtWidgets.QMessageBox.information(self, "ðŸŒŸ Premium", "Ragnar Premium !\n\nAvantages :\nâ€¢ FonctionnalitÃ©s exclusives\nâ€¢ Support prioritaire\nâ€¢ ThÃ¨mes premium")
    
    def show_ai_predictions(self):
        """Application supprimÃ©e"""
        QtWidgets.QMessageBox.information(self, "ðŸš« Application SupprimÃ©e", "Cette application a Ã©tÃ© supprimÃ©e de Ragnar OS 26.3.3")
    
    def show_theater_mode(self):
        """Application supprimÃ©e"""
        QtWidgets.QMessageBox.information(self, "ðŸš« Application SupprimÃ©e", "Cette application a Ã©tÃ© supprimÃ©e de Ragnar OS 26.3.3")

    def show_files(self):
        """Gestionnaire de fichiers moderne intÃ©grÃ©"""
        d = GlassDialog("ðŸ“ Gestionnaire de Fichiers Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(15)
        lay.setContentsMargins(20, 20, 20, 20)
        
        # Header moderne
        header = make_header("Gestionnaire de Fichiers", "Navigation et gestion avancÃ©e")
        lay.addWidget(header)
        
        # Barre de navigation
        nav_card = QtWidgets.QWidget(objectName="GlassCard")
        nav_layout = QtWidgets.QHBoxLayout(nav_card)
        nav_layout.setContentsMargins(16, 12, 16, 12)
        
        # Chemin actuel
        current_path = Path.cwd()
        path_label = QtWidgets.QLabel(f"ðŸ“ {current_path}")
        path_label.setStyleSheet("color: #00ff88; font-weight: bold; font-size: 13px;")
        
        # Boutons de navigation
        back_btn = QtWidgets.QPushButton("â¬…ï¸ Retour")
        up_btn = QtWidgets.QPushButton("â¬†ï¸ Parent")
        home_btn = QtWidgets.QPushButton("ðŸ  Accueil")
        refresh_btn = QtWidgets.QPushButton("ðŸ”„ Actualiser")
        
        nav_layout.addWidget(path_label)
        nav_layout.addStretch()
        nav_layout.addWidget(back_btn)
        nav_layout.addWidget(up_btn)
        nav_layout.addWidget(home_btn)
        nav_layout.addWidget(refresh_btn)

        # Option: effet de verre ultra rÃ©aliste
        glass_toggle = QtWidgets.QCheckBox("âœ¨ Verre Ultra")
        nav_layout.addWidget(glass_toggle)
        
        lay.addWidget(nav_card)
        
        # Liste des fichiers moderne
        files_card = QtWidgets.QWidget(objectName="GlassCard")
        files_layout = QtWidgets.QVBoxLayout(files_card)
        files_layout.setContentsMargins(16, 16, 16, 16)
        
        files_title = QtWidgets.QLabel("ðŸ“‚ Contenu du dossier")
        files_title.setStyleSheet("font-size: 16px; font-weight: bold; color: #00aaff; padding: 8px;")
        files_layout.addWidget(files_title)
        
        # Liste des fichiers
        file_list = QtWidgets.QListWidget()
        
        try:
            # Lister les fichiers et dossiers
            items = []
            for item in current_path.iterdir():
                if item.is_dir():
                    items.append(f"ðŸ“ {item.name}/")
                else:
                    size = item.stat().st_size
                    size_str = self.format_file_size(size)
                    items.append(f"ðŸ“„ {item.name} ({size_str})")
            
            # Trier : dossiers d'abord, puis fichiers
            items.sort(key=lambda x: (not x.startswith("ðŸ“"), x.lower()))
            
            for item in items:
                file_list.addItem(item)
                
        except Exception as e:
            file_list.addItem(f"âŒ Erreur : {str(e)}")
        
        files_layout.addWidget(file_list)
        lay.addWidget(files_card)
        
        # Actions rapides
        actions_card = QtWidgets.QWidget(objectName="GlassCard")
        actions_layout = QtWidgets.QHBoxLayout(actions_card)
        actions_layout.setContentsMargins(16, 16, 16, 16)
        
        new_folder_btn = QtWidgets.QPushButton("ðŸ“ Nouveau Dossier")
        new_file_btn = QtWidgets.QPushButton("ðŸ“„ Nouveau Fichier")
        open_external_btn = QtWidgets.QPushButton("ðŸš€ Ouvrir Externe")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        # Connexions
        new_folder_btn.clicked.connect(self.create_new_folder)
        new_file_btn.clicked.connect(self.create_new_file)
        open_external_btn.clicked.connect(lambda: safe_open(current_path))
        close_btn.clicked.connect(d.close)
        
        actions_layout.addWidget(new_folder_btn)
        actions_layout.addWidget(new_file_btn)
        actions_layout.addWidget(open_external_btn)
        actions_layout.addStretch()
        actions_layout.addWidget(close_btn)
        
        lay.addWidget(actions_card)
        
        # Double-clic: ouvrir fichiers / exÃ©cuter .rapp
        def on_item_double_click(item):
            text = item.text()
            try:
                # Extraire le nom rÃ©el
                name = text.split(' ', 1)[1] if ' ' in text else text
                if name.endswith('/'):
                    name = name[:-1]
                if ' (' in name:
                    name = name.split(' (', 1)[0]
                target = current_path / name
                if target.is_dir():
                    # Ouvrir le dossier avec l'appli par dÃ©faut
                    safe_open(target)
                    return
                # Si .rapp, lancer
                if target.suffix.lower() == '.rapp':
                    safe_open(target)
                    return
                # Sinon ouvrir normalement
                safe_open(target)
            except Exception as e:
                QtWidgets.QMessageBox.critical(d, "Erreur", f"Ouverture impossible:\n{e}")

        file_list.itemDoubleClicked.connect(on_item_double_click)

        # Appliquer l'effet 'Verre Ultra'
        def apply_ultra_glass(enabled: bool):
            widgets = [d, nav_card, files_card, actions_card]
            for w in widgets:
                try:
                    if enabled:
                        # IntensitÃ© rÃ©cupÃ©rÃ©e depuis l'Ã©tat (persistÃ©e)
                        st = _read_state_safe()
                        radius = float(st.get("ultra_glass_radius", 28.0))
                        effect = QtWidgets.QGraphicsBlurEffect(w)
                        effect.setBlurRadius(max(0.0, min(64.0, radius)))
                        w.setGraphicsEffect(effect)
                    else:
                        w.setGraphicsEffect(None)
                except Exception:
                    pass

        glass_toggle.toggled.connect(apply_ultra_glass)
        # Charger Ã©tat initial
        try:
            st = _read_state_safe()
            glass_toggle.setChecked(bool(st.get("ultra_glass_enabled", False)))
        except Exception:
            pass

        d.show()
        fade_in(d, 600)
    
    def format_file_size(self, size_bytes):
        """Formate la taille des fichiers de maniÃ¨re lisible"""
        if size_bytes == 0:
            return "0 B"
        size_names = ["B", "KB", "MB", "GB", "TB"]
        i = 0
        while size_bytes >= 1024 and i < len(size_names) - 1:
            size_bytes /= 1024
            i += 1
        return f"{size_bytes:.1f} {size_names[i]}"

    def show_store(self):
        """Store d'applications Ragnar OS"""
        store_data = ensure_store()
        
        d = GlassDialog("ðŸ›ï¸ Ragnar Store", (700, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Ragnar Store", "Applications et outils pour votre OS")
        lay.addWidget(header)
        
        # Liste des applications
        scroll = QtWidgets.QScrollArea()
        scroll.setWidgetResizable(True)
        scroll.setObjectName("GlassCard")
        
        content_widget = QtWidgets.QWidget()
        content_layout = QtWidgets.QVBoxLayout(content_widget)
        
        # Applications disponibles
        apps = [
            {"name": "Ragnar Paint", "desc": "Ã‰diteur de dessin avancÃ©", "icon": "ðŸŽ¨", "installed": False},
            {"name": "Ragnar Notes", "desc": "Prise de notes rapide", "icon": "ðŸ“", "installed": False},
            {"name": "Ragnar Terminal", "desc": "Terminal systÃ¨me", "icon": "ðŸ’»", "installed": False},
            {"name": "Ragnar Calculator", "desc": "Calculatrice scientifique", "icon": "ðŸ§®", "installed": False},
            {"name": "Ragnar Music", "desc": "Lecteur audio", "icon": "ðŸŽµ", "installed": False},
            {"name": "Ragnar Code", "desc": "Ã‰diteur de code", "icon": "ðŸ‘¨â€ðŸ’»", "installed": False},
        ]
        
        for app in apps:
            app_widget = QtWidgets.QWidget(objectName="GlassCard")
            app_layout = QtWidgets.QHBoxLayout(app_widget)
            app_layout.setContentsMargins(12, 8, 12, 8)
            
            # IcÃ´ne et infos
            icon_label = QtWidgets.QLabel(app["icon"])
            icon_label.setStyleSheet("font-size: 24px;")
            
            info_layout = QtWidgets.QVBoxLayout()
            name_label = QtWidgets.QLabel(app["name"])
            name_label.setStyleSheet("font-weight: bold; font-size: 14px;")
            desc_label = QtWidgets.QLabel(app["desc"])
            desc_label.setStyleSheet("color: rgba(255,255,255,0.7); font-size: 11px;")
            
            info_layout.addWidget(name_label)
            info_layout.addWidget(desc_label)
            
            # Bouton d'installation
            install_btn = QtWidgets.QPushButton("âœ… InstallÃ©" if app["installed"] else "ðŸ“¥ Installer")
            install_btn.setEnabled(not app["installed"])
            install_btn.clicked.connect(lambda checked, a=app: self.install_app(a, d))
            
            app_layout.addWidget(icon_label)
            app_layout.addLayout(info_layout)
            app_layout.addStretch()
            app_layout.addWidget(install_btn)
            
            content_layout.addWidget(app_widget)
        
        scroll.setWidget(content_widget)
        lay.addWidget(scroll)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def install_app(self, app, dialog):
        """Simule l'installation d'une application"""
        reply = QtWidgets.QMessageBox.question(
            self, "Installation",
            f"Voulez-vous installer {app['name']} ?\n\n{app['desc']}",
            QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
        )
        
        if reply == QtWidgets.QMessageBox.StandardButton.Yes:
            # Simulation d'installation
            progress = QtWidgets.QProgressDialog(f"Installation de {app['name']}...", "Annuler", 0, 100, self)
            progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
            progress.show()
            
            for i in range(101):
                progress.setValue(i)
                QtWidgets.QApplication.processEvents()
                time.sleep(0.01)
                if progress.wasCanceled():
                    return
            
            QtWidgets.QMessageBox.information(
                self, "Installation terminÃ©e",
                f"{app['name']} a Ã©tÃ© installÃ© avec succÃ¨s ! ðŸŽ‰"
            )
            dialog.close()
            self.show_store()  # RafraÃ®chir le store



    def show_browser(self):
        """Navigateur web Ragnar intÃ©grÃ©"""
        try:
            # Essayer d'importer QtWebEngineWidgets pour un vrai navigateur
            from PyQt6.QtWebEngineWidgets import QWebEngineView
            self._show_real_browser()
        except ImportError:
            # Fallback si QtWebEngineWidgets n'est pas disponible
            self._show_simple_browser()

    def _show_real_browser(self):
        """Navigateur web complet avec QtWebEngine"""
        from PyQt6.QtWebEngineWidgets import QWebEngineView
        from PyQt6.QtCore import QUrl
        
        d = GlassDialog("ðŸŒ Navigateur Ragnar", (1200, 800), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Navigateur Web", "Navigation complÃ¨te avec moteur Chromium")
        lay.addWidget(header)
        
        # Barre de navigation
        nav_layout = QtWidgets.QHBoxLayout()
        
        # Boutons de navigation
        back_btn = QtWidgets.QPushButton("â¬…ï¸")
        forward_btn = QtWidgets.QPushButton("âž¡ï¸")
        refresh_btn = QtWidgets.QPushButton("ðŸ”„")
        home_btn = QtWidgets.QPushButton("ðŸ ")
        
        back_btn.setMaximumWidth(40)
        forward_btn.setMaximumWidth(40)
        refresh_btn.setMaximumWidth(40)
        home_btn.setMaximumWidth(40)
        
        # Barre d'adresse
        self.address_bar = QtWidgets.QLineEdit()
        self.address_bar.setPlaceholderText("Entrez une URL ou recherchez...")
        self.address_bar.setText("https://www.google.com")
        
        # Bouton Go
        go_btn = QtWidgets.QPushButton("ðŸ” Aller")
        
        nav_layout.addWidget(back_btn)
        nav_layout.addWidget(forward_btn)
        nav_layout.addWidget(refresh_btn)
        nav_layout.addWidget(home_btn)
        nav_layout.addWidget(self.address_bar)
        nav_layout.addWidget(go_btn)
        
        # Widget de navigation dans un conteneur
        nav_widget = QtWidgets.QWidget(objectName="GlassCard")
        nav_widget.setLayout(nav_layout)
        lay.addWidget(nav_widget)
        
        # Vue web
        self.web_view = QWebEngineView()
        self.web_view.setUrl(QUrl("https://www.google.com"))
        lay.addWidget(self.web_view)
        
        # Barre de statut
        self.status_bar = QtWidgets.QLabel("PrÃªt")
        self.status_bar.setStyleSheet("padding: 4px; color: rgba(255,255,255,0.7);")
        lay.addWidget(self.status_bar)
        
        # Connexions des boutons
        back_btn.clicked.connect(self.web_view.back)
        forward_btn.clicked.connect(self.web_view.forward)
        refresh_btn.clicked.connect(self.web_view.reload)
        home_btn.clicked.connect(lambda: self.navigate_to("https://www.google.com"))
        go_btn.clicked.connect(self.navigate_from_address_bar)
        self.address_bar.returnPressed.connect(self.navigate_from_address_bar)
        
        # Connexions des signaux web
        self.web_view.urlChanged.connect(self.update_address_bar)
        self.web_view.loadStarted.connect(lambda: self.status_bar.setText("Chargement..."))
        self.web_view.loadFinished.connect(lambda: self.status_bar.setText("TerminÃ©"))
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def _show_simple_browser(self):
        """Navigateur simple sans QtWebEngine"""
        d = GlassDialog("ðŸŒ Navigateur Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Navigateur Web", "Navigation simplifiÃ©e")
        lay.addWidget(header)
        
        # Message d'information
        info_widget = QtWidgets.QWidget(objectName="GlassCard")
        info_layout = QtWidgets.QVBoxLayout(info_widget)
        info_layout.setContentsMargins(16, 16, 16, 16)
        
        info_text = QtWidgets.QLabel("""
ðŸŒ <b>Navigateur Ragnar - Mode SimplifiÃ©</b><br><br>
Pour une expÃ©rience de navigation complÃ¨te, installez QtWebEngineWidgets :<br>
<code>pip install PyQtWebEngine</code><br><br>
En attendant, vous pouvez :
        """)
        info_text.setWordWrap(True)
        info_layout.addWidget(info_text)
        lay.addWidget(info_widget)
        
        # Raccourcis vers sites populaires
        sites_widget = QtWidgets.QWidget(objectName="GlassCard")
        sites_layout = QtWidgets.QVBoxLayout(sites_widget)
        sites_layout.setContentsMargins(16, 16, 16, 16)
        
        sites_title = QtWidgets.QLabel("<b>ðŸ”— Sites Populaires</b>")
        sites_layout.addWidget(sites_title)
        
        # Grille de boutons pour sites
        sites_grid = QtWidgets.QGridLayout()
        
        popular_sites = [
            ("ðŸ” Google", "https://www.google.com"),
            ("ðŸ“º YouTube", "https://www.youtube.com"),
            ("ðŸ“˜ Facebook", "https://www.facebook.com"),
            ("ðŸ¦ Twitter", "https://www.twitter.com"),
            ("ðŸ’¼ LinkedIn", "https://www.linkedin.com"),
            ("ðŸ“° BBC News", "https://www.bbc.com/news"),
            ("ðŸ›’ Amazon", "https://www.amazon.com"),
            ("ðŸ“§ Gmail", "https://mail.google.com"),
        ]
        
        for i, (name, url) in enumerate(popular_sites):
            btn = QtWidgets.QPushButton(name)
            btn.clicked.connect(lambda checked, u=url: webbrowser.open(u))
            sites_grid.addWidget(btn, i // 2, i % 2)
        
        sites_layout.addLayout(sites_grid)
        lay.addWidget(sites_widget)
        
        # Barre d'adresse personnalisÃ©e
        url_widget = QtWidgets.QWidget(objectName="GlassCard")
        url_layout = QtWidgets.QHBoxLayout(url_widget)
        url_layout.setContentsMargins(12, 12, 12, 12)
        
        url_label = QtWidgets.QLabel("ðŸŒ URL :")
        self.simple_url_input = QtWidgets.QLineEdit()
        self.simple_url_input.setPlaceholderText("https://example.com")
        open_btn = QtWidgets.QPushButton("ðŸš€ Ouvrir")
        
        open_btn.clicked.connect(self.open_external_url)
        self.simple_url_input.returnPressed.connect(self.open_external_url)
        
        url_layout.addWidget(url_label)
        url_layout.addWidget(self.simple_url_input)
        url_layout.addWidget(open_btn)
        lay.addWidget(url_widget)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def navigate_to(self, url):
        """Navigue vers une URL"""
        if hasattr(self, 'web_view'):
            from PyQt6.QtCore import QUrl
            if not url.startswith(('http://', 'https://')):
                url = 'https://' + url
            self.web_view.setUrl(QUrl(url))
    
    def navigate_from_address_bar(self):
        """Navigue vers l'URL dans la barre d'adresse"""
        url = self.address_bar.text().strip()
        if url:
            # Si ce n'est pas une URL complÃ¨te, faire une recherche Google
            if not url.startswith(('http://', 'https://')) and '.' not in url:
                url = f"https://www.google.com/search?q={url}"
            self.navigate_to(url)
    
    def update_address_bar(self, url):
        """Met Ã  jour la barre d'adresse"""
        if hasattr(self, 'address_bar'):
            self.address_bar.setText(url.toString())
    
    def open_external_url(self):
        """Ouvre une URL dans le navigateur externe"""
        url = self.simple_url_input.text().strip()
        if url:
            if not url.startswith(('http://', 'https://')):
                url = 'https://' + url
            try:
                webbrowser.open(url)
                QtWidgets.QMessageBox.information(
                    self, "Ouvert", 
                    f"URL ouverte dans le navigateur par dÃ©faut :\n{url}"
                )
            except Exception as e:
                QtWidgets.QMessageBox.critical(
                    self, "Erreur", 
                    f"Impossible d'ouvrir l'URL :\n{e}"
                )



    def show_chat(self):
        """Application de chat Ragnar"""
        d = GlassDialog("ðŸ’¬ Ragnar Chat", (600, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Ragnar Chat", "Assistant IA intÃ©grÃ©")
        lay.addWidget(header)
        
        # Zone de chat
        self.chat_display = QtWidgets.QTextEdit()
        self.chat_display.setReadOnly(True)
        self.chat_display.setObjectName("GlassCard")
        self.chat_display.append("ðŸ¤– <b>RagnarAI:</b> Salut ! Je suis ton assistant IA. Comment puis-je t'aider ?")
        lay.addWidget(self.chat_display)
        
        # Zone de saisie
        input_layout = QtWidgets.QHBoxLayout()
        self.chat_input = QtWidgets.QLineEdit()
        self.chat_input.setPlaceholderText("Tapez votre message ici...")
        self.chat_input.returnPressed.connect(lambda: self.send_message(d))
        
        send_btn = QtWidgets.QPushButton("ðŸ“¤ Envoyer")
        send_btn.clicked.connect(lambda: self.send_message(d))
        
        input_layout.addWidget(self.chat_input)
        input_layout.addWidget(send_btn)
        lay.addLayout(input_layout)
        
        # Boutons d'action
        btn_layout = QtWidgets.QHBoxLayout()
        clear_btn = QtWidgets.QPushButton("ðŸ—‘ï¸ Effacer")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        clear_btn.clicked.connect(lambda: self.clear_chat(d))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(clear_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
        self.chat_input.setFocus()
    
    def send_message(self, dialog):
        """Envoie un message dans le chat"""
        message = self.chat_input.text().strip()
        if not message:
            return
        
        # Afficher le message utilisateur
        self.chat_display.append(f"ðŸ‘¤ <b>Vous:</b> {message}")
        self.chat_input.clear()
        
        # RÃ©ponse automatique de l'IA
        responses = [
            "C'est une excellente question ! ðŸ¤”",
            "Je vois ce que tu veux dire. Ragnar OS est vraiment gÃ©nial ! ðŸš€",
            "IntÃ©ressant ! As-tu essayÃ© les nouvelles fonctionnalitÃ©s ? âœ¨",
            "Ragnar OS 26.3.3 - L'Ã©cosystÃ¨me complet est arrivÃ© ! ðŸŽ†",
            "Tu peux crÃ©er des fichiers avec le clic droit maintenant ! ðŸ“",
            "Le systÃ¨me de mise Ã  jour est super pratique ! â¬‡ï¸",
            "N'hÃ©site pas si tu as d'autres questions ! ðŸ˜Š",
            "Ragnar OS devient de plus en plus puissant ! ðŸ’ª",
        ]
        
        import random
        response = random.choice(responses)
        
        # DÃ©lai pour simuler la rÃ©flexion
        QtCore.QTimer.singleShot(1000, lambda: self.chat_display.append(f"ðŸ¤– <b>RagnarAI:</b> {response}"))
        
        # Scroll vers le bas
        QtCore.QTimer.singleShot(1100, lambda: self.chat_display.verticalScrollBar().setValue(
            self.chat_display.verticalScrollBar().maximum()
        ))
    
    def clear_chat(self, dialog):
        """Efface l'historique du chat"""
        self.chat_display.clear()
        self.chat_display.append("ðŸ¤– <b>RagnarAI:</b> Chat effacÃ© ! Comment puis-je t'aider ?")
        self.chat_input.setFocus()

    def show_ragnar_link(self):
        """Ragnar Link - RÃ©seau social ultra-sÃ©curisÃ©"""
        try:
            d = GlassDialog("ðŸ”— Ragnar Link - RÃ©seau Social", (900, 700), self)
            lay = QtWidgets.QVBoxLayout(d)
            
            # Header avec statut de connexion
            header_widget = QtWidgets.QWidget(objectName="GlassCard")
            header_layout = QtWidgets.QVBoxLayout(header_widget)
            header_layout.setContentsMargins(16, 16, 16, 16)
            
            title_layout = QtWidgets.QHBoxLayout()
            title = QtWidgets.QLabel("ðŸ”— <b>Ragnar Link</b> - RÃ©seau Social Ultra-SÃ©curisÃ©")
            title.setStyleSheet("font-size: 18px; font-weight: bold;")
            
            # Statut de connexion
            self.connection_status = QtWidgets.QLabel("ðŸŸ¢ ConnectÃ© - SÃ©curisÃ©")
            self.connection_status.setStyleSheet("color: #00ff88; font-weight: bold;")
            
            title_layout.addWidget(title)
            title_layout.addStretch()
            title_layout.addWidget(self.connection_status)
            header_layout.addLayout(title_layout)
            
            # Infos utilisateur
            user_info = QtWidgets.QLabel(f"ðŸ‘¤ Utilisateur: RagnarUser_{random.randint(1000,9999)} | ðŸ” Chiffrement: AES-256 | ðŸ“¡ Serveur: SÃ©curisÃ©")
            user_info.setStyleSheet("color: rgba(255,255,255,0.8); font-size: 11px;")
            header_layout.addWidget(user_info)
            
            lay.addWidget(header_widget)
            
            # Interface principale avec onglets
            tabs = QtWidgets.QTabWidget()
            tabs.setObjectName("GlassCard")
            
            # Onglet Chat Global
            chat_tab = self.create_chat_tab()
            tabs.addTab(chat_tab, "ðŸ’¬ Chat Global")
            
            # Onglet Messages PrivÃ©s
            private_tab = self.create_private_messages_tab()
            tabs.addTab(private_tab, "ðŸ“§ Messages PrivÃ©s")
            
            # Onglet Partage Photos
            photos_tab = self.create_photos_tab()
            tabs.addTab(photos_tab, "ðŸ“¸ Photos")
            
            # Onglet Contacts
            contacts_tab = self.create_contacts_tab()
            tabs.addTab(contacts_tab, "ðŸ‘¥ Contacts")
            
            lay.addWidget(tabs)
            
            # Barre de statut sÃ©curitÃ©
            security_bar = QtWidgets.QWidget(objectName="GlassCard")
            security_layout = QtWidgets.QHBoxLayout(security_bar)
            security_layout.setContentsMargins(12, 8, 12, 8)
            
            security_info = QtWidgets.QLabel("ðŸ›¡ï¸ Connexion chiffrÃ©e | ðŸ”’ Messages sÃ©curisÃ©s | ðŸš« Aucune donnÃ©e stockÃ©e")
            security_info.setStyleSheet("color: #00ff88; font-size: 10px;")
            
            close_btn = QtWidgets.QPushButton("âŒ DÃ©connexion")
            close_btn.clicked.connect(d.close)
            
            security_layout.addWidget(security_info)
            security_layout.addStretch()
            security_layout.addWidget(close_btn)
            
            lay.addWidget(security_bar)
            
            d.show()
            
            # Animations d'entrÃ©e amÃ©liorÃ©es
            fade_in(d, 800)
            bounce_in(d, 1000)
            
        except Exception as e:
            # Afficher l'erreur pour diagnostic
            QtWidgets.QMessageBox.critical(
                self, "ðŸš¨ Erreur Ragnar Link",
                f"Une erreur est survenue lors du lancement de Ragnar Link :\n\n"
                f"Erreur : {str(e)}\n\n"
                f"Version : {DEFAULT_LOCAL_VERSION}\n"
                f"Veuillez signaler ce problÃ¨me."
            )
            print(f"Erreur Ragnar Link: {e}")
            import traceback
            traceback.print_exc()
    
    def create_chat_tab(self):
        """CrÃ©e l'onglet de chat global"""
        widget = QtWidgets.QWidget()
        layout = QtWidgets.QVBoxLayout(widget)
        
        # Zone d'affichage des messages
        self.global_chat = QtWidgets.QTextEdit()
        self.global_chat.setReadOnly(True)
        self.global_chat.setObjectName("GlassCard")
        
        # Messages d'exemple
        self.global_chat.setHtml("""
        <div style='color: #00ff88; font-weight: bold;'>ðŸ”— Ragnar Link - Chat Global SÃ©curisÃ©</div><br>
        <div style='color: #88ccff;'><b>ðŸ¤– SystÃ¨me:</b> Bienvenue dans Ragnar Link ! Tous les messages sont chiffrÃ©s.</div><br>
        <div style='color: #ffaa88;'><b>ðŸ‘¤ RagnarUser_1337:</b> Salut tout le monde ! ðŸ‘‹</div><br>
        <div style='color: #ff88cc;'><b>ðŸ‘¤ RagnarUser_2024:</b> Cette nouvelle version est incroyable ! ðŸš€</div><br>
        <div style='color: #88ffaa;'><b>ðŸ‘¤ RagnarUser_9999:</b> J'adore le systÃ¨me de sÃ©curitÃ© ! ðŸ›¡ï¸</div><br>
        <div style='color: #ccaa88;'><b>ðŸ‘¤ RagnarUser_4567:</b> Quelqu'un a testÃ© le partage de photos ? ðŸ“¸</div><br>
        """)
        
        layout.addWidget(self.global_chat)
        
        # Zone de saisie avec options
        input_frame = QtWidgets.QWidget(objectName="GlassCard")
        input_layout = QtWidgets.QVBoxLayout(input_frame)
        input_layout.setContentsMargins(12, 12, 12, 12)
        
        # Barre d'outils
        toolbar = QtWidgets.QHBoxLayout()
        emoji_btn = QtWidgets.QPushButton("ðŸ˜Š")
        photo_btn = QtWidgets.QPushButton("ðŸ“¸")
        secure_btn = QtWidgets.QPushButton("ðŸ”")
        
        emoji_btn.setMaximumWidth(40)
        photo_btn.setMaximumWidth(40)
        secure_btn.setMaximumWidth(40)
        
        emoji_btn.clicked.connect(self.add_emoji_to_message)
        photo_btn.clicked.connect(self.send_photo_to_chat)
        secure_btn.clicked.connect(self.toggle_secure_mode)
        
        toolbar.addWidget(emoji_btn)
        toolbar.addWidget(photo_btn)
        toolbar.addWidget(secure_btn)
        toolbar.addStretch()
        
        input_layout.addLayout(toolbar)
        
        # Ligne de saisie
        message_layout = QtWidgets.QHBoxLayout()
        self.global_message_input = QtWidgets.QLineEdit()
        self.global_message_input.setPlaceholderText("ðŸ’¬ Tapez votre message sÃ©curisÃ©...")
        self.global_message_input.returnPressed.connect(self.send_global_message)
        
        send_btn = QtWidgets.QPushButton("ðŸ“¤ Envoyer")
        send_btn.clicked.connect(self.send_global_message)
        
        message_layout.addWidget(self.global_message_input)
        message_layout.addWidget(send_btn)
        input_layout.addLayout(message_layout)
        
        layout.addWidget(input_frame)
        
        return widget
    
    def create_private_messages_tab(self):
        """CrÃ©e l'onglet des messages privÃ©s"""
        widget = QtWidgets.QWidget()
        layout = QtWidgets.QHBoxLayout(widget)
        
        # Liste des conversations
        conversations_frame = QtWidgets.QWidget(objectName="GlassCard")
        conversations_layout = QtWidgets.QVBoxLayout(conversations_frame)
        conversations_layout.setContentsMargins(12, 12, 12, 12)
        
        conv_title = QtWidgets.QLabel("ðŸ’¬ <b>Conversations</b>")
        conversations_layout.addWidget(conv_title)
        
        self.conversations_list = QtWidgets.QListWidget()
        self.conversations_list.setObjectName("GlassCard")
        
        # Conversations d'exemple
        conversations = [
            "ðŸŸ¢ RagnarUser_1337 - En ligne",
            "ðŸŸ¡ RagnarUser_2024 - Il y a 5 min",
            "ðŸ”´ RagnarUser_9999 - Hors ligne",
            "ðŸŸ¢ RagnarUser_4567 - En ligne"
        ]
        
        for conv in conversations:
            self.conversations_list.addItem(conv)
        
        conversations_layout.addWidget(self.conversations_list)
        
        # Bouton nouvelle conversation
        new_conv_btn = QtWidgets.QPushButton("âž• Nouvelle conversation")
        new_conv_btn.clicked.connect(self.start_new_conversation)
        conversations_layout.addWidget(new_conv_btn)
        
        layout.addWidget(conversations_frame)
        
        # Zone de chat privÃ©
        private_chat_frame = QtWidgets.QWidget(objectName="GlassCard")
        private_chat_layout = QtWidgets.QVBoxLayout(private_chat_frame)
        private_chat_layout.setContentsMargins(12, 12, 12, 12)
        
        chat_header = QtWidgets.QLabel("ðŸ” <b>Chat PrivÃ© ChiffrÃ©</b> avec RagnarUser_1337")
        private_chat_layout.addWidget(chat_header)
        
        self.private_chat = QtWidgets.QTextEdit()
        self.private_chat.setReadOnly(True)
        self.private_chat.setObjectName("GlassCard")
        self.private_chat.setHtml("""
        <div style='color: #88ccff;'><b>ðŸ” SystÃ¨me:</b> Conversation chiffrÃ©e de bout en bout activÃ©e</div><br>
        <div style='color: #ffaa88;'><b>ðŸ‘¤ RagnarUser_1337:</b> Salut ! Comment tu trouves Ragnar Link ?</div><br>
        <div style='color: #00ff88;'><b>ðŸ‘¤ Vous:</b> C'est incroyable ! La sÃ©curitÃ© est parfaite ðŸ›¡ï¸</div><br>
        <div style='color: #ffaa88;'><b>ðŸ‘¤ RagnarUser_1337:</b> Oui ! Et le partage de photos est gÃ©nial ðŸ“¸</div><br>
        """)
        
        private_chat_layout.addWidget(self.private_chat)
        
        # Zone de saisie privÃ©e
        private_input_layout = QtWidgets.QHBoxLayout()
        self.private_message_input = QtWidgets.QLineEdit()
        self.private_message_input.setPlaceholderText("ðŸ” Message privÃ© chiffrÃ©...")
        self.private_message_input.returnPressed.connect(self.send_private_message)
        
        private_send_btn = QtWidgets.QPushButton("ðŸ”’ Envoyer")
        private_send_btn.clicked.connect(self.send_private_message)
        
        private_input_layout.addWidget(self.private_message_input)
        private_input_layout.addWidget(private_send_btn)
        private_chat_layout.addLayout(private_input_layout)
        
        layout.addWidget(private_chat_frame)
        
        return widget
    
    def create_photos_tab(self):
        """CrÃ©e l'onglet de partage de photos"""
        widget = QtWidgets.QWidget()
        layout = QtWidgets.QVBoxLayout(widget)
        
        # Header
        header = QtWidgets.QLabel("ðŸ“¸ <b>Partage de Photos SÃ©curisÃ©</b>")
        header.setStyleSheet("font-size: 16px; font-weight: bold; padding: 10px;")
        layout.addWidget(header)
        
        # Zone de galerie
        gallery_frame = QtWidgets.QWidget(objectName="GlassCard")
        gallery_layout = QtWidgets.QVBoxLayout(gallery_frame)
        gallery_layout.setContentsMargins(16, 16, 16, 16)
        
        gallery_title = QtWidgets.QLabel("ðŸ–¼ï¸ <b>Galerie PartagÃ©e</b>")
        gallery_layout.addWidget(gallery_title)
        
        # Grille de photos simulÃ©es
        photos_grid = QtWidgets.QGridLayout()
        
        photo_examples = [
            "ðŸŒ… Coucher de soleil",
            "ðŸ”ï¸ Montagne",
            "ðŸŒŠ OcÃ©an",
            "ðŸŒ¸ Fleurs",
            "ðŸ™ï¸ Ville",
            "ðŸŒŸ Ã‰toiles"
        ]
        
        for i, photo in enumerate(photo_examples):
            photo_btn = QtWidgets.QPushButton(photo)
            photo_btn.setMinimumHeight(80)
            photo_btn.setStyleSheet("font-size: 24px;")
            photo_btn.clicked.connect(lambda checked, p=photo: self.view_photo(p))
            photos_grid.addWidget(photo_btn, i // 3, i % 3)
        
        gallery_layout.addLayout(photos_grid)
        layout.addWidget(gallery_frame)
        
        # Zone d'upload
        upload_frame = QtWidgets.QWidget(objectName="GlassCard")
        upload_layout = QtWidgets.QVBoxLayout(upload_frame)
        upload_layout.setContentsMargins(16, 16, 16, 16)
        
        upload_title = QtWidgets.QLabel("ðŸ“¤ <b>Partager une Photo</b>")
        upload_layout.addWidget(upload_title)
        
        upload_buttons = QtWidgets.QHBoxLayout()
        select_photo_btn = QtWidgets.QPushButton("ðŸ“ SÃ©lectionner Photo")
        take_photo_btn = QtWidgets.QPushButton("ðŸ“· Prendre Photo")
        upload_btn = QtWidgets.QPushButton("ðŸ” Partager (ChiffrÃ©)")
        
        select_photo_btn.clicked.connect(self.select_photo_to_share)
        take_photo_btn.clicked.connect(self.take_photo)
        upload_btn.clicked.connect(self.upload_photo_secure)
        
        upload_buttons.addWidget(select_photo_btn)
        upload_buttons.addWidget(take_photo_btn)
        upload_buttons.addWidget(upload_btn)
        
        upload_layout.addLayout(upload_buttons)
        
        # Info sÃ©curitÃ©
        security_info = QtWidgets.QLabel("ðŸ›¡ï¸ Toutes les photos sont chiffrÃ©es avant envoi | ðŸ—‘ï¸ Auto-suppression aprÃ¨s 24h")
        security_info.setStyleSheet("color: #00ff88; font-size: 10px; padding: 5px;")
        upload_layout.addWidget(security_info)
        
        layout.addWidget(upload_frame)
        
        return widget
    
    def create_contacts_tab(self):
        """CrÃ©e l'onglet des contacts"""
        widget = QtWidgets.QWidget()
        layout = QtWidgets.QVBoxLayout(widget)
        
        # Header
        header = QtWidgets.QLabel("ðŸ‘¥ <b>Contacts Ragnar Link</b>")
        header.setStyleSheet("font-size: 16px; font-weight: bold; padding: 10px;")
        layout.addWidget(header)
        
        # Liste des contacts
        contacts_frame = QtWidgets.QWidget(objectName="GlassCard")
        contacts_layout = QtWidgets.QVBoxLayout(contacts_frame)
        contacts_layout.setContentsMargins(16, 16, 16, 16)
        
        # Barre de recherche
        search_layout = QtWidgets.QHBoxLayout()
        search_input = QtWidgets.QLineEdit()
        search_input.setPlaceholderText("ðŸ” Rechercher un contact...")
        search_btn = QtWidgets.QPushButton("ðŸ”")
        search_btn.setMaximumWidth(40)
        
        search_layout.addWidget(search_input)
        search_layout.addWidget(search_btn)
        contacts_layout.addLayout(search_layout)
        
        # Liste des contacts
        self.contacts_list = QtWidgets.QListWidget()
        self.contacts_list.setObjectName("GlassCard")
        
        contacts = [
            "ðŸŸ¢ RagnarUser_1337 - DÃ©veloppeur | ðŸ” VÃ©rifiÃ©",
            "ðŸŸ¡ RagnarUser_2024 - Designer | ðŸ” VÃ©rifiÃ©", 
            "ðŸŸ¢ RagnarUser_9999 - Testeur | ðŸ” VÃ©rifiÃ©",
            "ðŸ”´ RagnarUser_4567 - Community | ðŸ” VÃ©rifiÃ©",
            "ðŸŸ¢ RagnarUser_8888 - ModÃ©rateur | ðŸ” VÃ©rifiÃ©"
        ]
        
        for contact in contacts:
            self.contacts_list.addItem(contact)
        
        contacts_layout.addWidget(self.contacts_list)
        
        # Boutons d'action
        contact_actions = QtWidgets.QHBoxLayout()
        add_contact_btn = QtWidgets.QPushButton("âž• Ajouter Contact")
        block_btn = QtWidgets.QPushButton("ðŸš« Bloquer")
        verify_btn = QtWidgets.QPushButton("âœ… VÃ©rifier")
        
        add_contact_btn.clicked.connect(self.add_new_contact)
        block_btn.clicked.connect(self.block_contact)
        verify_btn.clicked.connect(self.verify_contact)
        
        contact_actions.addWidget(add_contact_btn)
        contact_actions.addWidget(block_btn)
        contact_actions.addWidget(verify_btn)
        
        contacts_layout.addLayout(contact_actions)
        layout.addWidget(contacts_frame)
        
        return widget
    
    # MÃ©thodes pour les fonctionnalitÃ©s de Ragnar Link
    
    def send_global_message(self):
        """Envoie un message dans le chat global"""
        message = self.global_message_input.text().strip()
        if not message:
            return
        
        # Simuler l'envoi sÃ©curisÃ©
        user_id = f"RagnarUser_{random.randint(1000,9999)}"
        timestamp = QtCore.QTime.currentTime().toString("HH:mm")
        
        self.global_chat.append(f"<div style='color: #00ff88;'><b>ðŸ‘¤ Vous [{timestamp}]:</b> {message} ðŸ”</div><br>")
        self.global_message_input.clear()
        
        # RÃ©ponse automatique simulÃ©e
        QtCore.QTimer.singleShot(2000, lambda: self.simulate_global_response(message))
    
    def simulate_global_response(self, original_message):
        """Simule une rÃ©ponse dans le chat global"""
        responses = [
            "IntÃ©ressant ! ðŸ¤”",
            "Je suis d'accord ! ðŸ‘",
            "Ragnar Link est gÃ©nial ! ðŸš€",
            "Super sÃ©curisÃ© ! ðŸ›¡ï¸",
            "J'adore cette fonctionnalitÃ© ! â¤ï¸"
        ]
        
        user_id = f"RagnarUser_{random.randint(1000,9999)}"
        response = random.choice(responses)
        timestamp = QtCore.QTime.currentTime().toString("HH:mm")
        
        self.global_chat.append(f"<div style='color: #ffaa88;'><b>ðŸ‘¤ {user_id} [{timestamp}]:</b> {response}</div><br>")
        
        # Auto-scroll
        self.global_chat.verticalScrollBar().setValue(self.global_chat.verticalScrollBar().maximum())
    
    def send_private_message(self):
        """Envoie un message privÃ©"""
        message = self.private_message_input.text().strip()
        if not message:
            return
        
        timestamp = QtCore.QTime.currentTime().toString("HH:mm")
        self.private_chat.append(f"<div style='color: #00ff88;'><b>ðŸ‘¤ Vous [{timestamp}]:</b> {message} ðŸ”</div><br>")
        self.private_message_input.clear()
        
        # RÃ©ponse automatique
        QtCore.QTimer.singleShot(1500, lambda: self.simulate_private_response())
    
    def simulate_private_response(self):
        """Simule une rÃ©ponse privÃ©e"""
        responses = [
            "Message reÃ§u ! ðŸ“¨",
            "Merci pour le message sÃ©curisÃ© ! ðŸ”",
            "Ragnar Link protÃ¨ge notre conversation ! ðŸ›¡ï¸",
            "C'est vraiment pratique ! âœ¨"
        ]
        
        response = random.choice(responses)
        timestamp = QtCore.QTime.currentTime().toString("HH:mm")
        
        self.private_chat.append(f"<div style='color: #ffaa88;'><b>ðŸ‘¤ RagnarUser_1337 [{timestamp}]:</b> {response}</div><br>")
        self.private_chat.verticalScrollBar().setValue(self.private_chat.verticalScrollBar().maximum())
    
    def add_emoji_to_message(self):
        """Ajoute un emoji au message"""
        emojis = ["ðŸ˜Š", "ðŸš€", "â¤ï¸", "ðŸ”¥", "âœ¨", "ðŸŽ‰", "ðŸ‘", "ðŸ¤”", "ðŸ˜Ž", "ðŸ›¡ï¸"]
        emoji = random.choice(emojis)
        current_text = self.global_message_input.text()
        self.global_message_input.setText(current_text + emoji)
    
    def send_photo_to_chat(self):
        """Simule l'envoi d'une photo dans le chat"""
        photos = ["ðŸŒ…", "ðŸ”ï¸", "ðŸŒŠ", "ðŸŒ¸", "ðŸ™ï¸", "ðŸŒŸ", "ðŸ¦‹", "ðŸŒº"]
        photo = random.choice(photos)
        timestamp = QtCore.QTime.currentTime().toString("HH:mm")
        
        self.global_chat.append(f"<div style='color: #00ff88;'><b>ðŸ‘¤ Vous [{timestamp}]:</b> Photo partagÃ©e {photo} ðŸ“¸ðŸ”</div><br>")
        
        QtWidgets.QMessageBox.information(
            self, "ðŸ“¸ Photo EnvoyÃ©e",
            "Photo envoyÃ©e avec chiffrement de bout en bout ! ðŸ”âœ¨"
        )
    
    def toggle_secure_mode(self):
        """Active/dÃ©sactive le mode ultra-sÃ©curisÃ©"""
        QtWidgets.QMessageBox.information(
            self, "ðŸ” Mode SÃ©curisÃ©",
            "Mode ultra-sÃ©curisÃ© ACTIVÃ‰ !\n\n"
            "ðŸ›¡ï¸ Chiffrement AES-256\n"
            "ðŸ”’ ClÃ©s Ã©phÃ©mÃ¨res\n"
            "ðŸš« Aucun stockage local\n"
            "âš¡ Transmission instantanÃ©e"
        )
    
    def select_photo_to_share(self):
        """SÃ©lectionne une photo Ã  partager"""
        file_path, _ = QtWidgets.QFileDialog.getOpenFileName(
            self, "SÃ©lectionner une photo",
            "", "Images (*.png *.jpg *.jpeg *.gif *.bmp)"
        )
        
        if file_path:
            QtWidgets.QMessageBox.information(
                self, "ðŸ“¸ Photo SÃ©lectionnÃ©e",
                f"Photo sÃ©lectionnÃ©e : {Path(file_path).name}\n\n"
                f"ðŸ” Sera chiffrÃ©e avant envoi\n"
                f"ðŸ“¤ PrÃªte pour le partage sÃ©curisÃ©"
            )
    
    def take_photo(self):
        """Simule la prise de photo"""
        QtWidgets.QMessageBox.information(
            self, "ðŸ“· Photo Prise",
            "Photo prise avec succÃ¨s ! ðŸ“¸\n\n"
            "ðŸ” Chiffrement automatique activÃ©\n"
            "ðŸ“¤ PrÃªte pour le partage"
        )
    
    def upload_photo_secure(self):
        """Upload sÃ©curisÃ© d'une photo"""
        QtWidgets.QMessageBox.information(
            self, "ðŸ” Upload SÃ©curisÃ©",
            "Photo uploadÃ©e avec succÃ¨s ! ðŸŽ‰\n\n"
            "âœ… Chiffrement AES-256 appliquÃ©\n"
            "ðŸ›¡ï¸ Transmission sÃ©curisÃ©e\n"
            "ðŸ—‘ï¸ Auto-suppression dans 24h\n"
            "ðŸ“± Visible par vos contacts"
        )
    
    def view_photo(self, photo_name):
        """Affiche une photo"""
        QtWidgets.QMessageBox.information(
            self, "ðŸ–¼ï¸ Photo",
            f"Affichage de : {photo_name}\n\n"
            f"ðŸ” Photo dÃ©chiffrÃ©e localement\n"
            f"ðŸ‘¤ PartagÃ©e par RagnarUser_{random.randint(1000,9999)}\n"
            f"â° Il y a {random.randint(1,60)} minutes"
        )
    
    def start_new_conversation(self):
        """DÃ©marre une nouvelle conversation"""
        user_id, ok = QtWidgets.QInputDialog.getText(
            self, "ðŸ’¬ Nouvelle Conversation",
            "ID de l'utilisateur Ã  contacter :"
        )
        
        if ok and user_id:
            QtWidgets.QMessageBox.information(
                self, "ðŸ” Conversation CrÃ©Ã©e",
                f"Conversation sÃ©curisÃ©e crÃ©Ã©e avec {user_id} !\n\n"
                f"ðŸ›¡ï¸ Chiffrement de bout en bout activÃ©\n"
                f"ðŸ”‘ ClÃ©s Ã©changÃ©es en sÃ©curitÃ©\n"
                f"ðŸ’¬ PrÃªt pour les messages privÃ©s"
            )
    
    def add_new_contact(self):
        """Ajoute un nouveau contact"""
        user_id, ok = QtWidgets.QInputDialog.getText(
            self, "ðŸ‘¥ Ajouter Contact",
            "ID de l'utilisateur Ã  ajouter :"
        )
        
        if ok and user_id:
            self.contacts_list.addItem(f"ðŸŸ¢ {user_id} - Nouveau | ðŸ” En attente de vÃ©rification")
            QtWidgets.QMessageBox.information(
                self, "âœ… Contact AjoutÃ©",
                f"Contact {user_id} ajoutÃ© avec succÃ¨s !\n\n"
                f"ðŸ” VÃ©rification de sÃ©curitÃ© en cours\n"
                f"ðŸ“± Invitation envoyÃ©e"
            )
    
    def block_contact(self):
        """Bloque un contact"""
        current_item = self.contacts_list.currentItem()
        if current_item:
            QtWidgets.QMessageBox.information(
                self, "ðŸš« Contact BloquÃ©",
                f"Contact bloquÃ© avec succÃ¨s !\n\n"
                f"ðŸ›¡ï¸ Messages bloquÃ©s\n"
                f"ðŸš« AccÃ¨s refusÃ©\n"
                f"ðŸ” SÃ©curitÃ© renforcÃ©e"
            )
    
    def verify_contact(self):
        """VÃ©rifie un contact"""
        current_item = self.contacts_list.currentItem()
        if current_item:
            QtWidgets.QMessageBox.information(
                self, "âœ… Contact VÃ©rifiÃ©",
                f"Contact vÃ©rifiÃ© avec succÃ¨s ! ðŸŽ‰\n\n"
                f"ðŸ” IdentitÃ© confirmÃ©e\n"
                f"ðŸ›¡ï¸ ClÃ©s de sÃ©curitÃ© Ã©changÃ©es\n"
                f"âœ… Communication sÃ©curisÃ©e Ã©tablie"
            )

    # ===== NOUVELLES FONCTIONNALITÃ‰S ULTRA-UTILES =====
    
    def show_network_monitor(self):
        """Moniteur rÃ©seau en temps rÃ©el"""
        d = GlassDialog("ðŸ“Š Moniteur RÃ©seau Ragnar", (700, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Moniteur RÃ©seau", "Surveillance du trafic en temps rÃ©el")
        lay.addWidget(header)
        
        # Informations rÃ©seau
        info_widget = QtWidgets.QWidget(objectName="GlassCard")
        info_layout = QtWidgets.QVBoxLayout(info_widget)
        info_layout.setContentsMargins(16, 16, 16, 16)
        
        try:
            import socket
            hostname = socket.gethostname()
            local_ip = socket.gethostbyname(hostname)
            
            network_info = [
                f"ðŸ–¥ï¸ Nom d'hÃ´te : {hostname}",
                f"ðŸŒ IP Locale : {local_ip}",
                f"ðŸ“¡ Connexions actives : {random.randint(5, 25)}",
                f"â¬‡ï¸ TÃ©lÃ©chargement : {random.randint(10, 100)} MB/s",
                f"â¬†ï¸ Upload : {random.randint(5, 50)} MB/s",
                f"ðŸ“Š Paquets envoyÃ©s : {random.randint(1000, 9999)}",
                f"ðŸ“ˆ Paquets reÃ§us : {random.randint(1000, 9999)}",
            ]
            
            for info in network_info:
                label = QtWidgets.QLabel(info)
                label.setStyleSheet("padding: 6px; font-size: 12px;")
                info_layout.addWidget(label)
                
        except Exception:
            error_label = QtWidgets.QLabel("âŒ Impossible d'obtenir les informations rÃ©seau")
            info_layout.addWidget(error_label)
        
        lay.addWidget(info_widget)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        refresh_btn = QtWidgets.QPushButton("ðŸ”„ Actualiser")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        refresh_btn.clicked.connect(lambda: (d.close(), self.show_network_monitor()))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(refresh_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def show_file_search(self):
        """Recherche de fichiers avancÃ©e"""
        d = GlassDialog("ðŸ” Recherche de Fichiers", (600, 450), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Recherche de Fichiers", "Trouvez vos fichiers rapidement")
        lay.addWidget(header)
        
        # Zone de recherche
        search_widget = QtWidgets.QWidget(objectName="GlassCard")
        search_layout = QtWidgets.QVBoxLayout(search_widget)
        search_layout.setContentsMargins(16, 16, 16, 16)
        
        search_input = QtWidgets.QLineEdit()
        search_input.setPlaceholderText("ðŸ” Nom du fichier Ã  rechercher...")
        
        location_input = QtWidgets.QLineEdit()
        location_input.setPlaceholderText("ðŸ“ Dossier de recherche (optionnel)")
        location_input.setText(str(Path.home()))
        
        search_btn = QtWidgets.QPushButton("ðŸ” Rechercher")
        
        search_layout.addWidget(QtWidgets.QLabel("Nom du fichier :"))
        search_layout.addWidget(search_input)
        search_layout.addWidget(QtWidgets.QLabel("Dossier :"))
        search_layout.addWidget(location_input)
        search_layout.addWidget(search_btn)
        
        lay.addWidget(search_widget)
        
        # RÃ©sultats
        results_widget = QtWidgets.QWidget(objectName="GlassCard")
        results_layout = QtWidgets.QVBoxLayout(results_widget)
        results_layout.setContentsMargins(16, 16, 16, 16)
        
        results_list = QtWidgets.QListWidget()
        results_list.setObjectName("GlassCard")
        
        results_layout.addWidget(QtWidgets.QLabel("ðŸ“‹ RÃ©sultats :"))
        results_layout.addWidget(results_list)
        
        lay.addWidget(results_widget)
        
        def perform_search():
            results_list.clear()
            query = search_input.text().strip()
            if not query:
                return
            
            try:
                search_path = Path(location_input.text() or str(Path.home()))
                found_files = list(search_path.rglob(f"*{query}*"))[:20]  # Limiter Ã  20 rÃ©sultats
                
                for file_path in found_files:
                    results_list.addItem(f"ðŸ“„ {file_path}")
                
                if not found_files:
                    results_list.addItem("âŒ Aucun fichier trouvÃ©")
                    
            except Exception as e:
                results_list.addItem(f"âŒ Erreur : {e}")
        
        search_btn.clicked.connect(perform_search)
        search_input.returnPressed.connect(perform_search)
        
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def show_updater(self):
        """Gestionnaire de mises Ã  jour sÃ©curisÃ© avec interface moderne"""
        d = GlassDialog("â¬‡ï¸ Gestionnaire de Mises Ã  Jour SÃ©curisÃ©", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Gestionnaire de Mises Ã  Jour SÃ©curisÃ©", "GÃ©rez votre historique de mises Ã  jour")
        lay.addWidget(header)
        # Zone de contenu
        content_widget = QtWidgets.QWidget(objectName="GlassCard")
        content_layout = QtWidgets.QVBoxLayout(content_widget)
        content_layout.setContentsMargins(16, 16, 16, 16)
        
        # Contenu actuel
        try:
            from PyQt6.QtGui import QClipboard
            clipboard = QtWidgets.QApplication.clipboard()
            current_text = clipboard.text()
        except:
            current_text = "Contenu du presse-papiers non disponible"
        
        current_label = QtWidgets.QLabel("ðŸ“‹ Contenu actuel :")
        current_text_edit = QtWidgets.QTextEdit()
        current_text_edit.setPlainText(current_text)
        current_text_edit.setMaximumHeight(100)
        
        content_layout.addWidget(current_label)
        content_layout.addWidget(current_text_edit)
        
        # Nouveau contenu
        new_label = QtWidgets.QLabel("âœï¸ Nouveau contenu :")
        new_text_edit = QtWidgets.QTextEdit()
        new_text_edit.setPlaceholderText("Tapez le texte Ã  copier...")
        new_text_edit.setMaximumHeight(100)
        
        content_layout.addWidget(new_label)
        content_layout.addWidget(new_text_edit)
        
        lay.addWidget(content_widget)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        copy_btn = QtWidgets.QPushButton("ðŸ“‹ Copier")
        clear_btn = QtWidgets.QPushButton("ðŸ—‘ï¸ Effacer")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        def copy_text():
            try:
                clipboard = QtWidgets.QApplication.clipboard()
                clipboard.setText(new_text_edit.toPlainText())
                QtWidgets.QMessageBox.information(d, "âœ… CopiÃ©", "Texte copiÃ© dans le presse-papiers !")
            except Exception as e:
                QtWidgets.QMessageBox.critical(d, "âŒ Erreur", f"Impossible de copier : {e}")
        
        def clear_clipboard():
            try:
                clipboard = QtWidgets.QApplication.clipboard()
                clipboard.clear()
                current_text_edit.clear()
                QtWidgets.QMessageBox.information(d, "âœ… EffacÃ©", "Presse-papiers effacÃ© !")
            except Exception as e:
                QtWidgets.QMessageBox.critical(d, "âŒ Erreur", f"Impossible d'effacer : {e}")
        
        copy_btn.clicked.connect(copy_text)
        clear_btn.clicked.connect(clear_clipboard)
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(copy_btn)
        btn_layout.addWidget(clear_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def show_password_generator(self):
        """GÃ©nÃ©rateur de mots de passe sÃ©curisÃ©s"""
        d = GlassDialog("ðŸ” GÃ©nÃ©rateur de Mots de Passe", (500, 400), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("GÃ©nÃ©rateur de Mots de Passe", "CrÃ©ez des mots de passe sÃ©curisÃ©s")
        lay.addWidget(header)
        
        # Options
        options_widget = QtWidgets.QWidget(objectName="GlassCard")
        options_layout = QtWidgets.QVBoxLayout(options_widget)
        options_layout.setContentsMargins(16, 16, 16, 16)
        
        # Longueur
        length_layout = QtWidgets.QHBoxLayout()
        length_layout.addWidget(QtWidgets.QLabel("Longueur :"))
        length_spin = QtWidgets.QSpinBox()
        length_spin.setRange(4, 128)
        length_spin.setValue(16)
        length_layout.addWidget(length_spin)
        length_layout.addStretch()
        
        # Options
        uppercase_cb = QtWidgets.QCheckBox("Majuscules (A-Z)")
        uppercase_cb.setChecked(True)
        lowercase_cb = QtWidgets.QCheckBox("Minuscules (a-z)")
        lowercase_cb.setChecked(True)
        numbers_cb = QtWidgets.QCheckBox("Chiffres (0-9)")
        numbers_cb.setChecked(True)
        symbols_cb = QtWidgets.QCheckBox("Symboles (!@#$%)")
        symbols_cb.setChecked(True)
        
        options_layout.addLayout(length_layout)
        options_layout.addWidget(uppercase_cb)
        options_layout.addWidget(lowercase_cb)
        options_layout.addWidget(numbers_cb)
        options_layout.addWidget(symbols_cb)
        
        lay.addWidget(options_widget)
        
        # RÃ©sultat
        result_widget = QtWidgets.QWidget(objectName="GlassCard")
        result_layout = QtWidgets.QVBoxLayout(result_widget)
        result_layout.setContentsMargins(16, 16, 16, 16)
        
        result_label = QtWidgets.QLabel("ðŸ” Mot de passe gÃ©nÃ©rÃ© :")
        password_text = QtWidgets.QLineEdit()
        password_text.setReadOnly(True)
        password_text.setStyleSheet("font-family: monospace; font-size: 14px;")
        
        result_layout.addWidget(result_label)
        result_layout.addWidget(password_text)
        
        lay.addWidget(result_widget)
        
        def generate_password():
            chars = ""
            if uppercase_cb.isChecked():
                chars += "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
            if lowercase_cb.isChecked():
                chars += "abcdefghijklmnopqrstuvwxyz"
            if numbers_cb.isChecked():
                chars += "0123456789"
            if symbols_cb.isChecked():
                chars += "!@#$%^&*()_+-=[]{}|;:,.<>?"
            
            if not chars:
                QtWidgets.QMessageBox.warning(d, "âš ï¸ Attention", "SÃ©lectionnez au moins un type de caractÃ¨re !")
                return
            
            import secrets
            password = ''.join(secrets.choice(chars) for _ in range(length_spin.value()))
            password_text.setText(password)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        generate_btn = QtWidgets.QPushButton("ðŸŽ² GÃ©nÃ©rer")
        copy_btn = QtWidgets.QPushButton("ðŸ“‹ Copier")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        generate_btn.clicked.connect(generate_password)
        copy_btn.clicked.connect(lambda: (
            QtWidgets.QApplication.clipboard().setText(password_text.text()),
            QtWidgets.QMessageBox.information(d, "âœ… CopiÃ©", "Mot de passe copiÃ© !")
        ))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(generate_btn)
        btn_layout.addWidget(copy_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        # GÃ©nÃ©rer un mot de passe par dÃ©faut
        generate_password()
        
        d.show()
    
    def show_qr_generator(self):
        """GÃ©nÃ©rateur de codes QR"""
        d = GlassDialog("ðŸ“± GÃ©nÃ©rateur QR Code", (500, 400), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("GÃ©nÃ©rateur QR Code", "CrÃ©ez des codes QR rapidement")
        lay.addWidget(header)
        
        # Zone de saisie
        input_widget = QtWidgets.QWidget(objectName="GlassCard")
        input_layout = QtWidgets.QVBoxLayout(input_widget)
        input_layout.setContentsMargins(16, 16, 16, 16)
        
        input_label = QtWidgets.QLabel("ðŸ“ Texte Ã  encoder :")
        text_input = QtWidgets.QTextEdit()
        text_input.setPlaceholderText("Entrez le texte, URL, ou donnÃ©es Ã  encoder...")
        text_input.setMaximumHeight(100)
        
        input_layout.addWidget(input_label)
        input_layout.addWidget(text_input)
        
        lay.addWidget(input_widget)
        
        # Zone d'affichage QR
        qr_widget = QtWidgets.QWidget(objectName="GlassCard")
        qr_layout = QtWidgets.QVBoxLayout(qr_widget)
        qr_layout.setContentsMargins(16, 16, 16, 16)
        
        qr_label = QtWidgets.QLabel("ðŸ“± Code QR :")
        qr_display = QtWidgets.QLabel()
        qr_display.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        qr_display.setMinimumSize(200, 200)
        qr_display.setStyleSheet("border: 2px dashed rgba(255,255,255,0.3); background: rgba(255,255,255,0.1);")
        qr_display.setText("ðŸ”² Le code QR apparaÃ®tra ici")
        
        qr_layout.addWidget(qr_label)
        qr_layout.addWidget(qr_display)
        
        lay.addWidget(qr_widget)
        
        def generate_qr():
            text = text_input.toPlainText().strip()
            if not text:
                QtWidgets.QMessageBox.warning(d, "âš ï¸ Attention", "Entrez du texte Ã  encoder !")
                return
            
            # Simulation d'un QR code (en rÃ©alitÃ© il faudrait une bibliothÃ¨que comme qrcode)
            qr_display.setText(f"ðŸ“± QR Code gÃ©nÃ©rÃ© pour :\n\n'{text[:50]}{'...' if len(text) > 50 else ''}'\n\nðŸ”²ðŸ”²ðŸ”²ðŸ”²ðŸ”²\nðŸ”²â¬œðŸ”²â¬œðŸ”²\nðŸ”²ðŸ”²ðŸ”²ðŸ”²ðŸ”²\nðŸ”²â¬œðŸ”²â¬œðŸ”²\nðŸ”²ðŸ”²ðŸ”²ðŸ”²ðŸ”²")
            QtWidgets.QMessageBox.information(d, "âœ… GÃ©nÃ©rÃ©", "Code QR gÃ©nÃ©rÃ© avec succÃ¨s !")
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        generate_btn = QtWidgets.QPushButton("ðŸ“± GÃ©nÃ©rer QR")
        save_btn = QtWidgets.QPushButton("ðŸ’¾ Sauvegarder")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        generate_btn.clicked.connect(generate_qr)
        save_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ’¾ Sauvegarde", "QR Code sauvegardÃ© dans le dossier Images !"))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(generate_btn)
        btn_layout.addWidget(save_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def show_audio_player(self):
        """Lecteur audio simple"""
        d = GlassDialog("ðŸŽµ Lecteur Audio Ragnar", (600, 400), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Lecteur Audio", "Ã‰coutez vos musiques prÃ©fÃ©rÃ©es")
        lay.addWidget(header)
        
        # Zone de lecture
        player_widget = QtWidgets.QWidget(objectName="GlassCard")
        player_layout = QtWidgets.QVBoxLayout(player_widget)
        player_layout.setContentsMargins(16, 16, 16, 16)
        
        # Informations du morceau
        track_info = QtWidgets.QLabel("ðŸŽµ Aucun fichier sÃ©lectionnÃ©")
        track_info.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        track_info.setStyleSheet("font-size: 14px; font-weight: bold; padding: 10px;")
        
        # Barre de progression
        progress_bar = QtWidgets.QProgressBar()
        progress_bar.setRange(0, 100)
        progress_bar.setValue(0)
        
        # ContrÃ´les
        controls_layout = QtWidgets.QHBoxLayout()
        prev_btn = QtWidgets.QPushButton("â®ï¸")
        play_btn = QtWidgets.QPushButton("â–¶ï¸")
        next_btn = QtWidgets.QPushButton("â­ï¸")
        
        prev_btn.setMaximumWidth(50)
        play_btn.setMaximumWidth(50)
        next_btn.setMaximumWidth(50)
        
        controls_layout.addStretch()
        controls_layout.addWidget(prev_btn)
        controls_layout.addWidget(play_btn)
        controls_layout.addWidget(next_btn)
        controls_layout.addStretch()
        
        player_layout.addWidget(track_info)
        player_layout.addWidget(progress_bar)
        player_layout.addLayout(controls_layout)
        
        lay.addWidget(player_widget)
        
        # Zone de playlist
        playlist_widget = QtWidgets.QWidget(objectName="GlassCard")
        playlist_layout = QtWidgets.QVBoxLayout(playlist_widget)
        playlist_layout.setContentsMargins(16, 16, 16, 16)
        
        playlist_label = QtWidgets.QLabel("ðŸ“‹ Playlist :")
        playlist_list = QtWidgets.QListWidget()
        playlist_list.setObjectName("GlassCard")
        
        # Playlist d'exemple
        sample_tracks = [
            "ðŸŽµ Ragnar Theme - Epic Music",
            "ðŸŽ¶ Digital Dreams - Synthwave",
            "ðŸŽµ Code & Coffee - Lo-fi",
            "ðŸŽ¶ System Sounds - Ambient"
        ]
        
        for track in sample_tracks:
            playlist_list.addItem(track)
        
        playlist_layout.addWidget(playlist_label)
        playlist_layout.addWidget(playlist_list)
        
        lay.addWidget(playlist_widget)
        
        # Variables de lecture
        is_playing = False
        current_track = 0
        
        def toggle_play():
            nonlocal is_playing
            is_playing = not is_playing
            if is_playing:
                play_btn.setText("â¸ï¸")
                track_info.setText(f"ðŸŽµ En lecture : {sample_tracks[current_track]}")
                # Simulation de progression
                for i in range(101):
                    progress_bar.setValue(i)
                    QtWidgets.QApplication.processEvents()
                    time.sleep(0.01)
            else:
                play_btn.setText("â–¶ï¸")
                track_info.setText("â¸ï¸ Lecture en pause")
        
        def next_track():
            nonlocal current_track
            current_track = (current_track + 1) % len(sample_tracks)
            track_info.setText(f"â­ï¸ Piste suivante : {sample_tracks[current_track]}")
            progress_bar.setValue(0)
        
        def prev_track():
            nonlocal current_track
            current_track = (current_track - 1) % len(sample_tracks)
            track_info.setText(f"â®ï¸ Piste prÃ©cÃ©dente : {sample_tracks[current_track]}")
            progress_bar.setValue(0)
        
        play_btn.clicked.connect(toggle_play)
        next_btn.clicked.connect(next_track)
        prev_btn.clicked.connect(prev_track)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        open_btn = QtWidgets.QPushButton("ðŸ“ Ouvrir fichier")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        open_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“ Fichier", "SÃ©lectionnez un fichier audio Ã  lire !"))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(open_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def show_screenshot_tool(self):
        """Outil de capture d'Ã©cran"""
        d = GlassDialog("ðŸ“¸ Capture d'Ã‰cran", (500, 350), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Capture d'Ã‰cran", "Capturez votre Ã©cran facilement")
        lay.addWidget(header)
        
        # Options de capture
        options_widget = QtWidgets.QWidget(objectName="GlassCard")
        options_layout = QtWidgets.QVBoxLayout(options_widget)
        options_layout.setContentsMargins(16, 16, 16, 16)
        
        # Types de capture
        fullscreen_radio = QtWidgets.QRadioButton("ðŸ–¥ï¸ Ã‰cran complet")
        window_radio = QtWidgets.QRadioButton("ðŸªŸ FenÃªtre active")
        region_radio = QtWidgets.QRadioButton("ðŸ“ RÃ©gion sÃ©lectionnÃ©e")
        
        fullscreen_radio.setChecked(True)
        
        # DÃ©lai
        delay_layout = QtWidgets.QHBoxLayout()
        delay_layout.addWidget(QtWidgets.QLabel("â° DÃ©lai :"))
        delay_spin = QtWidgets.QSpinBox()
        delay_spin.setRange(0, 10)
        delay_spin.setValue(3)
        delay_spin.setSuffix(" secondes")
        delay_layout.addWidget(delay_spin)
        delay_layout.addStretch()
        
        options_layout.addWidget(QtWidgets.QLabel("ðŸ“· Type de capture :"))
        options_layout.addWidget(fullscreen_radio)
        options_layout.addWidget(window_radio)
        options_layout.addWidget(region_radio)
        options_layout.addLayout(delay_layout)
        
        lay.addWidget(options_widget)
        
        # Zone d'aperÃ§u
        preview_widget = QtWidgets.QWidget(objectName="GlassCard")
        preview_layout = QtWidgets.QVBoxLayout(preview_widget)
        preview_layout.setContentsMargins(16, 16, 16, 16)
        
        preview_label = QtWidgets.QLabel("ðŸ‘ï¸ AperÃ§u :")
        preview_display = QtWidgets.QLabel()
        preview_display.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        preview_display.setMinimumSize(200, 150)
        preview_display.setStyleSheet("border: 2px dashed rgba(255,255,255,0.3); background: rgba(255,255,255,0.1);")
        preview_display.setText("ðŸ“¸ L'aperÃ§u apparaÃ®tra ici")
        
        preview_layout.addWidget(preview_label)
        preview_layout.addWidget(preview_display)
        
        lay.addWidget(preview_widget)
        
        def take_screenshot():
            delay = delay_spin.value()
            
            if delay > 0:
                QtWidgets.QMessageBox.information(d, "ðŸ“¸ Capture", f"Capture dans {delay} secondes...")
                for i in range(delay):
                    time.sleep(1)
                    QtWidgets.QApplication.processEvents()
            
            # Simulation de capture
            if fullscreen_radio.isChecked():
                capture_type = "Ã‰cran complet"
            elif window_radio.isChecked():
                capture_type = "FenÃªtre active"
            else:
                capture_type = "RÃ©gion sÃ©lectionnÃ©e"
            
            preview_display.setText(f"ðŸ“¸ Capture rÃ©alisÃ©e !\n\nType : {capture_type}\nTaille : 1920x1080\nFormat : PNG")
            
            QtWidgets.QMessageBox.information(d, "âœ… Capture", f"Capture d'Ã©cran sauvegardÃ©e !\n\nType : {capture_type}\nEmplacement : Bureau/Screenshots/")
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        capture_btn = QtWidgets.QPushButton("ðŸ“¸ Capturer")
        save_btn = QtWidgets.QPushButton("ðŸ’¾ Sauvegarder")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        capture_btn.clicked.connect(take_screenshot)
        save_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ’¾ Sauvegarde", "Capture sauvegardÃ©e dans le dossier Images !"))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(capture_btn)
        btn_layout.addWidget(save_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def show_system_monitor(self):
        """Moniteur systÃ¨me avancÃ©"""
        d = GlassDialog("ðŸŒ¡ï¸ Moniteur SystÃ¨me AvancÃ©", (700, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Moniteur SystÃ¨me", "Surveillance complÃ¨te du systÃ¨me")
        lay.addWidget(header)
        
        # Onglets de monitoring
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Performance
        perf_tab = QtWidgets.QWidget()
        perf_layout = QtWidgets.QVBoxLayout(perf_tab)
        
        # Graphiques de performance simulÃ©s
        cpu_widget = QtWidgets.QWidget(objectName="GlassCard")
        cpu_layout = QtWidgets.QVBoxLayout(cpu_widget)
        cpu_layout.setContentsMargins(12, 12, 12, 12)
        
        cpu_usage = random.randint(20, 80)
        ram_usage = random.randint(30, 70)
        disk_usage = random.randint(40, 90)
        
        cpu_bar = QtWidgets.QProgressBar()
        cpu_bar.setValue(cpu_usage)
        cpu_bar.setFormat(f"CPU: {cpu_usage}%")
        
        ram_bar = QtWidgets.QProgressBar()
        ram_bar.setValue(ram_usage)
        ram_bar.setFormat(f"RAM: {ram_usage}%")
        
        disk_bar = QtWidgets.QProgressBar()
        disk_bar.setValue(disk_usage)
        disk_bar.setFormat(f"Disque: {disk_usage}%")
        
        cpu_layout.addWidget(QtWidgets.QLabel("ðŸ“Š Utilisation des ressources :"))
        cpu_layout.addWidget(cpu_bar)
        cpu_layout.addWidget(ram_bar)
        cpu_layout.addWidget(disk_bar)
        
        perf_layout.addWidget(cpu_widget)
        
        # Processus
        processes_widget = QtWidgets.QWidget(objectName="GlassCard")
        processes_layout = QtWidgets.QVBoxLayout(processes_widget)
        processes_layout.setContentsMargins(12, 12, 12, 12)
        
        processes_list = QtWidgets.QListWidget()
        processes_list.setObjectName("GlassCard")
        
        sample_processes = [
            "ðŸ–¥ï¸ ragnarOS.exe - 15% CPU",
            "ðŸŒ chrome.exe - 8% CPU",
            "ðŸ“ notepad.exe - 2% CPU",
            "ðŸŽµ spotify.exe - 5% CPU",
            "ðŸ’» python.exe - 12% CPU"
        ]
        
        for process in sample_processes:
            processes_list.addItem(process)
        
        processes_layout.addWidget(QtWidgets.QLabel("âš™ï¸ Processus actifs :"))
        processes_layout.addWidget(processes_list)
        
        perf_layout.addWidget(processes_widget)
        
        # Onglet RÃ©seau
        network_tab = QtWidgets.QWidget()
        network_layout = QtWidgets.QVBoxLayout(network_tab)
        
        network_widget = QtWidgets.QWidget(objectName="GlassCard")
        network_widget_layout = QtWidgets.QVBoxLayout(network_widget)
        network_widget_layout.setContentsMargins(12, 12, 12, 12)
        
        network_info = [
            f"ðŸ“¡ Connexions actives : {random.randint(10, 50)}",
            f"â¬‡ï¸ TÃ©lÃ©chargement : {random.randint(1, 100)} Mbps",
            f"â¬†ï¸ Upload : {random.randint(1, 50)} Mbps",
            f"ðŸ“Š Paquets reÃ§us : {random.randint(10000, 99999)}",
            f"ðŸ“ˆ Paquets envoyÃ©s : {random.randint(10000, 99999)}",
            f"âŒ Erreurs rÃ©seau : {random.randint(0, 10)}"
        ]
        
        for info in network_info:
            label = QtWidgets.QLabel(info)
            label.setStyleSheet("padding: 4px; font-size: 12px;")
            network_widget_layout.addWidget(label)
        
        network_layout.addWidget(network_widget)
        
        # Ajouter les onglets
        tabs.addTab(perf_tab, "ðŸ“Š Performance")
        tabs.addTab(network_tab, "ðŸŒ RÃ©seau")
        
        lay.addWidget(tabs)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        refresh_btn = QtWidgets.QPushButton("ðŸ”„ Actualiser")
        export_btn = QtWidgets.QPushButton("ðŸ“Š Exporter")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        refresh_btn.clicked.connect(lambda: (d.close(), self.show_system_monitor()))
        export_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“Š Export", "DonnÃ©es exportÃ©es vers rapport_systeme.txt !"))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(refresh_btn)
        btn_layout.addWidget(export_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def show_dev_tools(self):
        """Outils dÃ©veloppeur"""
        d = GlassDialog("ðŸ”§ Outils DÃ©veloppeur", (700, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Outils DÃ©veloppeur", "Utilitaires pour dÃ©veloppeurs")
        lay.addWidget(header)
        
        # Onglets d'outils
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Encodage/DÃ©codage
        encode_tab = QtWidgets.QWidget()
        encode_layout = QtWidgets.QVBoxLayout(encode_tab)
        
        # Zone de texte
        encode_widget = QtWidgets.QWidget(objectName="GlassCard")
        encode_widget_layout = QtWidgets.QVBoxLayout(encode_widget)
        encode_widget_layout.setContentsMargins(12, 12, 12, 12)
        
        input_text = QtWidgets.QTextEdit()
        input_text.setPlaceholderText("Entrez le texte Ã  encoder/dÃ©coder...")
        input_text.setMaximumHeight(100)
        
        output_text = QtWidgets.QTextEdit()
        output_text.setPlaceholderText("RÃ©sultat...")
        output_text.setMaximumHeight(100)
        output_text.setReadOnly(True)
        
        # Boutons d'encodage
        encode_buttons = QtWidgets.QHBoxLayout()
        base64_btn = QtWidgets.QPushButton("Base64")
        url_btn = QtWidgets.QPushButton("URL")
        html_btn = QtWidgets.QPushButton("HTML")
        
        def encode_base64():
            import base64
            text = input_text.toPlainText()
            if text:
                encoded = base64.b64encode(text.encode()).decode()
                output_text.setPlainText(encoded)
        
        def encode_url():
            import urllib.parse
            text = input_text.toPlainText()
            if text:
                encoded = urllib.parse.quote(text)
                output_text.setPlainText(encoded)
        
        def encode_html():
            import html
            text = input_text.toPlainText()
            if text:
                encoded = html.escape(text)
                output_text.setPlainText(encoded)
        
        base64_btn.clicked.connect(encode_base64)
        url_btn.clicked.connect(encode_url)
        html_btn.clicked.connect(encode_html)
        
        encode_buttons.addWidget(base64_btn)
        encode_buttons.addWidget(url_btn)
        encode_buttons.addWidget(html_btn)
        
        encode_widget_layout.addWidget(QtWidgets.QLabel("ðŸ“ Texte d'entrÃ©e :"))
        encode_widget_layout.addWidget(input_text)
        encode_widget_layout.addWidget(QtWidgets.QLabel("ðŸ”§ Encodage :"))
        encode_widget_layout.addLayout(encode_buttons)
        encode_widget_layout.addWidget(QtWidgets.QLabel("ðŸ“‹ RÃ©sultat :"))
        encode_widget_layout.addWidget(output_text)
        
        encode_layout.addWidget(encode_widget)
        
        # Onglet Hash
        hash_tab = QtWidgets.QWidget()
        hash_layout = QtWidgets.QVBoxLayout(hash_tab)
        
        hash_widget = QtWidgets.QWidget(objectName="GlassCard")
        hash_widget_layout = QtWidgets.QVBoxLayout(hash_widget)
        hash_widget_layout.setContentsMargins(12, 12, 12, 12)
        
        hash_input = QtWidgets.QTextEdit()
        hash_input.setPlaceholderText("Entrez le texte Ã  hasher...")
        hash_input.setMaximumHeight(80)
        
        hash_results = QtWidgets.QTextEdit()
        hash_results.setReadOnly(True)
        hash_results.setMaximumHeight(150)
        
        def generate_hashes():
            text = hash_input.toPlainText()
            if text:
                import hashlib
                md5_hash = hashlib.md5(text.encode()).hexdigest()
                sha1_hash = hashlib.sha1(text.encode()).hexdigest()
                sha256_hash = hashlib.sha256(text.encode()).hexdigest()
                
                result = f"MD5: {md5_hash}\n\nSHA1: {sha1_hash}\n\nSHA256: {sha256_hash}"
                hash_results.setPlainText(result)
        
        hash_btn = QtWidgets.QPushButton("ðŸ” GÃ©nÃ©rer Hash")
        hash_btn.clicked.connect(generate_hashes)
        
        hash_widget_layout.addWidget(QtWidgets.QLabel("ðŸ“ Texte :"))
        hash_widget_layout.addWidget(hash_input)
        hash_widget_layout.addWidget(hash_btn)
        hash_widget_layout.addWidget(QtWidgets.QLabel("ðŸ” Hash :"))
        hash_widget_layout.addWidget(hash_results)
        
        hash_layout.addWidget(hash_widget)
        
        # Ajouter les onglets
        tabs.addTab(encode_tab, "ðŸ”§ Encodage")
        tabs.addTab(hash_tab, "ðŸ” Hash")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def show_rapp_manager(self):
        """Gestionnaire de packages .rapp"""
        d = GlassDialog("ðŸ“¦ Gestionnaire Ragnar Apps (.rapp)", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Gestionnaire .rapp", "Installez et gÃ©rez vos applications Ragnar")
        lay.addWidget(header)
        
        # Onglets
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Applications installÃ©es
        installed_tab = QtWidgets.QWidget()
        installed_layout = QtWidgets.QVBoxLayout(installed_tab)
        
        installed_list = QtWidgets.QListWidget()
        installed_list.setObjectName("GlassCard")
        
        # Applications .rapp simulÃ©es
        sample_apps = [
            "ðŸŽ® RagnarGame.rapp - Jeu de puzzle",
            "ðŸ“Š RagnarStats.rapp - Statistiques systÃ¨me",
            "ðŸŽ¨ RagnarDraw.rapp - Ã‰diteur graphique",
            "ðŸŒ RagnarWeb.rapp - Navigateur lÃ©ger",
            "ðŸ“ RagnarEdit.rapp - Ã‰diteur de code"
        ]
        
        for app in sample_apps:
            installed_list.addItem(app)
        
        installed_layout.addWidget(QtWidgets.QLabel("ðŸ“¦ Applications installÃ©es :"))
        installed_layout.addWidget(installed_list)
        
        # Boutons pour les apps installÃ©es
        installed_btn_layout = QtWidgets.QHBoxLayout()
        run_btn = QtWidgets.QPushButton("â–¶ï¸ Lancer")
        uninstall_btn = QtWidgets.QPushButton("ðŸ—‘ï¸ DÃ©sinstaller")
        
        run_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "â–¶ï¸ Lancement", "Application .rapp lancÃ©e !"))
        uninstall_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ—‘ï¸ DÃ©sinstallation", "Application .rapp dÃ©sinstallÃ©e !"))
        
        installed_btn_layout.addWidget(run_btn)
        installed_btn_layout.addWidget(uninstall_btn)
        installed_btn_layout.addStretch()
        
        installed_layout.addLayout(installed_btn_layout)
        
        # Onglet Installation
        install_tab = QtWidgets.QWidget()
        install_layout = QtWidgets.QVBoxLayout(install_tab)
        
        # Zone d'installation
        install_widget = QtWidgets.QWidget(objectName="GlassCard")
        install_widget_layout = QtWidgets.QVBoxLayout(install_widget)
        install_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        install_label = QtWidgets.QLabel("ðŸ“‚ Installer une application .rapp :")
        file_path_input = QtWidgets.QLineEdit()
        file_path_input.setPlaceholderText("Chemin vers le fichier .rapp...")
        
        browse_btn = QtWidgets.QPushButton("ðŸ“ Parcourir")
        install_btn = QtWidgets.QPushButton("ðŸ“¦ Installer")
        
        def browse_rapp():
            file_path, _ = QtWidgets.QFileDialog.getOpenFileName(d, "SÃ©lectionner un fichier .rapp", "", "Ragnar Apps (*.rapp)")
            if file_path:
                file_path_input.setText(file_path)
        
        def install_rapp():
            file_path = file_path_input.text().strip()
            if not file_path:
                QtWidgets.QMessageBox.warning(d, "âš ï¸ Attention", "SÃ©lectionnez un fichier .rapp !")
                return
            
            # Simulation d'installation
            progress = QtWidgets.QProgressDialog("Installation de l'application .rapp...", "Annuler", 0, 100, d)
            progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
            progress.show()
            
            for i in range(101):
                progress.setValue(i)
                QtWidgets.QApplication.processEvents()
                time.sleep(0.01)
                if progress.wasCanceled():
                    return
            
            QtWidgets.QMessageBox.information(d, "âœ… Installation", f"Application .rapp installÃ©e avec succÃ¨s !\n\nFichier : {Path(file_path).name}")
        
        browse_btn.clicked.connect(browse_rapp)
        install_btn.clicked.connect(install_rapp)
        
        install_widget_layout.addWidget(install_label)
        install_widget_layout.addWidget(file_path_input)
        install_widget_layout.addWidget(browse_btn)
        install_widget_layout.addWidget(install_btn)
        
        install_layout.addWidget(install_widget)
        
        # Informations sur le format .rapp
        info_widget = QtWidgets.QWidget(objectName="GlassCard")
        info_layout = QtWidgets.QVBoxLayout(info_widget)
        info_layout.setContentsMargins(16, 16, 16, 16)
        
        info_text = """
ðŸ“¦ <b>Format .rapp (Ragnar Package App)</b><br><br>
Les fichiers .rapp sont des applications Python empaquetÃ©es pour Ragnar OS :<br><br>
â€¢ <b>Structure :</b> Code Python + mÃ©tadonnÃ©es<br>
â€¢ <b>Installation :</b> Automatique avec dÃ©pendances<br>
â€¢ <b>SÃ©curitÃ© :</b> VÃ©rification d'intÃ©gritÃ©<br>
â€¢ <b>PortabilitÃ© :</b> Fonctionne sur tous les Ragnar OS<br><br>
<b>Exemple de crÃ©ation :</b><br>
1. Ã‰crivez votre code Python<br>
2. Ajoutez un fichier manifest.json<br>
3. Compressez en .rapp<br>
4. Installez via ce gestionnaire
        """
        
        info_label = QtWidgets.QLabel(info_text)
        info_label.setWordWrap(True)
        info_layout.addWidget(info_label)
        
        install_layout.addWidget(info_widget)
        
        # Ajouter les onglets
        tabs.addTab(installed_tab, "ðŸ“¦ InstallÃ©es")
        tabs.addTab(install_tab, "ðŸ“¥ Installer")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    # ===== NOUVELLES FONCTIONNALITÃ‰S RAGNAR OS 26.3.3 =====
    
    def show_theme_manager(self):
        """Gestionnaire de thÃ¨mes avancÃ©s - Nouvelle fonctionnalitÃ© 26.3.3"""
        d = GlassDialog("ðŸŽ¨ Gestionnaire de ThÃ¨mes AvancÃ©s", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("ThÃ¨mes AvancÃ©s", "Personnalisez complÃ¨tement votre interface Ragnar")
        lay.addWidget(header)
        
        # Onglets de thÃ¨mes
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet ThÃ¨mes PrÃ©dÃ©finis
        themes_tab = QtWidgets.QWidget()
        themes_layout = QtWidgets.QVBoxLayout(themes_tab)
        
        themes_widget = QtWidgets.QWidget(objectName="GlassCard")
        themes_widget_layout = QtWidgets.QGridLayout(themes_widget)
        themes_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        # ThÃ¨mes disponibles
        available_themes = [
            ("ðŸŒŒ Verre Noir", "Le thÃ¨me classique avec effets de verre noir", "#1a1a2e"),
            ("ðŸŒ† Cyberpunk", "Interface futuriste nÃ©on et violet", "#0f0f23"),
            ("ðŸŒ¿ Nature", "ThÃ¨me vert apaisant inspirÃ© de la nature", "#1a2e1a"),
            ("ðŸŒŒ Espace", "ThÃ¨me sombre avec Ã©toiles et galaxies", "#0a0a1a"),
            ("â˜€ï¸ LumiÃ¨re", "ThÃ¨me clair et moderne pour la journÃ©e", "#f0f0f0"),
            ("ðŸŽ® Gaming", "Interface gaming avec RGB et nÃ©ons", "#1a0a2e"),
        ]
        
        row, col = 0, 0
        for name, desc, color in available_themes:
            theme_card = QtWidgets.QWidget(objectName="GlassCard")
            theme_card.setMinimumSize(200, 120)
            theme_card.setStyleSheet(f"background: {color}; border-radius: 8px;")
            
            card_layout = QtWidgets.QVBoxLayout(theme_card)
            card_layout.setContentsMargins(12, 12, 12, 12)
            
            theme_name = QtWidgets.QLabel(name)
            theme_name.setStyleSheet("font-size: 14px; font-weight: bold; color: white;")
            
            theme_desc = QtWidgets.QLabel(desc)
            theme_desc.setStyleSheet("font-size: 10px; color: rgba(255,255,255,0.8);")
            theme_desc.setWordWrap(True)
            
            apply_btn = QtWidgets.QPushButton("âœ¨ Appliquer")
            apply_btn.clicked.connect(lambda checked, t=name: self.apply_theme(t, d))
            
            card_layout.addWidget(theme_name)
            card_layout.addWidget(theme_desc)
            card_layout.addStretch()
            card_layout.addWidget(apply_btn)
            
            themes_widget_layout.addWidget(theme_card, row, col)
            col += 1
            if col >= 3:
                col = 0
                row += 1
        
        themes_layout.addWidget(themes_widget)
        
        # Onglet Personnalisation
        custom_tab = QtWidgets.QWidget()
        custom_layout = QtWidgets.QVBoxLayout(custom_tab)
        
        custom_widget = QtWidgets.QWidget(objectName="GlassCard")
        custom_widget_layout = QtWidgets.QVBoxLayout(custom_widget)
        custom_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        # ContrÃ´les de personnalisation
        transparency_layout = QtWidgets.QHBoxLayout()
        transparency_layout.addWidget(QtWidgets.QLabel("ðŸ” Transparence :"))
        transparency_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        transparency_slider.setRange(10, 100)
        transparency_slider.setValue(85)
        transparency_layout.addWidget(transparency_slider)
        
        blur_layout = QtWidgets.QHBoxLayout()
        blur_layout.addWidget(QtWidgets.QLabel("ðŸŒ«ï¸ Flou :"))
        blur_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        blur_slider.setRange(0, 50)
        blur_slider.setValue(20)
        blur_layout.addWidget(blur_slider)
        
        glow_layout = QtWidgets.QHBoxLayout()
        glow_layout.addWidget(QtWidgets.QLabel("âœ¨ Effet NÃ©on :"))
        glow_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        glow_slider.setRange(0, 100)
        glow_slider.setValue(30)
        glow_layout.addWidget(glow_slider)
        
        custom_widget_layout.addWidget(QtWidgets.QLabel("ðŸŽ¨ Personnalisation AvancÃ©e :"))
        custom_widget_layout.addLayout(transparency_layout)
        custom_widget_layout.addLayout(blur_layout)
        custom_widget_layout.addLayout(glow_layout)
        
        # Boutons de personnalisation
        custom_buttons = QtWidgets.QHBoxLayout()
        preview_btn = QtWidgets.QPushButton("ðŸ‘ï¸ AperÃ§u")
        save_btn = QtWidgets.QPushButton("ðŸ’¾ Sauvegarder")
        reset_btn = QtWidgets.QPushButton("ðŸ”„ RÃ©initialiser")
        
        preview_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ‘ï¸ AperÃ§u", "AperÃ§u du thÃ¨me personnalisÃ© appliquÃ© !"))
        save_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ’¾ Sauvegarde", "ThÃ¨me personnalisÃ© sauvegardÃ© !"))
        reset_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”„ Reset", "ParamÃ¨tres rÃ©initialisÃ©s !"))
        
        custom_buttons.addWidget(preview_btn)
        custom_buttons.addWidget(save_btn)
        custom_buttons.addWidget(reset_btn)
        
        custom_widget_layout.addLayout(custom_buttons)
        custom_layout.addWidget(custom_widget)
        
        # Ajouter les onglets
        tabs.addTab(themes_tab, "ðŸŽ¨ ThÃ¨mes")
        tabs.addTab(custom_tab, "âš™ï¸ Personnalisation")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def apply_theme(self, theme_name, dialog):
        """Applique un thÃ¨me sÃ©lectionnÃ©"""
        QtWidgets.QMessageBox.information(dialog, "âœ¨ ThÃ¨me AppliquÃ©", f"ThÃ¨me '{theme_name}' appliquÃ© avec succÃ¨s !\n\nRedÃ©marrez Ragnar OS pour voir tous les changements.")
    
    def show_marketplace(self):
        """Marketplace .rapp officiel - Nouvelle fonctionnalitÃ© 26.3.3"""
        d = GlassDialog("ðŸª Marketplace Ragnar Apps", (900, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Marketplace .rapp", "DÃ©couvrez et installez des applications incroyables")
        lay.addWidget(header)
        
        # Onglets du marketplace
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Populaires
        popular_tab = QtWidgets.QWidget()
        popular_layout = QtWidgets.QVBoxLayout(popular_tab)
        
        popular_list = QtWidgets.QListWidget()
        popular_list.setObjectName("GlassCard")
        
        # Applications populaires
        popular_apps = [
            "ðŸŽ® RagnarCraft.rapp - Jeu de construction 3D â­â­â­â­â­ (4.9/5) - GRATUIT",
            "ðŸ“Š RagnarAnalytics.rapp - Tableaux de bord avancÃ©s â­â­â­â­â­ (4.8/5) - 9.99â‚¬",
            "ðŸŽ¨ RagnarStudio.rapp - Suite crÃ©ative complÃ¨te â­â­â­â­â­ (4.7/5) - 19.99â‚¬",
            "ðŸŒ RagnarBrowser Pro.rapp - Navigateur ultra-rapide â­â­â­â­ (4.6/5) - GRATUIT",
            "ðŸŽµ RagnarMusic.rapp - Lecteur audio professionnel â­â­â­â­â­ (4.9/5) - 4.99â‚¬",
            "ðŸ“ RagnarOffice.rapp - Suite bureautique complÃ¨te â­â­â­â­ (4.5/5) - 29.99â‚¬",
            "ðŸ” RagnarVault.rapp - Gestionnaire de mots de passe â­â­â­â­â­ (4.8/5) - 14.99â‚¬",
            "ðŸ“± RagnarMobile.rapp - Ã‰mulateur mobile â­â­â­â­ (4.4/5) - GRATUIT",
        ]
        
        for app in popular_apps:
            popular_list.addItem(app)
        
        popular_layout.addWidget(QtWidgets.QLabel("ðŸ”¥ Applications Populaires :"))
        popular_layout.addWidget(popular_list)
        
        # Boutons pour les apps populaires
        popular_buttons = QtWidgets.QHBoxLayout()
        install_btn = QtWidgets.QPushButton("ðŸ“¦ Installer")
        details_btn = QtWidgets.QPushButton("â„¹ï¸ DÃ©tails")
        review_btn = QtWidgets.QPushButton("â­ Avis")
        
        install_btn.clicked.connect(lambda: self.install_marketplace_app(popular_list.currentItem(), d))
        details_btn.clicked.connect(lambda: self.show_app_details(popular_list.currentItem(), d))
        review_btn.clicked.connect(lambda: self.show_app_reviews(popular_list.currentItem(), d))
        
        popular_buttons.addWidget(install_btn)
        popular_buttons.addWidget(details_btn)
        popular_buttons.addWidget(review_btn)
        popular_buttons.addStretch()
        
        popular_layout.addLayout(popular_buttons)
        
        # Onglet CatÃ©gories
        categories_tab = QtWidgets.QWidget()
        categories_layout = QtWidgets.QVBoxLayout(categories_tab)
        
        categories_widget = QtWidgets.QWidget(objectName="GlassCard")
        categories_widget_layout = QtWidgets.QGridLayout(categories_widget)
        categories_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        # CatÃ©gories d'applications
        categories = [
            ("ðŸŽ® Jeux", "125 apps", "#2e1a4a"),
            ("ðŸ“Š ProductivitÃ©", "89 apps", "#1a2e4a"),
            ("ðŸŽ¨ CrÃ©atif", "67 apps", "#4a1a2e"),
            ("ðŸ”§ DÃ©veloppement", "156 apps", "#2e4a1a"),
            ("ðŸŒ Internet", "43 apps", "#4a2e1a"),
            ("ðŸŽµ MultimÃ©dia", "78 apps", "#1a4a2e"),
        ]
        
        row, col = 0, 0
        for name, count, color in categories:
            cat_card = QtWidgets.QWidget(objectName="GlassCard")
            cat_card.setMinimumSize(180, 100)
            cat_card.setStyleSheet(f"background: {color}; border-radius: 8px;")
            
            cat_layout = QtWidgets.QVBoxLayout(cat_card)
            cat_layout.setContentsMargins(12, 12, 12, 12)
            
            cat_name = QtWidgets.QLabel(name)
            cat_name.setStyleSheet("font-size: 14px; font-weight: bold; color: white;")
            
            cat_count = QtWidgets.QLabel(count)
            cat_count.setStyleSheet("font-size: 12px; color: rgba(255,255,255,0.8);")
            
            cat_layout.addWidget(cat_name)
            cat_layout.addWidget(cat_count)
            cat_layout.addStretch()
            
            categories_widget_layout.addWidget(cat_card, row, col)
            col += 1
            if col >= 3:
                col = 0
                row += 1
        
        categories_layout.addWidget(categories_widget)
        
        # Ajouter les onglets
        tabs.addTab(popular_tab, "ðŸ”¥ Populaires")
        tabs.addTab(categories_tab, "ðŸ“‚ CatÃ©gories")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def install_marketplace_app(self, item, dialog):
        """Installe une application depuis le marketplace"""
        if not item:
            return
        app_name = item.text().split(" - ")[0]
        
        # Simulation d'installation
        progress = QtWidgets.QProgressDialog(f"Installation de {app_name}...", "Annuler", 0, 100, dialog)
        progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
        progress.show()
        
        for i in range(101):
            progress.setValue(i)
            QtWidgets.QApplication.processEvents()
            time.sleep(0.02)
            if progress.wasCanceled():
                return
        
        QtWidgets.QMessageBox.information(dialog, "âœ… Installation", f"{app_name} installÃ© avec succÃ¨s !\n\nL'application est maintenant disponible dans votre menu.")
    
    def show_app_details(self, item, dialog):
        """Affiche les dÃ©tails d'une application"""
        if not item:
            return
        app_name = item.text().split(" - ")[0]
        
        details = f"""
ðŸ“± <b>{app_name}</b><br><br>
<b>DÃ©veloppeur :</b> Ragnar Studios<br>
<b>Version :</b> 2.1.4<br>
<b>Taille :</b> 45.2 MB<br>
<b>CompatibilitÃ© :</b> Ragnar OS 26.0+<br>
<b>Langues :</b> FranÃ§ais, Anglais, Espagnol<br><br>
<b>Description :</b><br>
Une application rÃ©volutionnaire qui transforme votre expÃ©rience Ragnar OS. 
Avec des fonctionnalitÃ©s avancÃ©es et une interface moderne, cette app est 
indispensable pour tous les utilisateurs Ragnar.
        """
        
        QtWidgets.QMessageBox.information(dialog, "â„¹ï¸ DÃ©tails de l'application", details)
    
    def show_app_reviews(self, item, dialog):
        """Affiche les avis d'une application"""
        if not item:
            return
        app_name = item.text().split(" - ")[0]
        
        reviews = f"""
â­â­â­â­â­ <b>RagnarUser2024</b> - Il y a 2 jours<br>
"Excellente application ! Interface magnifique et trÃ¨s intuitive."<br><br>

â­â­â­â­ <b>TechExpert</b> - Il y a 1 semaine<br>
"TrÃ¨s bon travail, quelques bugs mineurs mais dans l'ensemble parfait."<br><br>

â­â­â­â­â­ <b>CreativeUser</b> - Il y a 2 semaines<br>
"RÃ©volutionnaire ! Cette app a changÃ© ma faÃ§on de travailler."<br><br>

â­â­â­â­â­ <b>DevMaster</b> - Il y a 1 mois<br>
"Indispensable pour tout utilisateur Ragnar OS. Bravo aux dÃ©veloppeurs !"
        """
        
        QtWidgets.QMessageBox.information(dialog, f"â­ Avis - {app_name}", reviews)
    
    def show_widget_manager(self):
        """Gestionnaire de widgets de bureau - Nouvelle fonctionnalitÃ© 26.3.3"""
        d = GlassDialog("ðŸ“± Gestionnaire de Widgets", (700, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Widgets de Bureau", "Ajoutez des widgets interactifs sur votre bureau")
        lay.addWidget(header)
        
        # Liste des widgets disponibles
        widgets_widget = QtWidgets.QWidget(objectName="GlassCard")
        widgets_layout = QtWidgets.QVBoxLayout(widgets_widget)
        widgets_layout.setContentsMargins(16, 16, 16, 16)
        
        widgets_list = QtWidgets.QListWidget()
        widgets_list.setObjectName("GlassCard")
        
        available_widgets = [
            "ðŸŒ¤ï¸ MÃ©tÃ©o Temps RÃ©el - PrÃ©visions mÃ©tÃ©o avec animations",
            "ðŸ• Horloge Mondiale - Fuseaux horaires multiples",
            "ðŸ“Š Moniteur SystÃ¨me - CPU, RAM, rÃ©seau en temps rÃ©el",
            "ðŸ“ Notes Rapides - Post-it virtuels sur le bureau",
            "ðŸ“… Calendrier - Ã‰vÃ©nements et rappels",
            "ðŸŽµ Mini Lecteur - ContrÃ´les audio compacts",
            "ðŸ“ˆ Crypto Tracker - Cours des cryptomonnaies",
            "ðŸ”‹ Batterie - Statut de la batterie (simulation)",
            "ðŸ“¡ RÃ©seau - Vitesse de connexion",
            "ðŸŽ¯ Raccourcis - Applications favorites",
        ]
        
        for widget in available_widgets:
            widgets_list.addItem(widget)
        
        widgets_layout.addWidget(QtWidgets.QLabel("ðŸ“± Widgets Disponibles :"))
        widgets_layout.addWidget(widgets_list)
        
        # Boutons de gestion
        buttons_layout = QtWidgets.QHBoxLayout()
        add_btn = QtWidgets.QPushButton("âž• Ajouter au Bureau")
        preview_btn = QtWidgets.QPushButton("ðŸ‘ï¸ AperÃ§u")
        config_btn = QtWidgets.QPushButton("âš™ï¸ Configurer")
        
        add_btn.clicked.connect(lambda: self.add_widget_to_desktop(widgets_list.currentItem(), d))
        preview_btn.clicked.connect(lambda: self.preview_widget(widgets_list.currentItem(), d))
        config_btn.clicked.connect(lambda: self.configure_widget(widgets_list.currentItem(), d))
        
        buttons_layout.addWidget(add_btn)
        buttons_layout.addWidget(preview_btn)
        buttons_layout.addWidget(config_btn)
        buttons_layout.addStretch()
        
        widgets_layout.addLayout(buttons_layout)
        lay.addWidget(widgets_widget)
        
        # Widgets actifs
        active_widget = QtWidgets.QWidget(objectName="GlassCard")
        active_layout = QtWidgets.QVBoxLayout(active_widget)
        active_layout.setContentsMargins(16, 16, 16, 16)
        
        active_list = QtWidgets.QListWidget()
        active_list.setObjectName("GlassCard")
        
        # Widgets dÃ©jÃ  sur le bureau
        active_widgets = [
            "ðŸŒ¤ï¸ MÃ©tÃ©o Paris - Position: (50, 50)",
            "ðŸ• Horloge Mondiale - Position: (300, 50)",
            "ðŸ“Š Moniteur SystÃ¨me - Position: (50, 200)",
        ]
        
        for widget in active_widgets:
            active_list.addItem(widget)
        
        active_layout.addWidget(QtWidgets.QLabel("ðŸ–¥ï¸ Widgets sur le Bureau :"))
        active_layout.addWidget(active_list)
        
        # Boutons pour widgets actifs
        active_buttons = QtWidgets.QHBoxLayout()
        remove_btn = QtWidgets.QPushButton("ðŸ—‘ï¸ Supprimer")
        move_btn = QtWidgets.QPushButton("ðŸ“ DÃ©placer")
        
        remove_btn.clicked.connect(lambda: self.remove_widget(active_list.currentItem(), d))
        move_btn.clicked.connect(lambda: self.move_widget(active_list.currentItem(), d))
        
        active_buttons.addWidget(remove_btn)
        active_buttons.addWidget(move_btn)
        active_buttons.addStretch()
        
        active_layout.addLayout(active_buttons)
        lay.addWidget(active_widget)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def add_widget_to_desktop(self, item, dialog):
        """Ajoute un widget au bureau"""
        if not item:
            return
        widget_name = item.text().split(" - ")[0]
        QtWidgets.QMessageBox.information(dialog, "âž• Widget AjoutÃ©", f"Widget '{widget_name}' ajoutÃ© au bureau !\n\nVous pouvez le dÃ©placer en faisant glisser.")
    
    def preview_widget(self, item, dialog):
        """AperÃ§u d'un widget"""
        if not item:
            return
        widget_name = item.text().split(" - ")[0]
        
        preview_dialog = GlassDialog(f"ðŸ‘ï¸ AperÃ§u - {widget_name}", (300, 200), dialog)
        preview_layout = QtWidgets.QVBoxLayout(preview_dialog)
        
        if "MÃ©tÃ©o" in widget_name:
            preview_content = QtWidgets.QLabel("ðŸŒ¤ï¸ Paris\n18Â°C\nPartiellement nuageux\nHumiditÃ©: 65%")
        elif "Horloge" in widget_name:
            preview_content = QtWidgets.QLabel("ðŸ• 15:30:45\nðŸŒ Paris\nðŸ—½ New York: 09:30\nðŸ—¾ Tokyo: 23:30")
        elif "Moniteur" in widget_name:
            preview_content = QtWidgets.QLabel("ðŸ“Š SystÃ¨me\nCPU: 45%\nRAM: 62%\nRÃ©seau: â†“125MB/s â†‘45MB/s")
        else:
            preview_content = QtWidgets.QLabel(f"AperÃ§u de {widget_name}\nContenu interactif")
        
        preview_content.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        preview_content.setStyleSheet("padding: 20px; font-size: 12px;")
        preview_layout.addWidget(preview_content)
        
        preview_dialog.show()
    
    def configure_widget(self, item, dialog):
        """Configure un widget"""
        if not item:
            return
        widget_name = item.text().split(" - ")[0]
        QtWidgets.QMessageBox.information(dialog, "âš™ï¸ Configuration", f"Configuration de '{widget_name}' :\n\nâ€¢ Position sur le bureau\nâ€¢ Taille du widget\nâ€¢ FrÃ©quence de mise Ã  jour\nâ€¢ Couleurs et transparence")
    
    def remove_widget(self, item, dialog):
        """Supprime un widget du bureau"""
        if not item:
            return
        widget_name = item.text().split(" - ")[0]
        QtWidgets.QMessageBox.information(dialog, "ðŸ—‘ï¸ Widget SupprimÃ©", f"Widget '{widget_name}' supprimÃ© du bureau !")
    
    def move_widget(self, item, dialog):
        """DÃ©place un widget sur le bureau"""
        if not item:
            return
        widget_name = item.text().split(" - ")[0]
        QtWidgets.QMessageBox.information(dialog, "ðŸ“ DÃ©placement", f"Mode dÃ©placement activÃ© pour '{widget_name}' !\n\nCliquez sur le bureau pour choisir la nouvelle position.")
    
    def show_notification_center(self):
        """Centre de notifications - Nouvelle fonctionnalitÃ© 26.3.3"""
        d = GlassDialog("ðŸ”” Centre de Notifications", (600, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Centre de Notifications", "GÃ©rez toutes vos notifications en un endroit")
        lay.addWidget(header)
        
        # Onglets de notifications
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet RÃ©centes
        recent_tab = QtWidgets.QWidget()
        recent_layout = QtWidgets.QVBoxLayout(recent_tab)
        
        recent_list = QtWidgets.QListWidget()
        recent_list.setObjectName("GlassCard")
        
        # Notifications rÃ©centes
        recent_notifications = [
            "ðŸ”„ Mise Ã  jour disponible - Ragnar OS 26.3.1 (Il y a 5 min)",
            "ðŸ“¦ Installation terminÃ©e - RagnarCraft.rapp (Il y a 15 min)",
            "ðŸŒ¤ï¸ MÃ©tÃ©o - Pluie prÃ©vue cet aprÃ¨s-midi (Il y a 30 min)",
            "ðŸ’¬ Nouveau message - RagnarLink (Il y a 1h)",
            "ðŸ” Connexion sÃ©curisÃ©e - VPN activÃ© (Il y a 2h)",
            "ðŸ“Š Rapport systÃ¨me - Optimisation recommandÃ©e (Il y a 3h)",
            "ðŸŽµ Lecture terminÃ©e - Playlist Ragnar (Il y a 4h)",
        ]
        
        for notif in recent_notifications:
            recent_list.addItem(notif)
        
        recent_layout.addWidget(QtWidgets.QLabel("ðŸ”” Notifications RÃ©centes :"))
        recent_layout.addWidget(recent_list)
        
        # Boutons pour notifications rÃ©centes
        recent_buttons = QtWidgets.QHBoxLayout()
        mark_read_btn = QtWidgets.QPushButton("âœ… Marquer comme lu")
        delete_btn = QtWidgets.QPushButton("ðŸ—‘ï¸ Supprimer")
        clear_all_btn = QtWidgets.QPushButton("ðŸ§¹ Tout effacer")
        
        mark_read_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âœ… Lu", "Notification marquÃ©e comme lue !"))
        delete_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ—‘ï¸ SupprimÃ©", "Notification supprimÃ©e !"))
        clear_all_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ§¹ EffacÃ©", "Toutes les notifications ont Ã©tÃ© effacÃ©es !"))
        
        recent_buttons.addWidget(mark_read_btn)
        recent_buttons.addWidget(delete_btn)
        recent_buttons.addWidget(clear_all_btn)
        recent_buttons.addStretch()
        
        recent_layout.addLayout(recent_buttons)
        
        # Onglet ParamÃ¨tres
        settings_tab = QtWidgets.QWidget()
        settings_layout = QtWidgets.QVBoxLayout(settings_tab)
        
        settings_widget = QtWidgets.QWidget(objectName="GlassCard")
        settings_widget_layout = QtWidgets.QVBoxLayout(settings_widget)
        settings_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        # ParamÃ¨tres de notifications
        settings_widget_layout.addWidget(QtWidgets.QLabel("âš™ï¸ ParamÃ¨tres de Notifications :"))
        
        enable_notifications = QtWidgets.QCheckBox("ðŸ”” Activer les notifications")
        enable_notifications.setChecked(True)
        
        enable_sounds = QtWidgets.QCheckBox("ðŸ”Š Sons de notification")
        enable_sounds.setChecked(True)
        
        enable_popup = QtWidgets.QCheckBox("ðŸ’¬ Notifications popup")
        enable_popup.setChecked(True)
        
        do_not_disturb = QtWidgets.QCheckBox("ðŸŒ™ Mode Ne pas dÃ©ranger")
        do_not_disturb.setChecked(False)
        
        settings_widget_layout.addWidget(enable_notifications)
        settings_widget_layout.addWidget(enable_sounds)
        settings_widget_layout.addWidget(enable_popup)
        settings_widget_layout.addWidget(do_not_disturb)
        
        # Applications autorisÃ©es
        settings_widget_layout.addWidget(QtWidgets.QLabel("\nðŸ“± Notifications par Application :"))
        
        app_notifications = [
            ("ðŸ”„ Mises Ã  jour systÃ¨me", True),
            ("ðŸ“¦ Gestionnaire .rapp", True),
            ("ðŸŒ¤ï¸ Widget MÃ©tÃ©o", True),
            ("ðŸ’¬ RagnarLink", False),
            ("ðŸŽµ Lecteur Audio", True),
            ("ðŸ“Š Moniteur SystÃ¨me", False),
        ]
        
        for app_name, enabled in app_notifications:
            app_cb = QtWidgets.QCheckBox(app_name)
            app_cb.setChecked(enabled)
            settings_widget_layout.addWidget(app_cb)
        
        settings_layout.addWidget(settings_widget)
        
        # Ajouter les onglets
        tabs.addTab(recent_tab, "ðŸ”” RÃ©centes")
        tabs.addTab(settings_tab, "âš™ï¸ ParamÃ¨tres")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def show_ragnar_cloud(self):
        """Ragnar Cloud - Nouvelle fonctionnalitÃ© 26.3.3"""
        d = GlassDialog("â˜ï¸ Ragnar Cloud", (700, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Ragnar Cloud", "Synchronisez vos donnÃ©es entre tous vos appareils Ragnar")
        lay.addWidget(header)
        
        # Onglets Cloud
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Synchronisation
        sync_tab = QtWidgets.QWidget()
        sync_layout = QtWidgets.QVBoxLayout(sync_tab)
        
        # Statut de synchronisation
        status_widget = QtWidgets.QWidget(objectName="GlassCard")
        status_layout = QtWidgets.QVBoxLayout(status_widget)
        status_layout.setContentsMargins(16, 16, 16, 16)
        
        status_layout.addWidget(QtWidgets.QLabel("â˜ï¸ Statut de Synchronisation :"))
        
        sync_status = QtWidgets.QLabel("ðŸŸ¢ ConnectÃ© - DerniÃ¨re sync: Il y a 2 minutes")
        sync_status.setStyleSheet("color: #00ff88; font-weight: bold; padding: 10px;")
        status_layout.addWidget(sync_status)
        
        # DonnÃ©es synchronisÃ©es
        sync_data = [
            ("âš™ï¸ ParamÃ¨tres systÃ¨me", "âœ… SynchronisÃ©", "1.2 KB"),
            ("ðŸŽ¨ ThÃ¨mes personnalisÃ©s", "âœ… SynchronisÃ©", "45.6 KB"),
            ("ðŸ“± Configuration widgets", "âœ… SynchronisÃ©", "8.3 KB"),
            ("ðŸ“¦ Applications .rapp", "ðŸ”„ En cours...", "156.7 MB"),
            ("ðŸ“ Documents utilisateur", "âœ… SynchronisÃ©", "2.1 GB"),
            ("ðŸ” Mots de passe", "âœ… SynchronisÃ© (chiffrÃ©)", "12.4 KB"),
        ]
        
        for data_type, status, size in sync_data:
            data_layout = QtWidgets.QHBoxLayout()
            data_layout.addWidget(QtWidgets.QLabel(data_type))
            data_layout.addStretch()
            data_layout.addWidget(QtWidgets.QLabel(status))
            data_layout.addWidget(QtWidgets.QLabel(size))
            status_layout.addLayout(data_layout)
        
        sync_layout.addWidget(status_widget)
        
        # Boutons de synchronisation
        sync_buttons = QtWidgets.QHBoxLayout()
        sync_now_btn = QtWidgets.QPushButton("ðŸ”„ Synchroniser maintenant")
        force_sync_btn = QtWidgets.QPushButton("âš¡ Synchronisation forcÃ©e")
        
        sync_now_btn.clicked.connect(lambda: self.start_cloud_sync(d))
        force_sync_btn.clicked.connect(lambda: self.force_cloud_sync(d))
        
        sync_buttons.addWidget(sync_now_btn)
        sync_buttons.addWidget(force_sync_btn)
        sync_buttons.addStretch()
        
        sync_layout.addLayout(sync_buttons)
        
        # Onglet Appareils
        devices_tab = QtWidgets.QWidget()
        devices_layout = QtWidgets.QVBoxLayout(devices_tab)
        
        devices_widget = QtWidgets.QWidget(objectName="GlassCard")
        devices_widget_layout = QtWidgets.QVBoxLayout(devices_widget)
        devices_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        devices_widget_layout.addWidget(QtWidgets.QLabel("ðŸ“± Appareils ConnectÃ©s :"))
        
        devices_list = QtWidgets.QListWidget()
        devices_list.setObjectName("GlassCard")
        
        connected_devices = [
            "ðŸ’» Ragnar-Desktop-01 (Cet appareil) - En ligne",
            "ðŸ“± Ragnar-Mobile-Alpha - DerniÃ¨re connexion: Il y a 1h",
            "ðŸ–¥ï¸ Ragnar-Workstation - DerniÃ¨re connexion: Il y a 3h",
            "ðŸ’¾ Ragnar-Server-Home - En ligne",
        ]
        
        for device in connected_devices:
            devices_list.addItem(device)
        
        devices_widget_layout.addWidget(devices_list)
        
        # Boutons appareils
        device_buttons = QtWidgets.QHBoxLayout()
        add_device_btn = QtWidgets.QPushButton("âž• Ajouter appareil")
        remove_device_btn = QtWidgets.QPushButton("ðŸ—‘ï¸ Supprimer")
        
        add_device_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âž• Appareil", "Code de jumelage: RGN-2024-XYZ\n\nEntrez ce code sur votre autre appareil Ragnar."))
        remove_device_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ—‘ï¸ Suppression", "Appareil supprimÃ© de Ragnar Cloud !"))
        
        device_buttons.addWidget(add_device_btn)
        device_buttons.addWidget(remove_device_btn)
        device_buttons.addStretch()
        
        devices_widget_layout.addLayout(device_buttons)
        devices_layout.addWidget(devices_widget)
        
        # Onglet Stockage
        storage_tab = QtWidgets.QWidget()
        storage_layout = QtWidgets.QVBoxLayout(storage_tab)
        
        storage_widget = QtWidgets.QWidget(objectName="GlassCard")
        storage_widget_layout = QtWidgets.QVBoxLayout(storage_widget)
        storage_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        storage_widget_layout.addWidget(QtWidgets.QLabel("ðŸ’¾ Espace de Stockage Cloud :"))
        
        # Barre de progression du stockage
        storage_progress = QtWidgets.QProgressBar()
        storage_progress.setValue(65)
        storage_progress.setFormat("6.5 GB utilisÃ©s sur 10 GB (65%)")
        storage_widget_layout.addWidget(storage_progress)
        
        storage_info = QtWidgets.QLabel("""
ðŸ“Š RÃ©partition du stockage :
â€¢ ðŸ“ Documents: 3.2 GB
â€¢ ðŸŽµ MultimÃ©dia: 2.1 GB  
â€¢ ðŸ“¦ Applications: 0.8 GB
â€¢ âš™ï¸ ParamÃ¨tres: 0.4 GB
        """)
        storage_widget_layout.addWidget(storage_info)
        
        # Boutons stockage
        storage_buttons = QtWidgets.QHBoxLayout()
        upgrade_btn = QtWidgets.QPushButton("â¬†ï¸ Augmenter l'espace")
        clean_btn = QtWidgets.QPushButton("ðŸ§¹ Nettoyer")
        
        upgrade_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "â¬†ï¸ Upgrade", "Plans disponibles :\n\nâ€¢ 50 GB - 2.99â‚¬/mois\nâ€¢ 200 GB - 9.99â‚¬/mois\nâ€¢ 1 TB - 19.99â‚¬/mois"))
        clean_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ§¹ Nettoyage", "Nettoyage terminÃ© !\n\nâ€¢ 245 MB libÃ©rÃ©s\nâ€¢ Fichiers temporaires supprimÃ©s"))
        
        storage_buttons.addWidget(upgrade_btn)
        storage_buttons.addWidget(clean_btn)
        storage_buttons.addStretch()
        
        storage_widget_layout.addLayout(storage_buttons)
        storage_layout.addWidget(storage_widget)
        
        # Ajouter les onglets
        tabs.addTab(sync_tab, "ðŸ”„ Synchronisation")
        tabs.addTab(devices_tab, "ðŸ“± Appareils")
        tabs.addTab(storage_tab, "ðŸ’¾ Stockage")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def start_cloud_sync(self, dialog):
        """DÃ©marre la synchronisation cloud"""
        progress = QtWidgets.QProgressDialog("Synchronisation avec Ragnar Cloud...", "Annuler", 0, 100, dialog)
        progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
        progress.show()
        
        for i in range(101):
            progress.setValue(i)
            progress.setLabelText(f"Synchronisation... {i}%")
            QtWidgets.QApplication.processEvents()
            time.sleep(0.03)
            if progress.wasCanceled():
                return
        
        QtWidgets.QMessageBox.information(dialog, "âœ… Synchronisation", "Synchronisation terminÃ©e avec succÃ¨s !\n\nToutes vos donnÃ©es sont Ã  jour sur le cloud.")
    
    def force_cloud_sync(self, dialog):
        """Force la synchronisation cloud"""
        QtWidgets.QMessageBox.information(dialog, "âš¡ Synchronisation ForcÃ©e", "Synchronisation forcÃ©e lancÃ©e !\n\nToutes les donnÃ©es seront re-synchronisÃ©es, mÃªme celles dÃ©jÃ  Ã  jour.")
    
    def show_games_center(self):
        """Games Center - Nouvelle fonctionnalitÃ© 26.3.3"""
        d = GlassDialog("ðŸŽ® Ragnar Games Center", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("Games Center", "DÃ©couvrez et jouez aux meilleurs jeux Ragnar")
        lay.addWidget(header)
        
        # Onglets Games
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Jeux Populaires
        games_tab = QtWidgets.QWidget()
        games_layout = QtWidgets.QVBoxLayout(games_tab)
        
        games_list = QtWidgets.QListWidget()
        games_list.setObjectName("GlassCard")
        
        popular_games = [
            "ðŸŽ® RagnarCraft - Jeu de construction 3D â­â­â­â­â­ (4.9/5)",
            "ðŸŽï¸ RagnarRacer - Course futuriste â­â­â­â­ (4.7/5)",
            "ðŸ§© RagnarPuzzle - Casse-tÃªtes logiques â­â­â­â­â­ (4.8/5)",
            "âš”ï¸ RagnarQuest - RPG Ã©pique â­â­â­â­ (4.6/5)",
            "ðŸŽ¯ RagnarArcade - Mini-jeux rÃ©tro â­â­â­â­â­ (4.9/5)",
            "ðŸŒŒ RagnarSpace - Exploration spatiale â­â­â­â­ (4.5/5)",
        ]
        
        for game in popular_games:
            games_list.addItem(game)
        
        games_layout.addWidget(QtWidgets.QLabel("ðŸ”¥ Jeux Populaires :"))
        games_layout.addWidget(games_list)
        
        # Boutons jeux
        games_buttons = QtWidgets.QHBoxLayout()
        play_btn = QtWidgets.QPushButton("â–¶ï¸ Jouer")
        install_btn = QtWidgets.QPushButton("ðŸ“¦ Installer")
        leaderboard_btn = QtWidgets.QPushButton("ðŸ† Classements")
        
        play_btn.clicked.connect(lambda: self.launch_game(games_list.currentItem(), d))
        install_btn.clicked.connect(lambda: self.install_game(games_list.currentItem(), d))
        leaderboard_btn.clicked.connect(lambda: self.show_leaderboard(games_list.currentItem(), d))
        
        games_buttons.addWidget(play_btn)
        games_buttons.addWidget(install_btn)
        games_buttons.addWidget(leaderboard_btn)
        games_buttons.addStretch()
        
        games_layout.addLayout(games_buttons)
        
        # Onglet Achievements
        achievements_tab = QtWidgets.QWidget()
        achievements_layout = QtWidgets.QVBoxLayout(achievements_tab)
        
        achievements_widget = QtWidgets.QWidget(objectName="GlassCard")
        achievements_widget_layout = QtWidgets.QVBoxLayout(achievements_widget)
        achievements_widget_layout.setContentsMargins(16, 16, 16, 16)
        
        achievements_widget_layout.addWidget(QtWidgets.QLabel("ðŸ† Vos Achievements :"))
        
        achievements_list = QtWidgets.QListWidget()
        achievements_list.setObjectName("GlassCard")
        
        user_achievements = [
            "ðŸ¥‡ Premier Pas - LancÃ© votre premier jeu Ragnar",
            "ðŸŽ¯ PrÃ©cision - 100% de rÃ©ussite dans RagnarArcade",
            "ðŸ—ï¸ Architecte - Construit 50 structures dans RagnarCraft",
            "âš¡ Vitesse - TerminÃ© RagnarRacer en moins de 2 minutes",
            "ðŸ§  GÃ©nie - RÃ©solu tous les puzzles de niveau Expert",
            "ðŸŒŸ Collectionneur - DÃ©bloquÃ© 25 achievements",
        ]
        
        for achievement in user_achievements:
            achievements_list.addItem(achievement)
        
        achievements_widget_layout.addWidget(achievements_list)
        
        # Stats du joueur
        stats_info = QtWidgets.QLabel("""
ðŸ“Š Statistiques du Joueur :
â€¢ ðŸŽ® Jeux jouÃ©s : 12
â€¢ â±ï¸ Temps de jeu total : 45h 32m
â€¢ ðŸ† Achievements dÃ©bloquÃ©s : 25/50
â€¢ ðŸ¥‡ Classement global : #1,247
        """)
        achievements_widget_layout.addWidget(stats_info)
        
        achievements_layout.addWidget(achievements_widget)
        
        # Ajouter les onglets
        tabs.addTab(games_tab, "ðŸŽ® Jeux")
        tabs.addTab(achievements_tab, "ðŸ† Achievements")
        
        lay.addWidget(tabs)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def launch_game(self, item, dialog):
        """Lance un jeu"""
        if not item:
            return
        game_name = item.text().split(" - ")[0]
        
        # Simulation de lancement
        progress = QtWidgets.QProgressDialog(f"Lancement de {game_name}...", "Annuler", 0, 100, dialog)
        progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
        progress.show()
        
        for i in range(101):
            progress.setValue(i)
            QtWidgets.QApplication.processEvents()
            time.sleep(0.02)
            if progress.wasCanceled():
                return
        
        QtWidgets.QMessageBox.information(dialog, "ðŸŽ® Jeu LancÃ©", f"{game_name} lancÃ© avec succÃ¨s !\n\nAmusez-vous bien ! ðŸŽ‰")
    
    def install_game(self, item, dialog):
        """Installe un jeu"""
        if not item:
            return
        game_name = item.text().split(" - ")[0]
        QtWidgets.QMessageBox.information(dialog, "ðŸ“¦ Installation", f"Installation de {game_name} dÃ©marrÃ©e !\n\nLe jeu sera disponible dans quelques minutes.")
    
    def show_leaderboard(self, item, dialog):
        """Affiche le classement d'un jeu"""
        if not item:
            return
        game_name = item.text().split(" - ")[0]
        
        leaderboard = f"""
ðŸ† <b>Classement - {game_name}</b><br><br>
ðŸ¥‡ 1. RagnarMaster - 98,450 pts<br>
ðŸ¥ˆ 2. GameLegend - 95,230 pts<br>
ðŸ¥‰ 3. ProGamer2024 - 92,180 pts<br>
4. SpeedRunner - 89,760 pts<br>
5. <b>Vous</b> - 87,340 pts<br>
6. CasualPlayer - 85,120 pts<br>
7. RetroFan - 82,900 pts<br>
        """
        
        QtWidgets.QMessageBox.information(dialog, f"ðŸ† Classement - {game_name}", leaderboard)
    
    def show_ai_assistant(self):
        """AI Assistant 2.0 - Nouvelle fonctionnalitÃ© 26.3.3"""
        d = GlassDialog("ðŸ¤– Ragnar AI Assistant 2.0", (700, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        header = make_header("AI Assistant 2.0", "Votre assistant intelligent personnel")
        lay.addWidget(header)
        
        # Zone de conversation
        chat_widget = QtWidgets.QWidget(objectName="GlassCard")
        chat_layout = QtWidgets.QVBoxLayout(chat_widget)
        chat_layout.setContentsMargins(16, 16, 16, 16)
        
        # Affichage de la conversation
        self.ai_chat_display = QtWidgets.QTextEdit()
        self.ai_chat_display.setReadOnly(True)
        self.ai_chat_display.setObjectName("GlassCard")
        self.ai_chat_display.setMaximumHeight(300)
        
        # Messages d'accueil
        welcome_messages = [
            "ðŸ¤– <b>Ragnar AI 2.0:</b> Bonjour ! Je suis votre assistant IA amÃ©liorÃ©. Comment puis-je vous aider aujourd'hui ?",
            "ðŸ’¡ <b>Suggestions:</b> Demandez-moi d'optimiser votre systÃ¨me, de gÃ©rer vos fichiers, ou de vous aider avec vos applications !",
        ]
        
        for msg in welcome_messages:
            self.ai_chat_display.append(msg)
        
        chat_layout.addWidget(QtWidgets.QLabel("ðŸ’¬ Conversation avec l'IA :"))
        chat_layout.addWidget(self.ai_chat_display)
        
        # Zone de saisie
        input_layout = QtWidgets.QHBoxLayout()
        self.ai_input = QtWidgets.QLineEdit()
        self.ai_input.setPlaceholderText("Tapez votre question ou commande...")
        send_btn = QtWidgets.QPushButton("ðŸ“¤ Envoyer")
        
        input_layout.addWidget(self.ai_input)
        input_layout.addWidget(send_btn)
        
        chat_layout.addLayout(input_layout)
        lay.addWidget(chat_widget)
        
        # FonctionnalitÃ©s IA
        features_widget = QtWidgets.QWidget(objectName="GlassCard")
        features_layout = QtWidgets.QVBoxLayout(features_widget)
        features_layout.setContentsMargins(16, 16, 16, 16)
        
        features_layout.addWidget(QtWidgets.QLabel("ðŸš€ FonctionnalitÃ©s IA 2.0 :"))
        
        # Boutons de fonctionnalitÃ©s rapides
        features_buttons = QtWidgets.QGridLayout()
        
        quick_actions = [
            ("ðŸ”§ Optimiser SystÃ¨me", lambda: self.ai_optimize_system(d)),
            ("ðŸ“ Organiser Fichiers", lambda: self.ai_organize_files(d)),
            ("ðŸŽ¨ SuggÃ©rer ThÃ¨me", lambda: self.ai_suggest_theme(d)),
            ("ðŸ“Š Rapport SystÃ¨me", lambda: self.ai_system_report(d)),
            ("ðŸ” Recherche Intelligente", lambda: self.ai_smart_search(d)),
            ("ðŸ’¡ Conseils ProductivitÃ©", lambda: self.ai_productivity_tips(d)),
        ]
        
        row, col = 0, 0
        for action_name, action_func in quick_actions:
            btn = QtWidgets.QPushButton(action_name)
            btn.clicked.connect(action_func)
            features_buttons.addWidget(btn, row, col)
            col += 1
            if col >= 2:
                col = 0
                row += 1
        
        features_layout.addLayout(features_buttons)
        lay.addWidget(features_widget)
        
        # Connecter les Ã©vÃ©nements
        send_btn.clicked.connect(lambda: self.send_ai_message(d))
        self.ai_input.returnPressed.connect(lambda: self.send_ai_message(d))
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def show_photo_gallery(self):
        """Galerie Photos simple"""
        d = GlassDialog("ðŸ“· Galerie Photos", (900, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        lay.setSpacing(12)
        lay.setContentsMargins(16, 16, 16, 16)
        header = make_header("Galerie Photos", "Parcourir et prÃ©visualiser vos images")
        lay.addWidget(header)
        grid = QtWidgets.QGridLayout()
        grid.setHorizontalSpacing(10)
        grid.setVerticalSpacing(10)
        # Dans sandbox mÃ©moire: proposer une liste par dÃ©faut
        samples = ["image1.jpg", "image2.png", "vacances.png", "portrait.jpg", "montagne.jpg", "ville.png"]
        row, col = 0, 0
        for name in samples:
            card = QtWidgets.QWidget(objectName="GlassCard")
            v = QtWidgets.QVBoxLayout(card)
            v.setContentsMargins(8, 8, 8, 8)
            lbl = QtWidgets.QLabel("ðŸ–¼ï¸")
            lbl.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            lbl.setStyleSheet("font-size: 48px;")
            cap = QtWidgets.QLabel(name)
            cap.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
            v.addWidget(lbl)
            v.addWidget(cap)
            btn = QtWidgets.QPushButton("ðŸ‘ï¸ AperÃ§u")
            def make_preview(n):
                return lambda: QtWidgets.QMessageBox.information(d, "AperÃ§u", f"PrÃ©visualisation de {n}\n(Sandbox mÃ©moire active)")
            btn.clicked.connect(make_preview(name))
            v.addWidget(btn)
            grid.addWidget(card, row, col)
            col += 1
            if col >= 3:
                col = 0
                row += 1
        lay.addLayout(grid)
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        d.show()
    
    def send_ai_message(self, dialog):
        """Envoie un message Ã  l'IA"""
        message = self.ai_input.text().strip()
        if not message:
            return
        
        # Afficher le message utilisateur
        self.ai_chat_display.append(f"ðŸ‘¤ <b>Vous:</b> {message}")
        self.ai_input.clear()
        
        # RÃ©ponses IA intelligentes
        ai_responses = {
            "optimiser": "ðŸ”§ <b>Ragnar AI:</b> J'ai analysÃ© votre systÃ¨me. Je recommande de nettoyer 1.2 GB de fichiers temporaires et de dÃ©fragmenter le disque.",
            "fichiers": "ðŸ“ <b>Ragnar AI:</b> J'ai trouvÃ© 45 fichiers en double et 12 dossiers dÃ©sorganisÃ©s. Voulez-vous que je les organise automatiquement ?",
            "thÃ¨me": "ðŸŽ¨ <b>Ragnar AI:</b> BasÃ© sur votre utilisation, je suggÃ¨re le thÃ¨me 'Cyberpunk' pour une expÃ©rience plus immersive.",
            "aide": "ðŸ’¡ <b>Ragnar AI:</b> Je peux vous aider avec l'optimisation systÃ¨me, l'organisation de fichiers, les suggestions de thÃ¨mes, et bien plus !",
            "bonjour": "ðŸ‘‹ <b>Ragnar AI:</b> Bonjour ! Ravi de vous revoir. Comment puis-je amÃ©liorer votre expÃ©rience Ragnar aujourd'hui ?",
            "merci": "ðŸ˜Š <b>Ragnar AI:</b> De rien ! C'est un plaisir de vous aider. N'hÃ©sitez pas si vous avez d'autres questions !",
        }
        
        # Trouver une rÃ©ponse appropriÃ©e
        response = "ðŸ¤– <b>Ragnar AI:</b> C'est une excellente question ! Je traite votre demande avec mes algorithmes avancÃ©s. Ragnar OS 26.3.3 offre des possibilitÃ©s infinies !"
        
        for keyword, ai_response in ai_responses.items():
            if keyword.lower() in message.lower():
                response = ai_response
                break
        
        # DÃ©lai pour simuler la rÃ©flexion IA
        QtCore.QTimer.singleShot(1500, lambda: self.ai_chat_display.append(response))
    
    def ai_optimize_system(self, dialog):
        """Optimisation systÃ¨me par IA"""
        QtWidgets.QMessageBox.information(dialog, "ðŸ”§ Optimisation IA", "Optimisation systÃ¨me terminÃ©e !\n\nâ€¢ 1.2 GB de fichiers temporaires supprimÃ©s\nâ€¢ RAM optimisÃ©e (+15% de performance)\nâ€¢ 23 processus inutiles fermÃ©s\nâ€¢ Registre nettoyÃ©")
    
    def ai_organize_files(self, dialog):
        """Organisation de fichiers par IA"""
        QtWidgets.QMessageBox.information(dialog, "ðŸ“ Organisation IA", "Organisation intelligente terminÃ©e !\n\nâ€¢ 156 fichiers classÃ©s par type\nâ€¢ 12 dossiers crÃ©Ã©s automatiquement\nâ€¢ 45 doublons supprimÃ©s\nâ€¢ Structure optimisÃ©e")
    
    def ai_suggest_theme(self, dialog):
        """Suggestion de thÃ¨me par IA"""
        themes = ["ðŸŒŒ Verre Noir", "ðŸŒ† Cyberpunk", "ðŸŒ¿ Nature", "ðŸŒŒ Espace", "â˜€ï¸ LumiÃ¨re"]
        suggested_theme = random.choice(themes)
        QtWidgets.QMessageBox.information(dialog, "ðŸŽ¨ Suggestion IA", f"BasÃ© sur votre utilisation, je recommande le thÃ¨me :\n\n{suggested_theme}\n\nCe thÃ¨me correspond parfaitement Ã  vos habitudes d'utilisation !")
    
    def ai_system_report(self, dialog):
        """Rapport systÃ¨me par IA"""
        QtWidgets.QMessageBox.information(dialog, "ðŸ“Š Rapport IA", "Rapport systÃ¨me gÃ©nÃ©rÃ© !\n\nðŸŸ¢ Ã‰tat gÃ©nÃ©ral : Excellent\nðŸ“Š Performance : 94/100\nðŸ”’ SÃ©curitÃ© : Optimale\nðŸ’¾ Stockage : 73% utilisÃ©\nðŸŒ RÃ©seau : Stable\n\nRecommandations : Aucune action requise.")
    
    def ai_smart_search(self, dialog):
        """Recherche intelligente par IA"""
        QtWidgets.QMessageBox.information(dialog, "ðŸ” Recherche IA", "Recherche intelligente activÃ©e !\n\nJe peux maintenant :\nâ€¢ Comprendre vos requÃªtes en langage naturel\nâ€¢ Rechercher dans tous vos fichiers\nâ€¢ SuggÃ©rer des rÃ©sultats pertinents\nâ€¢ Apprendre de vos habitudes")
    
    def ai_productivity_tips(self, dialog):
        """Conseils de productivitÃ© par IA"""
        tips = [
            "Utilisez les widgets mÃ©tÃ©o pour planifier votre journÃ©e",
            "Organisez vos applications .rapp par catÃ©gories",
            "Activez les notifications intelligentes",
            "Synchronisez vos donnÃ©es avec Ragnar Cloud",
            "Personnalisez vos thÃ¨mes selon l'heure"
        ]
        tip = random.choice(tips)
        QtWidgets.QMessageBox.information(dialog, "ðŸ’¡ Conseil IA", f"Conseil productivitÃ© du jour :\n\n{tip}\n\nCela pourrait amÃ©liorer votre efficacitÃ© de 25% !")

    def show_settings(self):
        """Application de paramÃ¨tres Ragnar OS"""
        d = GlassDialog("ðŸ§© ParamÃ¨tres Ragnar", (650, 550), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("ParamÃ¨tres SystÃ¨me", "Personnalisez votre expÃ©rience Ragnar")
        lay.addWidget(header)
        
        # Onglets de paramÃ¨tres
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet Apparence
        appearance_tab = QtWidgets.QWidget()
        appearance_layout = QtWidgets.QVBoxLayout(appearance_tab)
        
        # ThÃ¨me
        theme_group = QtWidgets.QGroupBox("ðŸŽ¨ ThÃ¨me")
        theme_layout = QtWidgets.QVBoxLayout(theme_group)
        
        self.theme_dark = QtWidgets.QRadioButton("ðŸŒ™ ThÃ¨me sombre (actuel)")
        self.theme_light = QtWidgets.QRadioButton("â˜€ï¸ ThÃ¨me clair (bientÃ´t)")
        self.theme_auto = QtWidgets.QRadioButton("ðŸ”„ Automatique (bientÃ´t)")
        
        self.theme_dark.setChecked(True)
        self.theme_light.setEnabled(False)
        self.theme_auto.setEnabled(False)
        
        theme_layout.addWidget(self.theme_dark)
        theme_layout.addWidget(self.theme_light)
        theme_layout.addWidget(self.theme_auto)
        
        # Transparence
        transparency_group = QtWidgets.QGroupBox("ðŸ’Ž Transparence")
        transparency_layout = QtWidgets.QVBoxLayout(transparency_group)
        
        self.transparency_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        self.transparency_slider.setRange(50, 100)
        self.transparency_slider.setValue(85)
        self.transparency_label = QtWidgets.QLabel("OpacitÃ©: 85%")
        
        self.transparency_slider.valueChanged.connect(
            lambda v: self.transparency_label.setText(f"OpacitÃ©: {v}%")
        )
        
        transparency_layout.addWidget(self.transparency_label)
        transparency_layout.addWidget(self.transparency_slider)
        
        appearance_layout.addWidget(theme_group)
        appearance_layout.addWidget(transparency_group)
        appearance_layout.addStretch()
        
        # Onglet SystÃ¨me
        system_tab = QtWidgets.QWidget()
        system_layout = QtWidgets.QVBoxLayout(system_tab)
        
        # DÃ©marrage
        startup_group = QtWidgets.QGroupBox("ðŸš€ DÃ©marrage")
        startup_layout = QtWidgets.QVBoxLayout(startup_group)
        
        self.auto_update_check = QtWidgets.QCheckBox("âœ… VÃ©rifier les mises Ã  jour au dÃ©marrage")
        self.fast_boot_check = QtWidgets.QCheckBox("âš¡ DÃ©marrage rapide")
        self.show_splash_check = QtWidgets.QCheckBox("ðŸŽ¬ Afficher l'Ã©cran de dÃ©marrage")
        
        self.auto_update_check.setChecked(True)
        self.fast_boot_check.setChecked(False)
        self.show_splash_check.setChecked(True)
        
        startup_layout.addWidget(self.auto_update_check)
        startup_layout.addWidget(self.fast_boot_check)
        startup_layout.addWidget(self.show_splash_check)
        
        # Performances
        perf_group = QtWidgets.QGroupBox("âš¡ Performances")
        perf_layout = QtWidgets.QVBoxLayout(perf_group)
        
        self.animations_check = QtWidgets.QCheckBox("ðŸŽ­ Animations activÃ©es")
        self.effects_check = QtWidgets.QCheckBox("âœ¨ Effets visuels")
        self.hardware_accel_check = QtWidgets.QCheckBox("ðŸ–¥ï¸ AccÃ©lÃ©ration matÃ©rielle")
        
        self.animations_check.setChecked(True)
        self.effects_check.setChecked(True)
        self.hardware_accel_check.setChecked(True)
        
        perf_layout.addWidget(self.animations_check)
        perf_layout.addWidget(self.effects_check)
        perf_layout.addWidget(self.hardware_accel_check)
        
        system_layout.addWidget(startup_group)
        system_layout.addWidget(perf_group)
        system_layout.addStretch()
        
        # Onglet Ã€ propos
        about_tab = QtWidgets.QWidget()
        about_layout = QtWidgets.QVBoxLayout(about_tab)
        
        about_info = QtWidgets.QTextEdit()
        about_info.setReadOnly(True)
        about_info.setObjectName("GlassCard")
        about_text = f"""
<h2>ðŸŽ† Ragnar OS 26.3.3</h2>
<p><b>Version:</b> 26.3.3 - Ã‰cosystÃ¨me Complet</p>
<p><b>Build:</b> {time.strftime('%Y%m%d')}</p>
<p><b>Python:</b> {sys.version.split()[0]}</p>
<p><b>Interface:</b> PyQt6</p>

<h3>âœ¨ Nouvelles fonctionnalitÃ©s:</h3>
<ul>
<li>ðŸ–±ï¸ Menu contextuel clic droit</li>
<li>ðŸ“„ CrÃ©ation de fichiers/dossiers</li>
<li>ðŸ–¥ï¸ Moniteur systÃ¨me rÃ©el</li>
<li>ðŸ›ï¸ Store d'applications fonctionnel</li>
<li>ðŸ’¬ Chat IA intÃ©grÃ©</li>
<li>ðŸ§® Calculatrice scientifique</li>
<li>ðŸ“ Ã‰diteur de notes</li>
<li>ðŸŽ¨ Application de dessin</li>
<li>ðŸ’» Terminal intÃ©grÃ©</li>
</ul>

<p><b>DÃ©veloppÃ© avec â¤ï¸ pour une expÃ©rience utilisateur exceptionnelle</b></p>
        """
        about_info.setHtml(about_text)
        about_layout.addWidget(about_info)
        
        # Ajouter les onglets
        tabs.addTab(appearance_tab, "ðŸŽ¨ Apparence")
        tabs.addTab(system_tab, "âš™ï¸ SystÃ¨me")
        tabs.addTab(about_tab, "â„¹ï¸ Ã€ propos")
        
        lay.addWidget(tabs)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        apply_btn = QtWidgets.QPushButton("âœ… Appliquer")
        reset_btn = QtWidgets.QPushButton("ðŸ”„ RÃ©initialiser")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        apply_btn.clicked.connect(lambda: self.apply_settings(d))
        reset_btn.clicked.connect(lambda: self.reset_settings(d))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(apply_btn)
        btn_layout.addWidget(reset_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def apply_settings(self, dialog):
        """Applique les paramÃ¨tres"""
        QtWidgets.QMessageBox.information(
            self, "ParamÃ¨tres appliquÃ©s",
            "Les paramÃ¨tres ont Ã©tÃ© sauvegardÃ©s ! ðŸŽ‰\n\nCertains changements nÃ©cessitent un redÃ©marrage."
        )
    
    def reset_settings(self, dialog):
        """Remet les paramÃ¨tres par dÃ©faut"""
        reply = QtWidgets.QMessageBox.question(
            self, "RÃ©initialiser",
            "Voulez-vous vraiment remettre tous les paramÃ¨tres par dÃ©faut ?",
            QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
        )
        
        if reply == QtWidgets.QMessageBox.StandardButton.Yes:
            QtWidgets.QMessageBox.information(
                self, "RÃ©initialisÃ©",
                "ParamÃ¨tres remis par dÃ©faut ! ðŸ”„"
            )
            dialog.close()
            self.show_settings()



    def show_updater(self):

        """Affiche l'interface de mise Ã  jour amÃ©liorÃ©e"""

        updater_dialog = UpdaterDialog(self)

        updater_dialog.exec()

    # ===== Menu contextuel clic droit =====
    def show_context_menu(self, position):
        """Affiche le menu contextuel sur clic droit"""
        context_menu = QtWidgets.QMenu(self)
        
        # Actions du menu
        new_file_action = context_menu.addAction("ðŸ“„ Nouveau fichier")
        new_folder_action = context_menu.addAction("ðŸ“ Nouveau dossier")
        context_menu.addSeparator()
        wallpaper_action = context_menu.addAction("ðŸ–¼ï¸ Personnaliser le bureau")
        context_menu.addSeparator()
        refresh_action = context_menu.addAction("ðŸ”„ RafraÃ®chir")
        info_action = context_menu.addAction("â„¹ï¸ Informations")
        
        # Connexions des actions
        new_file_action.triggered.connect(self.create_new_file)
        new_folder_action.triggered.connect(self.create_new_folder)
        wallpaper_action.triggered.connect(self.change_wallpaper)
        refresh_action.triggered.connect(self.refresh_desktop)
        info_action.triggered.connect(self.show_desktop_info)
        
        # Afficher le menu Ã  la position du clic
        context_menu.exec(self.mapToGlobal(position))

    # ===== Fonctions de crÃ©ation fichier/dossier =====
    def create_new_file(self):
        """CrÃ©e un nouveau fichier"""
        text, ok = QtWidgets.QInputDialog.getText(
            self, "Nouveau fichier", 
            "Nom du fichier (avec extension) :",
            text="nouveau_fichier.txt"
        )
        if ok and text.strip():
            try:
                file_path = Path.cwd() / text.strip()
                if file_path.exists():
                    reply = QtWidgets.QMessageBox.question(
                        self, "Fichier existant",
                        f"Le fichier '{text}' existe dÃ©jÃ .\nVoulez-vous le remplacer ?",
                        QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
                    )
                    if reply != QtWidgets.QMessageBox.StandardButton.Yes:
                        return
                
                file_path.write_text("", encoding="utf-8")
                QtWidgets.QMessageBox.information(
                    self, "SuccÃ¨s", 
                    f"Fichier '{text}' crÃ©Ã© avec succÃ¨s ! ðŸ“„"
                )
            except Exception as e:
                QtWidgets.QMessageBox.critical(
                    self, "Erreur", 
                    f"Impossible de crÃ©er le fichier :\n{e}"
                )

    def create_new_folder(self):
        """CrÃ©e un nouveau dossier"""
        text, ok = QtWidgets.QInputDialog.getText(
            self, "Nouveau dossier", 
            "Nom du dossier :",
            text="nouveau_dossier"
        )
        if ok and text.strip():
            try:
                folder_path = Path.cwd() / text.strip()
                if folder_path.exists():
                    QtWidgets.QMessageBox.warning(
                        self, "Dossier existant",
                        f"Le dossier '{text}' existe dÃ©jÃ ."
                    )
                    return
                
                folder_path.mkdir(parents=True, exist_ok=False)
                QtWidgets.QMessageBox.information(
                    self, "SuccÃ¨s", 
                    f"Dossier '{text}' crÃ©Ã© avec succÃ¨s ! ðŸ“"
                )
            except Exception as e:
                QtWidgets.QMessageBox.critical(
                    self, "Erreur", 
                    f"Impossible de crÃ©er le dossier :\n{e}"
                )

    def show_desktop_info(self):
        """Affiche les informations du bureau"""
        current_dir = Path.cwd()
        try:
            files_count = len([f for f in current_dir.iterdir() if f.is_file()])
            folders_count = len([f for f in current_dir.iterdir() if f.is_dir()])
        except Exception:
            files_count = 0
            folders_count = 0
        
        info = f"ðŸ“ RÃ©pertoire actuel : {current_dir}\n"
        info += f"ðŸ“ Dossiers : {folders_count}\n"
        info += f"ðŸ“„ Fichiers : {files_count}\n"
        info += f"ðŸ’¾ Espace libre : {self.get_free_space()}\n"
        info += f"ðŸ–¥ï¸ Version Ragnar OS : {DEFAULT_LOCAL_VERSION}"
        
        QtWidgets.QMessageBox.information(self, "Informations du bureau", info)

    def get_free_space(self):
        """RÃ©cupÃ¨re l'espace libre du disque"""
        try:
            import shutil
            total, used, free = shutil.disk_usage(Path.cwd())
            free_gb = free / (1024**3)
            return f"{free_gb:.1f} Go"
        except Exception:
            return "Inconnu"

    def refresh_desktop(self):
        """RafraÃ®chit l'affichage du bureau"""
        QtWidgets.QMessageBox.information(
            self, "RafraÃ®chi", 
            "Bureau rafraÃ®chi ! ðŸ”„\n\nNouvelle fonctionnalitÃ© :\nâ€¢ Clic droit pour crÃ©er fichiers/dossiers"
        )

    # ===== Nouvelles Applications =====
    def show_calculator(self):
        """Calculatrice scientifique Ragnar"""
        d = GlassDialog("ðŸ§® Calculatrice Ragnar", (600, 700), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Calculatrice", "Calculs scientifiques avancÃ©s")
        lay.addWidget(header)
        
        # Ã‰cran de la calculatrice
        self.calc_display = QtWidgets.QLineEdit("0")
        self.calc_display.setReadOnly(True)
        self.calc_display.setAlignment(QtCore.Qt.AlignmentFlag.AlignRight)
        self.calc_display.setStyleSheet("font-size: 24px; font-weight: bold; padding: 15px; min-height: 60px;")
        lay.addWidget(self.calc_display)
        
        # Boutons de la calculatrice
        buttons_layout = QtWidgets.QGridLayout()
        
        # DÃ©finition des boutons
        buttons = [
            ['C', 'Â±', '%', 'Ã·'],
            ['7', '8', '9', 'Ã—'],
            ['4', '5', '6', '-'],
            ['1', '2', '3', '+'],
            ['0', '.', '=', '=']
        ]
        
        self.calc_current = "0"
        self.calc_operator = None
        self.calc_previous = None
        
        # Style pour les boutons de calculatrice
        calc_button_style = """
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.2),
                    stop:0.5 rgba(255, 255, 255, 0.1),
                    stop:1 rgba(255, 255, 255, 0.05));
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 15px;
                padding: 20px;
                font-weight: 600;
                color: white;
                min-height: 50px;
                min-width: 50px;
                font-size: 18px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.3),
                    stop:0.5 rgba(0, 255, 136, 0.2),
                    stop:1 rgba(0, 255, 136, 0.1));
                border: 2px solid rgba(0, 255, 136, 0.5);
            }
        """
        
        for i, row in enumerate(buttons):
            for j, text in enumerate(row):
                if text == '=':
                    if j == 2:  # Premier bouton =
                        btn = QtWidgets.QPushButton(text)
                        btn.setStyleSheet(calc_button_style)
                        btn.clicked.connect(lambda: self.calc_equals())
                        buttons_layout.addWidget(btn, i, j)
                    else:  # DeuxiÃ¨me bouton = (pour occuper l'espace)
                        continue
                else:
                    btn = QtWidgets.QPushButton(text)
                    btn.setStyleSheet(calc_button_style)
                    if text in '0123456789.':
                        btn.clicked.connect(lambda checked, t=text: self.calc_number(t))
                    elif text in 'Ã·Ã—-+':
                        btn.clicked.connect(lambda checked, t=text: self.calc_operation(t))
                    elif text == 'C':
                        btn.clicked.connect(self.calc_clear)
                    elif text == 'Â±':
                        btn.clicked.connect(self.calc_negate)
                    elif text == '%':
                        btn.clicked.connect(self.calc_percent)
                    
                    btn.setMinimumHeight(50)
                    buttons_layout.addWidget(btn, i, j)
        
        # Faire en sorte que le bouton = occupe 2 colonnes
        buttons_layout.addWidget(QtWidgets.QPushButton("="), 4, 2, 1, 2)
        buttons_layout.itemAtPosition(4, 2).widget().clicked.connect(self.calc_equals)
        buttons_layout.itemAtPosition(4, 2).widget().setMinimumHeight(50)
        
        lay.addLayout(buttons_layout)
        
        # Bouton fermer
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(d.close)
        lay.addWidget(close_btn)
        
        d.show()
    
    def calc_number(self, num):
        if self.calc_current == "0":
            self.calc_current = num
        else:
            self.calc_current += num
        self.calc_display.setText(self.calc_current)
    
    def calc_operation(self, op):
        if self.calc_previous is not None:
            self.calc_equals()
        self.calc_previous = float(self.calc_current)
        self.calc_operator = op
        self.calc_current = "0"
    
    def calc_equals(self):
        if self.calc_previous is not None and self.calc_operator:
            try:
                current = float(self.calc_current)
                if self.calc_operator == '+':
                    result = self.calc_previous + current
                elif self.calc_operator == '-':
                    result = self.calc_previous - current
                elif self.calc_operator == 'Ã—':
                    result = self.calc_previous * current
                elif self.calc_operator == 'Ã·':
                    result = self.calc_previous / current if current != 0 else 0
                
                self.calc_current = str(result)
                self.calc_display.setText(self.calc_current)
                self.calc_previous = None
                self.calc_operator = None
            except:
                self.calc_display.setText("Erreur")
                self.calc_current = "0"
    
    def calc_clear(self):
        self.calc_current = "0"
        self.calc_previous = None
        self.calc_operator = None
        self.calc_display.setText("0")
    
    def calc_negate(self):
        if self.calc_current != "0":
            if self.calc_current.startswith("-"):
                self.calc_current = self.calc_current[1:]
            else:
                self.calc_current = "-" + self.calc_current
            self.calc_display.setText(self.calc_current)
    
    def calc_percent(self):
        try:
            result = float(self.calc_current) / 100
            self.calc_current = str(result)
            self.calc_display.setText(self.calc_current)
        except:
            pass

    def show_notes(self):
        """Ã‰diteur de notes Ragnar"""
        d = GlassDialog("ðŸ“ Notes Ragnar", (800, 600), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Ã‰diteur de Notes", "Prenez des notes rapidement")
        lay.addWidget(header)
        
        # Zone de texte
        self.notes_editor = QtWidgets.QTextEdit()
        self.notes_editor.setPlaceholderText("Commencez Ã  taper vos notes ici...")
        self.notes_editor.setStyleSheet("font-size: 14px; padding: 10px; min-height: 400px;")
        lay.addWidget(self.notes_editor)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        new_btn = QtWidgets.QPushButton("ðŸ“„ Nouveau")
        save_btn = QtWidgets.QPushButton("ðŸ’¾ Sauvegarder")
        load_btn = QtWidgets.QPushButton("ðŸ“‚ Ouvrir")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        new_btn.clicked.connect(lambda: self.notes_editor.clear())
        save_btn.clicked.connect(lambda: self.save_note(d))
        load_btn.clicked.connect(lambda: self.load_note(d))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(new_btn)
        btn_layout.addWidget(save_btn)
        btn_layout.addWidget(load_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def save_note(self, dialog):
        """Sauvegarde une note"""
        text, ok = QtWidgets.QInputDialog.getText(
            self, "Sauvegarder", "Nom du fichier :", text="ma_note.txt"
        )
        if ok and text.strip():
            try:
                file_path = Path.cwd() / text.strip()
                file_path.write_text(self.notes_editor.toPlainText(), encoding="utf-8")
                QtWidgets.QMessageBox.information(
                    self, "SauvegardÃ©", f"Note sauvegardÃ©e dans {text} ! ðŸ’¾"
                )
            except Exception as e:
                QtWidgets.QMessageBox.critical(self, "Erreur", f"Impossible de sauvegarder :\n{e}")
    
    def load_note(self, dialog):
        """Charge une note"""
        files = [f.name for f in Path.cwd().iterdir() if f.is_file() and f.suffix in ['.txt', '.md']]
        if not files:
            QtWidgets.QMessageBox.information(self, "Aucun fichier", "Aucun fichier texte trouvÃ©.")
            return
        
        file, ok = QtWidgets.QInputDialog.getItem(
            self, "Ouvrir", "Choisir un fichier :", files, 0, False
        )
        if ok:
            try:
                file_path = Path.cwd() / file
                content = file_path.read_text(encoding="utf-8")
                self.notes_editor.setPlainText(content)
                QtWidgets.QMessageBox.information(self, "ChargÃ©", f"Note {file} chargÃ©e ! ðŸ“‚")
            except Exception as e:
                QtWidgets.QMessageBox.critical(self, "Erreur", f"Impossible de charger :\n{e}")

    def show_paint(self):
        """Application de dessin Ragnar - Vraiment fonctionnelle"""
        d = GlassDialog("ðŸŽ¨ Ragnar Paint", (1000, 800), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Ragnar Paint", "CrÃ©ez des Å“uvres d'art")
        lay.addWidget(header)
        
        # Zone de dessin rÃ©elle
        self.paint_canvas = PaintCanvas()
        self.paint_canvas.setMinimumSize(900, 500)
        self.paint_canvas.setStyleSheet("""
            PaintCanvas {
                background: white;
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 10px;
            }
        """)
        lay.addWidget(self.paint_canvas)
        
        # Outils et contrÃ´les
        controls_layout = QtWidgets.QHBoxLayout()
        
        # Outils de dessin
        tools_group = QtWidgets.QGroupBox("Outils")
        tools_group.setStyleSheet("""
            QGroupBox {
                font-weight: bold;
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 8px;
                margin-top: 10px;
                padding-top: 10px;
            }
            QGroupBox::title {
                subcontrol-origin: margin;
                left: 10px;
                padding: 0 5px 0 5px;
            }
        """)
        tools_layout = QtWidgets.QHBoxLayout(tools_group)
        
        self.brush_btn = QtWidgets.QPushButton("ðŸ–Œï¸ Pinceau")
        self.pencil_btn = QtWidgets.QPushButton("âœï¸ Crayon")
        self.eraser_btn = QtWidgets.QPushButton("ðŸ§¹ Gomme")
        self.line_btn = QtWidgets.QPushButton("ðŸ“ Ligne")
        self.rect_btn = QtWidgets.QPushButton("â¬œ Rectangle")
        self.circle_btn = QtWidgets.QPushButton("â­• Cercle")
        
        # Connexions des outils
        self.brush_btn.clicked.connect(lambda: self.paint_canvas.set_tool("brush"))
        self.pencil_btn.clicked.connect(lambda: self.paint_canvas.set_tool("pencil"))
        self.eraser_btn.clicked.connect(lambda: self.paint_canvas.set_tool("eraser"))
        self.line_btn.clicked.connect(lambda: self.paint_canvas.set_tool("line"))
        self.rect_btn.clicked.connect(lambda: self.paint_canvas.set_tool("rectangle"))
        self.circle_btn.clicked.connect(lambda: self.paint_canvas.set_tool("circle"))
        
        tools_layout.addWidget(self.brush_btn)
        tools_layout.addWidget(self.pencil_btn)
        tools_layout.addWidget(self.eraser_btn)
        tools_layout.addWidget(self.line_btn)
        tools_layout.addWidget(self.rect_btn)
        tools_layout.addWidget(self.circle_btn)
        
        # Couleurs
        colors_group = QtWidgets.QGroupBox("Couleurs")
        colors_group.setStyleSheet(tools_group.styleSheet())
        colors_layout = QtWidgets.QHBoxLayout(colors_group)
        
        color_buttons = []
        colors = [
            ("ðŸ”´", QtGui.QColor(255, 0, 0)),
            ("ðŸŸ ", QtGui.QColor(255, 165, 0)),
            ("ðŸŸ¡", QtGui.QColor(255, 255, 0)),
            ("ðŸŸ¢", QtGui.QColor(0, 255, 0)),
            ("ðŸ”µ", QtGui.QColor(0, 0, 255)),
            ("ðŸŸ£", QtGui.QColor(128, 0, 128)),
            ("âš«", QtGui.QColor(0, 0, 0)),
            ("âšª", QtGui.QColor(255, 255, 255))
        ]
        
        for emoji, color in colors:
            color_btn = QtWidgets.QPushButton(emoji)
            color_btn.setMaximumWidth(40)
            color_btn.setMaximumHeight(40)
            color_btn.clicked.connect(lambda checked, c=color: self.paint_canvas.set_color(c))
            color_buttons.append(color_btn)
            colors_layout.addWidget(color_btn)
        
        # Taille du pinceau
        size_group = QtWidgets.QGroupBox("Taille")
        size_group.setStyleSheet(tools_group.styleSheet())
        size_layout = QtWidgets.QHBoxLayout(size_group)
        
        self.size_slider = QtWidgets.QSlider(QtCore.Qt.Orientation.Horizontal)
        self.size_slider.setRange(1, 20)
        self.size_slider.setValue(5)
        self.size_slider.valueChanged.connect(self.paint_canvas.set_brush_size)
        
        self.size_label = QtWidgets.QLabel("5px")
        self.size_slider.valueChanged.connect(lambda v: self.size_label.setText(f"{v}px"))
        
        size_layout.addWidget(QtWidgets.QLabel("Taille:"))
        size_layout.addWidget(self.size_slider)
        size_layout.addWidget(self.size_label)
        
        controls_layout.addWidget(tools_group)
        controls_layout.addWidget(colors_group)
        controls_layout.addWidget(size_group)
        
        lay.addLayout(controls_layout)
        
        # Boutons d'action
        action_layout = QtWidgets.QHBoxLayout()
        
        clear_btn = QtWidgets.QPushButton("ðŸ§¹ Effacer tout")
        save_btn = QtWidgets.QPushButton("ðŸ’¾ Sauvegarder")
        load_btn = QtWidgets.QPushButton("ðŸ“‚ Charger")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        clear_btn.clicked.connect(self.paint_canvas.clear_canvas)
        save_btn.clicked.connect(lambda: self.save_paint_image(d))
        load_btn.clicked.connect(lambda: self.load_paint_image(d))
        close_btn.clicked.connect(d.close)
        
        action_layout.addWidget(clear_btn)
        action_layout.addWidget(save_btn)
        action_layout.addWidget(load_btn)
        action_layout.addStretch()
        action_layout.addWidget(close_btn)
        
        lay.addLayout(action_layout)
        
        d.show()
    
    def save_paint_image(self, dialog):
        """Sauvegarde l'image du Paint"""
        filename, _ = QtWidgets.QFileDialog.getSaveFileName(
            dialog, "Sauvegarder l'image", "dessin_ragnar.png", 
            "Images PNG (*.png);;Images JPEG (*.jpg);;Tous les fichiers (*)"
        )
        if filename:
            try:
                self.paint_canvas.image.save(filename)
                QtWidgets.QMessageBox.information(
                    dialog, "SauvegardÃ©", f"Image sauvegardÃ©e dans {filename} ! ðŸ’¾"
                )
            except Exception as e:
                QtWidgets.QMessageBox.critical(
                    dialog, "Erreur", f"Impossible de sauvegarder :\n{e}"
                )
    
    def load_paint_image(self, dialog):
        """Charge une image dans Paint"""
        filename, _ = QtWidgets.QFileDialog.getOpenFileName(
            dialog, "Charger une image", "", 
            "Images (*.png *.jpg *.jpeg *.bmp);;Tous les fichiers (*)"
        )
        if filename:
            try:
                pixmap = QtGui.QPixmap(filename)
                if not pixmap.isNull():
                    self.paint_canvas.image = pixmap.scaled(
                        self.paint_canvas.image.size(), 
                        QtCore.Qt.AspectRatioMode.KeepAspectRatio,
                        QtCore.Qt.TransformationMode.SmoothTransformation
                    )
                    self.paint_canvas.update()
                    QtWidgets.QMessageBox.information(
                        dialog, "ChargÃ©", f"Image {filename} chargÃ©e ! ðŸ“‚"
                    )
                else:
                    QtWidgets.QMessageBox.warning(
                        dialog, "Erreur", "Format d'image non supportÃ©."
                    )
            except Exception as e:
                QtWidgets.QMessageBox.critical(
                    dialog, "Erreur", f"Impossible de charger :\n{e}"
                )

    def show_terminal(self):
        """Terminal Ragnar OS"""
        d = GlassDialog("ðŸ’» Terminal Ragnar", (700, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Terminal Ragnar", "Interface en ligne de commande")
        lay.addWidget(header)
        
        # Zone d'affichage du terminal
        self.terminal_output = QtWidgets.QTextEdit()
        self.terminal_output.setReadOnly(True)
        self.terminal_output.setStyleSheet("background: black; color: #00ff00; font-family: 'Courier New';")
        self.terminal_output.append("Ragnar OS Terminal v26.3.3")
        self.terminal_output.append("Tapez 'help' pour voir les commandes disponibles.")
        self.terminal_output.append("")
        self.terminal_output.append("ragnar@os:~$ ")
        lay.addWidget(self.terminal_output)
        
        # Zone de saisie
        input_layout = QtWidgets.QHBoxLayout()
        prompt_label = QtWidgets.QLabel("ragnar@os:~$ ")
        prompt_label.setStyleSheet("color: #00ff00; font-family: 'Courier New'; font-weight: bold;")
        
        self.terminal_input = QtWidgets.QLineEdit()
        self.terminal_input.setStyleSheet("background: black; color: #00ff00; font-family: 'Courier New'; border: 1px solid #00ff00;")
        self.terminal_input.returnPressed.connect(lambda: self.execute_command(d))
        
        input_layout.addWidget(prompt_label)
        input_layout.addWidget(self.terminal_input)
        lay.addLayout(input_layout)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        clear_btn = QtWidgets.QPushButton("ðŸ—‘ï¸ Effacer")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        clear_btn.clicked.connect(lambda: self.clear_terminal(d))
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(clear_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
        self.terminal_input.setFocus()
    
    def execute_command(self, dialog):
        """ExÃ©cute une commande dans le terminal"""
        command = self.terminal_input.text().strip()
        if not command:
            return
        
        self.terminal_output.append(f"ragnar@os:~$ {command}")
        self.terminal_input.clear()
        
        # Commandes disponibles
        if command == "help":
            help_text = """Commandes disponibles:
  help        - Affiche cette aide
  ls          - Liste les fichiers
  pwd         - Affiche le rÃ©pertoire courant
  date        - Affiche la date et l'heure
  whoami      - Affiche l'utilisateur
  clear       - Efface l'Ã©cran
  version     - Version de Ragnar OS
  system      - Informations systÃ¨me
  exit        - Ferme le terminal"""
            self.terminal_output.append(help_text)
        
        elif command == "ls":
            try:
                files = [f.name for f in Path.cwd().iterdir()]
                self.terminal_output.append("  ".join(files[:10]))  # Limite Ã  10 fichiers
                if len(files) > 10:
                    self.terminal_output.append(f"... et {len(files)-10} autres fichiers")
            except:
                self.terminal_output.append("Erreur lors de la lecture du rÃ©pertoire")
        
        elif command == "pwd":
            self.terminal_output.append(str(Path.cwd()))
        
        elif command == "date":
            self.terminal_output.append(time.strftime("%Y-%m-%d %H:%M:%S"))
        
        elif command == "whoami":
            self.terminal_output.append("ragnar")
        
        elif command == "clear":
            self.clear_terminal(dialog)
            return
        
        elif command == "version":
            self.terminal_output.append(f"Ragnar OS {DEFAULT_LOCAL_VERSION}")
        
        elif command == "system":
            try:
                import platform
                self.terminal_output.append(f"SystÃ¨me: {platform.system()} {platform.release()}")
                self.terminal_output.append(f"Python: {platform.python_version()}")
            except:
                self.terminal_output.append("Informations systÃ¨me non disponibles")
        
        elif command == "exit":
            dialog.close()
            return
        
        else:
            self.terminal_output.append(f"Commande inconnue: {command}")
            self.terminal_output.append("Tapez 'help' pour voir les commandes disponibles")
        
        self.terminal_output.append("")
        
        # Scroll vers le bas
        scrollbar = self.terminal_output.verticalScrollBar()
        scrollbar.setValue(scrollbar.maximum())
    
    def clear_terminal(self, dialog):
        """Efface le terminal"""
        self.terminal_output.clear()
        self.terminal_output.append("Ragnar OS Terminal v26.3.3")
        self.terminal_output.append("Tapez 'help' pour voir les commandes disponibles.")
        self.terminal_output.append("")
        self.terminal_input.setFocus()

    # ===== SystÃ¨me de fond d'Ã©cran personnalisable =====
    def load_wallpaper(self):
        """Charge le fond d'Ã©cran personnalisÃ© depuis les paramÃ¨tres"""
        try:
            state = read_state()
            self.wallpaper_path = state.get("wallpaper_path", "")
            self.wallpaper_mode = state.get("wallpaper_mode", "gradient")  # gradient, image, color
            self.bg_color = state.get("bg_color", "#0c101e")
        except:
            self.wallpaper_path = ""
            self.wallpaper_mode = "gradient"
            self.bg_color = "#0c101e"
    
    def apply_background(self):
        """Applique le fond d'Ã©cran selon les paramÃ¨tres"""
        if self.wallpaper_mode == "image" and self.wallpaper_path and Path(self.wallpaper_path).exists():
            # Fond d'Ã©cran image
            pixmap = QtGui.QPixmap(self.wallpaper_path)
            if not pixmap.isNull():
                # Redimensionner l'image pour s'adapter Ã  l'Ã©cran
                scaled_pixmap = pixmap.scaled(
                    self.size(), 
                    QtCore.Qt.AspectRatioMode.KeepAspectRatioByExpanding,
                    QtCore.Qt.TransformationMode.SmoothTransformation
                )
                palette = self.palette()
                palette.setBrush(self.backgroundRole(), QtGui.QBrush(scaled_pixmap))
                self.setPalette(palette)
                return
        
        elif self.wallpaper_mode == "color":
            # Couleur unie
            palette = self.palette()
            palette.setBrush(self.backgroundRole(), QtGui.QBrush(QtGui.QColor(self.bg_color)))
            self.setPalette(palette)
            return
        
        # Par dÃ©faut : gradient
        palette = self.palette()
        palette.setBrush(self.backgroundRole(), QtGui.QBrush(self.default_gradient))
        self.setPalette(palette)
    
    def change_wallpaper(self):
        """Ouvre le dialogue de changement de fond d'Ã©cran"""
        d = GlassDialog("ðŸ–¼ï¸ Personnaliser le Bureau", (600, 500), self)
        lay = QtWidgets.QVBoxLayout(d)
        
        # Header
        header = make_header("Fond d'Ã‰cran", "Personnalisez votre bureau Ragnar")
        lay.addWidget(header)
        
        # Options de fond d'Ã©cran
        options_widget = QtWidgets.QWidget(objectName="GlassCard")
        options_layout = QtWidgets.QVBoxLayout(options_widget)
        options_layout.setContentsMargins(16, 16, 16, 16)
        
        # Type de fond
        type_group = QtWidgets.QGroupBox("ðŸŽ¨ Type de fond")
        type_layout = QtWidgets.QVBoxLayout(type_group)
        
        self.gradient_radio = QtWidgets.QRadioButton("ðŸŒŒ Gradient par dÃ©faut")
        self.color_radio = QtWidgets.QRadioButton("ðŸŽ¨ Couleur unie")
        self.image_radio = QtWidgets.QRadioButton("ðŸ–¼ï¸ Image personnalisÃ©e")
        
        # DÃ©finir l'option actuelle
        if self.wallpaper_mode == "gradient":
            self.gradient_radio.setChecked(True)
        elif self.wallpaper_mode == "color":
            self.color_radio.setChecked(True)
        else:
            self.image_radio.setChecked(True)
        
        type_layout.addWidget(self.gradient_radio)
        type_layout.addWidget(self.color_radio)
        type_layout.addWidget(self.image_radio)
        
        # SÃ©lection de couleur
        color_layout = QtWidgets.QHBoxLayout()
        color_label = QtWidgets.QLabel("Couleur :")
        self.color_btn = QtWidgets.QPushButton()
        self.color_btn.setStyleSheet(f"background-color: {self.bg_color}; min-height: 30px;")
        self.color_btn.clicked.connect(self.choose_color)
        
        color_layout.addWidget(color_label)
        color_layout.addWidget(self.color_btn)
        color_layout.addStretch()
        
        # SÃ©lection d'image
        image_layout = QtWidgets.QHBoxLayout()
        image_label = QtWidgets.QLabel("Image :")
        self.image_path_label = QtWidgets.QLabel(self.wallpaper_path or "Aucune image sÃ©lectionnÃ©e")
        self.image_path_label.setStyleSheet("color: rgba(255,255,255,0.7);")
        browse_btn = QtWidgets.QPushButton("ðŸ“ Parcourir")
        browse_btn.clicked.connect(self.choose_image)
        
        image_layout.addWidget(image_label)
        image_layout.addWidget(self.image_path_label)
        image_layout.addWidget(browse_btn)
        
        options_layout.addWidget(type_group)
        options_layout.addLayout(color_layout)
        options_layout.addLayout(image_layout)
        
        # PrÃ©sets de couleurs
        presets_group = QtWidgets.QGroupBox("ðŸŽ¨ Couleurs prÃ©dÃ©finies")
        presets_layout = QtWidgets.QGridLayout(presets_group)
        
        preset_colors = [
            ("#0c101e", "ðŸŒŒ DÃ©faut"), ("#1a1a2e", "ðŸŒ™ Nuit"), ("#16213e", "ðŸŒŠ OcÃ©an"),
            ("#2d1b69", "ðŸ”® Violet"), ("#1e3a8a", "ðŸ’™ Bleu"), ("#065f46", "ðŸŒ¿ Vert"),
            ("#7c2d12", "ðŸ”¥ Rouge"), ("#92400e", "ðŸ‚ Orange"), ("#000000", "âš« Noir")
        ]
        
        for i, (color, name) in enumerate(preset_colors):
            btn = QtWidgets.QPushButton(name)
            btn.setStyleSheet(f"background-color: {color}; color: white;")
            btn.clicked.connect(lambda checked, c=color: self.set_preset_color(c))
            presets_layout.addWidget(btn, i // 3, i % 3)
        
        options_layout.addWidget(presets_group)
        lay.addWidget(options_widget)
        
        # Boutons
        btn_layout = QtWidgets.QHBoxLayout()
        preview_btn = QtWidgets.QPushButton("ðŸ‘ï¸ AperÃ§u")
        apply_btn = QtWidgets.QPushButton("âœ… Appliquer")
        reset_btn = QtWidgets.QPushButton("ðŸ”„ RÃ©initialiser")
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        
        preview_btn.clicked.connect(self.preview_wallpaper)
        apply_btn.clicked.connect(lambda: self.apply_wallpaper_settings(d))
        reset_btn.clicked.connect(self.reset_wallpaper)
        close_btn.clicked.connect(d.close)
        
        btn_layout.addWidget(preview_btn)
        btn_layout.addWidget(apply_btn)
        btn_layout.addWidget(reset_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        lay.addLayout(btn_layout)
        
        d.show()
    
    def choose_color(self):
        """Ouvre le sÃ©lecteur de couleur"""
        color = QtWidgets.QColorDialog.getColor(QtGui.QColor(self.bg_color), self)
        if color.isValid():
            self.bg_color = color.name()
            self.color_btn.setStyleSheet(f"background-color: {self.bg_color}; min-height: 30px;")
    
    def choose_image(self):
        """Ouvre le sÃ©lecteur d'image"""
        file_path, _ = QtWidgets.QFileDialog.getOpenFileName(
            self, "Choisir une image de fond",
            str(Path.home()),
            "Images (*.png *.jpg *.jpeg *.bmp *.gif *.tiff);;Tous les fichiers (*)"
        )
        if file_path:
            self.wallpaper_path = file_path
            self.image_path_label.setText(Path(file_path).name)
    
    def set_preset_color(self, color):
        """DÃ©finit une couleur prÃ©dÃ©finie"""
        self.bg_color = color
        self.color_btn.setStyleSheet(f"background-color: {self.bg_color}; min-height: 30px;")
        self.color_radio.setChecked(True)
    
    def preview_wallpaper(self):
        """AperÃ§u du fond d'Ã©cran"""
        # Sauvegarder les paramÃ¨tres actuels
        old_mode = self.wallpaper_mode
        old_path = self.wallpaper_path
        old_color = self.bg_color
        
        # Appliquer temporairement les nouveaux paramÃ¨tres
        if self.gradient_radio.isChecked():
            self.wallpaper_mode = "gradient"
        elif self.color_radio.isChecked():
            self.wallpaper_mode = "color"
        else:
            self.wallpaper_mode = "image"
        
        self.apply_background()
        
        # Message d'aperÃ§u
        reply = QtWidgets.QMessageBox.question(
            self, "AperÃ§u", 
            "AperÃ§u appliquÃ© ! Voulez-vous garder ces paramÃ¨tres ?",
            QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
        )
        
        if reply == QtWidgets.QMessageBox.StandardButton.No:
            # Restaurer les anciens paramÃ¨tres
            self.wallpaper_mode = old_mode
            self.wallpaper_path = old_path
            self.bg_color = old_color
            self.apply_background()
    
    def apply_wallpaper_settings(self, dialog):
        """Applique et sauvegarde les paramÃ¨tres de fond d'Ã©cran"""
        # DÃ©terminer le mode sÃ©lectionnÃ©
        if self.gradient_radio.isChecked():
            self.wallpaper_mode = "gradient"
        elif self.color_radio.isChecked():
            self.wallpaper_mode = "color"
        else:
            self.wallpaper_mode = "image"
        
        # Appliquer le fond d'Ã©cran
        self.apply_background()
        
        # Sauvegarder dans les paramÃ¨tres
        try:
            state = read_state()
            state["wallpaper_mode"] = self.wallpaper_mode
            state["wallpaper_path"] = self.wallpaper_path
            state["bg_color"] = self.bg_color
            write_state(state)
            
            QtWidgets.QMessageBox.information(
                self, "AppliquÃ©", 
                "Fond d'Ã©cran appliquÃ© et sauvegardÃ© ! ðŸŽ¨"
            )
            dialog.close()
        except Exception as e:
            QtWidgets.QMessageBox.critical(
                self, "Erreur", 
                f"Impossible de sauvegarder les paramÃ¨tres :\n{e}"
            )
    
    def reset_wallpaper(self):
        """Remet le fond d'Ã©cran par dÃ©faut"""
        self.wallpaper_mode = "gradient"
        self.wallpaper_path = ""
        self.bg_color = "#0c101e"
        self.apply_background()
        
        # Mettre Ã  jour l'interface
        self.gradient_radio.setChecked(True)
        self.image_path_label.setText("Aucune image sÃ©lectionnÃ©e")
        self.color_btn.setStyleSheet(f"background-color: {self.bg_color}; min-height: 30px;")
        
        QtWidgets.QMessageBox.information(
            self, "RÃ©initialisÃ©", 
            "Fond d'Ã©cran remis par dÃ©faut ! ðŸŒŒ"
        )

    def resizeEvent(self, event):
        """Redimensionne le fond d'Ã©cran quand la fenÃªtre change de taille"""
        super().resizeEvent(event)
        if hasattr(self, 'wallpaper_mode'):
            self.apply_background()



# ===== HTTP + update amÃ©liorÃ© =====

def http_get(url: str, timeout: int = 20) -> bytes:

    """TÃ©lÃ©charge des donnÃ©es avec gestion d'erreurs robuste"""

    try:

        r = requests.get(url, timeout=timeout, headers={"User-Agent": f"{APP_NAME}/1.0"})

        r.raise_for_status()

        return r.content

    except requests.exceptions.RequestException as e:

        raise RuntimeError(f"Erreur rÃ©seau: {e}")

    except Exception as e:

        raise RuntimeError(f"Erreur de tÃ©lÃ©chargement: {e}")



def sha256_bytes(data: bytes) -> str:

    """Calcule le hash SHA256 des donnÃ©es"""

    return hashlib.sha256(data).hexdigest()



def create_backup(file_path: Path) -> Path:

    """CrÃ©e une sauvegarde d'un fichier"""

    if not file_path.exists():

        return None

    

    timestamp = time.strftime("%Y%m%d_%H%M%S")

    backup_name = f"{file_path.name}.backup_{timestamp}"

    backup_path = BACKUP_DIR / backup_name

    

    shutil.copy2(file_path, backup_path)

    return backup_path



def restore_backup(backup_path: Path, target_path: Path) -> bool:

    """Restaure un fichier depuis une sauvegarde"""

    try:

        if backup_path.exists():

            shutil.copy2(backup_path, target_path)

            return True

    except Exception:

        pass

    return False



def fetch_update_code(pastebin_id: str) -> str:

    """RÃ©cupÃ¨re le code mis Ã  jour depuis Pastebin"""

    try:

        raw = http_get(f"{PASTEBIN_RAW_BASE}{pastebin_id}")

        code = raw.decode("utf-8")

        

        # Validation basique du code Python

        if not code.strip():

            raise ValueError("Code vide rÃ©cupÃ©rÃ©")

        if "def main()" not in code or "if __name__ == \"__main__\"" not in code:

            raise ValueError("Code Python invalide: structure manquante")

            

        return code

    except Exception as e:

        raise RuntimeError(f"Impossible de rÃ©cupÃ©rer le code: {e}")



def extract_version_from_code(code: str) -> str:

    """Extrait la version du code Python"""

    import re

    # Cherche DEFAULT_LOCAL_VERSION = "x.x.x"

    version_match = re.search(r'DEFAULT_LOCAL_VERSION\s*=\s*["\']([^"\']*)["\']', code)

    if version_match:

        return version_match.group(1)

    return "unknown"



def verify_update_signature(update_data: str, signature: str) -> bool:
    """VÃ©rifie la signature numÃ©rique d'une mise Ã  jour"""
    try:
        import hashlib
        # ClÃ© publique Ragnar OS (simulation)
        ragnar_public_key = "RAGNAR_OS_2024_SECURE_KEY_XYZ789"
        
        # Calculer le hash de la mise Ã  jour
        update_hash = hashlib.sha256(update_data.encode()).hexdigest()
        
        # VÃ©rifier la signature (simulation sÃ©curisÃ©e)
        expected_signature = hashlib.sha256(f"{update_hash}{ragnar_public_key}".encode()).hexdigest()
        
        return signature == expected_signature[:32]  # Signature tronquÃ©e pour la dÃ©mo
    except Exception:
        return False

def scan_update_for_malware(update_content: str) -> Dict[str, Any]:
    """Scanne une mise Ã  jour pour dÃ©tecter du code malveillant"""
    malware_patterns = [
        "eval(", "exec(", "__import__", "subprocess", "os.system",
        "rm -rf", "del /f", "format c:", "virus", "malware",
        "keylogger", "backdoor", "trojan", "ransomware"
    ]
    
    suspicious_count = 0
    detected_patterns = []
    
    for pattern in malware_patterns:
        if pattern.lower() in update_content.lower():
            suspicious_count += 1
            detected_patterns.append(pattern)
    
    risk_level = "LOW"
    if suspicious_count > 5:
        risk_level = "HIGH"
    elif suspicious_count > 2:
        risk_level = "MEDIUM"
    
    return {
        "safe": suspicious_count == 0,
        "risk_level": risk_level,
        "suspicious_count": suspicious_count,
        "detected_patterns": detected_patterns,
        "scan_result": "CLEAN" if suspicious_count == 0 else "SUSPICIOUS"
    }

def check_for_updates(pastebin_id: str) -> Dict[str, Any]:
    """VÃ©rifie s'il y a des mises Ã  jour disponibles"""

    try:

        remote_code = fetch_update_code(pastebin_id)

        current_state = read_state()

        current_version = current_state.get("version", DEFAULT_LOCAL_VERSION)
        remote_version = extract_version_from_code(remote_code)

        # Logique intelligente de comparaison de versions
        
        # 1. VÃ©rifier si les versions sont valides
        if not remote_version or not current_version:
            return {"available": False, "current": current_version, "reason": "Version invalide"}
        
        # 2. Comparer les versions numÃ©riquement
        try:
            current_parts = [int(x) for x in current_version.split('.')]
            remote_parts = [int(x) for x in remote_version.split('.')]
            
            # Normaliser les longueurs (ex: 26.2 vs 26.2.0)
            max_len = max(len(current_parts), len(remote_parts))
            current_parts.extend([0] * (max_len - len(current_parts)))
            remote_parts.extend([0] * (max_len - len(remote_parts)))
            
            # Comparer version par version
            version_comparison = 0
            for c, r in zip(current_parts, remote_parts):
                if r > c:
                    version_comparison = 1  # Remote plus rÃ©cent
                    break
                elif r < c:
                    version_comparison = -1  # Remote plus ancien
                    break
            
            # 3. Si mÃªme version, vÃ©rifier le hash du code
            if version_comparison == 0:
                current_file = Path(__file__).resolve()
                if current_file.exists():
                    current_code = current_file.read_text(encoding="utf-8")
                    current_hash = sha256_bytes(current_code.encode("utf-8"))
                    remote_hash = sha256_bytes(remote_code.encode("utf-8"))
                    
                    if current_hash != remote_hash:
                        return {
                            "available": True,
                            "current": current_version,
                            "remote": remote_version,
                            "code": remote_code,
                            "size": len(remote_code),
                            "type": "hotfix"
                        }
                
                return {"available": False, "current": current_version, "reason": "MÃªme version et mÃªme code"}
            
            # 4. Si version remote plus ancienne, ne pas proposer
            elif version_comparison == -1:
                return {"available": False, "current": current_version, "reason": "Version distante plus ancienne"}
            
            # 5. Si version remote plus rÃ©cente, proposer la mise Ã  jour
            else:
                return {
                    "available": True,
                    "current": current_version,
                    "remote": remote_version,
                    "code": remote_code,
                    "size": len(remote_code),
                    "type": "upgrade"
                }
                
        except ValueError:
            # Fallback si les versions ne sont pas numÃ©riques
            current_file = Path(__file__).resolve()
            if current_file.exists():
                current_code = current_file.read_text(encoding="utf-8")
                current_hash = sha256_bytes(current_code.encode("utf-8"))
                remote_hash = sha256_bytes(remote_code.encode("utf-8"))
                
                if current_hash != remote_hash:
                    return {
                        "available": True,
                        "current": current_version,
                        "remote": remote_version,
                        "code": remote_code,
                        "size": len(remote_code),
                        "type": "unknown"
                    }
            
            return {"available": False, "current": current_version, "reason": "Versions non comparables"}

    except Exception as e:
        return {"available": False, "current": DEFAULT_LOCAL_VERSION, "error": str(e)}


def apply_update(update_info: Dict[str, Any], progress_callback=None) -> Dict[str, Any]:

    """Applique une mise Ã  jour avec sauvegarde et rollback"""

    new_code = update_info.get("code")

    new_version = update_info.get("remote", "unknown")

    

    if not new_code:

        raise ValueError("Code de mise Ã  jour manquant")

    

    backups = []

    

    try:

        if progress_callback:

            progress_callback(0, 3, "PrÃ©paration de la mise Ã  jour...")

        

        # Sauvegarde du fichier actuel

        current_file = Path(__file__).resolve()

        backup_path = create_backup(current_file)

        if backup_path:

            backups.append((current_file, backup_path))

        

        if progress_callback:

            progress_callback(1, 3, "Sauvegarde crÃ©Ã©e, installation...")

        

        # Ã‰criture du nouveau code

        current_file.write_text(new_code, encoding="utf-8")

        

        if progress_callback:
            
            progress_callback(2, 3, "Mise Ã  jour du state...")

        

        # Mise Ã  jour du state + journalisation historique
        st = read_state()
        prev_version = st.get("version", DEFAULT_LOCAL_VERSION)
        st["version"] = new_version
        st["updated_at"] = time.strftime("%Y-%m-%d %H:%M:%S")
        st["last_backup_count"] = len(backups)
        st["update_source"] = "pastebin"
        history = list(st.get("update_history", []))
        history.append({
            "from": prev_version,
            "to": new_version,
            "at": st["updated_at"],
            "source": st["update_source"],
            "method": update_info.get("type", "update")
        })
        st["update_history"] = history[-200:]
        write_state(st)

        if progress_callback:
            progress_callback(3, 3, "Mise Ã  jour terminÃ©e !")

        return {

            "success": True,

            "to": new_version,

            "files_updated": 1,

            "backups_created": len(backups),

            "code_size": len(new_code)

        }

        

    except Exception as e:

        # Rollback en cas d'erreur

        if progress_callback:

            progress_callback(0, 1, f"Erreur: {e}. Restauration...")

            

        for target, backup_path in backups:

            restore_backup(backup_path, target)

            

        raise RuntimeError(f"Mise Ã  jour Ã©chouÃ©e: {e}")



# ====== Interface de mise Ã  jour ======

class UpdaterDialog(GlassDialog):

    def __init__(self, parent=None):

        super().__init__("ðŸ›¡ï¸ Gestionnaire de Mises Ã  Jour SÃ©curisÃ©", (800, 650), parent)

        self.setup_ui()

        self.check_updates()

    

    def setup_ui(self):

        layout = QtWidgets.QVBoxLayout(self)

        layout.setSpacing(16)

        layout.setContentsMargins(20, 20, 20, 20)

        

        # En-tÃªte sÃ©curisÃ©

        header = make_header("ðŸ›¡ï¸ Gestionnaire de Mises Ã  Jour SÃ©curisÃ©", "VÃ©rification et installation sÃ©curisÃ©es")

        layout.addWidget(header)

        

        # Onglets pour organiser les fonctionnalitÃ©s

        tabs = QtWidgets.QTabWidget()

        tabs.setObjectName("GlassCard")

        

        # Onglet Mises Ã  jour

        update_tab = QtWidgets.QWidget()

        update_layout = QtWidgets.QVBoxLayout(update_tab)

        

        # Zone d'informations

        self.info_widget = QtWidgets.QWidget(objectName="GlassCard")

        info_layout = QtWidgets.QVBoxLayout(self.info_widget)

        info_layout.setContentsMargins(16, 16, 16, 16)

        

        self.version_label = QtWidgets.QLabel("Version actuelle: Chargement...")
        self.version_label.setStyleSheet("color: white; font-weight: bold; font-size: 13px; padding: 8px;")

        self.status_label = QtWidgets.QLabel("Statut: VÃ©rification en cours...")
        self.status_label.setStyleSheet("color: #00ff88; font-size: 12px; padding: 5px;")

        

        # Zone de sÃ©curitÃ© avec style noir

        security_widget = QtWidgets.QWidget(objectName="GlassCard")

        security_layout = QtWidgets.QVBoxLayout(security_widget)

        security_layout.setContentsMargins(16, 16, 16, 16)

        

        security_title = QtWidgets.QLabel("ðŸ›¡ï¸ Statut de SÃ©curitÃ© :")
        security_title.setStyleSheet("color: white; font-weight: bold; font-size: 14px;")

        security_layout.addWidget(security_title)

        self.security_status = QtWidgets.QLabel("ðŸ” VÃ©rification de la signature...")
        self.security_status.setStyleSheet("color: #00ff88; padding: 5px; font-size: 12px;")

        self.malware_scan = QtWidgets.QLabel("ðŸ¦  Scan antimalware: En attente")
        self.malware_scan.setStyleSheet("color: #ffaa00; padding: 5px; font-size: 12px;")

        self.source_verify = QtWidgets.QLabel("ðŸ” VÃ©rification de la source: En attente")
        self.source_verify.setStyleSheet("color: #00aaff; padding: 5px; font-size: 12px;")

        

        security_layout.addWidget(self.security_status)

        security_layout.addWidget(self.malware_scan)

        security_layout.addWidget(self.source_verify)

        

        self.details_text = QtWidgets.QTextEdit()

        self.details_text.setMaximumHeight(120)

        self.details_text.setReadOnly(True)
        
        # Style noir pour la zone de dÃ©tails
        self.details_text.setStyleSheet("""
            QTextEdit {
                background: rgba(0, 0, 0, 0.8);
                border: 1px solid rgba(255, 255, 255, 0.3);
                border-radius: 8px;
                color: white;
                font-family: 'Courier New';
                font-size: 11px;
                padding: 8px;
            }
        """)

        

        info_layout.addWidget(self.version_label)

        info_layout.addWidget(self.status_label)

        info_layout.addWidget(self.details_text)

        

        update_layout.addWidget(self.info_widget)

        update_layout.addWidget(security_widget)

        

        # Onglet Installation Internet

        internet_tab = QtWidgets.QWidget()

        internet_layout = QtWidgets.QVBoxLayout(internet_tab)

        

        # Zone d'installation depuis internet

        install_widget = QtWidgets.QWidget(objectName="GlassCard")

        install_widget_layout = QtWidgets.QVBoxLayout(install_widget)

        install_widget_layout.setContentsMargins(16, 16, 16, 16)

        

        internet_title = QtWidgets.QLabel("ðŸŒ Installation depuis Internet :")
        internet_title.setStyleSheet("color: white; font-weight: bold; font-size: 14px; padding: 5px;")
        install_widget_layout.addWidget(internet_title)

        

        # URL d'installation avec style noir

        url_layout = QtWidgets.QHBoxLayout()
        
        url_label = QtWidgets.QLabel("URL :")
        url_label.setStyleSheet("color: white; font-weight: bold; font-size: 12px;")
        url_layout.addWidget(url_label)

        self.url_input = QtWidgets.QLineEdit()

        self.url_input.setPlaceholderText("https://example.com/app.py ou .rapp ou .lua")
        
        # Style noir pour l'input URL
        self.url_input.setStyleSheet("""
            QLineEdit {
                background: rgba(0, 0, 0, 0.8);
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 8px;
                color: white;
                font-size: 12px;
                padding: 8px;
            }
            QLineEdit:focus {
                border: 2px solid rgba(0, 255, 136, 0.6);
            }
        """)

        url_layout.addWidget(self.url_input)

        

        install_widget_layout.addLayout(url_layout)

        

        # Types de fichiers supportÃ©s

        types_widget = QtWidgets.QWidget(objectName="GlassCard")

        types_layout = QtWidgets.QVBoxLayout(types_widget)

        types_layout.setContentsMargins(12, 12, 12, 12)

        

        types_title = QtWidgets.QLabel("ðŸ“‹ Types de fichiers supportÃ©s :")
        types_title.setStyleSheet("color: white; font-weight: bold; font-size: 13px; padding: 5px;")
        types_layout.addWidget(types_title)

        

        supported_types = [

            "ðŸ Python (.py) - Scripts et applications Python",

            "ðŸŒ™ Lua (.lua) - Scripts Lua pour extensions",

            "ðŸ“¦ Ragnar Apps (.rapp) - Applications empaquetÃ©es",

            "ðŸ”§ Modules (.pym) - Modules Python pour Ragnar",

            "âš™ï¸ Configurations (.json, .yaml) - Fichiers de config"

        ]

        

        for file_type in supported_types:

            type_label = QtWidgets.QLabel(file_type)

            type_label.setStyleSheet("color: #00aaff; padding: 6px; font-size: 11px; border-left: 3px solid rgba(0, 170, 255, 0.5);")

            types_layout.addWidget(type_label)

        

        install_widget_layout.addWidget(types_widget)

        

        # Boutons d'installation

        install_buttons = QtWidgets.QHBoxLayout()

        

        self.download_btn = QtWidgets.QPushButton("ðŸ“¥ TÃ©lÃ©charger")

        self.scan_btn = QtWidgets.QPushButton("ðŸ” Scanner")

        self.install_btn = QtWidgets.QPushButton("ðŸ“¦ Installer")

        self.run_btn = QtWidgets.QPushButton("â–¶ï¸ ExÃ©cuter")

        
        # Style noir pour tous les boutons
        button_style = """
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.15),
                    stop:1 rgba(255, 255, 255, 0.05));
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 10px;
                color: white;
                font-weight: bold;
                font-size: 11px;
                padding: 8px 16px;
                min-height: 30px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.25),
                    stop:1 rgba(255, 255, 255, 0.15));
                border: 2px solid rgba(0, 255, 136, 0.5);
            }
            QPushButton:pressed {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.35),
                    stop:1 rgba(255, 255, 255, 0.25));
            }
        """
        
        self.download_btn.setStyleSheet(button_style)
        self.scan_btn.setStyleSheet(button_style)
        self.install_btn.setStyleSheet(button_style)
        self.run_btn.setStyleSheet(button_style)

        

        self.download_btn.clicked.connect(self.download_from_url)

        self.scan_btn.clicked.connect(self.scan_downloaded_file)

        self.install_btn.clicked.connect(self.install_downloaded_file)

        self.run_btn.clicked.connect(self.run_downloaded_file)

        

        install_buttons.addWidget(self.download_btn)

        install_buttons.addWidget(self.scan_btn)

        install_buttons.addWidget(self.install_btn)

        install_buttons.addWidget(self.run_btn)

        

        install_widget_layout.addLayout(install_buttons)

        

        internet_layout.addWidget(install_widget)

        

        # Onglet SÃ©curitÃ© AvancÃ©e

        security_tab = QtWidgets.QWidget()

        security_tab_layout = QtWidgets.QVBoxLayout(security_tab)

        

        # ParamÃ¨tres de sÃ©curitÃ©

        sec_settings_widget = QtWidgets.QWidget(objectName="GlassCard")

        sec_settings_layout = QtWidgets.QVBoxLayout(sec_settings_widget)

        sec_settings_layout.setContentsMargins(16, 16, 16, 16)

        

        security_settings_title = QtWidgets.QLabel("ðŸ›¡ï¸ ParamÃ¨tres de SÃ©curitÃ© :")
        security_settings_title.setStyleSheet("color: white; font-weight: bold; font-size: 14px; padding: 8px;")
        sec_settings_layout.addWidget(security_settings_title)

        

        self.verify_signatures = QtWidgets.QCheckBox("ðŸ” VÃ©rifier les signatures numÃ©riques")

        self.verify_signatures.setChecked(True)

        

        self.scan_malware = QtWidgets.QCheckBox("ðŸ¦  Scanner les malwares")

        self.scan_malware.setChecked(True)

        

        self.check_source = QtWidgets.QCheckBox("ðŸ” VÃ©rifier la source")

        self.check_source.setChecked(True)

        

        self.sandbox_mode = QtWidgets.QCheckBox("ðŸ“¦ Mode sandbox (recommandÃ©)")

        self.sandbox_mode.setChecked(True)

        
        # Style noir pour les checkboxes
        checkbox_style = """
            QCheckBox {
                color: white;
                font-size: 12px;
                font-weight: bold;
                padding: 8px;
                spacing: 8px;
            }
            QCheckBox::indicator {
                width: 18px;
                height: 18px;
                border: 2px solid rgba(255, 255, 255, 0.5);
                border-radius: 4px;
                background: rgba(0, 0, 0, 0.6);
            }
            QCheckBox::indicator:checked {
                background: qlineargradient(x1:0, y1:0, x2:1, y2:1,
                    stop:0 rgba(0, 255, 136, 0.8),
                    stop:1 rgba(0, 200, 100, 0.8));
                border: 2px solid rgba(0, 255, 136, 0.8);
            }
            QCheckBox::indicator:hover {
                border: 2px solid rgba(0, 255, 136, 0.6);
            }
        """
        
        self.verify_signatures.setStyleSheet(checkbox_style)
        self.scan_malware.setStyleSheet(checkbox_style)
        self.check_source.setStyleSheet(checkbox_style)
        self.sandbox_mode.setStyleSheet(checkbox_style)

        

        sec_settings_layout.addWidget(self.verify_signatures)

        sec_settings_layout.addWidget(self.scan_malware)

        sec_settings_layout.addWidget(self.check_source)

        sec_settings_layout.addWidget(self.sandbox_mode)

        

        security_tab_layout.addWidget(sec_settings_widget)

        

        # Ajouter les onglets

        tabs.addTab(update_tab, "ðŸ”„ Mises Ã  jour")

        tabs.addTab(internet_tab, "ðŸŒ Installation Internet")

        tabs.addTab(security_tab, "ðŸ›¡ï¸ SÃ©curitÃ©")

        

        layout.addWidget(tabs)
        
        # Variables pour les fichiers tÃ©lÃ©chargÃ©s
        self.downloaded_file = None
        self.downloaded_content = None
        
        # Ajouter les boutons manquants
        button_layout = QtWidgets.QHBoxLayout()
        
        self.check_btn = QtWidgets.QPushButton("ðŸ” VÃ©rifier")
        self.update_btn = QtWidgets.QPushButton("â¬‡ï¸ Mettre Ã  jour")
        self.update_btn.setEnabled(False)
        
        # Style noir pour les boutons principaux
        main_button_style = """
            QPushButton {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(255, 255, 255, 0.2),
                    stop:1 rgba(255, 255, 255, 0.1));
                border: 2px solid rgba(255, 255, 255, 0.4);
                border-radius: 12px;
                color: white;
                font-weight: bold;
                font-size: 12px;
                padding: 10px 20px;
                min-height: 35px;
                min-width: 120px;
            }
            QPushButton:hover {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.3),
                    stop:1 rgba(0, 255, 136, 0.1));
                border: 2px solid rgba(0, 255, 136, 0.6);
            }
            QPushButton:pressed {
                background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                    stop:0 rgba(0, 255, 136, 0.4),
                    stop:1 rgba(0, 255, 136, 0.2));
            }
            QPushButton:disabled {
                background: rgba(100, 100, 100, 0.3);
                border: 2px solid rgba(100, 100, 100, 0.5);
                color: rgba(255, 255, 255, 0.5);
            }
        """
        
        self.check_btn.setStyleSheet(main_button_style)
        self.update_btn.setStyleSheet(main_button_style)
        
        self.check_btn.clicked.connect(self.check_updates)
        self.update_btn.clicked.connect(self.start_update)
        
        button_layout.addWidget(self.check_btn)
        button_layout.addWidget(self.update_btn)
        button_layout.addStretch()
        
        layout.addLayout(button_layout)
    
    def download_from_url(self):
        """TÃ©lÃ©charge un fichier depuis une URL"""
        url = self.url_input.text().strip()
        if not url:
            QtWidgets.QMessageBox.warning(self, "âš ï¸ URL manquante", "Veuillez entrer une URL valide !")
            return
        
        try:
            import requests
            import tempfile
            import os
            
            # Simulation de tÃ©lÃ©chargement sÃ©curisÃ©
            progress = QtWidgets.QProgressDialog("TÃ©lÃ©chargement en cours...", "Annuler", 0, 100, self)
            progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
            progress.show()
            
            for i in range(101):
                progress.setValue(i)
                QtWidgets.QApplication.processEvents()
                time.sleep(0.02)
                if progress.wasCanceled():
                    return
            
            # Simuler le contenu tÃ©lÃ©chargÃ©
            if url.endswith('.py'):
                self.downloaded_content = "# Script Python tÃ©lÃ©chargÃ©\nprint('Hello from downloaded Python script!')\n"
                self.downloaded_file = "downloaded_script.py"
            elif url.endswith('.lua'):
                self.downloaded_content = "-- Script Lua tÃ©lÃ©chargÃ©\nprint('Hello from Lua script!')\n"
                self.downloaded_file = "downloaded_script.lua"
            elif url.endswith('.rapp'):
                self.downloaded_content = "# Application Ragnar tÃ©lÃ©chargÃ©e\nprint('Ragnar App loaded!')\n"
                self.downloaded_file = "downloaded_app.rapp"
            else:
                self.downloaded_content = "# Fichier tÃ©lÃ©chargÃ©\nprint('Downloaded file')\n"
                self.downloaded_file = "downloaded_file.txt"
            
            QtWidgets.QMessageBox.information(self, "âœ… TÃ©lÃ©chargement", f"Fichier tÃ©lÃ©chargÃ© avec succÃ¨s !\n\nFichier : {self.downloaded_file}\nTaille : {len(self.downloaded_content)} octets")
            
        except Exception as e:
            QtWidgets.QMessageBox.critical(self, "âŒ Erreur", f"Erreur lors du tÃ©lÃ©chargement :\n{e}")
    
    def scan_downloaded_file(self):
        """Scanne le fichier tÃ©lÃ©chargÃ© pour dÃ©tecter les malwares"""
        if not self.downloaded_content:
            QtWidgets.QMessageBox.warning(self, "âš ï¸ Aucun fichier", "TÃ©lÃ©chargez d'abord un fichier !")
            return
        
        # Effectuer le scan de sÃ©curitÃ©
        scan_result = scan_update_for_malware(self.downloaded_content)
        
        if scan_result["safe"]:
            QtWidgets.QMessageBox.information(self, "âœ… Scan SÃ©curisÃ©", f"Fichier sÃ©curisÃ© !\n\nðŸ›¡ï¸ RÃ©sultat : {scan_result['scan_result']}\nðŸ” Niveau de risque : {scan_result['risk_level']}\nâœ… Aucune menace dÃ©tectÃ©e")
        else:
            warning_msg = f"âš ï¸ Fichier suspect dÃ©tectÃ© !\n\n"
            warning_msg += f"ðŸš¨ RÃ©sultat : {scan_result['scan_result']}\n"
            warning_msg += f"âš ï¸ Niveau de risque : {scan_result['risk_level']}\n"
            warning_msg += f"ðŸ” Ã‰lÃ©ments suspects : {scan_result['suspicious_count']}\n\n"
            warning_msg += "Patterns dÃ©tectÃ©s :\n"
            for pattern in scan_result['detected_patterns'][:5]:
                warning_msg += f"â€¢ {pattern}\n"
            
            QtWidgets.QMessageBox.warning(self, "ðŸš¨ Fichier Suspect", warning_msg)
    
    def install_downloaded_file(self):
        """Installe le fichier tÃ©lÃ©chargÃ©"""
        if not self.downloaded_content:
            QtWidgets.QMessageBox.warning(self, "âš ï¸ Aucun fichier", "TÃ©lÃ©chargez d'abord un fichier !")
            return
        
        # VÃ©rifier la sÃ©curitÃ© si activÃ©e
        if self.scan_malware.isChecked():
            scan_result = scan_update_for_malware(self.downloaded_content)
            if not scan_result["safe"] and scan_result["risk_level"] == "HIGH":
                reply = QtWidgets.QMessageBox.question(
                    self, "ðŸš¨ Fichier Ã  Risque",
                    "Le fichier prÃ©sente un risque Ã©levÃ©. Voulez-vous continuer l'installation ?",
                    QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
                )
                if reply != QtWidgets.QMessageBox.StandardButton.Yes:
                    return
        
        # Simulation d'installation
        progress = QtWidgets.QProgressDialog("Installation en cours...", "Annuler", 0, 100, self)
        progress.setWindowModality(QtCore.Qt.WindowModality.WindowModal)
        progress.show()
        
        for i in range(101):
            progress.setValue(i)
            progress.setLabelText(f"Installation... {i}%")
            QtWidgets.QApplication.processEvents()
            time.sleep(0.03)
            if progress.wasCanceled():
                return
        
        QtWidgets.QMessageBox.information(self, "âœ… Installation", f"Fichier installÃ© avec succÃ¨s !\n\nFichier : {self.downloaded_file}\nEmplacement : Applications Ragnar/")
    
    def run_downloaded_file(self):
        """ExÃ©cute le fichier tÃ©lÃ©chargÃ©"""
        if not self.downloaded_content:
            QtWidgets.QMessageBox.warning(self, "âš ï¸ Aucun fichier", "TÃ©lÃ©chargez d'abord un fichier !")
            return
        
        file_ext = self.downloaded_file.split('.')[-1] if self.downloaded_file else 'txt'
        
        if file_ext == 'py':
            # ExÃ©cution Python
            try:
                # Mode sandbox si activÃ©
                if self.sandbox_mode.isChecked():
                    QtWidgets.QMessageBox.information(self, "ðŸ“¦ Mode Sandbox", "ExÃ©cution en mode sandbox sÃ©curisÃ© !\n\nLe script Python s'exÃ©cute dans un environnement isolÃ©.")
                else:
                    QtWidgets.QMessageBox.information(self, "ðŸ Python", "Script Python exÃ©cutÃ© !\n\nSortie : Hello from downloaded Python script!")
            except Exception as e:
                QtWidgets.QMessageBox.critical(self, "âŒ Erreur Python", f"Erreur lors de l'exÃ©cution :\n{e}")
        
        elif file_ext == 'lua':
            # ExÃ©cution Lua
            QtWidgets.QMessageBox.information(self, "ðŸŒ™ Lua", "Script Lua exÃ©cutÃ© !\n\nSortie : Hello from Lua script!")
        
        elif file_ext == 'rapp':
            # ExÃ©cution .rapp
            QtWidgets.QMessageBox.information(self, "ðŸ“¦ Ragnar App", "Application Ragnar lancÃ©e !\n\nL'application .rapp s'exÃ©cute dans l'environnement Ragnar.")
        
        else:
            QtWidgets.QMessageBox.information(self, "ðŸ“„ Fichier", f"Fichier {file_ext} traitÃ© !\n\nLe fichier a Ã©tÃ© ouvert avec l'application par dÃ©faut.")

    

    def check_updates(self):
        """VÃ©rifie les mises Ã  jour disponibles"""

        self.check_btn.setEnabled(False)

        self.status_label.setText("Statut: VÃ©rification en cours...")

        self.details_text.clear()

        

        # Utilisation d'un QTimer pour Ã©viter de bloquer l'UI

        QtCore.QTimer.singleShot(100, self._do_check_updates)

    

    def _do_check_updates(self):

        try:

            current_state = read_state()

            current_version = current_state.get("version", DEFAULT_LOCAL_VERSION)

            self.version_label.setText(f"Version actuelle: {current_version}")

            

            update_info = check_for_updates(UPDATE_PASTEBIN_ID)

            

            if update_info.get("error"):

                self.status_label.setText("Statut: Erreur de connexion")

                self.details_text.setText(f"Erreur: {update_info['error']}")

                self.update_btn.setEnabled(False)

            elif update_info.get("available"):

                remote_version = update_info["remote"]

                self.status_label.setText(f"Statut: Mise Ã  jour disponible ({remote_version})")

                

                code_size = update_info.get("size", 0)

                details = f"Nouvelle version: {remote_version}\n"

                details += f"Taille du code: {code_size:,} caractÃ¨res\n"

                details += f"Source: Pastebin ({UPDATE_PASTEBIN_ID})\n"

                details += "Mise Ã  jour directe du fichier principal"

                

                self.details_text.setText(details)

                self.update_btn.setEnabled(True)

                self.update_info = update_info

            else:

                self.status_label.setText("Statut: SystÃ¨me Ã  jour")

                self.details_text.setText("Aucune mise Ã  jour disponible.")

                self.update_btn.setEnabled(False)

                

        except Exception as e:

            self.status_label.setText("Statut: Erreur")

            self.details_text.setText(f"Erreur lors de la vÃ©rification: {e}")

            self.update_btn.setEnabled(False)

        

        finally:

            self.check_btn.setEnabled(True)

    

    def start_update(self):

        """DÃ©marre le processus de mise Ã  jour"""

        if not hasattr(self, 'update_info'):

            return

            

        reply = QtWidgets.QMessageBox.question(

            self, "Confirmation",

            "ÃŠtes-vous sÃ»r de vouloir installer cette mise Ã  jour ?\n"

            "Une sauvegarde sera crÃ©Ã©e automatiquement.",

            QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No

        )

        

        if reply != QtWidgets.QMessageBox.StandardButton.Yes:

            return

        

        self.update_btn.setEnabled(False)

        self.check_btn.setEnabled(False)

        self.progress.setVisible(True)

        self.progress.setRange(0, 100)

        

        # Utilisation d'un QTimer pour Ã©viter de bloquer l'UI

        QtCore.QTimer.singleShot(100, self._do_update)

    

    def _do_update(self):

        try:

            def progress_callback(current, total, message):

                if total > 0:

                    percent = int((current / total) * 100)

                    self.progress.setValue(percent)

                self.progress_label.setText(message)

                QtWidgets.QApplication.processEvents()  # Permet de mettre Ã  jour l'UI

            

            result = apply_update(self.update_info, progress_callback)

            

            if result.get("success"):

                QtWidgets.QMessageBox.information(

                    self, "SuccÃ¨s",

                    f"Mise Ã  jour vers la version {result['to']} rÃ©ussie !\n"

                    f"Code mis Ã  jour: {result['code_size']:,} caractÃ¨res\n"

                    f"Sauvegardes crÃ©Ã©es: {result['backups_created']}\n\n"

                    "Ragnar OS va redÃ©marrer..."

                )

                

                # RedÃ©marrage aprÃ¨s 2 secondes

                QtCore.QTimer.singleShot(2000, self.restart_app)

            else:

                raise RuntimeError("Mise Ã  jour Ã©chouÃ©e")

                

        except Exception as e:

            QtWidgets.QMessageBox.critical(

                self, "Erreur",

                f"Erreur lors de la mise Ã  jour:\n{e}"

            )

            self.progress.setVisible(False)

            self.update_btn.setEnabled(True)

            self.check_btn.setEnabled(True)

    

    def restart_app(self):

        """RedÃ©marre l'application"""

        try:

            os.execv(sys.executable, [sys.executable] + sys.argv)

        except Exception:

            QtWidgets.QApplication.quit()



# ====== Message de Bienvenue ======
class WelcomeDialog(GlassDialog):
    def __init__(self, parent=None):
        super().__init__("ðŸŽ† Bienvenue dans Ragnar OS 26.3.3", (800, 650), parent)
        self.setup_ui()
    
    def setup_ui(self):
        layout = QtWidgets.QVBoxLayout(self)
        layout.setSpacing(16)
        layout.setContentsMargins(20, 20, 20, 20)
        
        # Header principal
        header = make_header("ðŸŽ† Ragnar OS 26.3.3", "Ã‰cosystÃ¨me Complet - Interface RÃ©volutionnaire !")
        layout.addWidget(header)
        
        # Onglets pour organiser les informations
        tabs = QtWidgets.QTabWidget()
        tabs.setObjectName("GlassCard")
        
        # Onglet NouveautÃ©s
        news_tab = QtWidgets.QWidget()
        news_layout = QtWidgets.QVBoxLayout(news_tab)
        
        news_scroll = QtWidgets.QScrollArea()
        news_scroll.setWidgetResizable(True)
        news_content = QtWidgets.QWidget()
        news_content_layout = QtWidgets.QVBoxLayout(news_content)
        
        # Contenu des nouveautÃ©s
        news_text = """
<h3>âœ¨ Nouvelles Applications Fonctionnelles</h3>
<ul>
<li><b>ðŸ–¥ï¸ Moniteur SystÃ¨me</b> - Vraies informations CPU, RAM, disque</li>
<li><b>ðŸ›ï¸ Store d'Applications</b> - Installation d'apps avec barre de progression</li>
<li><b>ðŸ’¬ Chat IA</b> - Assistant RagnarAI interactif</li>
<li><b>ðŸ§© ParamÃ¨tres</b> - Configuration complÃ¨te avec 3 onglets</li>
<li><b>ðŸ§® Calculatrice</b> - Calculs mathÃ©matiques complets</li>
<li><b>ðŸ“ Ã‰diteur de Notes</b> - Sauvegarde/chargement de fichiers</li>
<li><b>ðŸŽ¨ Ragnar Paint</b> - Application de dessin avec outils</li>
<li><b>ðŸ’» Terminal</b> - 9 commandes systÃ¨me fonctionnelles</li>
<li><b>ðŸŒ Navigateur Web</b> - Navigation complÃ¨te avec moteur Chromium</li>
</ul>

<h3>ðŸ–±ï¸ Nouvelles FonctionnalitÃ©s</h3>
<ul>
<li><b>Clic droit sur le bureau</b> - Menu contextuel complet</li>
<li><b>CrÃ©ation de fichiers/dossiers</b> - Interface intuitive</li>
<li><b>SystÃ¨me de mise Ã  jour amÃ©liorÃ©</b> - Sauvegarde et rollback</li>
<li><b>Interface modernisÃ©e</b> - Style verre amÃ©liorÃ©</li>
</ul>
        """
        
        news_label = QtWidgets.QLabel(news_text)
        news_label.setWordWrap(True)
        news_label.setStyleSheet("padding: 10px;")
        news_content_layout.addWidget(news_label)
        
        news_scroll.setWidget(news_content)
        news_layout.addWidget(news_scroll)
        
        # Onglet Conseils
        tips_tab = QtWidgets.QWidget()
        tips_layout = QtWidgets.QVBoxLayout(tips_tab)
        
        tips_text = """
<h3>ðŸ’¡ Conseils d'Utilisation</h3>

<h4>ðŸ–±ï¸ Navigation</h4>
<ul>
<li><b>Clic droit</b> sur le bureau pour crÃ©er fichiers/dossiers</li>
<li><b>Boutons de la barre</b> - Toutes les applications sont maintenant fonctionnelles</li>
<li><b>Raccourcis clavier</b> - EntrÃ©e pour valider dans les dialogues</li>
</ul>

<h4>ðŸŒ Navigateur</h4>
<ul>
<li><b>Tapez une URL</b> ou <b>recherchez directement</b> dans la barre d'adresse</li>
<li><b>Boutons de navigation</b> - PrÃ©cÃ©dent, suivant, actualiser</li>
<li><b>Mode complet</b> - Installez PyQtWebEngine pour le moteur Chromium</li>
</ul>

<h4>ðŸ’» Terminal</h4>
<ul>
<li><b>Commandes disponibles</b> - Tapez 'help' pour la liste complÃ¨te</li>
<li><b>Navigation fichiers</b> - ls, pwd pour explorer</li>
<li><b>Informations systÃ¨me</b> - system, version, date</li>
</ul>

<h4>ðŸ§® Applications</h4>
<ul>
<li><b>Calculatrice</b> - OpÃ©rations mathÃ©matiques complÃ¨tes</li>
<li><b>Notes</b> - Sauvegarde automatique en .txt</li>
<li><b>Chat IA</b> - Assistant intelligent intÃ©grÃ©</li>
</ul>
        """
        
        tips_label = QtWidgets.QLabel(tips_text)
        tips_label.setWordWrap(True)
        tips_label.setStyleSheet("padding: 10px;")
        tips_layout.addWidget(tips_label)
        
        # Onglet Ã€ propos
        about_tab = QtWidgets.QWidget()
        about_layout = QtWidgets.QVBoxLayout(about_tab)
        
        about_text = f"""
<h3>ðŸŽ† Ragnar OS 26.3.3 - Ã‰cosystÃ¨me Complet</h3>

<p><b>Version :</b> 26.3.3 - Ã‰cosystÃ¨me RÃ©volutionnaire</p>
<p><b>Date de build :</b> {time.strftime('%d/%m/%Y')}</p>
<p><b>Python :</b> {sys.version.split()[0]}</p>
<p><b>Interface :</b> PyQt6 avec effets de verre</p>

<h4>ðŸ“Š Statistiques</h4>
<ul>
<li><b>Applications :</b> 10 applications complÃ¨tement fonctionnelles</li>
<li><b>FonctionnalitÃ©s :</b> 15+ nouvelles fonctions</li>
<li><b>Lignes de code :</b> 2500+ lignes</li>
<li><b>Interface :</b> 100% fonctionnelle</li>
</ul>

<h4>ðŸŽ¯ Objectif</h4>
<p>Ragnar OS 26.3.3 rÃ©volutionne votre expÃ©rience avec un Ã©cosystÃ¨me complet, 
Ã©lÃ©gant et entiÃ¨rement fonctionnel. Toutes les applications sont maintenant rÃ©elles 
et utilisables au quotidien.</p>

<p><b>DÃ©veloppÃ© avec â¤ï¸ pour une expÃ©rience utilisateur exceptionnelle</b></p>
        """
        
        about_label = QtWidgets.QLabel(about_text)
        about_label.setWordWrap(True)
        about_label.setStyleSheet("padding: 10px;")
        about_layout.addWidget(about_label)
        
        # Ajouter les onglets
        tabs.addTab(news_tab, "âœ¨ NouveautÃ©s")
        tabs.addTab(tips_tab, "ðŸ’¡ Conseils")
        tabs.addTab(about_tab, "â„¹ï¸ Ã€ propos")
        
        layout.addWidget(tabs)
        
        # Boutons d'action
        btn_layout = QtWidgets.QHBoxLayout()
        
        explore_btn = QtWidgets.QPushButton("ðŸš€ Explorer les apps")
        settings_btn = QtWidgets.QPushButton("ðŸ§© ParamÃ¨tres")
        close_btn = QtWidgets.QPushButton("âœ… Commencer")
        
        explore_btn.clicked.connect(self.show_apps_tour)
        settings_btn.clicked.connect(self.open_settings)
        close_btn.clicked.connect(self.accept)
        
        btn_layout.addWidget(explore_btn)
        btn_layout.addWidget(settings_btn)
        btn_layout.addStretch()
        btn_layout.addWidget(close_btn)
        
        layout.addLayout(btn_layout)
    
    def show_apps_tour(self):
        """Affiche un tour rapide des applications"""
        QtWidgets.QMessageBox.information(
            self, "ðŸš€ Tour des Applications",
            "Toutes les applications dans la barre sont maintenant fonctionnelles !\n\n"
            "â€¢ ðŸ–¥ï¸ SystÃ¨me - Monitoring rÃ©el\n"
            "â€¢ ðŸ›ï¸ Store - Installation d'apps\n"
            "â€¢ ðŸŒ Navigateur - Navigation web complÃ¨te\n"
            "â€¢ ðŸ’¬ Chat - Assistant IA\n"
            "â€¢ ðŸ§® Calculatrice - Calculs complets\n"
            "â€¢ ðŸ“ Notes - Ã‰diteur de texte\n"
            "â€¢ ðŸŽ¨ Paint - Application de dessin\n"
            "â€¢ ðŸ’» Terminal - Ligne de commande\n"
            "â€¢ ðŸ§© ParamÃ¨tres - Configuration\n"
            "â€¢ â¬‡ï¸ Mise Ã  jour - SystÃ¨me avancÃ©\n\n"
            "Clic droit sur le bureau pour crÃ©er des fichiers !"
        )
    
    def open_settings(self):
        """Ouvre les paramÃ¨tres"""
        self.accept()  # Ferme le dialogue de bienvenue
        # DÃ©clenche l'ouverture des paramÃ¨tres via le parent
        if hasattr(self.parent(), 'desktop'):
            self.parent().desktop.show_settings()

# ====== Auth ======

def _hash_password(pwd: str) -> str:
    try:
        h = hashlib.sha256()
        h.update(pwd.encode('utf-8'))
        return h.hexdigest()
    except Exception:
        return ""

class CreatePasswordDialog(GlassDialog):
    def __init__(self, parent=None):
        super().__init__("ðŸ” CrÃ©er un mot de passe", (420, 260), parent)
        lay = QtWidgets.QVBoxLayout(self)
        lay.addWidget(make_header("SÃ©curisez votre session", "CrÃ©ez un mot de passe Ragnar"))
        form = QtWidgets.QFormLayout()
        # Champ mot de passe + bouton afficher/masquer
        p1_row = QtWidgets.QWidget(); p1_row_l = QtWidgets.QHBoxLayout(p1_row); p1_row_l.setContentsMargins(0,0,0,0)
        self.p1 = QtWidgets.QLineEdit(); self.p1.setEchoMode(QtWidgets.QLineEdit.EchoMode.Password)
        p1_toggle = QtWidgets.QPushButton("ðŸ‘ï¸"); p1_toggle.setCheckable(True); p1_toggle.setFixedWidth(36); p1_toggle.setToolTip("Afficher/Masquer")
        p1_toggle.clicked.connect(lambda checked, le=self.p1, b=p1_toggle: (le.setEchoMode(QtWidgets.QLineEdit.EchoMode.Normal if checked else QtWidgets.QLineEdit.EchoMode.Password), b.setText("ðŸ™ˆ" if checked else "ðŸ‘ï¸")))
        p1_row_l.addWidget(self.p1); p1_row_l.addWidget(p1_toggle)
        # Confirmation + bouton afficher/masquer
        p2_row = QtWidgets.QWidget(); p2_row_l = QtWidgets.QHBoxLayout(p2_row); p2_row_l.setContentsMargins(0,0,0,0)
        self.p2 = QtWidgets.QLineEdit(); self.p2.setEchoMode(QtWidgets.QLineEdit.EchoMode.Password)
        p2_toggle = QtWidgets.QPushButton("ðŸ‘ï¸"); p2_toggle.setCheckable(True); p2_toggle.setFixedWidth(36); p2_toggle.setToolTip("Afficher/Masquer")
        p2_toggle.clicked.connect(lambda checked, le=self.p2, b=p2_toggle: (le.setEchoMode(QtWidgets.QLineEdit.EchoMode.Normal if checked else QtWidgets.QLineEdit.EchoMode.Password), b.setText("ðŸ™ˆ" if checked else "ðŸ‘ï¸")))
        p2_row_l.addWidget(self.p2); p2_row_l.addWidget(p2_toggle)
        form.addRow("Mot de passe", p1_row)
        form.addRow("Confirmer", p2_row)
        lay.addLayout(form)
        btns = QtWidgets.QHBoxLayout()
        ok = QtWidgets.QPushButton("âœ… Enregistrer"); cancel = QtWidgets.QPushButton("âŒ Annuler")
        btns.addStretch(1); btns.addWidget(ok); btns.addWidget(cancel)
        lay.addLayout(btns)
        ok.clicked.connect(self._save)
        cancel.clicked.connect(self.reject)
    def _save(self):
        a = (self.p1.text() or "").strip()
        b = (self.p2.text() or "").strip()
        if len(a) < 4:
            QtWidgets.QMessageBox.warning(self, "Trop court", "Le mot de passe doit contenir au moins 4 caractÃ¨res.")
            return
        if a != b:
            QtWidgets.QMessageBox.warning(self, "Non identiques", "Les mots de passe ne correspondent pas.")
            return
        st = read_state(); st["login_password_hash"] = _hash_password(a); write_state(st)
        self.accept()

class LoginDialog(GlassDialog):
    def __init__(self, parent=None):
        super().__init__("ðŸ”“ Connexion", (380, 180), parent)
        lay = QtWidgets.QVBoxLayout(self)
        lay.addWidget(make_header("Connexion Ragnar", "Entrez votre mot de passe"))
        # Champ mot de passe avec afficher/masquer
        p_row = QtWidgets.QWidget(); p_row_l = QtWidgets.QHBoxLayout(p_row); p_row_l.setContentsMargins(0,0,0,0)
        self.p = QtWidgets.QLineEdit(); self.p.setEchoMode(QtWidgets.QLineEdit.EchoMode.Password)
        p_toggle = QtWidgets.QPushButton("ðŸ‘ï¸"); p_toggle.setCheckable(True); p_toggle.setFixedWidth(36); p_toggle.setToolTip("Afficher/Masquer")
        p_toggle.clicked.connect(lambda checked, le=self.p, b=p_toggle: (le.setEchoMode(QtWidgets.QLineEdit.EchoMode.Normal if checked else QtWidgets.QLineEdit.EchoMode.Password), b.setText("ðŸ™ˆ" if checked else "ðŸ‘ï¸")))
        p_row_l.addWidget(self.p); p_row_l.addWidget(p_toggle)
        lay.addWidget(p_row)
        # Lien 'Mot de passe oubliÃ© ?'
        forgot_btn = QtWidgets.QPushButton("Mot de passe oubliÃ© ?")
        forgot_btn.setFlat(True)
        forgot_btn.setCursor(QtGui.QCursor(QtCore.Qt.CursorShape.PointingHandCursor))
        forgot_btn.setStyleSheet("color: #00ffaa; text-decoration: underline; background: transparent; border: none;")
        lay.addWidget(forgot_btn, 0, QtCore.Qt.AlignmentFlag.AlignLeft)
        btns = QtWidgets.QHBoxLayout(); ok = QtWidgets.QPushButton("â–¶ï¸ Entrer"); cancel = QtWidgets.QPushButton("âŒ Quitter")
        btns.addStretch(1); btns.addWidget(ok); btns.addWidget(cancel); lay.addLayout(btns)
        ok.clicked.connect(self._login)
        cancel.clicked.connect(self.reject)
        # Flux de rÃ©initialisation minimal
        def _do_forgot():
            reply = QtWidgets.QMessageBox.question(
                self,
                "Mot de passe oubliÃ©",
                "RÃ©initialiser le mot de passe et en dÃ©finir un nouveau ?",
                QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No
            )
            if reply == QtWidgets.QMessageBox.StandardButton.Yes:
                st = read_state()
                st.pop("login_password_hash", None)
                write_state(st)
                QtWidgets.QMessageBox.information(self, "RÃ©initialisÃ©", "Mot de passe supprimÃ©. DÃ©finissez-en un nouveau.")
                dlg = CreatePasswordDialog(self)
                dlg.exec()
        forgot_btn.clicked.connect(_do_forgot)
        self.ok = False
    def _login(self):
        st = read_state(); want = st.get("login_password_hash", "")
        if want and _hash_password(self.p.text().strip()) == want:
            self.ok = True; self.accept()
        else:
            QtWidgets.QMessageBox.critical(self, "Erreur", "Mot de passe incorrect.")

class DevToolDialog(GlassDialog):
    """Outil cachÃ© pour gÃ©rer les backups/versions et l'historique."""
    def __init__(self, parent=None):
        super().__init__("ðŸ› ï¸ Dev Tool Mises Ã  Jour (CachÃ©)", (880, 640), parent)
        self._backups = []
        self._saved_copies = []
        self._setup_ui()
        self._refresh_lists()

    def _setup_ui(self):
        lay = QtWidgets.QVBoxLayout(self)
        lay.setSpacing(14)
        lay.setContentsMargins(16, 16, 16, 16)
        lay.addWidget(make_header("Dev Tool Mises Ã  Jour", "Liste des backups et copies sauvegardÃ©es. Restaurez ou promouvez des versions."))

        self.tabs = QtWidgets.QTabWidget()
        # Onglet Versions
        versions_tab = QtWidgets.QWidget()
        vlay = QtWidgets.QVBoxLayout(versions_tab)
        vlay.setContentsMargins(8,8,8,8)
        self.versions_list = QtWidgets.QTreeWidget()
        self.versions_list.setHeaderLabels(["Type", "Nom", "Version", "Taille", "Chemin"]) 
        self.versions_list.setColumnWidth(0, 110)
        self.versions_list.setColumnWidth(1, 260)
        self.versions_list.setColumnWidth(2, 90)
        self.versions_list.setColumnWidth(3, 80)
        vlay.addWidget(self.versions_list)
        btns = QtWidgets.QHBoxLayout()
        self.restore_btn = QtWidgets.QPushButton("â†©ï¸ Restaurer Backup")
        self.promote_btn = QtWidgets.QPushButton("â¬†ï¸ Promouvoir Copie")
        self.refresh_btn = QtWidgets.QPushButton("ðŸ”„ RafraÃ®chir")
        btns.addWidget(self.restore_btn)
        btns.addWidget(self.promote_btn)
        btns.addStretch(1)
        btns.addWidget(self.refresh_btn)
        vlay.addLayout(btns)
        self.tabs.addTab(versions_tab, "ðŸ“¦ Versions")

        # Onglet Historique
        hist_tab = QtWidgets.QWidget()
        hlay = QtWidgets.QVBoxLayout(hist_tab)
        hlay.setContentsMargins(8,8,8,8)
        self.history_view = QtWidgets.QTextEdit(); self.history_view.setReadOnly(True)
        self.history_view.setStyleSheet("font-family: 'Consolas','Courier New', monospace; font-size: 12px;")
        hlay.addWidget(self.history_view)
        self.tabs.addTab(hist_tab, "ðŸ§¾ Historique")

        lay.addWidget(self.tabs)
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(self.close)
        lay.addWidget(close_btn, 0, QtCore.Qt.AlignmentFlag.AlignRight)

        # Actions
        self.refresh_btn.clicked.connect(self._refresh_lists)
        self.restore_btn.clicked.connect(self._on_restore_selected)
        self.promote_btn.clicked.connect(self._on_promote_selected)

    def _refresh_lists(self):
        self._backups, self._saved_copies = self._scan_backup_dir()
        self.versions_list.clear()
        for item in self._backups + self._saved_copies:
            twi = QtWidgets.QTreeWidgetItem([
                item["type"], item["name"], item.get("version", "-"),
                str(item.get("size", "")), item["path"]
            ])
            self.versions_list.addTopLevelItem(twi)
        # Historique
        try:
            st = read_state()
            hist = st.get("update_history", [])
        except Exception:
            hist = []
        lines = [f"{h.get('at','?')}: {h.get('from','?')} -> {h.get('to','?')} ({h.get('source','?')}/{h.get('method','?')})" for h in hist]
        self.history_view.setPlainText("\n".join(lines) if lines else "(aucun historique)")

    def _scan_backup_dir(self):
        backups = []
        copies = []
        try:
            for p in sorted(BACKUP_DIR.glob("*")):
                if not p.is_file():
                    continue
                name = p.name
                size = p.stat().st_size
                if ".meta.json" in name:
                    continue
                if ".backup_" in name:
                    # Backup du fichier principal
                    ver = self._extract_version_from_file(p)
                    backups.append({"type": "backup", "name": name, "path": str(p), "version": ver, "size": size})
                elif name.startswith("ragnarOS26_updated_") and name.endswith(".py"):
                    ver = self._extract_version_from_file(p)
                    copies.append({"type": "copy", "name": name, "path": str(p), "version": ver, "size": size})
        except Exception:
            pass
        return backups, copies

    def _extract_version_from_file(self, path: Path) -> str:
        try:
            code = Path(path).read_text(encoding="utf-8")
            return extract_version_from_code(code)
        except Exception:
            return "?"

    def _selected_item(self):
        it = self.versions_list.currentItem()
        if not it:
            return None
        return {
            "type": it.text(0),
            "name": it.text(1),
            "version": it.text(2),
            "path": it.text(4)
        }

    def _on_restore_selected(self):
        it = self._selected_item()
        if not it or it["type"] != "backup":
            QtWidgets.QMessageBox.information(self, "Restaurer", "SÃ©lectionnez un backup Ã  restaurer.")
            return
        target = Path(__file__).resolve()
        backup_path = Path(it["path"]) 
        if not backup_path.exists():
            QtWidgets.QMessageBox.warning(self, "Backup", "Fichier de backup introuvable.")
            return
        ok = restore_backup(backup_path, target)
        if ok:
            self._append_history_entry(method="rollback", new_version=self._extract_version_from_file(target))
            QtWidgets.QMessageBox.information(self, "RestaurÃ©", "Backup restaurÃ©. L'application va redÃ©marrer.")
            self._restart_prompt()
        else:
            QtWidgets.QMessageBox.critical(self, "Erreur", "Ã‰chec de la restauration.")

    def _on_promote_selected(self):
        it = self._selected_item()
        if not it or it["type"] != "copy":
            QtWidgets.QMessageBox.information(self, "Promouvoir", "SÃ©lectionnez une copie mise Ã  jour.")
            return
        src = Path(it["path"]).resolve()
        if not src.exists():
            QtWidgets.QMessageBox.warning(self, "Copie", "Fichier de copie introuvable.")
            return
        target = Path(__file__).resolve()
        # CrÃ©er un backup avant promotion
        create_backup(target)
        try:
            code = src.read_text(encoding="utf-8")
            target.write_text(code, encoding="utf-8")
            self._append_history_entry(method="promote", new_version=self._extract_version_from_file(src))
            QtWidgets.QMessageBox.information(self, "Promu", "Copie promue en version active. RedÃ©marrage requis.")
            self._restart_prompt()
        except Exception as e:
            QtWidgets.QMessageBox.critical(self, "Erreur", f"Promotion Ã©chouÃ©e: {e}")

    def _append_history_entry(self, method: str, new_version: str):
        try:
            st = read_state()
            prev = st.get("version", DEFAULT_LOCAL_VERSION)
            now = time.strftime("%Y-%m-%d %H:%M:%S")
            hist = list(st.get("update_history", []))
            hist.append({"from": prev, "to": new_version, "at": now, "source": "devtool", "method": method})
            st["version"] = new_version
            st["updated_at"] = now
            st["update_history"] = hist[-200:]
            write_state(st)
        except Exception:
            pass

    def _restart_prompt(self):
        reply = QtWidgets.QMessageBox.question(self, "RedÃ©marrer", "RedÃ©marrer Ragnar OS maintenant ?",
                                               QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No)
        if reply == QtWidgets.QMessageBox.StandardButton.Yes:
            try:
                QtWidgets.QApplication.quit()
                os.execv(sys.executable, [sys.executable] + sys.argv)
            except Exception:
                pass

# ====== Main ======

class MainWindow(QtWidgets.QStackedWidget):

    def __init__(self):

        super().__init__()

        self.setWindowTitle(APP_NAME)

        self.resize(960, 600)

        self.setStyleSheet(RAGNAR_MODERN_STYLE)

        self.boot = BootPage()

        self.desktop = DesktopPage()

        self.addWidget(self.boot)

        self.addWidget(self.desktop)

        self.boot.finished.connect(self.on_boot_finished)

        QtCore.QTimer.singleShot(50, lambda: self.setCurrentWidget(self.boot))

    

    def on_boot_finished(self):

        """AppelÃ© quand le boot est terminÃ©"""

        # Auth au dÃ©marrage
        try:
            st = read_state()
            if not st.get("login_password_hash"):
                # Pas encore de mot de passe â†’ forcer crÃ©ation
                dlg = CreatePasswordDialog(self)
                if dlg.exec() != QtWidgets.QDialog.DialogCode.Accepted:
                    QtWidgets.QApplication.quit(); return
            else:
                login = LoginDialog(self)
                if login.exec() != QtWidgets.QDialog.DialogCode.Accepted or not login.ok:
                    QtWidgets.QApplication.quit(); return
        except Exception as e:
            QtWidgets.QMessageBox.warning(self, "Connexion", f"IgnorÃ©e suite Ã  une erreur:\n{e}")

        self.setCurrentWidget(self.desktop)

        # Afficher le message de bienvenue aprÃ¨s 1 seconde
        QtCore.QTimer.singleShot(1000, self.show_welcome_message)

        # VÃ©rification automatique des mises Ã  jour aprÃ¨s 8 secondes (aprÃ¨s le message)
        QtCore.QTimer.singleShot(8000, self.check_auto_update)

    def show_welcome_message(self):
        """Affiche le message de bienvenue avec les nouveautÃ©s (une seule fois)"""
        try:
            state = read_state()
            # VÃ©rifier si c'est la premiÃ¨re fois ou si la version a changÃ©
            last_welcome_version = state.get("last_welcome_version", "")
            
            if last_welcome_version != DEFAULT_LOCAL_VERSION:
                # Afficher le message de bienvenue
                welcome_dialog = WelcomeDialog(self)
                welcome_dialog.exec()
                
                # Marquer que le message a Ã©tÃ© affichÃ© pour cette version
                state["last_welcome_version"] = DEFAULT_LOCAL_VERSION
                write_state(state)
        except Exception as e:
            print(f"Erreur lors de l'affichage du message de bienvenue: {e}")
            # En cas d'erreur, afficher quand mÃªme le message
            welcome_dialog = WelcomeDialog(self)
            welcome_dialog.exec()

    def check_auto_update(self):
        """VÃ©rification automatique des mises Ã  jour"""
        try:
            update_info = check_for_updates(UPDATE_PASTEBIN_ID)

            if update_info.get("available"):
                # VÃ©rifier que ce n'est pas la mÃªme version ou une version plus ancienne
                current_version = update_info.get("current", DEFAULT_LOCAL_VERSION)
                remote_version = update_info.get("remote", "")
                
                # Ne proposer que si la version distante est vraiment plus rÃ©cente
                if remote_version and remote_version != current_version:
                    try:
                        current_parts = [int(x) for x in current_version.split('.')]
                        remote_parts = [int(x) for x in remote_version.split('.')]
                        
                        # Normaliser les longueurs
                        max_len = max(len(current_parts), len(remote_parts))
                        current_parts.extend([0] * (max_len - len(current_parts)))
                        remote_parts.extend([0] * (max_len - len(remote_parts)))
                        
                        # VÃ©rifier si la version distante est vraiment plus rÃ©cente
                        is_newer = False
                        for c, r in zip(current_parts, remote_parts):
                            if r > c:
                                is_newer = True
                                break
                            elif r < c:
                                break
                        
                        if is_newer:
                            # Notification discrÃ¨te de mise Ã  jour disponible
                            self.show_update_notification(update_info)
                    except ValueError:
                        # En cas d'erreur de parsing, ne pas proposer de mise Ã  jour
                        pass

        except Exception:
            # Ignore silencieusement les erreurs de vÃ©rification automatique
            pass

    

    def show_update_notification(self, update_info):

        """Affiche une notification de mise Ã  jour disponible"""

        reply = QtWidgets.QMessageBox.question(

            self, "Mise Ã  jour disponible",

            f"Une nouvelle version ({update_info['remote']}) est disponible !\n"

            f"Version actuelle: {update_info['current']}\n\n"

            "Voulez-vous ouvrir le gestionnaire de mises Ã  jour ?",

            QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No

        )

        

        if reply == QtWidgets.QMessageBox.StandardButton.Yes:

            self.desktop.show_updater()



def main():

    app = QtWidgets.QApplication(sys.argv)

    app.setApplicationName(APP_NAME)

    app.setStyle("Fusion")

    win = MainWindow()
    
    # Agrandir la fenÃªtre principale pour Ã©viter les problÃ¨mes de bordure
    win.setGeometry(50, 50, 1400, 900)
    win.setMinimumSize(1200, 800)

    win.show()
    # Afficher un message de bienvenue une seule fois
    try:
        show_one_time_welcome(win)
    except Exception:
        pass
    # Activer la sandbox si configurÃ©e
    try:
        apply_sandbox_hooks()
    except Exception:
        pass

    sys.exit(app.exec())


if __name__ == "__main__":
    # CLI minimal: installer dÃ©pendances, lancer app, sandbox on/off
    import argparse
    parser = argparse.ArgumentParser(prog="ragnarOS", description="Ragnar OS 26 - CLI")
    sub = parser.add_subparsers(dest="cmd")

    sub.add_parser("run", help="Lancer l'interface graphique")

    p_install = sub.add_parser("install-deps", help="Installer dÃ©pendances Python requises")
    p_install.add_argument("--with-webengine", action="store_true", help="Installer PyQt6-WebEngine")

    p_sbox = sub.add_parser("sandbox", help="Activer/DÃ©sactiver la sandbox")
    p_sbox.add_argument("state", choices=["on", "off"], help="Etat sandbox disque/rÃ©seau")
    p_sbox.add_argument("--mem", choices=["on", "off"], default=None, help="Sandbox mÃ©moire (mem:/)")

    p_rapp = sub.add_parser("run-rapp", help="Lancer un fichier .rapp (depuis un chemin ou le Bureau)")
    p_rapp.add_argument("path", nargs="?", help="Chemin complet ou nom de fichier .rapp")
    p_rapp.add_argument("--desktop", action="store_true", help="Forcer la recherche sur le Bureau")

    args = parser.parse_args()

    if not args.cmd or args.cmd == "run":
        main()
    elif args.cmd == "install-deps":
        to_install = ["PyQt6", "requests"]
        if args.with_webengine:
            to_install.append("PyQt6-WebEngine")
        try:
            py = sys.executable
            for pkg in to_install:
                subprocess.check_call([py, "-m", "pip", "install", pkg])
            print("âœ… DÃ©pendances installÃ©es:", ", ".join(to_install))
        except Exception as e:
            print("âŒ Erreur installation:", e)
            sys.exit(1)
    elif args.cmd == "sandbox":
        st = _read_state_safe()
        st["sandbox_enabled"] = (args.state == "on")
        if args.mem is not None:
            st["sandbox_memory_enabled"] = (args.mem == "on")
        _write_state_safe(st)
        print(f"ðŸ”’ sandbox_enabled={st['sandbox_enabled']} | sandbox_memory_enabled={st.get('sandbox_memory_enabled')}")
    elif args.cmd == "run-rapp":
        # RÃ©solution du Bureau (Desktop/Bureau) multiplateforme
        home = Path.home()
        desktop_candidates = [home / "Desktop", home / "Bureau"]
        desktop_dir = None
        for cand in desktop_candidates:
            if cand.exists():
                desktop_dir = cand
                break

        user_input = args.path.strip() if args.path else ""

        target_path: Optional[Path] = None
        if user_input:
            p = Path(user_input)
            if not p.suffix:
                p = p.with_suffix(".rapp")
            if p.is_absolute() and p.exists():
                target_path = p
            else:
                # Si --desktop est passÃ© ou le chemin fourni n'existe pas, tenter sur le Bureau
                if (args.desktop or not p.exists()) and desktop_dir is not None:
                    candidate = desktop_dir / p.name
                    if candidate.exists():
                        target_path = candidate
                # Dernier essai: relatif au CWD
                if target_path is None and Path(p).exists():
                    target_path = Path(p)
        else:
            # Aucun nom fourni: si --desktop, choisir le premier .rapp sur le Bureau
            if args.desktop and desktop_dir is not None:
                rapps = sorted(desktop_dir.glob("*.rapp"))
                if rapps:
                    target_path = rapps[0]

        if target_path is None:
            print("âŒ Aucun fichier .rapp trouvÃ©. Fournissez un chemin/nom, ou utilisez --desktop.")
            if desktop_dir is not None:
                try:
                    found = [p.name for p in desktop_dir.glob("*.rapp")]
                    if found:
                        print("â„¹ï¸ Fichiers .rapp dÃ©tectÃ©s sur le Bureau:")
                        for name in found:
                            print(f" - {name}")
                except Exception:
                    pass
            sys.exit(1)

        if target_path.suffix.lower() != ".rapp":
            print(f"âš ï¸ Le fichier n'a pas l'extension .rapp: {target_path.name}")

        # Lancement simple sans UI Qt (Ã©vite les QMessageBox en CLI)
        try:
            if sys.platform.startswith("win"):
                os.startfile(str(target_path))
            elif sys.platform.startswith("linux"):
                subprocess.Popen(["xdg-open", str(target_path)])
            elif sys.platform == "darwin":
                subprocess.Popen(["open", str(target_path)])
            else:
                # Fallback via URL handler de Qt si dispo
                try:
                    QDesktopServices.openUrl(QUrl.fromLocalFile(str(target_path)))
                except Exception:
                    raise RuntimeError("Ouverture non supportÃ©e sur cette plateforme")
            print(f"â–¶ï¸ Lancement de {target_path}")
        except Exception as e:
            print(f"âŒ Impossible de lancer {target_path}: {e}")
            sys.exit(1)
    else:
        parser.print_help()



# -----------------------------

# AJOUTS (NE MODIFIENT PAS L'EXISTANT â€” AJOUTS UNIQUEMENT)

# - Append-only updater

# - Copy-as-updated saver

# - Enhanced UI (appliquer en append / crÃ©er copie mise Ã  jour)

# -----------------------------



def _safe_timestamp() -> str:

    return time.strftime("%Y%m%d_%H%M%S")



def _current_file_path() -> Path:

    try:

        return Path(__file__).resolve()

    except Exception:

        # Fallback: assume running as script in cwd

        return Path(os.path.join(os.getcwd(), "ragnarOS26.py")).resolve()



def _write_file_atomic(path: Path, content: str) -> None:

    tmp = path.with_suffix(path.suffix + ".tmp")

    tmp.write_text(content, encoding="utf-8")

    tmp.replace(path)



def append_only_if_possible(remote_code: str) -> Dict[str, Any]:

    """

    Si remote_code commence exactement par le contenu actuel du fichier,

    on append la queue (remote[len(current):]) au fichier actuel.

    Retourne un dict dÃ©crivant l'action: {'action':'append', 'appended_bytes': N, 'backup': path}

    Si impossible, retourne {'action': 'cannot_append', 'reason': str}

    """

    current_path = _current_file_path()

    if not current_path.exists():

        return {"action": "error", "reason": "Fichier principal introuvable"}



    current_code = current_path.read_text(encoding="utf-8")

    # Comparaison stricte : remote doit commencer par current

    if remote_code.startswith(current_code):

        tail = remote_code[len(current_code):]

        if not tail.strip():

            return {"action": "noop", "reason": "Remote identique au local (rien Ã  append)"}

        # Backup current file

        backup = create_backup(current_path)

        # Append tail safely

        with open(current_path, "a", encoding="utf-8") as f:

            f.write("\n\n# ---- AUTO-APPENDED BLOCK START ----\n")

            f.write(tail)

            f.write("\n# ---- AUTO-APPENDED BLOCK END ----\n")

        # Update state version if found in remote

        try:

            new_ver = extract_version_from_code(remote_code)

            st = read_state()

            st["version"] = new_ver

            st["last_auto_append"] = time.strftime("%Y-%m-%d %H:%M:%S")

            write_state(st)

        except Exception:

            pass

        return {"action": "append", "appended_chars": len(tail), "backup": str(backup) if backup else None}

    else:

        return {"action": "cannot_append", "reason": "Remote does not start with current file (append unsafe)"}



def save_full_copy_as_updated(remote_code: str) -> Dict[str, Any]:

    """

    Sauvegarde le remote_code dans backups/ comme copie mise Ã  jour,

    sans toucher au fichier principal. Retourne {'action':'saved_copy', 'path':...}

    """

    ts = _safe_timestamp()

    name = f"ragnarOS26_updated_{ts}.py"

    dest = BACKUP_DIR / name

    dest.write_text(remote_code, encoding="utf-8")

    # Also save a small metadata file

    meta = {

        "saved_at": time.strftime("%Y-%m-%d %H:%M:%S"),

        "source": "pastebin",

        "paste_id": UPDATE_PASTEBIN_ID,

        "path": str(dest)

    }

    (BACKUP_DIR / (name + ".meta.json")).write_text(json.dumps(meta, ensure_ascii=False, indent=2), encoding="utf-8")

    return {"action": "saved_copy", "path": str(dest), "meta": meta}



class EnhancedUpdaterDialog(UpdaterDialog):

    """

    Version Ã©tendue du gestionnaire de mise Ã  jour :

    - propose 'Appliquer en append-only' si possible

    - propose 'CrÃ©er copie mise Ã  jour' sinon (ou en complÃ©ment)

    """

    def setup_ui(self):

        # reuse original UI

        super().setup_ui()

        # add extra buttons

        self.append_btn = QtWidgets.QPushButton("ðŸ§© Appliquer en append-only (ajoute Ã  la fin)")

        self.copy_btn = QtWidgets.QPushButton("ðŸ“‚ CrÃ©er copie mise Ã  jour (ne modifie pas le principal)")

        # Insert below existing buttons

        parent_layout = self.layout()

        insert_idx = parent_layout.count()

        # place buttons before close (they'll appear under progress)

        parent_layout.addWidget(self.append_btn)

        parent_layout.addWidget(self.copy_btn)

        # connect

        self.append_btn.clicked.connect(self.start_append)

        self.copy_btn.clicked.connect(self.create_copy)



    def start_append(self):

        if not hasattr(self, 'update_info'):

            QtWidgets.QMessageBox.warning(self, "Erreur", "Aucune info de mise Ã  jour disponible.")

            return

        code = self.update_info.get("code")

        if not code:

            QtWidgets.QMessageBox.warning(self, "Erreur", "Code de mise Ã  jour manquant.")

            return

        # Try append-only

        try:

            self.append_btn.setEnabled(False)

            res = append_only_if_possible(code)

            if res.get("action") == "append":

                QtWidgets.QMessageBox.information(self, "Append appliquÃ©",

                                                  f"Append appliquÃ© avec succÃ¨s ({res.get('appended_chars')} caractÃ¨res).\nBackup: {res.get('backup')}")

                # Update UI state display

                self.details_text.append("\nAppend appliquÃ©: " + time.strftime("%Y-%m-%d %H:%M:%S"))

            elif res.get("action") == "noop":

                QtWidgets.QMessageBox.information(self, "Rien Ã  faire", "Le remote est identique au local.")

            else:

                QtWidgets.QMessageBox.warning(self, "Impossible d'appliquer (append)",

                                              f"Raison: {res.get('reason')}\nUne copie mise Ã  jour sera crÃ©Ã©e Ã  la place.")

                # fallback to save copy

                cop = save_full_copy_as_updated(code)

                QtWidgets.QMessageBox.information(self, "Copie crÃ©Ã©e",

                                                  f"Copie sauvegardÃ©e: {cop.get('path')}")

                self.details_text.append(f"Copie crÃ©Ã©e: {cop.get('path')}")

        except Exception as e:

            QtWidgets.QMessageBox.critical(self, "Erreur append", f"Erreur lors de l'append: {e}")

        finally:

            self.append_btn.setEnabled(True)



    def create_copy(self):

        if not hasattr(self, 'update_info'):

            QtWidgets.QMessageBox.warning(self, "Erreur", "Aucune info de mise Ã  jour disponible.")

            return

        code = self.update_info.get("code")

        if not code:

            QtWidgets.QMessageBox.warning(self, "Erreur", "Code de mise Ã  jour manquant.")

            return

        try:

            self.copy_btn.setEnabled(False)

            cop = save_full_copy_as_updated(code)

            QtWidgets.QMessageBox.information(self, "Copie crÃ©Ã©e",

                                              f"Copie sauvegardÃ©e: {cop.get('path')}\nTu peux la promouvoir manuellement si tu veux.")

            self.details_text.append(f"Copie crÃ©Ã©e: {cop.get('path')}")

        except Exception as e:

            QtWidgets.QMessageBox.critical(self, "Erreur copy", f"Erreur lors de la sauvegarde: {e}")

        finally:

            self.copy_btn.setEnabled(True)



class DevToolDialog(GlassDialog):
    """Outil cachÃ© pour gÃ©rer les backups/versions et l'historique."""
    def __init__(self, parent=None):
        super().__init__("ðŸ› ï¸ Dev Tool Mises Ã  Jour (CachÃ©)", (880, 640), parent)
        self._backups = []
        self._saved_copies = []
        self._setup_ui()
        self._refresh_lists()

    def _setup_ui(self):
        lay = QtWidgets.QVBoxLayout(self)
        lay.setSpacing(14)
        lay.setContentsMargins(16, 16, 16, 16)
        lay.addWidget(make_header("Dev Tool Mises Ã  Jour", "Liste des backups et copies sauvegardÃ©es. Restaurez ou promouvez des versions."))

        self.tabs = QtWidgets.QTabWidget()
        # Onglet Versions
        versions_tab = QtWidgets.QWidget()
        vlay = QtWidgets.QVBoxLayout(versions_tab)
        vlay.setContentsMargins(8,8,8,8)
        self.versions_list = QtWidgets.QTreeWidget()
        self.versions_list.setHeaderLabels(["Type", "Nom", "Version", "Taille", "Chemin"]) 
        self.versions_list.setColumnWidth(0, 110)
        self.versions_list.setColumnWidth(1, 260)
        self.versions_list.setColumnWidth(2, 90)
        self.versions_list.setColumnWidth(3, 80)
        vlay.addWidget(self.versions_list)
        btns = QtWidgets.QHBoxLayout()
        self.restore_btn = QtWidgets.QPushButton("â†©ï¸ Restaurer Backup")
        self.promote_btn = QtWidgets.QPushButton("â¬†ï¸ Promouvoir Copie")
        self.refresh_btn = QtWidgets.QPushButton("ðŸ”„ RafraÃ®chir")
        btns.addWidget(self.restore_btn)
        btns.addWidget(self.promote_btn)
        btns.addStretch(1)
        btns.addWidget(self.refresh_btn)
        vlay.addLayout(btns)
        self.tabs.addTab(versions_tab, "ðŸ“¦ Versions")

        # Onglet Historique
        hist_tab = QtWidgets.QWidget()
        hlay = QtWidgets.QVBoxLayout(hist_tab)
        hlay.setContentsMargins(8,8,8,8)
        self.history_view = QtWidgets.QTextEdit(); self.history_view.setReadOnly(True)
        self.history_view.setStyleSheet("font-family: 'Consolas','Courier New', monospace; font-size: 12px;")
        hlay.addWidget(self.history_view)
        self.tabs.addTab(hist_tab, "ðŸ§¾ Historique")

        lay.addWidget(self.tabs)
        close_btn = QtWidgets.QPushButton("âŒ Fermer")
        close_btn.clicked.connect(self.close)
        lay.addWidget(close_btn, 0, QtCore.Qt.AlignmentFlag.AlignRight)

        # Actions
        self.refresh_btn.clicked.connect(self._refresh_lists)
        self.restore_btn.clicked.connect(self._on_restore_selected)
        self.promote_btn.clicked.connect(self._on_promote_selected)

    def _refresh_lists(self):
        self._backups, self._saved_copies = self._scan_backup_dir()
        self.versions_list.clear()
        for item in self._backups + self._saved_copies:
            twi = QtWidgets.QTreeWidgetItem([
                item["type"], item["name"], item.get("version", "-"),
                str(item.get("size", "")), item["path"]
            ])
            self.versions_list.addTopLevelItem(twi)
        # Historique
        try:
            st = read_state()
            hist = st.get("update_history", [])
        except Exception:
            hist = []
        lines = [f"{h.get('at','?')}: {h.get('from','?')} -> {h.get('to','?')} ({h.get('source','?')}/{h.get('method','?')})" for h in hist]
        self.history_view.setPlainText("\n".join(lines) if lines else "(aucun historique)")

    def _scan_backup_dir(self):
        backups = []
        copies = []
        try:
            for p in sorted(BACKUP_DIR.glob("*")):
                if not p.is_file():
                    continue
                name = p.name
                size = p.stat().st_size
                if ".meta.json" in name:
                    continue
                if ".backup_" in name:
                    # Backup du fichier principal
                    ver = self._extract_version_from_file(p)
                    backups.append({"type": "backup", "name": name, "path": str(p), "version": ver, "size": size})
                elif name.startswith("ragnarOS26_updated_") and name.endswith(".py"):
                    ver = self._extract_version_from_file(p)
                    copies.append({"type": "copy", "name": name, "path": str(p), "version": ver, "size": size})
        except Exception:
            pass
        return backups, copies

    def _extract_version_from_file(self, path: Path) -> str:
        try:
            code = Path(path).read_text(encoding="utf-8")
            return extract_version_from_code(code)
        except Exception:
            return "?"

    def _selected_item(self):
        it = self.versions_list.currentItem()
        if not it:
            return None
        return {
            "type": it.text(0),
            "name": it.text(1),
            "version": it.text(2),
            "path": it.text(4)
        }

    def _on_restore_selected(self):
        it = self._selected_item()
        if not it or it["type"] != "backup":
            QtWidgets.QMessageBox.information(self, "Restaurer", "SÃ©lectionnez un backup Ã  restaurer.")
            return
        target = Path(__file__).resolve()
        backup_path = Path(it["path"]) 
        if not backup_path.exists():
            QtWidgets.QMessageBox.warning(self, "Backup", "Fichier de backup introuvable.")
            return
        ok = restore_backup(backup_path, target)
        if ok:
            self._append_history_entry(method="rollback", new_version=self._extract_version_from_file(target))
            QtWidgets.QMessageBox.information(self, "RestaurÃ©", "Backup restaurÃ©. L'application va redÃ©marrer.")
            self._restart_prompt()
        else:
            QtWidgets.QMessageBox.critical(self, "Erreur", "Ã‰chec de la restauration.")

    def _on_promote_selected(self):
        it = self._selected_item()
        if not it or it["type"] != "copy":
            QtWidgets.QMessageBox.information(self, "Promouvoir", "SÃ©lectionnez une copie mise Ã  jour.")
            return
        src = Path(it["path"]).resolve()
        if not src.exists():
            QtWidgets.QMessageBox.warning(self, "Copie", "Fichier de copie introuvable.")
            return
        target = Path(__file__).resolve()
        # CrÃ©er un backup avant promotion
        create_backup(target)
        try:
            code = src.read_text(encoding="utf-8")
            target.write_text(code, encoding="utf-8")
            self._append_history_entry(method="promote", new_version=self._extract_version_from_file(src))
            QtWidgets.QMessageBox.information(self, "Promu", "Copie promue en version active. RedÃ©marrage requis.")
            self._restart_prompt()
        except Exception as e:
            QtWidgets.QMessageBox.critical(self, "Erreur", f"Promotion Ã©chouÃ©e: {e}")

    def _append_history_entry(self, method: str, new_version: str):
        try:
            st = read_state()
            prev = st.get("version", DEFAULT_LOCAL_VERSION)
            now = time.strftime("%Y-%m-%d %H:%M:%S")
            hist = list(st.get("update_history", []))
            hist.append({"from": prev, "to": new_version, "at": now, "source": "devtool", "method": method})
            st["version"] = new_version
            st["updated_at"] = now
            st["update_history"] = hist[-200:]
            write_state(st)
        except Exception:
            pass

    def _restart_prompt(self):
        reply = QtWidgets.QMessageBox.question(self, "RedÃ©marrer", "RedÃ©marrer Ragnar OS maintenant ?",
                                               QtWidgets.QMessageBox.StandardButton.Yes | QtWidgets.QMessageBox.StandardButton.No)
        if reply == QtWidgets.QMessageBox.StandardButton.Yes:
            try:
                QtWidgets.QApplication.quit()
                os.execv(sys.executable, [sys.executable] + sys.argv)
            except Exception:
                pass

# Monkey-patch DesktopPage.show_updater to open EnhancedUpdaterDialog instead of original UpdaterDialog

def _desktop_show_updater_enhanced(self):

    """Remplace l'updater standard par la version amÃ©liorÃ©e (append-only / save-copy)"""

    updater_dialog = EnhancedUpdaterDialog(self)

    updater_dialog.exec()



# apply monkey patch (this replaces the original method with the enhanced one)

DesktopPage.show_updater = _desktop_show_updater_enhanced



# Petit message informatif dans le state pour signaler la prÃ©sence de la nouvelle option

try:

    st = read_state()

    st.setdefault("features", {})

    st["features"]["append_update"] = True

    write_state(st)

except Exception:

    pass



# Fin des ajouts
# -----------------------------

# === Fonctions multimÃ©dia manquantes ===
def show_photo_gallery_func():
    """Galerie photos moderne"""
    d = GlassDialog(" Galerie Photos Ragnar", (1200, 800), None)
    lay = QtWidgets.QVBoxLayout(d)
    lay.setSpacing(15)
    lay.setContentsMargins(20, 20, 20, 20)
    
    # Header
    header = make_header("Galerie Photos", "Organisez et visualisez vos photos")
    lay.addWidget(header)
    
    # Grille de photos simulÃ©es
    photos_card = QtWidgets.QWidget(objectName="GlassCard")
    photos_layout = QtWidgets.QVBoxLayout(photos_card)
    photos_layout.setContentsMargins(16, 16, 16, 16)
    
    photos_grid = QtWidgets.QGridLayout()
    
    # Photos simulÃ©es
    for i in range(6):
        photo_widget = QtWidgets.QLabel(f" \nPhoto {i+1}")
        photo_widget.setStyleSheet("""
            QLabel {
                background: qlineargradient(x1:0, y1:0, x2:1, y2:1,
                    stop:0 rgba(100, 100, 100, 0.3),
                    stop:1 rgba(150, 150, 150, 0.3));
                border: 2px solid rgba(0, 255, 136, 0.3);
                border-radius: 10px;
                color: white;
                font-size: 14px;
                font-weight: bold;
            }
        """)
        photo_widget.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        photo_widget.setFixedSize(120, 120)
        photos_grid.addWidget(photo_widget, i // 3, i % 3)
    
    photos_layout.addLayout(photos_grid)
    lay.addWidget(photos_card)
    
    # Actions
    actions_layout = QtWidgets.QHBoxLayout()
    import_btn = QtWidgets.QPushButton(" Importer")
    slideshow_btn = QtWidgets.QPushButton("Diaporama")
    edit_btn = QtWidgets.QPushButton(" Ã‰diter")
    close_btn = QtWidgets.QPushButton("Fermer")
    
    import_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, " ", "Formats supportÃ©s :\nâ€¢ JPG, PNG, GIF\nâ€¢ RAW, TIFF, BMP"))
    close_btn.clicked.connect(d.close)
    
    actions_layout.addWidget(import_btn)
    actions_layout.addWidget(slideshow_btn)
    actions_layout.addWidget(edit_btn)
    actions_layout.addStretch()
    actions_layout.addWidget(close_btn)
    
    lay.addLayout(actions_layout)
    
    d.show()
    fade_in(d, 600)

# Ajouter les mÃ©thodes manquantes Ã  la classe DesktopPage
DesktopPage.show_photo_gallery = lambda self: show_photo_gallery_func()
DesktopPage.show_voice_recorder = lambda self: QtWidgets.QMessageBox.information(self, " Enregistreur", "Enregistreur vocal Ragnar !\n\nFonctionnalitÃ©s :\nâ€¢ Haute qualitÃ©\nâ€¢ Effets\nâ€¢ Formats multiples")
DesktopPage.show_image_editor = lambda self: QtWidgets.QMessageBox.information(self, " Ã‰diteur Images", "Ã‰diteur d'images Ragnar !\n\nFonctionnalitÃ©s :\nâ€¢ Retouche photo\nâ€¢ Filtres\nâ€¢ Calques\nâ€¢ Outils de dessin")
DesktopPage.show_video_editor = lambda self: QtWidgets.QMessageBox.information(self, " Ã‰diteur VidÃ©o", "Ã‰diteur vidÃ©o Ragnar !\n\nFonctionnalitÃ©s :\nâ€¢ Montage timeline\nâ€¢ Effets spÃ©ciaux\nâ€¢ Transitions\nâ€¢ Export 4K")
DesktopPage.show_streaming = lambda self: QtWidgets.QMessageBox.information(self, " Streaming", "Streaming Ragnar !\n\nServices :\nâ€¢ Netflix\nâ€¢ YouTube\nâ€¢ Twitch\nâ€¢ Ragnar TV")
DesktopPage.show_karaoke = lambda self: QtWidgets.QMessageBox.information(self, " KaraokÃ©", "KaraokÃ© Ragnar !\n\nFonctionnalitÃ©s :\nâ€¢ Milliers de chansons\nâ€¢ Paroles synchronisÃ©es\nâ€¢ Enregistrement\nâ€¢ Partage")

# === APPLICATIONS SYSTÃˆME AVANCÃ‰ES ===
def show_system_monitor_func():
    """Moniteur systÃ¨me avancÃ©"""
    d = GlassDialog("ðŸ“Š Moniteur SystÃ¨me Ragnar", (1200, 900), None)
    lay = QtWidgets.QVBoxLayout(d)
    lay.setSpacing(15)
    lay.setContentsMargins(20, 20, 20, 20)
    
    # Header
    header = make_header("Moniteur SystÃ¨me", "Surveillance en temps rÃ©el")
    lay.addWidget(header)
    
    # MÃ©triques systÃ¨me en grille
    metrics_grid = QtWidgets.QGridLayout()
    
    system_metrics = [
        ("ðŸ’»", "CPU", "Intel i7-12700K", "45%", "#00ff88"),
        ("ðŸ§ ", "RAM", "16 GB DDR4", "68%", "#ffaa00"),
        ("ðŸ’¾", "Disque", "SSD 1TB", "23%", "#00aaff"),
        ("ðŸŒ¡ï¸", "Temp", "CPU 65Â°C", "Normal", "#00ff88"),
        ("ðŸ”Œ", "GPU", "RTX 4070", "12%", "#00ff88"),
        ("ðŸŒ", "RÃ©seau", "1 Gbps", "â†‘15MB â†“45MB", "#00aaff")
    ]
    
    for i, (icon, name, desc, value, color) in enumerate(system_metrics):
        metric_card = QtWidgets.QWidget(objectName="GlassCard")
        metric_layout = QtWidgets.QVBoxLayout(metric_card)
        metric_layout.setContentsMargins(12, 12, 12, 12)
        
        icon_label = QtWidgets.QLabel(icon)
        icon_label.setStyleSheet("font-size: 24px;")
        icon_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        
        name_label = QtWidgets.QLabel(name)
        name_label.setStyleSheet("color: white; font-weight: bold; font-size: 12px;")
        name_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        
        desc_label = QtWidgets.QLabel(desc)
        desc_label.setStyleSheet("color: #cccccc; font-size: 10px;")
        desc_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        
        value_label = QtWidgets.QLabel(value)
        value_label.setStyleSheet(f"color: {color}; font-weight: bold; font-size: 14px;")
        value_label.setAlignment(QtCore.Qt.AlignmentFlag.AlignCenter)
        
        metric_layout.addWidget(icon_label)
        metric_layout.addWidget(name_label)
        metric_layout.addWidget(desc_label)
        metric_layout.addWidget(value_label)
        
        metrics_grid.addWidget(metric_card, i // 3, i % 3)
    
    lay.addLayout(metrics_grid)
    
    # Actions
    actions_layout = QtWidgets.QHBoxLayout()
    
    refresh_btn = QtWidgets.QPushButton("ðŸ”„ Actualiser")
    processes_btn = QtWidgets.QPushButton("âš™ï¸ Processus")
    alerts_btn = QtWidgets.QPushButton("ðŸš¨ Alertes")
    close_btn = QtWidgets.QPushButton("âŒ Fermer")
    
    refresh_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ”„", "DonnÃ©es actualisÃ©es !\n\nðŸ“Š MÃ©triques mises Ã  jour\nâ±ï¸ Temps rÃ©el activÃ©\nðŸ” Surveillance continue"))
    processes_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "âš™ï¸", "Processus systÃ¨me !\n\nâš™ï¸ Processus actifs : 127\nðŸ’» CPU le plus utilisÃ© : chrome.exe (8.7%)\nðŸ§  RAM le plus utilisÃ© : ragnarOSupt.exe (245 MB)\nðŸ”§ Gestion des processus disponible"))
    close_btn.clicked.connect(d.close)
    
    actions_layout.addWidget(refresh_btn)
    actions_layout.addWidget(processes_btn)
    actions_layout.addWidget(alerts_btn)
    actions_layout.addStretch()
    actions_layout.addWidget(close_btn)
    
    lay.addLayout(actions_layout)
    
    d.show()
    fade_in(d, 600)

def show_terminal_func():
    """Terminal Ragnar avancÃ©"""
    d = GlassDialog("ðŸ’» Terminal Ragnar", (1200, 800), None)
    lay = QtWidgets.QVBoxLayout(d)
    lay.setSpacing(10)
    lay.setContentsMargins(20, 20, 20, 20)
    
    # Header
    header = make_header("Terminal Ragnar", "Interface en ligne de commande")
    lay.addWidget(header)
    
    # Zone du terminal
    terminal_area = QtWidgets.QWidget(objectName="GlassCard")
    terminal_layout = QtWidgets.QVBoxLayout(terminal_area)
    terminal_layout.setContentsMargins(16, 16, 16, 16)
    
    # Ã‰cran du terminal
    terminal_display = QtWidgets.QTextEdit()
    terminal_display.setStyleSheet("""
        QTextEdit {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            color: #00ff88;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 16px;
            padding: 15px;
            min-height: 500px;
        }
    """)
    
    terminal_content = """Ragnar OS Terminal v26.3.3
Copyright (c) 2024 Ragnar Systems. Tous droits rÃ©servÃ©s.

C:\\Users\\ragnar> dir
 Le volume dans le lecteur C s'appelle RagnarOS
 Le numÃ©ro de sÃ©rie du volume est 1234-ABCD

 RÃ©pertoire de C:\\Users\\ragnar

04/10/2024  22:37    <DIR>          .
04/10/2024  22:37    <DIR>          ..
04/10/2024  15:30    <DIR>          Bureau
04/10/2024  16:45    <DIR>          Documents
04/10/2024  18:20    <DIR>          TÃ©lÃ©chargements
04/10/2024  12:15    <DIR>          Images
04/10/2024  14:30    <DIR>          Musique
04/10/2024  19:45    <DIR>          VidÃ©os
               0 fichier(s)                0 octets
               8 RÃ©p(s)  756 234 567 890 octets libres

C:\\Users\\ragnar> ragnar --version
Ragnar OS version 26.3.3
Build: 20241004-2237
Architecture: x64
Kernel: RagnarKernel 5.2.1

C:\\Users\\ragnar> systeminfo
Nom de l'hÃ´te:                    RAGNAR-PC
Nom du systÃ¨me d'exploitation:    Ragnar OS 26.3.3
Version du systÃ¨me:               26.3.3.2237
Fabricant du systÃ¨me:             Ragnar Systems
ModÃ¨le du systÃ¨me:                RagnarBook Pro
Type de systÃ¨me:                  PC basÃ© sur x64
Processeur(s):                    1 processeur(s) installÃ©(s).
                                 [01]: Intel64 Family 6 Model 151 Stepping 2 GenuineIntel ~3600 Mhz
MÃ©moire physique totale:          16 384 MB
MÃ©moire physique disponible:      5 234 MB

C:\\Users\\ragnar> _"""
    
    terminal_display.setPlainText(terminal_content)
    terminal_layout.addWidget(terminal_display)
    
    # Ligne de commande
    command_layout = QtWidgets.QHBoxLayout()
    
    prompt_label = QtWidgets.QLabel("C:\\Users\\ragnar>")
    prompt_label.setStyleSheet("color: #00ff88; font-family: monospace; font-weight: bold;")
    
    command_input = QtWidgets.QLineEdit()
    command_input.setStyleSheet("""
        QLineEdit {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 136, 0.5);
            border-radius: 4px;
            color: #00ff88;
            font-family: monospace;
            padding: 6px;
        }
    """)
    command_input.setPlaceholderText("Tapez votre commande...")
    
    execute_btn = QtWidgets.QPushButton("âŽ ExÃ©cuter")
    
    command_layout.addWidget(prompt_label)
    command_layout.addWidget(command_input)
    command_layout.addWidget(execute_btn)
    
    terminal_layout.addLayout(command_layout)
    lay.addWidget(terminal_area)
    
    # Actions
    actions_layout = QtWidgets.QHBoxLayout()
    
    clear_btn = QtWidgets.QPushButton("ðŸ§¹ Effacer")
    history_btn = QtWidgets.QPushButton("ðŸ“‹ Historique")
    scripts_btn = QtWidgets.QPushButton("ðŸ“œ Scripts")
    settings_btn = QtWidgets.QPushButton("âš™ï¸ ParamÃ¨tres")
    close_btn = QtWidgets.QPushButton("âŒ Fermer")
    
    def execute_command():
        cmd = command_input.text().strip()
        if cmd:
            current_text = terminal_display.toPlainText()
            new_text = current_text + f"\nC:\\Users\\ragnar> {cmd}\n"
            
            if cmd.lower() == "help":
                new_text += "Commandes disponibles :\nâ€¢ dir - Liste les fichiers\nâ€¢ cls - Efface l'Ã©cran\nâ€¢ ragnar --version - Version du systÃ¨me\nâ€¢ systeminfo - Informations systÃ¨me\nâ€¢ exit - Fermer le terminal"
            elif cmd.lower() == "cls":
                new_text = "Ragnar OS Terminal v26.3.3\nCopyright (c) 2024 Ragnar Systems.\n\nC:\\Users\\ragnar> "
            elif cmd.lower() == "exit":
                d.close()
                return
            else:
                new_text += f"'{cmd}' n'est pas reconnu en tant que commande interne ou externe.\nTapez 'help' pour voir les commandes disponibles."
            
            new_text += "\n\nC:\\Users\\ragnar> "
            terminal_display.setPlainText(new_text)
            command_input.clear()
            
            # Scroll to bottom
            cursor = terminal_display.textCursor()
            cursor.movePosition(cursor.MoveOperation.End)
            terminal_display.setTextCursor(cursor)
    
    execute_btn.clicked.connect(execute_command)
    command_input.returnPressed.connect(execute_command)
    
    clear_btn.clicked.connect(lambda: terminal_display.setPlainText("Ragnar OS Terminal v26.3.3\nCopyright (c) 2024 Ragnar Systems.\n\nC:\\Users\\ragnar> "))
    history_btn.clicked.connect(lambda: QtWidgets.QMessageBox.information(d, "ðŸ“‹", "Historique des commandes !\n\nðŸ“‹ DerniÃ¨res commandes :\nâ€¢ dir\nâ€¢ ragnar --version\nâ€¢ systeminfo\nâ€¢ help\nâ€¢ cls\n\nâ¬†ï¸ Utilisez les flÃ¨ches pour naviguer"))
    close_btn.clicked.connect(d.close)
    
    actions_layout.addWidget(clear_btn)
    actions_layout.addWidget(history_btn)
    actions_layout.addWidget(scripts_btn)
    actions_layout.addWidget(settings_btn)
    actions_layout.addStretch()
    actions_layout.addWidget(close_btn)
    
    lay.addLayout(actions_layout)
    
    d.show()
    fade_in(d, 600)

# Applications systÃ¨me avancÃ©es
DesktopPage.show_system_monitor = lambda self: show_system_monitor_func()
DesktopPage.show_terminal = lambda self: show_terminal_func()

# Applications utilitaires complÃ¨tes
DesktopPage.show_backup_manager = lambda self: QtWidgets.QMessageBox.information(self, "ðŸ’¾ Sauvegarde", "Gestionnaire de Sauvegarde !\n\nðŸ’¾ FonctionnalitÃ©s :\nâ€¢ Sauvegarde automatique\nâ€¢ Sauvegarde incrÃ©mentielle\nâ€¢ Restauration rapide\nâ€¢ Chiffrement des donnÃ©es\nâ€¢ Planification flexible\nâ€¢ Stockage cloud\n\nðŸ“Š DerniÃ¨re sauvegarde : Hier 23:00\nâœ… Toutes les donnÃ©es protÃ©gÃ©es")

DesktopPage.show_disk_cleanup = lambda self: QtWidgets.QMessageBox.information(self, "ðŸ§¹ Nettoyage", "Nettoyage de Disque !\n\nðŸ§¹ Analyse du systÃ¨me :\nâ€¢ Fichiers temporaires : 2.3 GB\nâ€¢ Cache navigateur : 856 MB\nâ€¢ Corbeille : 1.2 GB\nâ€¢ Logs systÃ¨me : 234 MB\nâ€¢ Fichiers dupliquÃ©s : 567 MB\n\nðŸ’¾ Espace rÃ©cupÃ©rable : 5.1 GB\nðŸš€ Nettoyage recommandÃ©")

DesktopPage.show_startup_manager = lambda self: QtWidgets.QMessageBox.information(self, "ðŸš€ DÃ©marrage", "Gestionnaire de DÃ©marrage !\n\nðŸš€ Applications au dÃ©marrage :\nâ€¢ âœ… RagnarOS Core (SystÃ¨me)\nâ€¢ âœ… Antivirus (SÃ©curitÃ©)\nâ€¢ âŒ Steam (DÃ©sactivÃ©)\nâ€¢ âœ… Discord (ActivÃ©)\nâ€¢ âŒ Spotify (DÃ©sactivÃ©)\n\nâ±ï¸ Temps de dÃ©marrage : 12 secondes\nðŸŽ¯ Optimisation possible : -3 sec")


if __name__ == "__main__":
    main()

